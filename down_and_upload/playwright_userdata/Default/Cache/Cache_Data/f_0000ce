/*! For license information please see 37103.27432c42.js.LICENSE.txt */
(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["37103"],{237681:function(t){var e,n;e=window,n=function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e||4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,(function(e){return t[e]}).bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=5)}([function(t,e,n){"use strict";function i(t,e){return t.classList?Array.prototype.some.call(t.classList,function(t){return t===e}):!!t.className.match(RegExp("(\\s|^)"+e+"(\\s|$)"))}function o(t,e){t.classList?e.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(e){e&&t.classList.add(e)}):i(t,e)||(t.className+=" "+e)}function r(t,e){t.classList?e.split(/\s+/g).forEach(function(e){t.classList.remove(e)}):i(t,e)&&e.split(/\s+/g).forEach(function(e){var n=RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")})}function a(t){return Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]}Object.defineProperty(e,"__esModule",{value:!0}),e.createDom=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=document.createElement(t);return o.className=i,o.innerHTML=e,Object.keys(n).forEach(function(e){var i=n[e];"video"===t||"audio"===t?i&&o.setAttribute(e,i):o.setAttribute(e,i)}),o},e.hasClass=i,e.addClass=o,e.removeClass=r,e.toggleClass=function(t,e){e.split(/\s+/g).forEach(function(e){i(t,e)?r(t,e):o(t,e)})},e.findDom=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,e=arguments[1],n=void 0;try{n=t.querySelector(e)}catch(i){e.startsWith("#")&&(n=t.getElementById(e.slice(1)))}return n},e.deepCopy=function t(e,n){if("Object"===a(n)&&"Object"===a(e))return Object.keys(n).forEach(function(i){"Object"!==a(n[i])||n[i]instanceof Node?"Array"===a(n[i])?e[i]="Array"===a(e[i])?e[i].concat(n[i]):n[i]:e[i]=n[i]:e[i]?t(e[i],n[i]):e[i]=n[i]}),e},e.typeOf=a,e.copyDom=function(t){if(t&&1===t.nodeType){var e=document.createElement(t.tagName);return Array.prototype.forEach.call(t.attributes,function(t){e.setAttribute(t.name,t.value)}),t.innerHTML&&(e.innerHTML=t.innerHTML),e}return""},e.attachEventListener=function(t,e,n,i){i?(t.on(e,n),function(t,e,n,i){t.once(i,function o(){t.off(e,n),t.off(i,o)})}(t,e,n,i)):t.on(e,function i(o){n(o),t.off(e,i)})},e.styleUtil=function(t,e,n){if(t){var i=t.style;try{i[e]=n}catch(t){i.setProperty(e,n)}}},e.styleCSSText=function(t,e){var n=t.style;try{n.cssText=e}catch(t){}},e.isNumber=function(t){return"number"==typeof t&&!Number.isNaN(t)},e.isFunction=function(t){return"function"==typeof t},e.throttle=function(t,e){var n=this,i=0;return function(){for(var o=arguments.length,r=Array(o),a=0;a<o;a++)r[a]=arguments[a];clearTimeout(i),i=setTimeout(function(){return t.apply(n,r)},e)}},e.hasOwnProperty=Object.prototype.hasOwnProperty,e.getTimeStamp=function(){return"undefined"!=typeof window&&window.performance&&"function"==typeof window.performance.now?performance.now():Date.now()}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(4),r=o&&o.__esModule?o:{default:o},a=function(){function t(){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,t)}return i(t,[{key:"setLogger",value:function(t){this.logger=t instanceof r.default?t:new r.default((t||"")+".js")}}]),t}();e.default=a,t.exports=e.default},function(t,e,n){"use strict";var i=n(19)();t.exports=function(t){return t!==i&&null!==t}},function(t,e,n){"use strict";t.exports=function(t){return null!=t}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o="undefined"!=typeof window&&window.location.href.indexOf("danmu-debug")>-1,r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,t),this.constructorName=e||""}return i(t,[{key:"info",value:function(t){for(var e,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];o&&(e=console).log.apply(e,["[Danmu Log]["+this.constructorName+"]",t].concat(i))}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6),o=i&&i.__esModule?i:{default:i};n(34),e.default=o.default,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DanmuJs=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=h(n(7)),r=n(26),a=h(n(1)),s=h(n(27)),l=h(n(32)),u=n(33),c=n(0);function h(t){return t&&t.__esModule?t:{default:t}}function f(t,e){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&("object"==typeof e||"function"==typeof e)?e:t}var d=e.DanmuJs=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e);var n=f(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));n.setLogger("danmu"),n.logger&&n.logger.info("danmu.js version: "+r.version);var i=n.config={overlap:!1,area:{start:0,end:1,lines:void 0},hooks:void 0,live:!1,comments:[],direction:"r2l",needResizeObserver:!1,dropStaleComments:!1,channelSize:void 0,maxCommentsLength:void 0,bulletOffset:void 0,interval:2e3,highScorePriority:!0,chaseEffect:!0};if((0,c.deepCopy)(i,t),(0,o.default)(n),n.globalHooks={},i.hooks&&n.hooks(i.hooks),n.hideArr=[],n.recycler=new l.default,n.getBoundingCounts=0,n.danmuElCreateCounts=0,n.readDataTimes=-1,n.attachTimes=-1,n.startMoveTimes=-1,n.freezeId=null,i.comments.forEach(function(t){t.duration=t.duration?t.duration:5e3,t.mode||(t.mode="scroll")}),n.container=i.container&&1===i.container.nodeType?i.container:null,!n.container)return n.emit("error","container id can't be empty"),f(n,!1);if(i.containerStyle){var a=i.containerStyle;Object.keys(a).forEach(function(t){n.container.style[t]=a[t]})}return(0,c.addClass)(n.container,"danmu"),n.live=i.live,n.player=i.player,n.direction=i.direction,n.bulletBtn=new s.default(n),n.main=n.bulletBtn.main,n.isReady=!0,n.emit("ready"),n.logger&&n.logger.info("ready"),n.addResizeObserver(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"updateGetBoundingCounts",value:function(t){void 0!==this.getBoundingCounts&&("number"==typeof t?this.getBoundingCounts=t:this.getBoundingCounts++)}},{key:"updateDanmuElCreateCounts",value:function(t){void 0!==this.danmuElCreateCounts&&("number"==typeof t?this.danmuElCreateCounts=t:this.danmuElCreateCounts++)}},{key:"updateReadDataTimes",value:function(){this.readDataTimes<0&&(this.readDataTimes=(0,c.getTimeStamp)())}},{key:"updateAttachTimes",value:function(){this.attachTimes<0&&(this.attachTimes=(0,c.getTimeStamp)())}},{key:"updateStartMoveTimes",value:function(){this.startMoveTimes<0&&(this.startMoveTimes=(0,c.getTimeStamp)())}},{key:"hooks",value:function(t){(0,c.deepCopy)(this.globalHooks,t)}},{key:"addResizeObserver",value:function(){var t=this;this.config.needResizeObserver&&this.container&&(0,u.addObserver)(this.container,function(){t.logger&&t.logger.info("needResizeObserver"),t.resize()})}},{key:"start",value:function(){this.logger&&this.logger.info("start"),this.main&&this.main.start()}},{key:"pause",value:function(){this.logger&&this.logger.info("pause"),this.main&&this.main.pause()}},{key:"play",value:function(){this.logger&&this.logger.info("play"),this.main&&this.main.play()}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),this.main&&this.main.stop()}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.main&&this.main.clear()}},{key:"destroy",value:function(){for(var t in(0,u.unObserver)(this.container),this.logger&&this.logger.info("destroy"),this.stop(),this.bulletBtn&&this.bulletBtn.destroy(),this.recycler&&this.recycler.destroy(),this)delete this[t];this.emit("destroy")}},{key:"sendComment",value:function(t){var e=this.main,n=this.logger;n&&n.info("sendComment: "+(t.txt||"[DOM Element]")),e&&(t.duration||(t.duration=15e3),t&&t.id&&t.duration&&(t.el||t.elLazyInit||t.txt)&&(t.duration=t.duration?t.duration:5e3,t.style||(t.style={opacity:void 0,fontSize:void 0}),t.style&&(this.opacity&&this.opacity!==t.style.opacity&&(t.style.opacity=this.opacity),this.fontSize&&this.fontSize!==t.style.fontSize&&(t.style.fontSize=this.fontSize)),t.prior||t.realTime?(e.data.unshift(t),t.realTime&&(this.config&&this.config.trackAllocationOptimization?e.readDataV1():(e.readData(),e.dataHandle()))):e.data.push(t),e.sortData(),e.keepPoolWatermark()))}},{key:"setCommentID",value:function(t,e){var n=this;this.logger&&this.logger.info("setCommentID: oldID "+t+" newID "+e),t&&e&&(this.main.data.some(function(n){return n.id===t&&(n.id=e,!0)}),this.main.queue.some(function(i){return i.id===t&&(i.id=e,i.pauseMove(),"paused"!==n.main.status&&i.startMove(),!0)}))}},{key:"setCommentDuration",value:function(t,e){var n=this;this.logger&&this.logger.info("setCommentDuration: id "+t+" duration "+e),t&&e&&(e=e||5e3,this.main.data.some(function(n){return n.id===t&&(n.duration=e,!0)}),this.main.queue.some(function(i){return i.id===t&&(i.duration=e,i.pauseMove(),"paused"!==n.main.status&&i.startMove(),!0)}))}},{key:"setCommentLike",value:function(t,e){this.logger&&this.logger.info("setCommentLike: id "+t+" like "+e),t&&e&&(this.main.data.some(function(n){return n.id===t&&(n.like=e,!0)}),this.main.queue.some(function(n){return n.id===t&&(n.pauseMove(),n.setLikeDom(e.el,e.style),"paused"!==n.danmu.main.status&&n.startMove(),!0)}))}},{key:"restartComment",value:function(t){if(this.logger&&this.logger.info("restartComment: id "+t),t){var e=this.main;this._releaseCtrl(t),"closed"!==e.status&&e.queue.some(function(n){return n.id===t&&("paused"!==e.status?n.startMove(!0):n.status="paused",!0)})}}},{key:"_releaseCtrl",value:function(t){this.freezeId&&t===this.freezeId&&(this.mouseControl=!1,this.freezeId=null)}},{key:"_freezeCtrl",value:function(t){this.mouseControl=!0,this.freezeId=t}},{key:"freezeComment",value:function(t){this.logger&&this.logger.info("freezeComment: id "+t),t&&(this._freezeCtrl(t),this.main.queue.some(function(e){return e.id===t&&(e.status="forcedPause",e.pauseMove(),e.el&&e.el.style&&(0,c.styleUtil)(e.el,"zIndex",10),!0)}))}},{key:"removeComment",value:function(t){if(this.logger&&this.logger.info("removeComment: id "+t),t){var e=this.main;this._releaseCtrl(t),e.queue=e.queue.filter(function(e){return e.id!==t||(e.remove(),!1)}),e.data=e.data.filter(function(e){return e.id!==t})}}},{key:"updateComments",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this.logger&&this.logger.info("updateComments: "+t.length+", isClear "+e);var n=this.main;"boolean"==typeof e&&e&&(n.data=[]),n.data||(n.data=[]),n.data=n.data.concat(t),n.sortData(),n.keepPoolWatermark()}},{key:"setAllDuration",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",e=this,n=arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this.logger&&this.logger.info("setAllDuration: mode "+t+" duration "+n+" force "+i),n&&(n=n||5e3,i&&(this.main.forceDuration=n),this.main.data.forEach(function(e){t===e.mode&&(e.duration=n)}),this.main.queue.forEach(function(i){t===i.mode&&(i.duration=n,i.pauseMove(),"paused"!==e.main.status&&i.startMove())}))}},{key:"setPlayRate",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",n=arguments[1];this.logger&&this.logger.info("setPlayRate: "+n),(0,c.isNumber)(n)&&n>0&&(this.main.playRate=n,this.main.queue.forEach(function(n){e===n.mode&&(n.pauseMove(),"paused"!==t.main.status&&n.startMove())}))}},{key:"setOpacity",value:function(t){this.logger&&this.logger.info("setOpacity: opacity "+t),this.container&&(this.container.style.opacity=t)}},{key:"setFontSize",value:function(t,e,n){this.config&&this.config.trackAllocationOptimization?this.setFontSizeV1(t,e,n):this.setFontSizeV0(t,e,n)}},{key:"setFontSizeV0",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{reflow:!0};this.logger&&this.logger.info("setFontSize: size "+t+" channelSize "+e),this.fontSize=t+"px",t&&(this.main.data.forEach(function(t){t.style&&(t.style.fontSize=n.fontSize)}),this.main.queue.forEach(function(t){t.options.style||(t.options.style={}),t.options.style.fontSize=n.fontSize,t.setFontSize(n.fontSize),e&&(t.top=t.channel_id[0]*e,t.topInit())})),e&&(this.config.channelSize=e,i.reflow&&this.main.channel.resizeSync())}},{key:"setFontSizeV1",value:function(t,e){var n=this;if(t&&this.fontSize!==t+"px"){if(this.fontSize||this.fontSizeItem!==t+"px"){this.fontSize=t+"px",this.main.data.forEach(function(t){t.style&&(t.style.fontSize=n.fontSize)});for(var i=this.main.queue,o=0,r=0;r<i.length&&o<1e3;o++){var a=i.findIndex(function(t){return t.el&&t.el.style&&t.el.style.fontSize!==n.fontSize}),s=i[r=a>=0?a:0];if(r>=i.length||a<0)break;s.options.style||(s.options.style={}),s.options.style.fontSize=this.fontSize,s.setFontSize(this.fontSize),s.top=s.channelId*e,s.topInit(),s.pauseMove()}this.config.channelSize=e,this.updateQueueTimestamp(),this.main&&this.main.channel&&this.main.channel.updateChannlState&&this.main.channel.updateChannlState(e)}else this.fontSize=this.fontSizeItem}}},{key:"updateQueueTimestamp",value:function(){if(this.main.channel&&this.main.channel.channels&&this.main.channel.channels){var t="paused"!==this.main.status,e=this.main.channel||{},n=e.containerLeft,i=e.containerRight;this.main.channel.channels.forEach(function(e){if(e&&e.queue&&e.queue.scroll&&0!==e.queue.scroll.length)for(var o=e.queue.scroll,r=o.length,a=(0,c.getTimeStamp)(),s=r-1;s>=0;s--){var l=o[s];if(l&&l.el){l.recalculate=!0,l.waitTimeStamp=0;var u=o[s+1],h=l.updatePosition();if(h.right<n)l.remove(!1);else if(u){var f=u.fullLeaveTime-a,d=Math.max(n+(u.fullLeaveTime-a)*u.moveVV1,h.left),p=(d-n)/l.moveVV1,m=d+Math.max(f-p,0)*l.moveVV1;m!==h.left&&(0,c.styleUtil)(l.el,"left",m+"px");var v=m+h.width,g=v/l.moveVV1;l.fullLeaveTime=a+g,t&&(l.fullEnterTime=v>i?a+(v-i)/l.moveVV1:-1,(0,c.styleUtil)(l.el,"transition","transform "+g/1e3+"s linear 0s"),(0,c.styleUtil)(l.el,"transform","translateX(-"+v+"px) translateZ(0px)"),l.status="start")}else{var y=h.right-n,b=y/l.moveVV1;l.fullLeaveTime=a+b,t&&(l.fullEnterTime=h.right>i?a+(h.right-i)/l.moveVV1:-1,(0,c.styleUtil)(l.el,"transition","transform "+b/1e3+"s linear 0s"),(0,c.styleUtil)(l.el,"transform","translateX(-"+y+"px)"),l.status="start")}}}})}}},{key:"setArea",value:function(t,e,n){this.config&&this.config.trackAllocationOptimization?this.setAreaV1(t,e,n):this.setAreaV0(t,e,n)}},{key:"setAreaV0",value:function(t){this.logger&&this.logger.info("setArea: area "+t),this.config.area=t,!1!==t.reflow&&this.main.channel.resizeSync()}},{key:"setAreaV1",value:function(t){this.config.area=t,this.main&&this.main.channel&&this.main.channel.updateChannlState&&this.main.channel.updateChannlState()}},{key:"hide",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("hide: mode "+t),0>this.hideArr.indexOf(t)&&this.hideArr.push(t),this.main.queue.filter(function(e){return t===e.mode||"color"===t&&e.color}).forEach(function(t){return t.remove()})}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";this.logger&&this.logger.info("show: mode "+t);var e=this.hideArr.indexOf(t);e>-1&&this.hideArr.splice(e,1)}},{key:"setDirection",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"r2l";this.logger&&this.logger.info("setDirection: direction "+t),this.direction=t,this.emit("changeDirection",t)}},{key:"resize",value:function(){this.logger&&this.logger.info("resize"),this.emit("channel_resize")}},{key:"status",get:function(){return this.main?this.main.status:"destroy"}},{key:"state",get:function(){var t=this.main;return{status:t.status,comments:t.data,bullets:t.queue,displayArea:t.channel.getRealOccupyArea()}}},{key:"containerPos",get:function(){return this.main.channel.containerPos}}]),e}(a.default);e.default=d},function(t,e,n){"use strict";var i,o,r,a,s,l,u,c=n(8),h=n(25),f=Function.prototype.apply,d=Function.prototype.call,p=Object.create,m=Object.defineProperty,v=Object.defineProperties,g=Object.prototype.hasOwnProperty,y={configurable:!0,enumerable:!1,writable:!0};o=function(t,e){var n,o;return h(e),o=this,i.call(this,t,n=function(){r.call(o,t,n),f.call(e,this,arguments)}),n.__eeOnceListener__=e,this},s={on:i=function(t,e){var n;return h(e),g.call(this,"__ee__")?n=this.__ee__:(n=y.value=p(null),m(this,"__ee__",y),y.value=null),n[t]?"object"==typeof n[t]?n[t].push(e):n[t]=[n[t],e]:n[t]=e,this},once:o,off:r=function(t,e){var n,i,o,r;if(h(e),!g.call(this,"__ee__")||!(n=this.__ee__)[t])return this;if("object"==typeof(i=n[t]))for(r=0;o=i[r];++r)o!==e&&o.__eeOnceListener__!==e||(2===i.length?n[t]=i[r?0:1]:i.splice(r,1));else i!==e&&i.__eeOnceListener__!==e||delete n[t];return this},emit:a=function(t){var e,n,i,o,r;if(g.call(this,"__ee__")&&(o=this.__ee__[t])){if("object"==typeof o){for(n=arguments.length,r=Array(n-1),e=1;e<n;++e)r[e-1]=arguments[e];for(o=o.slice(),e=0;i=o[e];++e)f.call(i,this,r)}else switch(arguments.length){case 1:d.call(o,this);break;case 2:d.call(o,this,arguments[1]);break;case 3:d.call(o,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,r=Array(n-1),e=1;e<n;++e)r[e-1]=arguments[e];f.call(o,this,r)}}}},u=v({},l={on:c(i),once:c(o),off:c(r),emit:c(a)}),t.exports=e=function(t){return null==t?p(u):v(Object(t),l)},e.methods=s},function(t,e,n){"use strict";var i=n(3),o=n(9),r=n(13),a=n(21),s=n(22);(t.exports=function(t,e){var n,o,l,u,c;return arguments.length<2||"string"!=typeof t?(u=e,e=t,t=null):u=arguments[2],i(t)?(n=s.call(t,"c"),o=s.call(t,"e"),l=s.call(t,"w")):(n=l=!0,o=!1),c={value:e,configurable:n,enumerable:o,writable:l},u?r(a(u),c):c}).gs=function(t,e,n){var l,u,c,h;return"string"!=typeof t?(c=n,n=e,e=t,t=null):c=arguments[3],i(e)?o(e)?i(n)?o(n)||(c=n,n=void 0):n=void 0:(c=e,e=n=void 0):e=void 0,i(t)?(l=s.call(t,"c"),u=s.call(t,"e")):(l=!0,u=!1),h={get:e,set:n,configurable:l,enumerable:u},c?r(a(c),h):h}},function(t,e,n){"use strict";var i=n(10),o=/^\s*class[\s{/}]/,r=Function.prototype.toString;t.exports=function(t){return!!i(t)&&!o.test(r.call(t))}},function(t,e,n){"use strict";var i=n(11);t.exports=function(t){if("function"!=typeof t||!hasOwnProperty.call(t,"length"))return!1;try{if("number"!=typeof t.length||"function"!=typeof t.call||"function"!=typeof t.apply)return!1}catch(t){return!1}return!i(t)}},function(t,e,n){"use strict";var i=n(12);t.exports=function(t){if(!i(t))return!1;try{return!!t.constructor&&t.constructor.prototype===t}catch(t){return!1}}},function(t,e,n){"use strict";var i=n(3),o={object:!0,function:!0,undefined:!0};t.exports=function(t){return!!i(t)&&hasOwnProperty.call(o,typeof t)}},function(t,e,n){"use strict";t.exports=n(14)()?Object.assign:n(15)},function(t,e,n){"use strict";t.exports=function(){var t,e=Object.assign;return"function"==typeof e&&(e(t={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),t.foo+t.bar+t.trzy==="razdwatrzy")}},function(t,e,n){"use strict";var i=n(16),o=n(20),r=Math.max;t.exports=function(t,e){var n,a,s,l=r(arguments.length,2);for(t=Object(o(t)),s=function(i){try{t[i]=e[i]}catch(t){n||(n=t)}},a=1;a<l;++a)i(e=arguments[a]).forEach(s);if(void 0!==n)throw n;return t}},function(t,e,n){"use strict";t.exports=n(17)()?Object.keys:n(18)},function(t,e,n){"use strict";t.exports=function(){try{return Object.keys("primitive"),!0}catch(t){return!1}}},function(t,e,n){"use strict";var i=n(2),o=Object.keys;t.exports=function(t){return o(i(t)?Object(t):t)}},function(t,e,n){"use strict";t.exports=function(){}},function(t,e,n){"use strict";var i=n(2);t.exports=function(t){if(!i(t))throw TypeError("Cannot use null or undefined");return t}},function(t,e,n){"use strict";var i=n(2),o=Array.prototype.forEach,r=Object.create,a=function(t,e){var n;for(n in t)e[n]=t[n]};t.exports=function(t){var e=r(null);return o.call(arguments,function(t){i(t)&&a(Object(t),e)}),e}},function(t,e,n){"use strict";t.exports=n(23)()?String.prototype.contains:n(24)},function(t,e,n){"use strict";var i="razdwatrzy";t.exports=function(){return"function"==typeof i.contains&&!0===i.contains("dwa")&&!1===i.contains("foo")}},function(t,e,n){"use strict";var i=String.prototype.indexOf;t.exports=function(t){return i.call(this,t,arguments[1])>-1}},function(t,e,n){"use strict";t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function");return t}},function(t){t.exports=JSON.parse('{"version":"1.1.13-douyin-2.4"}')},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=s(n(1)),r=s(n(28)),a=n(0);function s(t){return t&&t.__esModule?t:{default:t}}var l=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&("object"==typeof e||"function"==typeof e)?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.setLogger("control"),n.danmu=t,n.main=new r.default(t),t.config.defaultOff||n.main.start(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"createSwitch",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.logger&&this.logger.info("createSwitch"),this.switchBtn=(0,a.createDom)("dk-switch",'<span class="txt">å¼¹</span>',{},"danmu-switch "+(t?"danmu-switch-active":"")),this.switchBtn}},{key:"destroy",value:function(){for(var t in this.logger&&this.logger.info("destroy"),this.main.destroy(),this)a.hasOwnProperty.call(this,t)&&delete this[t]}}]),e}(o.default);e.default=l,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=l(n(1)),r=l(n(29)),a=l(n(30)),s=n(0);function l(t){return t&&t.__esModule?t:{default:t}}var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&("object"==typeof e||"function"==typeof e)?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.setLogger("main"),n.danmu=t,n.container=t.container,n.channel=new a.default(t),n.data=[].concat(t.config.comments),n.playedData=[],n.queue=[],n.timer=null,n.playRate=1,n.retryStatus="normal",n.interval=t.config.interval,n._status="idle",n._events=[],n._bindEvents(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"destroy",value:function(){for(var t in this.logger&&this.logger.info("destroy"),this._unbindEvents(),this._cancelTick(),this.channel&&this.channel.destroy(),this.data=[],this.danmu&&this.danmu.updateGetBoundingCounts&&this.danmu.updateGetBoundingCounts(0),this)delete this[t]}},{key:"_bindEvents",value:function(){var t=this,e=this.danmu,n=this.container;this._unbindEvents(),this._events.push([e,"bullet_remove",function(e){var n=e.bullet,i=t.data,o=t.queue;o.some(function(t,e){return t.id===n.id&&(o.splice(e,1),!0)}),i.some(function(e,o){return e.id===n.id&&(e.attached_=!1,t.danmu&&t.danmu.config&&t.danmu.config.postOptimization&&e.prior&&i.splice(o,1),!0)})}]),this._events.push([n,"transitionend",function(e){var n=t._getBulletByEvt(e);n&&(n.status="end",n.remove(!1))}]),(e.config.mouseControl||e.config.mouseEnterControl)&&this._events.push([n,"mouseover",function(e){var n,i=t.danmu;!i||i.mouseControl&&i.config.mouseControlPause||(n=t._getBulletByEvt(e))&&"waiting"!==n.status&&"end"!==n.status&&i.emit("bullet_hover",{bullet:n,event:e})}]),this._events.forEach(function(t){t[0].addEventListener?t[0].addEventListener(t[1],t[2],!1):t[0].on&&t[0].on(t[1],t[2])})}},{key:"_unbindEvents",value:function(){this._events.length&&(this._events.forEach(function(t){t[0].removeEventListener?t[0].removeEventListener(t[1],t[2],!1):t[0].off&&t[0].off(t[1],t[2])}),this._events=[])}},{key:"_cancelTick",value:function(){this.handleTimer&&(clearTimeout(this.handleTimer),this.handleTimer=null)}},{key:"_startTickV0",value:function(){var t=this;t.retryStatus="normal",t._cancelTick(),t.sortData(),function e(){"closed"!==t._status||"stop"!==t.retryStatus?("playing"===t._status&&(t.readData(),t.dataHandle()),"stop"===t.retryStatus&&"paused"!==t._status||(t.handleTimer=setTimeout(e,250))):t._cancelTick()}()}},{key:"_startTickV1",value:function(){var t=this;this.retryStatus="normal",this._cancelTick(),this.sortData(),!function e(){"closed"!==t._status||"stop"!==t.retryStatus?("playing"===t._status&&(t.readDataV1(),t.queue.forEach(function(t){"waiting"!==t.status&&"paused"!==t.status||t.startMoveV1()})),"stop"===t.retryStatus&&"paused"!==t._status||(t.handleTimer=setTimeout(e,250))):t._cancelTick()}()}},{key:"_startTick",value:function(){this.danmu&&this.danmu.config&&this.danmu.config.trackAllocationOptimization?this._startTickV1():this._startTickV0()}},{key:"start",value:function(){this.logger&&this.logger.info("start"),"playing"!==this._status&&(this._status="playing",this.queue=[],this.container.innerHTML="",this.channel.reset(),this._startTick())}},{key:"stop",value:function(){this.logger&&this.logger.info("stop"),"closed"!==this._status&&(this._status="closed",this.retryStatus="stop",this.queue=[],this.container&&(this.container.innerHTML=""),this.channel&&this.channel.reset(),this._cancelTick())}},{key:"clear",value:function(){this.logger&&this.logger.info("clear"),this.channel&&this.channel.reset(),this.data=[],this.queue=[],this.container&&(this.container.innerHTML="")}},{key:"play",value:function(){var t=this;if("closed"!==this._status){this.logger&&this.logger.info("play"),this._status="playing";var e=this.channel.channels;e&&e.length>0&&["scroll","top","bottom"].forEach(function(n){t.queue.forEach(function(t){t.startMove(),t.resized=!0});for(var i=0;i<e.length;i++)e[i].queue[n].forEach(function(t){t.resized=!1})}),this._startTick()}else this.logger&&this.logger.info("play ignored")}},{key:"pause",value:function(){if("closed"!==this._status){this.logger&&this.logger.info("pause"),this._status="paused",this._cancelTick();var t=this.channel.channels;t&&t.length>0&&this.queue.forEach(function(t){t.pauseMove()})}else this.logger&&this.logger.info("pause ignored")}},{key:"dataHandle",value:function(){"paused"!==this._status&&"closed"!==this._status&&this.queue.length&&this.queue.forEach(function(t){"waiting"===t.status&&t.startMove()})}},{key:"readData",value:function(){var t=this.danmu,e=this.interval,n=this.channel,i=t.player,o=void 0,a=void 0;if(t.isReady&&t.main){if(i){var l=i.currentTime?Math.floor(1e3*i.currentTime):0;a=this.data.filter(function(n){return!n.start&&0>t.hideArr.indexOf(n.mode)&&(!n.color||0>t.hideArr.indexOf("color"))&&(n.start=l),t.config.postOptimization?!n.attached_&&0>t.hideArr.indexOf(n.mode)&&(!n.color||0>t.hideArr.indexOf("color"))&&n.start-e<=l&&(l<=n.start+e||n.prior):!n.attached_&&0>t.hideArr.indexOf(n.mode)&&(!n.color||0>t.hideArr.indexOf("color"))&&n.start-e<=l&&l<=n.start+e}),t.config.postOptimization?a.sort(function(t,e){return t.prior&&!e.prior?-1:!t.prior&&e.prior?1:(e.score||-1)-(t.score||-1)}):t.config.highScorePriority&&a.sort(function(t,e){return e.prior&&!t.prior||(e.score||-1)-(t.score||-1)}),t.live&&(this.data=[])}else 0===(a=this.data.splice(0,1)).length&&(a=this.playedData.splice(0,1));if(a.length>0&&n.checkAvailableTrack(a[0].mode)){t&&t.updateReadDataTimes&&t.updateReadDataTimes(),n.updatePos();for(var u,c=0,h=0;h<a.length;h++)if(u=a[h],this.forceDuration&&this.forceDuration!==u.duration&&(u.duration=this.forceDuration),(o=new r.default(t,u)).bulletCreateFail){if(0===c)break;c--}else if(o.attach(),u.attached_=!0,n.addBullet(o).result)this.queue.push(o),o.topInit(),c=0;else{for(var f in o.detach(),o)s.hasOwnProperty.call(o,f)&&delete o[f];if(o=null,u.attached_=!1,u.noDiscard&&(u.prior?this.data.unshift(u):this.data.push(u)),0===c)break;c--}}}}},{key:"readDataV1",value:function(){var t=this,e=this.danmu,n=this.interval,i=this.channel,o=this.data,a=this.forceDuration,l=e.player;if(e.isReady&&e.main){var u=[];if(l){var c=l.currentTime?Math.floor(1e3*l.currentTime):0;u=o.filter(function(t){return t.start||(t.start=c),e.config.postOptimization?!t.attached_&&t.start-n<=c&&(c<=t.start+n||t.prior):!t.attached_&&t.start-n<=c&&c<=t.start+n}),e.config.postOptimization?u.sort(function(t,e){return t.prior&&!e.prior?-1:!t.prior&&e.prior?1:(e.score||-1)-(t.score||-1)}):e.config.highScorePriority&&u.sort(function(t,e){return e.prior&&!t.prior||(e.score||-1)-(t.score||-1)}),e.live&&(this.data=[])}else 0===(u=this.data.splice(0,1)).length&&(u=this.playedData.splice(0,1));if(0!==u.length)for(var h=0;h<u.length;h++)(function(n){e&&e.updateReadDataTimes&&e.updateReadDataTimes();var o=u[n];if(a&&a!==o.duration&&(o.duration=a),!i.checkAvailableTrackV1()||"playing"!==t._status||t.queue&&t.queue.find(function(t){return t.id===o.id}))return;var l=new r.default(e,o);if(l.bulletCreateFail)return;if(l.attachV1(),o.attached_=!0,i.addBulletV1(l)&&"end"!==l.status&&!t.queue.find(function(t){return t.id===o.id}))t.queue.push(l),l.topInit();else{for(var c in l.detach(),l)s.hasOwnProperty.call(l,c)&&delete l[c];o.attached_=!1}})(h)}}},{key:"sortData",value:function(){this.data.sort(function(t,e){return(t.start||-1)-(e.start||-1)})}},{key:"keepPoolWatermark",value:function(){var t=this.danmu,e=t.config,n=t.player,i=this.data,o=[],r=0;if("number"==typeof e.maxCommentsLength&&i.length>e.maxCommentsLength){r=i.length-e.maxCommentsLength;for(var a,s=0;s<r;s++)(a=i[s]).prior&&!a.attached_&&o.push(i[s])}else if(e.dropStaleComments&&n&&n.currentTime){var l=Math.floor(1e3*n.currentTime)-e.interval;if(l>0){for(var u,c=0;c<i.length;c++)if((u=i[c]).prior&&!u.attached_&&o.push(i[c]),u.start>l){r=c;break}}}r>0&&(i.splice(0,r),this.data=o.concat(i))}},{key:"_getBulletByEvt",value:function(t){for(var e,n=t.target||t.srcElement,i=this.queue,o=void 0,r=0;r<i.length;r++)if((e=i[r])&&e.el&&(e.el===n||e.el.contains(n))){o=e;break}return o}},{key:"status",get:function(){return this._status}}]),e}(o.default);e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Bullet=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=s(n(1)),r=s(n(4)),a=n(0);function s(t){return t&&t.__esModule?t:{default:t}}var l=new r.default("bullet"),u=e.Bullet=function(t){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e);var i=function(t,e){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&("object"==typeof e||"function"==typeof e)?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),o=t.container,r=t.recycler,a=t.config;return i.setLogger(l),i.danmu=t,i.options=n,i.duration=n.duration,i.id=n.id,i.container=o,i.mode="top"===n.mode||"bottom"===n.mode?n.mode:"scroll",i.start=n.start,i.prior=n.prior,i.realTime=n.realTime,i.color=n.color,i.bookChannelId=n.bookChannelId,i.reuseDOM=!0,i.noCopyEl=!(!a.disableCopyDOM&&!n.disableCopyDOM),i.recycler=r,i._fullySlideInScreenDuration=void 0,i._lastMoveTime=void 0,i.status="waiting",n.elLazyInit||(i.bulletCreateFail=!i._makeEl()),i.startsTime=0,i.fullEnterTime=0,i.fullLeaveTime=0,i.waitTimeStamp=0,i}return function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"_makeEl",value:function(){var t=this.danmu,e=this.options,n=t.config,i=t.globalHooks,o=void 0,r="",s=e.style||{};if(s.perspective="500em",e.el||e.elLazyInit){if(this.noCopyEl&&(this.reuseDOM=!1),e.elLazyInit){if((0,a.isFunction)(i.bulletCreateEl))try{var l=i.bulletCreateEl(e);t&&t.updateDanmuElCreateCounts&&t.updateDanmuElCreateCounts(),o=l instanceof HTMLElement?l:l.el}catch(t){}}else if(1===e.el.nodeType&&!e.el.parentNode){if(this.reuseDOM){var u=(0,a.copyDom)(e.el);e.eventListeners&&e.eventListeners.length>0&&e.eventListeners.forEach(function(t){u.addEventListener(t.event,t.listener,t.useCapture||!1)}),(o=this.recycler.use()).childNodes.length>0&&(o.innerHTML=""),o.textContent&&(o.textContent=""),o.appendChild(u)}else o=e.el}}else"string"==typeof e.txt&&((o=this.recycler.use()).textContent=e.txt);if(!o||!t.main)return!1;var c=void 0;if((0,a.isNumber)(n.bulletOffset)&&n.bulletOffset>=0)c=n.bulletOffset;else{var h=t.containerPos;c=h.width/10>100?100:h.width/10}var f=e.realTime?0:Math.floor(Math.random()*c),d=this.updateOffset(f,!0);return s.left=d,Object.keys(s).forEach(function(t){var e=t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});r+=e+":"+s[t]+";"}),(0,a.styleCSSText)(o,r),this.el=o,e.like&&e.like.el&&this.setLikeDom(e.like.el,e.like.style),!0}},{key:"_makeElV1",value:function(){var t=this.danmu,e=this.options,n=t.globalHooks,i=void 0,o="",r=e.style||{};if(r.position="absolute",this.reuseDOM=!1,e.elLazyInit&&(0,a.isFunction)(n.bulletCreateEl))try{var s=n.bulletCreateEl(e);t&&t.updateDanmuElCreateCounts&&t.updateDanmuElCreateCounts(),i=s instanceof HTMLElement?s:s.el}catch(t){}return!(!i||!t.main)&&(r.left=this.updateOffset(0,!0),Object.keys(r).forEach(function(t){var e=t.replace(/[A-Z]/g,function(t){return"-"+t.toLowerCase()});o+=e+":"+r[t]+";"}),(0,a.styleCSSText)(i,o),this.el=i,!0)}},{key:"updateOffset",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.random=t;var n=this.danmu.containerPos.width+t+"px";return e||(0,a.styleUtil)(this.el,"left",this.danmu.containerPos.width+t+"px"),n}},{key:"updatePosition",value:function(){return this.el?(this.elPos=this.el.getBoundingClientRect(),this.width=this.elPos.width,this.options.width=this.elPos.width,this.danmu&&this.danmu.updateGetBoundingCounts&&this.danmu.updateGetBoundingCounts(),this.el&&this.el.style&&this.el.style.fontSize&&(this.danmu.fontSizeItem=this.el.style.fontSize),this.elPos):{}}},{key:"attach",value:function(){if(this.options.elLazyInit&&!this.el&&this._makeEl(),this.danmu&&this.danmu.main){var t=this.danmu,e=this.options,n=this.el,i=t.globalHooks;i.bulletAttaching&&i.bulletAttaching(e),this.container.contains(n)||this.container.appendChild(n),this.elPos=n.getBoundingClientRect(),t&&t.updateGetBoundingCounts&&t.updateGetBoundingCounts(),"b2t"===this.direction?(this.width=this.elPos.height,this.height=this.elPos.width):(this.width=this.elPos.width,this.height=this.elPos.height),this.moveV&&(this.duration=(this.danmu.containerPos.width+this.random+this.width)/this.moveV*1e3),i.bulletAttached&&i.bulletAttached(e,n)}}},{key:"attachV1",value:function(){var t=this.danmu,e=this.options,n=t.globalHooks;if(e.elLazyInit&&!this.el&&this._makeElV1(),t&&t.main){var i=this.el;i instanceof Element&&!this.container.contains(i)&&this.container.appendChild(i),this.width||this.updatePosition(),n.bulletAttached&&n.bulletAttached(e,this.el)}}},{key:"detach",value:function(){var t=this.el,e=this.danmu,n=this.options,i=e.globalHooks;t&&(i.bulletDetaching&&i.bulletDetaching(n),this.reuseDOM?this.recycler.unused(t):t.parentNode&&t.parentNode.removeChild(t),i.bulletDetached&&i.bulletDetached(n,t),this.el=null),this.elPos=void 0}},{key:"topInit",value:function(){this.logger&&this.logger.info("topInit #"+(this.options.txt||"[DOM Element]")+"#"),"b2t"===this.direction?((0,a.styleUtil)(this.el,"transformOrigin","left top"),(0,a.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+this.danmu.containerPos.height+"px) translateZ(0px) rotate(90deg)"),(0,a.styleUtil)(this.el,"transition","transform 0s linear 0s")):(0,a.styleUtil)(this.el,"top",this.top+"px")}},{key:"pauseMove",value:function(t){this.danmu&&this.danmu.config&&this.danmu.config.trackAllocationOptimization?this.pauseMoveV1():this.pauseMoveV0(t)}},{key:"pauseMoveV0",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if("paused"!==this.status&&("forcedPause"!==this.status&&(this.status="paused"),this._moveV=void 0,this.el)){if("scroll"===this.mode){var e=this.danmu.containerPos;if(t){var n=((new Date).getTime()-this._lastMoveTime)/1e3*this.moveV,i=0;i=this.moveMoreS-n>=0?"b2t"===this.direction?(this.moveMoreS-n)/this.moveContainerHeight*e.height:(this.moveMoreS-n)/this.moveContainerWidth*e.width:this.moveMoreS-n,"b2t"===this.direction?(0,a.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+i+"px) translateZ(0px) rotate(90deg)"):(0,a.styleUtil)(this.el,"left",i+"px")}else"b2t"===this.direction?(0,a.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY("+(this.el.getBoundingClientRect().top-e.top)+"px) translateZ(0px) rotate(90deg)"):((0,a.styleUtil)(this.el,"left",this.el.getBoundingClientRect().left-e.left+"px"),this.danmu&&this.danmu.updateGetBoundingCounts&&this.danmu.updateGetBoundingCounts());"b2t"===this.direction||(0,a.styleUtil)(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,a.styleUtil)(this.el,"transition","transform 0s linear 0s")}else this.pastDuration&&this.startTime?this.pastDuration=this.pastDuration+(new Date).getTime()-this.startTime:this.pastDuration=1}}},{key:"pauseMoveV1",value:function(){if("paused"!==this.status&&this.el){"forcedPause"!==this.status&&(this.status="paused");var t=this.danmu.containerPos;this.recalculate=!0;var e=this.updatePosition();(0,a.styleUtil)(this.el,"left",e.left-t.left+"px"),(0,a.styleUtil)(this.el,"transform","translateX(0px) translateY(0px) translateZ(0px)"),(0,a.styleUtil)(this.el,"transition","transform 0s linear 0s"),e.right<=t.right&&(this.fullEnterTime=-1),e.right<t.left&&this.remove(!1)}}},{key:"startMove",value:function(t){this.danmu&&this.danmu.config&&this.danmu.config.trackAllocationOptimization?this.startMoveV1(t):this.startMoveV0(t)}},{key:"startMoveV0",value:function(t){if(this.hasMove||(this.danmu.emit("bullet_start",this),this.hasMove=!0),("forcedPause"!==this.status||t)&&this.el&&"start"!==this.status){if(this.status="start","scroll"===this.mode){var e=this.danmu.containerPos;if(!!this.el){var n=this.el.getBoundingClientRect();this.danmu&&this.danmu.updateGetBoundingCounts&&this.danmu.updateGetBoundingCounts();var i=void 0;if("b2t"===this.direction){i=n.bottom-e.bottom;var o=(n.bottom-e.top)/this.moveV;(0,a.styleUtil)(this.el,"transition","transform "+o+"s linear 0s"),(0,a.styleUtil)(this.el,"transform","translateX(-"+this.top+"px) translateY(-"+this.height+"px) translateZ(0px) rotate(90deg)"),this._lastMoveTime=(new Date).getTime(),this.moveMoreS=n.top-e.top,this.moveContainerHeight=e.height}else{i=n.right-e.right;var r=n.right-e.left,s=r/this.moveV;this.danmu&&this.danmu.updateStartMoveTimes&&this.danmu.updateStartMoveTimes(),n.right>e.left?((0,a.styleUtil)(this.el,"transition","transform "+s+"s linear 0s"),(0,a.styleUtil)(this.el,"transform","translateX(-"+r+"px) translateY(0px) translateZ(0px)"),this._lastMoveTime=(new Date).getTime(),this.moveMoreS=n.left-e.left,this.moveContainerWidth=e.width):(this.status="end",this.remove())}this._fullySlideInScreenDuration=i/this.moveV}}else{var l=(new Date).getTime(),u=(this.startTime&&l-this.startTime>this.duration?l-this.startTime:this.duration)/1e3;(0,a.styleUtil)(this.el,"left","50%"),(0,a.styleUtil)(this.el,"margin","0 0 0 -"+this.width/2+"px"),(0,a.styleUtil)(this.el,"visibility","hidden"),(0,a.styleUtil)(this.el,"transition","visibility "+u+"s 0s"),this.pastDuration||(this.pastDuration=1),this.startTime=l}}}},{key:"startMoveV1",value:function(t){var e=this.status;if("visible"!==document.visibilityState&&"paused"!==e&&"forcedPause"!==e&&!this.recalculate)return this.waitTimeStamp=0,this.remove(!1),void(this.status="end");var n=(0,a.getTimeStamp)();if(this.el&&!(this.waitTimeStamp>n)){if(this.recalculate);else{if("start"===e||"forcedPause"===e&&!t)return;if("forcedPause"!==e&&"paused"!==e&&this.fullLeaveTime&&this.fullLeaveTime<n)return this.remove(!1),void(this.status="end")}this.waitTimeStamp=0;var i=this.danmu.containerPos;if(this.status="start",this.danmu&&this.danmu.updateStartMoveTimes&&this.danmu.updateStartMoveTimes(),"paused"===e||"forcedPause"===e||this.recalculate){var o=this.updatePosition(),r=o.right-i.left,s=r/this.moveVV1;o.right>i.left?((0,a.styleUtil)(this.el,"transition","transform "+s/1e3+"s linear 0s"),(0,a.styleUtil)(this.el,"transform","translateX(-"+r+"px) translateY(0px) translateZ(0px)"),o.right>i.right?this.fullEnterTime=n+(o.right-i.right)/this.moveVV1:this.fullEnterTime=-1,this.fullLeaveTime=n+s):(this.status="end",this.remove(!1))}else{var l=this.el;(0,a.styleUtil)(l,"transition","transform "+this.duration/1e3+"s linear 0s"),(0,a.styleUtil)(l,"transform","translateX(-"+(i.width+this.width)+"px) translateY(0px) translateZ(0px)"),this.startsTime=(0,a.getTimeStamp)(),this.endTime=this.startsTime+this.duration,this.fullEnterTime=this.startsTime+this.width/this.moveVV1,this.fullLeaveTime=this.startsTime+this.duration}}}},{key:"remove",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.logger&&this.logger.info("remove #"+(this.options.txt||"[DOM Element]")+"#");this.fullEnterTime=-1,t&&this.pauseMove(),this.el&&this.el.parentNode&&(this.detach(),this.options.el&&1===this.options.el.nodeType&&this.noCopyEl&&(0,a.styleUtil)(this.options.el,"transform","none"),this.danmu.emit("bullet_remove",{bullet:this}))}},{key:"setFontSize",value:function(t){this.el&&(this.el.style.fontSize=t),this.danmu&&this.danmu.config&&this.danmu.config.fontSizeAdjust&&(this.el.style.height=t)}},{key:"setLikeDom",value:function(t,e){if(t&&(Object.keys(e).forEach(function(n){t.style[n]=e[n]}),t.className="danmu-like",this.el)){var n=this.el.querySelector(".danmu-like");n&&this.el.removeChild(n),this.el.innerHTML=""+this.el.innerHTML+t.outerHTML}return t}},{key:"moveV",get:function(){var t=this.danmu,e=this.options,n=this._moveV;if(!n){if(e.moveV)n=e.moveV;else if(this.elPos){var i=t.containerPos;n=("b2t"===this.direction?i.height+(t.config.chaseEffect?this.height:0):i.width+(t.config.chaseEffect?this.width:0))/this.duration*1e3}n&&(n*=t.main.playRate,this._moveV=n)}return n}},{key:"moveVV1",get:function(){return!this.width&&this.el&&(this.updatePosition(),this.options.width=this.width),((this.danmu.containerPos.width||0)+this.width)/this.duration}},{key:"direction",get:function(){return this.danmu.direction}},{key:"fullySlideIntoScreen",get:function(){var t=!0;return"scroll"===this.mode&&this._lastMoveTime&&this._fullySlideInScreenDuration>0&&(t=((new Date).getTime()-this._lastMoveTime)/1e3>=this._fullySlideInScreenDuration),t}}]),e}(o.default);e.default=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(1),r=o&&o.__esModule?o:{default:o},a=n(0),s=n(31);function l(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}var u=function(t){function e(t){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,e);var n=function(t,e){if(!t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&("object"==typeof e||"function"==typeof e)?e:t}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return n.setLogger("channel"),n.danmu=t,n.width=0,n.height=0,n.reset(!0),n.channels=[],n.updatePos(),(0,a.attachEventListener)(n.danmu,"bullet_remove",function(t){t.bullet.danmu.config.trackAllocationOptimization?n.removeBulletV1(t.bullet):n.removeBullet(t.bullet)},"destroy"),(0,a.attachEventListener)(n.danmu,"channel_resize",function(){n.resize()},"destroy"),n}return function(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,t),i(e,[{key:"checkAvailableTrack",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll",e=this.channels,n=!1;if("scroll"===t)for(var i,o=0;o<e.length;o++)if(n=!0,(i=e[o]).operating[t])n=!1;else{var r=i.queue[t][0];if(!r||r.fullySlideIntoScreen){if(n)break}else n=!1}else n=!0;return n}},{key:"checkAvailableTrackV1",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"scroll";return"visible"===document.visibilityState&&this.channels.findIndex(function(e){var n=e.queue[t][0];return!e.freeze&&(!(n&&!(n.fullEnterTime&&n.fullEnterTime<=(0,a.getTimeStamp)()))||void 0)})>=0}},{key:"destroy",value:function(){for(var t in this.logger&&this.logger.info("destroy"),this.channels.splice(0,this.channels.length),this._cancelResizeTimer(),this)a.hasOwnProperty.call(this,t)&&delete this[t]}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.logger&&this.logger.info("reset");var e=this,n=e.danmu,i=n.container,o=n.bulletBtn;function r(){if(e.danmu&&e.danmu.container){var t=e.danmu.container.getBoundingClientRect();e.danmu.updateGetBoundingCounts&&e.danmu.updateGetBoundingCounts(),e.width=t.width,e.height=t.height,e.resetId&&(cancelAnimationFrame(e.resetId),e.resetId=null);var n=e._initChannels(),i=n.channelSize,o=n.channelCount,r=n.channels;e.channelCount=o,e.channels=r,"b2t"===e.direction?e.channelWidth=i:e.channelHeight=i}}e.container=i,o&&o.main&&o.main.queue.forEach(function(t){t.remove()}),e.channels&&e.channels.length>0&&["scroll","top","bottom"].forEach(function(t){for(var n=0;n<e.channels.length;n++)e.channels[n].queue[t].forEach(function(t){t.remove()})}),o&&o.main&&o.main.data&&o.main.data.forEach(function(t){t.attached_=!1}),t?this.resetId=requestAnimationFrame(r):r()}},{key:"getRealOccupyArea",value:function(){return{width:this.width,height:this.height}}},{key:"updatePos",value:function(){var t=this.container.getBoundingClientRect();this.danmu&&this.danmu.updateGetBoundingCounts&&this.danmu.updateGetBoundingCounts(),this.containerPos=t,this.containerWidth=t.width,this.containerHeight=t.height,this.containerTop=t.top,this.containerBottom=t.bottom,this.containerLeft=t.left,this.containerRight=t.right}},{key:"addBullet",value:function(t){var e=this,n=this.danmu,i=this.channels,o=void 0,r=void 0,a=void 0;if("b2t"===e.direction?(r=this.channelWidth,a=Math.ceil(t.width/r)):(o=this.channelHeight,a=Math.ceil(t.height/o)),a>i.length)return{result:!1,message:"exceed channels.length, occupy="+a+",channelsSize="+i.length};for(var s=!0,l=void 0,u=-1,c=0,h=i.length;c<h;c++)if(i[c].queue[t.mode].some(function(e){return e.id===t.id}))return{result:!1,message:"exited, channelOrder="+c+",danmu_id="+t.id};if("scroll"===t.mode)for(var f=0,d=i.length-a;f<=d;f+=a){s=!0;for(var p=f;p<f+a;p++){if((l=i[p]).operating.scroll||l.bookId.scroll&&l.bookId.scroll!==t.id){s=!1;break}l.operating.scroll=!0;var m=l.queue.scroll[0];if(m){var v=m.el.getBoundingClientRect();if(n&&n.updateGetBoundingCounts&&n.updateGetBoundingCounts(),"b2t"===e.direction){if(v.bottom>=e.containerPos.bottom){s=!1,l.operating.scroll=!1;break}}else if(v.right>=e.containerPos.right){s=!1,l.operating.scroll=!1;break}var g=void 0,y=m.moveV,b=void 0,_=t.moveV,k=void 0;if("b2t"===e.direction?(b=(g=v.bottom-e.containerTop)/y,k=e.containerHeight+t.random-g):(b=(g=v.right-e.containerLeft)/y,k=e.containerWidth+t.random-g),_>y){var w=k/(_-y);if(n.config.bOffset||(n.config.bOffset=0),b+n.config.bOffset>=w){var O=b*_-e.containerPos.width;O>0&&t.updateOffset(O+(1+Math.ceil(5*Math.random())))}}}l.operating.scroll=!1}if(s){u=f;break}}else if("top"===t.mode)for(var T=0,C=i.length-a;T<=C;T++){s=!0;for(var x=T;x<T+a;x++){if(x>Math.floor(i.length/2)||(l=i[x]).operating[t.mode]||(l.bookId[t.mode]||t.prior)&&l.bookId[t.mode]!==t.id){s=!1;break}if(l.operating[t.mode]=!0,l.queue[t.mode].length>0){s=!1,l.operating[t.mode]=!1;break}l.operating[t.mode]=!1}if(s){u=T;break}}else if("bottom"===t.mode)for(var S=i.length-a;S>=0;S--){s=!0;for(var E=S;E<S+a;E++){if(E<=Math.floor(i.length/2)||(l=i[E]).operating[t.mode]||(l.bookId[t.mode]||t.prior)&&l.bookId[t.mode]!==t.id){s=!1;break}if(l.operating[t.mode]=!0,l.queue[t.mode].length>0){s=!1,l.operating[t.mode]=!1;break}l.operating[t.mode]=!1}if(s){u=S;break}}if(-1!==u){n&&n.updateAttachTimes&&n.updateAttachTimes();for(var z=u,M=u+a;z<M;z++)(l=i[z]).operating[t.mode]=!0,l.queue[t.mode].unshift(t),t.prior&&(delete l.bookId[t.mode],e.logger&&e.logger.info(z+"å·è½¨éæ¢å¤æ­£å¸¸ä½¿ç¨")),l.operating[t.mode]=!1;return t.prior&&(e.logger&&e.logger.info(t.id+"å·ä¼åå¼¹å¹è¿è¡å®æ¯"),delete t.bookChannelId,n.player&&n.bulletBtn.main.data.some(function(e){return e.id===t.id&&(delete e.bookChannelId,!0)})),t.channel_id=[u,a],t.el.setAttribute("data-line-index",u+1),"b2t"===e.direction?(t.top=u*r,e.danmu.config.area&&e.danmu.config.area.start&&(t.top+=e.containerWidth*e.danmu.config.area.start)):(t.top=u*o,e.danmu.config.area&&e.danmu.config.area.start&&(t.top+=e.containerHeight*e.danmu.config.area.start)),{result:t,message:"success"}}if(t.options.realTime){var P=0,L=-1,j=null;if(e.danmu.bulletBtn.main.queue.forEach(function(t,n){!t.prior&&!t.options.realTime&&t.el&&t.el.getBoundingClientRect().left>e.containerPos.right&&t.start>=P&&(P=t.start,L=n,j=t)}),j){j.remove(),e.removeBullet(j),e.danmu.bulletBtn.main.queue.splice(L,1),t.channel_id=j.channel_id;for(var D=j.channel_id[0],A=j.channel_id[0]+j.channel_id[1];D<A;D++)(l=i[D]).operating[t.mode]=!0,l.queue[t.mode].unshift(t),t.prior&&delete l.bookId[t.mode],l.operating[t.mode]=!1;return t.top=j.top,e.danmu.config.area&&e.danmu.config.area.start&&(t.top+=e.containerHeight*e.danmu.config.area.start),{result:t,message:"success"}}}if(t.prior){if(t.bookChannelId||e.danmu.live)n.player&&n.bulletBtn.main.data.some(function(n){return n.id===t.id&&(e.logger&&e.logger.info(t.id+"å·ä¼åå¼¹å¹å°äº2ç§ååæ¬¡è¯·æ±æ³¨å"),n.start+=2e3,!0)});else{u=-1;for(var V=0,I=i.length-a;V<=I;V++){s=!0;for(var B=V;B<V+a;B++)if(i[B].bookId[t.mode]){s=!1;break}if(s){u=V;break}}if(-1!==u){for(var q=u;q<u+a;q++)i[q].bookId[t.mode]=t.id,e.logger&&e.logger.info(q+"å·è½¨éè¢«"+t.id+"å·ä¼åå¼¹å¹é¢å®");n.player&&n.bulletBtn.main.data.some(function(n){return n.id===t.id&&(e.logger&&e.logger.info(t.id+"å·ä¼åå¼¹å¹å°äº2ç§ååæ¬¡è¯·æ±æ³¨å"),n.start+=2e3,n.bookChannelId=[u,a],e.logger&&e.logger.info(t.id+"å·ä¼åå¼¹å¹é¢å®äº"+u+"~"+(u+a-1)+"å·è½¨é"),!0)})}}}return{result:!1,message:"no surplus will right"}}},{key:"addBulletV1",value:function(t){for(var e=-1,n=(0,a.getTimeStamp)(),i=0;i<this.channels.length;i++){var o=this.channels[i];if(!o.freeze){var r=o.queue.scroll[0];if(!r||!r.el){e=o.id;break}if(r.recalculate){var s=r.updatePosition();if(this.containerRight>s.right){var l=r.fullLeaveTime-n-this.containerWidth/t.moveVV1;t.waitTimeStamp=l>=0?n+l:0,e=o.id;break}}else{if(r.waitTimeStamp||!r.startsTime||!r.fullEnterTime)continue;if(r.fullEnterTime<n){if(r.moveVV1>t.moveVV1){e=o.id;break}var u=r.fullLeaveTime-n-this.containerWidth/t.moveVV1;e=o.id,u>0&&(t.waitTimeStamp=n+u);break}}}}return e>-1&&(this.danmu&&this.danmu.updateAttachTimes&&this.danmu.updateAttachTimes(),this.channels[e].queue.scroll.unshift(t),t.channelIndex=e,t.top=e*this.channelHeight,t.channelId=e,t.startMoveV1(),!0)}},{key:"removeBullet",value:function(t){this.logger&&this.logger.info("removeBullet "+(t.options.txt||"[DOM Element]"));for(var e=this.channels,n=t.channel_id,i=void 0,o=n[0],r=n[0]+n[1];o<r;o++)if(i=e[o]){i.operating[t.mode]=!0;var a=-1;i.queue[t.mode].some(function(e,n){return e.id===t.id&&(a=n,!0)}),a>-1&&i.queue[t.mode].splice(a,1),i.operating[t.mode]=!1}t.options.loop&&this.danmu.bulletBtn.main.playedData.push(t.options)}},{key:"removeBulletV1",value:function(t){if(t&&void 0!==t.channelId&&this.channels[t.channelId]){var e=this.channels[t.channelId];e.operating[t.mode]=!0;for(var n=e.queue[t.mode],i=n.length-1;i>=0;i--)if(n[i].id===t.id){n.splice(i,1),e.operating[t.mode]=!1;break}}t.options.loop&&this.danmu.bulletBtn.main.playedData.push(t.options)}},{key:"resizeSync",value:function(){this.resize(!0)}},{key:"_initChannels",value:function(t){return this.danmu&&this.danmu.config&&this.danmu.config.trackAllocationOptimization?this._initChannelsV1(t):this._initChannelsV0(t)}},{key:"_initChannelsV0",value:function(t){if(this.danmu&&this.danmu.config){var e=this.danmu.config,n=t||e.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),i=void 0;if(e.area){var o=e.area,r=o.lines,l=o.start,u=o.end;if((0,s.validAreaLineRule)(r))i=r,"b2t"===this.direction?this.width=i*n:this.height=i*n;else if(l>=0&&u>=l){var c=u-l;"b2t"===this.direction?this.width=Math.floor(this.width*c):this.height=Math.floor(this.height*c)}}(0,a.isNumber)(i)||(i="b2t"===this.direction?Math.floor(this.width/n):Math.floor(this.height/n));for(var h=[],f=0;f<i;f++)h[f]={id:f,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};return{channelSize:n,channelCount:i,channels:h}}}},{key:"_initChannelsV1",value:function(t){if(this.danmu&&this.danmu.config){var e=this.danmu.config,n=t||e.channelSize||(/mobile/gi.test(navigator.userAgent)?10:12),i=void 0;if(e.area){var o=e.area,r=o.lines,a=o.start,l=o.end;(0,s.validAreaLineRule)(r)?(i=Number(r),this.height=i*n):a>=0&&l>=a&&(this.height=Math.floor(this.containerHeight*(l-a)),i=Math.floor(this.height/n))}for(var u=[],c=0;c<i;c++)u[c]={id:c,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}};return{channelSize:n,channelCount:i,channels:u}}}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.danmu&&this.danmu.config&&this.danmu.config.trackAllocationOptimization?this.resizeV1(t):this.resizeV0(t)}},{key:"resizeV0",value:function(t){this.logger&&this.logger.info("resize");var e=this;function n(t,e){t[e]={id:e,queue:{scroll:[],top:[],bottom:[]},operating:{scroll:!1,top:!1,bottom:!1},bookId:{}}}function i(){var t=e.danmu,i=t.container,o=t.bulletBtn;e.container=i,e.updatePos(),e._cancelResizeTimer(),o.main.data&&o.main.data.forEach(function(t){t.bookChannelId&&(delete t.bookChannelId,e.logger&&e.logger.info("resizeå¯¼è´"+t.id+"å·ä¼åå¼¹å¹é¢å®åæ¶"))}),e.logger&&e.logger.info("resizeå¯¼è´ææè½¨éæ¢å¤æ­£å¸¸ä½¿ç¨"),e.width=e.containerWidth,e.height=e.containerHeight;var r=e._initChannels(),a=r.channelSize,s=r.channels;e.channels&&(e.channels.length<=s.length?function(t,i){for(var o=0;o<e.channels.length;o++)n(t,o),function(n){["scroll","top"].forEach(function(i){e.channels[n].queue[i].forEach(function(e){e.el&&t[n].queue[i].push(e)})})}(o),function(n){e.channels[n].queue.bottom.forEach(function(o){if(o.el&&(t[n+t.length-e.channels.length].queue.bottom.push(o),o.channel_id[0]+o.channel_id[1]-1===n)){var r=[].concat(o.channel_id);o.channel_id=[r[0]-e.channels.length+t.length,r[1]],o.top=o.channel_id[0]*i,e.danmu.config.area&&e.danmu.config.area.start&&(o.top+=e.containerHeight*e.danmu.config.area.start),o.topInit()}})}(o);for(var r=function(e){["scroll","top","bottom"].forEach(function(n){t[e].queue[n].forEach(function(t){t.resized=!1})})},a=0;a<t.length;a++)r(a);e.channels=t,"b2t"===e.direction?e.channelWidth=i:e.channelHeight=i}(s,a):function(t,i){for(var o=["scroll","top","bottom"],r=function(r){n(t,r),o.forEach(function(n){if("top"===n&&r>Math.floor(t.length/2));else if("bottom"===n&&r<=Math.floor(t.length/2));else{var o="bottom"===n?r-t.length+e.channels.length:r;e.channels[o].queue[n].forEach(function(a,s){if(a.el){if(t[r].queue[n].push(a),"bottom"===n&&a.channel_id[0]+a.channel_id[1]-1===o){var l=[].concat(a.channel_id);a.channel_id=[l[0]-e.channels.length+t.length,l[1]],a.top=a.channel_id[0]*i,e.danmu.config.area&&e.danmu.config.area.start&&(a.top+=e.containerHeight*e.danmu.config.area.start),a.topInit()}e.channels[o].queue[n].splice(s,1)}})}})},a=0;a<t.length;a++)r(a);var s=function(e){o.forEach(function(n){t[e].queue[n].forEach(function(t){t.resized=!1})})};for(a=0;a<t.length;a++)s(a);e.channels=t,"b2t"===e.direction?e.channelWidth=i:e.channelHeight=i}(s,a)),e.resizing=!1}e.resizing||(e.resizing=!0,t?i():(this._cancelResizeTimer(),this.resizeId=requestAnimationFrame(i)))}},{key:"updateChannlState",value:function(t){var e=this._initChannels(t),n=e.channelCount,i=e.channels,o=e.channelSize,r=this.channels,a=r.filter(function(t){return!t.freeze});if(r){var s=a.length;a.length<n?this.channels=[].concat(l(a),l(i.slice(s))):(r.forEach(function(t,e){return t.freeze=e>=n}),this.channels=r)}else this.channels=i;this.channelHeight=o}},{key:"resizeV1",value:function(t){this.updatePos(),this.width=this.containerWidth,this.height=this.containerHeight,this.danmu.main.queue.forEach(function(t){t.recalculate=!0}),this.updateChannlState(),this.danmu&&this.danmu.main&&this.danmu.main.queue&&(this.danmu.main.queue.forEach(function(t){t.pauseMove()}),this.danmu&&this.danmu.updateQueueTimestamp&&this.danmu.updateQueueTimestamp())}},{key:"_cancelResizeTimer",value:function(){this.resizeId&&(cancelAnimationFrame(this.resizeId),this.resizeId=null)}},{key:"direction",get:function(){return this.danmu.direction}}]),e}(r.default);e.default=u,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.validAreaLineRule=function(t){return"number"==typeof t&&t>=0&&Number.isInteger(t)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(0),r=function(){function t(e){!function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,t),e={initDOM:function(){return document.createElement("div")},initSize:10},this.init(e)}return i(t,[{key:"init",value:function(t){this.idleList=[],this.usingList=[],this._id=0,this.options=t,this._expand(t.initSize)}},{key:"use",value:function(){this.idleList.length||this._expand(1);var t=this.idleList.shift();return this.usingList.push(t),t}},{key:"unused",value:function(t){var e=this.usingList.indexOf(t);e<0||(this.usingList.splice(e,1),t.style.opacity=0,this.idleList.push(t))}},{key:"_expand",value:function(t){for(var e=0;e<t;e++)this.idleList.push(this.options.initDOM(this._id++))}},{key:"destroy",value:function(){for(var t=0;t<this.idleList.length;t++)this.idleList[t].innerHTML="",this.idleList[t].textcontent="",this.clearElementStyle(this.idleList[t]);for(var e=0;e<this.usingList.length;e++)this.usingList[e].innerHTML="",this.usingList[e].textcontent="",this.clearElementStyle(this.usingList[e]);for(var n in this)o.hasOwnProperty.call(this,n)&&delete this[n]}},{key:"clearElementStyle",value:function(t){var e="undefined"!=typeof window?window.navigator.userAgent:null;e&&(e.indexOf("MSIE ")>-1||e.indexOf("Trident/")>-1?(0,o.styleUtil)(t,"transform","none"):t.setAttribute("style",""))}}]),t}();e.default=r,t.exports=e.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.destroyObserver=e.unObserver=e.addObserver=void 0;var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),o=n(0),r=new(function(){function t(){var e=this;if(function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}(this,t),this.__handlers=[],window.ResizeObserver)try{this.observer=new window.ResizeObserver((0,o.throttle)(function(t){e.__trigger(t)},100))}catch(t){}}return i(t,[{key:"addObserver",value:function(t,e){if(this.observer&&t){this.observer&&this.observer.observe(t);for(var n=this.__handlers,i=-1,o=0;o<n.length;o++)n[o]&&t===n[o].target&&(i=o);i>-1?this.__handlers[i].handler.push(e):this.__handlers.push({target:t,handler:[e]})}}},{key:"unObserver",value:function(t){if(t){var e=-1;this.__handlers.map(function(n,i){t===n.target&&(e=i)}),this.observer&&this.observer.unobserve(t),e>-1&&this.__handlers.splice(e,1)}}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(t){for(var e=this.__handlers,n=0;n<e.length;n++)if(e[n]&&t===e[n].target){e[n].handler&&e[n].handler.map(function(t){try{t()}catch(t){}});break}}},{key:"__trigger",value:function(t){var e=this;t.map(function(t){e.__runHandler(t.target)})}}]),t}());e.addObserver=function(t,e){r.addObserver(t,e)},e.unObserver=function(t,e){r.unObserver(t,e)},e.destroyObserver=function(t,e){r.destroyObserver(t,e)}},function(t,e,n){var i=n(35);"string"==typeof i&&(i=[[t.i,i,""]]);n(37)(i,{hmr:!0,transform:void 0,insertInto:void 0}),i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(36)(!1)).push([t.i,".danmu{overflow:hidden;-webkit-user-select:none;-moz-user-select:none;user-select:none;-ms-user-select:none}.danmu>*{position:absolute;white-space:nowrap}.danmu-switch{width:32px;height:20px;border-radius:100px;background-color:#ccc;-webkit-box-sizing:border-box;box-sizing:border-box;outline:none;cursor:pointer;position:relative;text-align:center;margin:10px auto}.danmu-switch.danmu-switch-active{padding-left:12px;background-color:#f85959}.danmu-switch span.txt{width:20px;height:20px;line-height:20px;text-align:center;display:block;border-radius:100px;background-color:#fff;-webkit-box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);box-shadow:-2px 0 0 0 rgba(0, 0, 0, .04);font-family:PingFangSC;font-size:10px;font-weight:500;color:#f44336}",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var o="/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */";return[n].concat(i.sources.map(function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"})).concat([o]).join("\n")}return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},o=0;o<this.length;o++){var r=this[o][0];"number"==typeof r&&(i[r]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),e.push(a))}},e}},function(t,e,n){var i,o,r,a,s={},l=(r=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=r.apply(this,arguments)),a}),u=function(t){return document.querySelector(t)},c=(o={},function(t){if("function"==typeof t)return t();if(void 0===o[t]){var e=u.call(this,t);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}o[t]=e}return o[t]}),h=null,f=0,d=[],p=n(38);function m(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=s[i.id];if(o){o.refs++;for(var r=0;r<o.parts.length;r++)o.parts[r](i.parts[r]);for(;r<i.parts.length;r++)o.parts.push(k(i.parts[r],e))}else{var a=[];for(r=0;r<i.parts.length;r++)a.push(k(i.parts[r],e));s[i.id]={id:i.id,refs:1,parts:a}}}}function v(t,e){for(var n=[],i={},o=0;o<t.length;o++){var r=t[o],a=e.base?r[0]+e.base:r[0],s={css:r[1],media:r[2],sourceMap:r[3]};i[a]?i[a].parts.push(s):n.push(i[a]={id:a,parts:[s]})}return n}function g(t,e){var n=c(t.insertInto);if(!n)throw Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=d[d.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),d.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var o=c(t.insertInto+" "+t.insertAt.before);n.insertBefore(e,o)}}function y(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=d.indexOf(t);e>=0&&d.splice(e,1)}function b(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),_(e,t.attrs),g(t,e),e}function _(t,e){Object.keys(e).forEach(function(n){t.setAttribute(n,e[n])})}function k(t,e){if(e.transform&&t.css){if(!(r=e.transform(t.css)))return function(){};t.css=r}if(e.singleton){var n,i,o,r,a,s,l=f++;i=T.bind(null,n=h||(h=b(e)),l,!1),o=T.bind(null,n,l,!0)}else{;t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(a=e,s=document.createElement("link"),void 0===a.attrs.type&&(a.attrs.type="text/css"),a.attrs.rel="stylesheet",_(s,a.attrs),g(a,s),i=x.bind(null,n=s,e),o=function(){y(n),n.href&&URL.revokeObjectURL(n.href)}):(i=C.bind(null,n=b(e)),o=function(){y(n)})}return i(t),function(e){e?(e.css!==t.css||e.media!==t.media||e.sourceMap!==t.sourceMap)&&i(t=e):o()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=l()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=v(t,e);return m(n,e),function(t){for(var i,o=[],r=0;r<n.length;r++){var a=n[r];(i=s[a.id]).refs--,o.push(i)}for(t&&m(v(t,e),e),r=0;r<o.length;r++)if(0===(i=o[r]).refs){for(var l=0;l<i.parts.length;l++)i.parts[l]();delete s[i.id]}}};var w,O=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function T(t,e,n,i){var o=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=O(e,o);else{var r=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(r,a[e]):t.appendChild(r)}}function C(t,e){var n=e.css,i=e.media;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function x(t,e,n){var i=n.css,o=n.sourceMap,r=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||r)&&(i=p(i)),o&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([i],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:"url("+JSON.stringify(0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""))+")"})}}])},t.exports=n()}}]);