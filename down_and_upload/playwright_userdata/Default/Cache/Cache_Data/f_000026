/*! For license information please see player-11.48630a35.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xss={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var r=/[^a-zA-Z0-9\\_:.-]/gim,i=/</g,a=/>/g,o=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,u=/&colon;?/gim,d=/&newline;?/gim,c=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,l=/u\s*r\s*l\s*\(.*/gi,h=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,f=/"/g,g=function(e){return e.replace(i,"&lt;").replace(a,"&gt;")},_={indexOf:function(e,t){var n,r;for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return -1},forEach:function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)t.call(n,e[r],r,e)},some:function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r,e))return!0;return!1},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},uniq:function(e){for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]||(n.push(e[r]),t[e[r]]=!0);return n},from:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},keys:function(e){var t=[];for(var n in e)t.push(n);return t}};function p(e){return null==e}function v(e){var t;return'"'===(t=e)[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]?e.substr(1,e.length-2):e}function m(e){var t,n,r,i,a,o,s,u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d="",c=0;for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?t+=String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):t+=String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128)}return t}(e);c<e.length;)i=(t=e.charCodeAt(c++))>>2,a=(3&t)<<4|(n=e.charCodeAt(c++))>>4,o=(15&n)<<2|(r=e.charCodeAt(c++))>>6,s=63&r,isNaN(n)?o=s=64:isNaN(r)&&(s=64),d=d+u.charAt(i)+u.charAt(a)+u.charAt(o)+u.charAt(s);return d}function y(e){var t,n,r,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",d=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");d<e.length;)t=s.indexOf(e.charAt(d++))<<2|(i=s.indexOf(e.charAt(d++)))>>4,n=(15&i)<<4|(a=s.indexOf(e.charAt(d++)))>>2,r=(3&a)<<6|(o=s.indexOf(e.charAt(d++))),u+=String.fromCharCode(t),64!==a&&(u+=String.fromCharCode(n)),64!==o&&(u+=String.fromCharCode(r));return function(e){for(var t="",n=0,r=0,i=0,a=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(t+=String.fromCharCode((31&r)<<6|63&(a=e.charCodeAt(n+1))),n+=2):(a=e.charCodeAt(n+1),t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&(i=e.charCodeAt(n+2))),n+=3);return t}(u)}function b(e,t,n){var r="",i=0,a=!1,o=!1,s=0,u=e.length,d="",c="";e:for(s=0;s<u;s++){var l=e.charAt(s);if(!1===a){if("<"===l){a=s;continue}}else if(!1===o){if("<"===l){r+=n(e.slice(i,s)),a=s,i=s;continue}if(">"===l||s===u-1){r+=n(e.slice(i,a)),d=function(e){var t,n=_.spaceIndex(e);return t=-1===n?e.slice(1,-1):e.slice(1,n+1),"/"===(t=_.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}(c=e.slice(a,s+1)),r+=t(a,r.length,d,c,"</"===c.slice(0,2)),i=s+1,a=!1;continue}if('"'===l||"'"===l)for(var h=1,f=e.charAt(s-h);""===f.trim()||"="===f;){if("="===f){o=l;continue e}f=e.charAt(s-++h)}}else if(l===o){o=!1;continue}}return i<u&&(r+=n(e.substr(i))),r}function E(e,t){var n=0,i=0,a=[],o=!1,s=e.length;function u(e,n){if(!((e=(e=_.trim(e)).replace(r,"").toLowerCase()).length<1)){var i=t(e,n||"");i&&a.push(i)}}for(var d=0;d<s;d++){var c=e.charAt(d),l=void 0;if(!1!==o||"="!==c){if(!1===o||d!==i){if(/\s|\n|\t/.test(c)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(l=function(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}return -1}(e,d))){u(_.trim(e.slice(n,d))),o=!1,n=d+1;continue}d=l-1;continue}if(-1===(l=function(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}return -1}(e,d-1))){u(o,v(_.trim(e.slice(n,d)))),o=!1,n=d+1;continue}}}else{if(-1===(l=e.indexOf(c,d+1)))break;u(o,_.trim(e.slice(i+1,l))),o=!1,n=(d=l)+1}}else o=e.slice(n,d),n=d+1,i='"'===e.charAt(n)||"'"===e.charAt(n)?n:function(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"'"===n||'"'===n?t:-1}return -1}(e,d+1)}return n<e.length&&(!1===o?u(e.slice(n)):u(o,v(_.trim(e.slice(n))))),_.trim(a.join(" "))}function T(e,t,n){if(n=function(e){return e=function(e){for(var t="",n=0,r=e.length;n<r;n++)t+=32>e.charCodeAt(n)?" ":e.charAt(n);return _.trim(t)}(e=(e=(e=e.replace(s,'"')).replace(o,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})).replace(u,":").replace(d," "))}(n),"href"===t||"src"===t){if("#"===(n=_.trim(n)))return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"data:image/"!==n.substr(0,11)&&"ftp://"!==n.substr(0,6)&&"./"!==n.substr(0,2)&&"../"!==n.substr(0,3)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(c.lastIndex=0,c.test(n))return""}else if("style"===t&&(h.lastIndex=0,h.test(n)||(l.lastIndex=0,l.test(n)&&(c.lastIndex=0,c.test(n)))))return"";return n=function(e){return e=g(e=e.replace(f,"&quot;"))}(n)}var k=function(e){return"string"==typeof e?e.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},x=function(){function e(e){var t=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=T,t.escapeHtml=g,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,n,r,i,a,o,s=this.options,u=s.whiteList,d=s.onTag,c=s.onIgnoreTag,l=s.onTagAttr,h=s.onIgnoreTagAttr,f=s.safeAttrValue,g=s.escapeHtml;s.stripBlankChar&&(e=(t=(t=e.split("")).filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")),s.allowCommentTag||(e=function(e){for(var t="",n=0;n<e.length;){var r=e.indexOf("\x3c!--",n);if(-1===r){t+=e.slice(n);break}t+=e.slice(n,r);var i=e.indexOf("--\x3e",r);if(-1===i)break;n=i+3}return t}(e));var p=!1;s.stripIgnoreTagBody&&(n=s.stripIgnoreTagBody,"function"!=typeof(r=c)&&(r=function(){}),i=!Array.isArray(n),a=[],o=!1,c=(p={onIgnoreTag:function(e,t,s){var u;if(u=e,i||-1!==_.indexOf(n,u)){if(s.isClosing){var d="[/removed]",c=s.position+d.length;return a.push([!1!==o?o:s.position,c]),o=!1,d}return o||(o=s.position),"[removed]"}return r(e,t,s)},remove:function(e){var t="",n=0;return _.forEach(a,function(r){t+=e.slice(n,r[0]),n=r[1]}),t+=e.slice(n)}}).onIgnoreTag);var v=b(e,function(e,t,n,r,i){var a={sourcePosition:e,position:t,isClosing:i,isWhite:Object.prototype.hasOwnProperty.call(u,n)},o=d(n,r,a);if(null!=o)return o;if(a.isWhite){if(a.isClosing)return"</".concat(n,">");var s=function(e){var t=_.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=_.trim(e.slice(t+1,-1)))[e.length-1];return n&&(e=_.trim(e.slice(0,-1))),{html:e,closing:n}}(r),p=u[n],v=E(s.html,function(e,t){var r=-1!==_.indexOf(p,e),i=l(n,e,t,r);return null==i?r?(t=f(n,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(i=h(n,e,t,r))?void 0:i:i});return r="<".concat(n),v&&(r+=" ".concat(v)),s.closing&&(r+=" /"),r+=">"}return null==(o=c(n,r,a))?g(r):o},g);return p&&(v=p.remove(v)),v},e}(),R=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),w=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,n,r="douyin_web";if(!_.includes(r,"bid"))return r;if(e.config&&e.config.bid)return e.config.bid;if(R&&R._xssBid)return R._xssBid;if(R&&R.slardar&&"function"==typeof R.slardar.config){var i=(R.slardar.config()||{}).bid;if(i)return i}if(R&&R.Slardar&&"function"==typeof R.Slardar.config){var a=(R.Slardar.config()||{}).bid;if(a)return a}return(null===(n=null===(t=null==R?void 0:R.Slardar)||void 0===t?void 0:t._baseParams)||void 0===n?void 0:n.bid)||"argus"},this.getConfigRegion=function(){var t;return _.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==R?void 0:R.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var t={cn:y("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:y("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:y("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[e.getConfigRegion()];if(t)return t+e.getSlardarBid()}}return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var n=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),R.fetch(t,{method:"post",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).catch(function(e){}),e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=function(e){return e.collectKey?[e.collectMode,e.collectKey].join("___"):""},e.prototype.push=function(e){this.batchData.push(e),this.upload()},e.prototype.report=function(e){var t=this.generateKey(e);if(R.fetch&&e.collectKey){var n="object"==typeof window?window.location.href:"SSR";e.documentUrl=n;var r={age:Math.floor(Date.now()),type:"xss",url:n,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==n||(r.url=t),"SSR"===n&&(r.url="SSR___".concat(r.url),r.body.ssr=!0),this.push(r)}},e}()),I=function(e){for(var t=0,n=function(n){Array.isArray(e[n])?0===e[n].length?delete e[n]:(e[n]=_.from(_.uniq(e[n])),t+=e[n].length):0===_.keys(e[n]).length?delete e[n]:_.keys(e[n]).forEach(function(r){e[n][r]=_.from(_.uniq(e[n][r])),t+=e[n][r].length})},r=0,i=_.keys(e);r<i.length;r++)n(i[r]);return{count:t,ret:e}};function O(e,t){return w.setConfig(t),new x(t).process(e)}function S(e){var t,n=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===n)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=e.slice(n+1,-1).trim())[e.length-1];return r&&(e=e.slice(0,-1).trim()),{html:e,closing:r}}var D=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(e,t,n,r){return String.fromCharCode(t?parseInt(n,16):parseInt(r))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function A(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=D(e),_.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!_.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var n=["expression(","behavior:","view-source:"];if(_.some(n,function(t){return -1!==e.indexOf(t)}))return _.forEach(n,function(n){-1!==e.indexOf(n)&&t&&t(n)}),!1;var r=["data:application","data:javascript","data:text/html","data:texthtml"];if(_.some(r,function(t){return -1!==e.indexOf(t)}))return _.forEach(r,function(n){-1!==e.indexOf(n)&&t&&t(n)}),!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var i=e.slice(11).replace(/\s/g,"").trim();return!!_.some(["void","void(0)","void0","false","undefined",";"],function(e){return e===i})||(t&&t("javascript:"),!1)}return!0}var L=function(e,t){var n,r,i="<%= isSaveValidUrl =>";if("string"!=typeof e||(r=Number("<%= urlLimit =>"),void 0!==n&&(r=n),"NaN"!==e.toString()&&-1!==r&&e.length>=r)||A(e,t))return e;try{if(!0===(i=JSON.parse(i))||"true"===i){var a=new URL(e);return a.origin+a.pathname}}catch(e){}return"#"};function C(e,t,r){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!A(e=D(e)))return!1;var i,a={url:(i=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:i[1],slash:i[2],host:i[3],port:i[4],path:i[5],query:i[6],hash:i[7]},o=a.scheme,s=a.host;return r?!!r(e):!(!o||!s)&&(!_.includes(["http","https","file"],o)||("object"==typeof window&&window&&(t=n(n([],t,!0),[location.host],!1)),_.some(t,function(e){return!!(e instanceof RegExp&&e.test(s))||e===s})))}var P={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},M={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=I(this.collect),t=e.count,n=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(n),collectMode:"white"}},onIgnoreTagAttr:function(e,t,r){return e&&_.indexOf(["href","src"],t)>-1?M.domainWhiteList&&Array.isArray(M.domainWhiteList)&&M.domainWhiteList.length>0&&!C(r,n([],M.domainWhiteList,!0))?"":"".concat(t,'="').concat(L(r,function(e){var t;null===(t=M.collect)||void 0===t||t.filterProtocol.push(e)}),'"'):e&&(_.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(r,'"'):(M.collect.whiteList[e]=M.collect.whiteList[e]||[],void M.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;b(t,function(e,t,n,r){E(S(r).html.replace("/",""),function(e){M.collect.whiteList[n]=M.collect.whiteList[n]||[],M.collect.whiteList[n].push(e)})},g)},whiteList:P,mergeWhiteList:function(e){for(var t,n={},r=0,i=_.keys(P);r<i.length;r++)n[t=i[r]]=_.from(P[t]);for(var a=0,o=_.keys(e);a<o.length;a++)n[t=o[a]]=t in P?P[t].concat(e[t]):_.from(e[t]);return n},setWhiteList:function(e){for(var t=0,n=_.keys(e);t<n.length;t++){var r=n[t];this.whiteList[r]=r in P?P[r].concat(e[r]):_.from(e[r])}}};try{var N={},Z="merge";_.includes(Z,"override")&&(M.whiteList=N.whiteList),_.includes(Z,"merge")&&M.setWhiteList(N.whiteList)}catch(e){}var U=function(e,t){for(var n={},r=0,i=_.keys(e);r<i.length;r++){var a=i[r];Array.isArray(e[a])?n[a]=_.from(e[a]):n[a]=U({},e[a])}for(var o=0,s=_.keys(t);o<s.length;o++)(a=s[o])in e?Array.isArray(e[a])?n[a]=e[a].concat(t[a]):n[a]=U(e[a],t[a]):Array.isArray(t[a])?n[a]=_.from(t[a]):n[a]=U({},t[a]);return n},H={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var j={};j.blackAttrRegExps&&(j.blackAttrRegExps=j.blackAttrRegExps.map(function(e){return new RegExp(e.toString().slice(1,e.toString().length-1))}));var W="merge";_.includes(W,"override")&&(H=j),_.includes(W,"merge")&&(H=U(H,j))}catch(e){}var F={mode:"black",whiteList:{},blackConfig:H,collect:null,initCollect:function(){F.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var e=I(F.collect),t=e.count,n=e.ret;return F.collect=null,{collectKey:0===t?null:JSON.stringify(n),collectMode:"black"}},onIgnoreTag:function(e,t){var n;if(!_.includes(H.blackTags,e))return b(t,function(e,t,n,r,i){if(-1!==n.indexOf("/"))return g(r);if(i)return"</".concat(n,">");var a=S(r),o=E(a.html,function(e,t){var r,i=0;if(H.blackList[n]&&_.includes(H.blackList[n],e)&&(F.collect.blackList[n]=F.collect.blackList[n]||[],F.collect.blackList[n].push(e),i++),H.blackAttrRegExps.length&&H.blackAttrRegExps.some(function(t){return t.test(e)})&&_.forEach(H.blackAttrRegExps,function(t){t.test(e)&&(F.collect.blackAttrRegExps.push("".concat(t.toString(),"->").concat(e)),i++)}),H.blackAttrs.length&&_.includes(H.blackAttrs,e)&&(H.blackAttrs.push(e),i++),!i){if(H.filterList&&H.filterList[n]&&_.includes(H.filterList[n],e)){var a=L(t,function(e){var t;null===(t=F.collect)||void 0===t||t.filterProtocol.push(e)});return a!==t&&(F.collect.filterList[n]=F.collect.filterList[n]||[],F.collect.filterList[n].push(e)),t?"".concat(e,"='").concat(a,"'"):e}return H.filterAttrs&&_.includes(H.filterAttrs,e)?((a=L(t,function(e){var t;null===(t=F.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(r=F.collect)||void 0===r||r.filterAttrs.push(e)),t?"".concat(e,"='").concat(a,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return r="<".concat(n),o&&(r+=" ".concat(o)),a.closing&&(r+=" /"),r+=">"},g);null===(n=F.collect)||void 0===n||n.blackTags.push(e)}},B=function(e){var t=e.reportOnly,n=void 0===t||t,r=e.block;return n&&"all"===n?"report":("string"==typeof n&&("true"===n&&(n=!0),"false"===n&&(n=!1)),r?"enforce":n?"report":"enforce")},V=function(e){return function(n,r,i){if(!n||"string"!=typeof n)return n;var a=r;e===O&&(a=M).initCollect();var o=e(n,a);if(k(o)===k(n))return n;if(!i)return o;var s=i.logType,u=B(i),d=a.removeCollect();return w.report(t(t({type:s,disposition:u},d),{sourceText:m(n),filterText:m(o)})),"enforce"===u?o:n}},Y=V(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new x(t).process(e)}),J=V(O),G=function(e,t,n){var r=[],i=L(e,function(e){r.push(e)});if(i===e)return e;r=_.from(_.uniq(r));var a=t||n||{};if(!a)return i;var o=a.logType,s=B(n);return w.report({type:o,disposition:s,collectKey:r.join("___"),collectData:JSON.stringify(r),collectMode:"black",sourceText:m(e),filterText:m(i)}),"enforce"===s?i:e},K=R._xssProject||{},X=R.xssNamespace||{},z="3.0.26",q={FilterXSS:x,version:z,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:Y,_filterXSS:J,filterUrl:G,Config:M,BlackConfig:F,project:K,setProjectName:function(e){K[e]=this,R._xssProjectName=e}};X.douyin_web=q,R.xssNamespace=X,R.Math&&!R.Math.xssNamespace&&(R.Math.xssNamespace=X),K[z]=q,R.globalThis=R,R.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:q},R.xss=q,R.isSafeUrl=C,R.isSafeDomain=C,R.isSafeProtocol=A,R._xssProject=K,R._xssProjectName&&(K[R._xssProjectName]=q);var Q=q.setProjectName.bind(q);e.BlackConfig=F,e.Config=M,e.FilterXSS=x,e._filterXSS=J,e.filterUrl=G,e.filterXSS=Y,e.isSafeDomain=C,e.isSafeProtocol=A,e.isSafeUrl=C,e.project=K,e.setProjectName=Q,e.setXssNamespace=function(e){var t=e.appId,n=e.bid,r=e.region;X[t]=q;M.bid=n,M.region=r,M.enabled=!0},e.xssNamespace=X,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["81712"],{515842:function(e,t,n){function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,n){return(t=c(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){o(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function d(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n={};for(var r in e)if(({}).hasOwnProperty.call(e,r)){if(-1!==t.indexOf(r))continue;n[r]=e[r]}return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],-1===t.indexOf(n)&&({}).propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}n.d(t,{Ac:function(){return l},Kd:function(){return d},PA:function(){return r},Zj:function(){return u},_x:function(){return o},qH:function(){return a}});function c(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},229813:function(e,t,n){n.d(t,{Zj:function(){return i}});function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){var r,i,a;r=e,i=t,a=n[t],(i=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(i))in r?Object.defineProperty(r,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):r[i]=a}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}},73988:function(e,t,n){n.d(t,{T:function(){return i}}),n(465132),n(721911),n(110617);var r=[{range:[0,90],size:614400},{range:[90,120],size:819200},{range:[120,Number.MAX_VALUE],size:1024e3}];function i(e,t,n){var i=n>51200?Math.min(n,t):t;if(!e)return i||r[0].size;var a=r.find(function(t){return e>=t.range[0]&&e<t.range[1]});return a&&(i=Math.min(a.size,n>0?n:t)),i||r[0].size}},94701:function(e,t,n){n.d(t,{Z:function(){return o}});var r=n(452006);n(836654),n(691842),n(465132),n(891555),n(499953),n(721911),n(110617);var i=n(336397),a=n(298028),o=function(e){function t(e,n,i,o,s){var u;return(0,r.PA)(this,t),(u=(0,r.$w)(this,t,[e,n,i,o,s])).logTag="".concat(s,"_").concat(a.TJ.GOP)||"",u.lastDemuxSampleIdxRange.video=-1,u.lastDemuxSampleIdxRange.audio=-1,u.adaptTimeRange=[],u}return(0,r.XW)(t,e),(0,r.qH)(t,[{key:"updateAdaptTimeRange",value:function(e,t){!this.adaptTimeRange&&(this.adaptTimeRange=[]),this.lastTargetDur=t;var n=this.adaptTimeRange;null===e&&(e=n.length>0?n[n.length-1].timeRangeIdx[1]:0);for(var r=0;r<(null==n?void 0:n.length);r++){var a=n[r].timeRangeIdx;if(a&&e>=a[0]&&e<a[1])return this.log(i._.LOG,"has adaptTimeRange,startSrcIdx: ".concat(e,", adaptTimeRangeIdx: ").concat(r,", dur: ").concat(t),JSON.stringify(n[r])),r}var o=n.length>0?n[n.length-1].timeRangeIdx[1]:0;if(o>=this.timeRange.length)return n.length-1;for(;o<e;){var s=this.timeRange[o].startTime,u=this.timeRange[o].endTime,d={startTime:s,endTime:u,timeRangeIdx:[o,o+1],duration:u-s,downloaded:!1,isLoading:!1};this.adaptTimeRange.push(d),this.updateTimeRangeInAdaptTimeRangeIdx(d.timeRangeIdx,this.adaptTimeRange.length-1),this.log(i._.LOG,"gap adaptTimeRange,adaptTimeRangeIdx: ".concat(this.adaptTimeRange.length-1),JSON.stringify(d)),o++}for(var c=0,l=o,h=o;h<this.timeRange.length;h++)if(c<t)c+=this.timeRange[h].endTime-this.timeRange[h].startTime;else{l=h;break}h===this.timeRange.length&&(l=this.timeRange.length);var f=[o,l],g=this.timeRange[f[0]].startTime,_=f[1]===this.timeRange.length?this.timeRange[f[1]-1].endTime:this.timeRange[f[1]].startTime,p={startTime:g,endTime:_,timeRangeIdx:f,duration:_-g,downloaded:!1,isLoading:!1};return this.log(i._.LOG,"update adaptTimeRange,startIdx,",f[0],", dur,",t,JSON.stringify(p)),this.adaptTimeRange.push(p),this.updateTimeRangeInAdaptTimeRangeIdx(f,this.adaptTimeRange.length-1),this.adaptTimeRange.length-1}},{key:"getAdaptIdxBySrcIdx",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.adaptTimeRange.length;if(!n&&e>=(null===(t=this.adaptTimeRange[r-1])||void 0===t?void 0:t.timeRangeIdx[1])){var i=this.lastTargetDur||5;this.updateAdaptTimeRange(e,i)}for(var a=0;a<this.adaptTimeRange.length;a++){var o=this.adaptTimeRange[a].timeRangeIdx;if(o&&e>=o[0]&&e<o[1])return a}return this.adaptTimeRange.length-1}},{key:"getFragmentIdx",value:function(e){if(!(null!==(t=this.videoTrak)&&void 0!==t&&t.length))return(r=null===(i=this.audioTrak)||void 0===i?void 0:i.find(function(t){return t.startTime<=e&&t.endTime>e}))?r.index:0;if(n=this.videoTrak.find(function(t){return t.startTime<=e&&t.endTime>e}),r=null===(a=this.audioTrak)||void 0===a?void 0:a.find(function(t){return t.startTime<=e&&t.endTime>e}),n&&r)return Math.min(n.index,r.index);if(n||r)return n?n.index:r.index;else{var t,n,r,i,a,o=Number.MAX_VALUE;return this.videoTrak.length>0&&(o=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(o=Math.min(this.audioTrak.length-1,o)),o}}},{key:"resetFragmentLoadState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.log(i._.LOG,", resetFragmentLoadState, fragIndex, ",e,",changeBitrate,",t);var n=this.adaptTimeRange.length;t&&(this.adaptTimeRange.splice(e+1,n-e-1),n=this.adaptTimeRange.length);for(var r=0;r<n;r++)if(r<e?(this.adaptTimeRange[r].downloaded=!0,this.adaptTimeRange[r].isLoading=!0):(this.adaptTimeRange[r].downloaded=!1,this.adaptTimeRange[r].isLoading=!1),t){this.adaptTimeRange[r].range=null;var a=this.adaptTimeRange[r].timeRangeIdx;if(a&&a[0]>=this.timeRange.length){this.log(i._.WARN,"fix adaptTimeRange fragIndex ".concat(e)," ,timeRangeIdx[0] >= this.timeRange.length, so end",a[0],this.timeRange.length,",endFragment,",r),this.adaptTimeRange=this.adaptTimeRange.slice(0,r);break}a&&a[1]>=this.timeRange.length&&(this.log(i._.WARN,"fix adaptTimeRange fragIndex",e," ,timeRangeIdx[1],",a[1],">>>>",this.timeRange.length,",endFragment,",r),a[1]=this.timeRange.length,this.adaptTimeRange=this.adaptTimeRange.slice(0,r+1)),this.adaptTimeRange[r].startTime=this.timeRange[a[0]].startTime,this.adaptTimeRange[r].endTime=a&&a[1]>=this.timeRange.length?this.timeRange[this.timeRange.length-1].endTime:this.timeRange[a[1]].startTime,this.adaptTimeRange[r].range=this.getFragRange(r)}}},{key:"calculateRange",value:function(e){var t,n,a,o,s=null,u=null,d=null,c=null,l=e<this.adaptTimeRange.length?this.adaptTimeRange[e].timeRangeIdx:null;if(!l){this.log(i._.WARN,"calculateRange err",e,JSON.stringify(this.adaptTimeRange));return}var h=l[0],f=l[1];this.log(i._.LOG,"getFragRange, timeRangeIdx,",JSON.stringify(l));var g=this.videoTrak;g&&(s=h<g.length?g[h]:g[g.length-1],u=f<g.length?g[f-1]:g[g.length-1]);var _=this.audioTrak;_&&(d=h<_.length?_[h]:_[_.length-1],c=f<_.length?_[f-1]:_[_.length-1]);var p=[Math.min((null===(t=s)||void 0===t?void 0:t.range[0])||1/0,(null===(n=d)||void 0===n?void 0:n.range[0])||1/0),Math.max.apply(Math,(0,r.u)([null===(a=u)||void 0===a?void 0:a.range[1],null===(o=c)||void 0===o?void 0:o.range[1]].filter(function(e){return"number"==typeof e})).concat([0]))];return this.log(i._.LOG,"calculateRange",e,p[0],"-",p[1]),p}},{key:"getTimeRangeByIdx",value:function(e){var t,n,r,i=null,a=this.videoTrak;a&&(i=e<a.length?a[e]:a[a.length-1]);var o=null,s=this.audioTrak;return s&&(o=e<s.length?s[e]:s[s.length-1]),[Math.min((null===(t=i)||void 0===t?void 0:t.range[0])||1/0,(null===(n=o)||void 0===n?void 0:n.range[0])||1/0),Math.max(i?i.range[1]-1:0,o?(null===(r=o)||void 0===r?void 0:r.range[1])-1:0)]}},{key:"getFragRange",value:function(e){if(e<this.adaptTimeRange.length&&null!==(t=this.adaptTimeRange[e])&&void 0!==t&&t.range)return this.log(i._.LOG,"getFragRange exist",e,JSON.stringify(this.adaptTimeRange[e].range)),this.adaptTimeRange[e].range;var t,n=this.calculateRange(e);if(n&&e<this.adaptTimeRange.length){this.adaptTimeRange[e].range=n;var r=this.adaptTimeRange[e].timeRangeIdx[1];if(r<this.timeRange.length){var a=this.getTimeRangeByIdx(r);(null==a?void 0:a.length)>1&&a[0]<a[1]&&n[1]>a[0]&&(this.adaptTimeRange[e].repeatRange=[a[0],n[1]])}}return n}},{key:"getSubRange",value:function(e,t,n){for(var r=this.adaptTimeRange[e].timeRangeIdx,a=r[0],o=r[0];o<r[1];o++)if(t>=this.timeRange[o].startTime&&t<this.timeRange[o].endTime){a=o;break}var s=[this.getSrcFragRange(a)[0],n[1]];return this.log(i._.LOG,">>>>>getSubRange finalRange ",JSON.stringify(s),",oldRange,",JSON.stringify(n)),s}},{key:"getSrcFragRange",value:function(e){var t,n,r,a=null,o=null;this.log(i._.LOG,"getFragRange, timeRangeIdx, srcFragment,",JSON.stringify(e));var s=this.videoTrak;s&&s.length>0&&(a=e<s.length?s[e]:s[s.length-1]);var u=this.audioTrak;u&&u.length>0&&(o=e<u.length?u[e]:u[u.length-1]);var d=[Math.min((null===(t=a)||void 0===t?void 0:t.range[0])||1/0,(null===(n=o)||void 0===n?void 0:n.range[0])||1/0),Math.max(a&&(null===(r=a)||void 0===r?void 0:r.range[1])-1||0,o&&o.range[1]-1||0)];return this.log(i._.LOG,",getSrcFragRange",e,d),d}},{key:"getSamplesRange",value:function(e,t){var n=void 0,r="video"===t?this.videoTrak:this.audioTrak,i=this.lastDemuxSampleIdxRange[t],a=this.adaptTimeRange[e].timeRangeIdx;if(r&&r.length>0){var o=a[1]-1,s=r.length,u=o<s?r[o].frames:r[s-1].frames;n=[i+1,u[u.length-1].index]}return n}}])}(n(235879).Yx)},1285:function(e,t,n){n.d(t,{Z:function(){return E}});var r,i,a=n(22450);n(836654),n(691842),n(910795),n(464135),n(891555),n(981168),n(634856),n(429532),n(98601),n(110617),n(927234),n(742611);var o=n(734123),s=n(174883),u=n(212401),d=n(907769),c=n(749517),l=n(41659),h=n(810815),f=n(906579),g=n(258817),_=n(779517),p=n(806394),v=n(119106),m=n(21976),y=n(546041),b=h.iS;var E=(0,a.qH)(function e(t){var n,r=this;(0,a.PA)(this,e),(0,a._x)(this,"start",(n=(0,a.x)((0,a.l5)().mark(function e(t){var n,i,o,u,d,_,p;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r._beforeLoadStartCostTime=0,r._tm=g.Z.nowTime(),r._sTime=g.Z.nowTime(),!r._checkHasDestroy("start")){e.next=5;break}return e.abrupt("return");case 5:if(r._hasStart&&(r.__dash__&&(r.__dash__.destroy(),r.__dash__=null),r._initProfile(),r._initialize(),r._hasStart=!1),r.setNodeTime("newplayer_start"),n=Date.now(),i=r.__dash__,u=(o=r._pluginInst).player,d=o.config,u.dashState=h.kI,u.emit("dashStateChange",h.kI),!t&&(t=u.config.url="anytext"),_=new s.Z(t,r._pluginInst,i),i){e.next=17;break}return r._info({msg:"__dash__ is null, dashOpts",startMs:n,name:"start __dash__"}),e.abrupt("return");case 17:return i.initDash(_),i.dashVideoEncrypted||i.dashAudioEncrypted||r._pluginInst.softVideo?(c.ZP.log("加密视频"),p=!1===d.useEME,d.useEME=(0,f.isEMESupported)(),(p||r._pluginInst.softVideo)&&(d.useEME=!1),d.intertrustServerURL&&(d.useEME=!0),!d.useEME&&(i.crypto=new l.Z),_.useEME=d.useEME,r._info({msg:"encrypt video ready useEME ".concat(_.useEME)})):(c.ZP.log("非加密视频"),r._info({msg:" no encrypt video ready"})),u.dashState=h.h4,u.emit("dashStateChange",h.h4),e.next=23,r._onWasmReady({url:t});case 23:r._info({msg:"info player start execute",startMs:n,name:"start",profile:!0}),r._hasStart=!0;case 25:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})),(0,a._x)(this,"_onLoadStart",function(){var e=r._pluginInst.config,t=g.Z.nowTime()-r._tm;r._beforeLoadStartCostTime=t>100?100:t,r.changeState("loadstart","beforeLoadStartCostTime ".concat(r._beforeLoadStartCostTime)),e.mseOpenTimeout>0&&(c.ZP.log("mOPenTime",e.mseOpenTimeout,performance.now()),r._mseOpenTimeoutId=setTimeout(function(){c.ZP.log("Timeout",performance.now()),r._errorHandler(new p.Z(u.wb.MEDIA,p.Z.MSE_OPEN_TIMEOUT,{message:"mse open timeout"})),r._clearMseOpenTimeout();var e,t,n=parseInt((0,v.uS)(h.Hy)||"0")+1;(0,v.iR)(h.Hy,n),null===(e=r.__dash__)||void 0===e||e.destroy(),null===(t=r.__dash__)||void 0===t||null===(t=t.dash)||void 0===t||t.destroy()},e.mseOpenTimeout))}),(0,a._x)(this,"_onLoadData",(0,a.x)((0,a.l5)().mark(function e(){var t,n,i;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.changeState("loaddata"),null==(i=r.__dash__)||null===(t=i.dash)||void 0===t||t.checkPCDN(),null==i||null===(n=i.dash)||void 0===n||n.cachePreloadData(),c.ZP.log("未起播计时 clearCheckCanplayTimer"),i.clearCheckCanplayTimer(),!(null!=i&&i.abrInstance)){e.next=10;break}return e.next=9,i.abrInstance.init(i.dash.mpd.mediaList);case 9:i.abrInstance.execute();case 10:case"end":return e.stop()}},e)}))),(0,a._x)(this,"_errorHandler",function(e){if(r._checkHasDestroy("errorHandler"))return;var t,n,i,s=r._pluginInst,d=s.player,l=s.config;if(l.codecType===m.$V[m.d0.HEVC].logCodeType&&(null===(t=d.video.error)||void 0===t||null===(t=t.message)||void 0===t?void 0:t.indexOf("video decoder initialization failed"))>=0&&(c.ZP.log("ErrorHandler DECODER_FAILED"),d.emit("DECODER_FAILED",{codecType:l.codecType,vid:l.vid,message:e.message})),e instanceof p.Z)e=new o.Errors(d,e);else if(d.video.error)e=new o.Errors(d,{errorType:u.wb.MEDIA,errorCode:5100+d.video.error.code});else{var f=e;if("string"!=typeof e)try{f=JSON.stringify(e)}catch(e){f="other"}e=new o.Errors(d,{errorType:u.wb.OTHER,errorCode:0,errorMessage:f})}if(null===(n=r._pluginInst)||void 0===n||n.setStartTimelines(y.l1.PLAYER_ERROR,{message:"mse-".concat(e.message,"-").concat(e.errorCode)}),r._errors.push({time:new Date().getTime(),err:e}),d.emit("xglog_cache"),!!e&&d.dashState!==h.Ck&&d.dashState!==h.mD&&"mp4"!==l.defaultFormat){c.ZP.log(l.vid,e),d.dashState=h.Ck,e.vid=l.vid,e.url=d.src;var g=r.__dash__,_=g&&g.isCurrentAutoDefi;if(e.errd&&"object"===(0,a.Ac)(e.errd)&&g&&g.dash&&(e.errd.url=g.dash.url,e.url=g.dash.url),e.url&&e.url.indexOf("blob:")>-1&&l.dashOpts&&l.dashOpts.dynamic_video&&(e.url=l.dashOpts.dynamic_video.main_url),e&&(e.errorCode===r._getCode(u.wb.MEDIA,u.wb.SUB_TYPES.MSE_HIJACK)||e.errorCode===r._getCode(u.wb.MEDIA,u.wb.SUB_TYPES.EME_HIJACK))){d.emit("error",e);return}if(d.emit("DATA_REPORT",e),e&&e.errorCode===r._getCode(u.wb.DRM,u.wb.SUB_TYPES.LICENSE)){r._pluginInst.destroyKernal(),d.emit("error",e);return}if(e&&(e.errorCode===r._getCode(u.wb.MEDIA,u.wb.SUB_TYPES.MSE_ADD_SB)||e.errorCode===r._getCode(u.wb.DEMUX,u.wb.SUB_TYPES.SIDX))){r._handleDegradeToMp4(e);return}if(e.segmentExpired||e.msg===h.uD){g&&g.abrInstance&&"function"==typeof g.abrInstance._stop&&(g.abrInstance._stop(),c.ZP.abr("error stop","expired",e.segmentExpired,e.ex)),r._pluginInst.emitExpireEvent(e);return}if(!e.curReqVideoSegInfo&&g&&(e.curReqVideoSegInfo=JSON.parse(JSON.stringify(g.curReqVideoSegInfo||{}))),!e.headers&&(e.headers=e.curReqVideoSegInfo.headers||{}),l.useBackUrl&&!r._pluginInst._hasUsedBackUrl&&l.dashOpts&&l.dashOpts.dynamic_video&&g){c.ZP.log("backup replay");var v=g.changeMainBackUrl(b.ERR,r._pluginInst._hasUsedBackUrl);g.updateDashType(),_?v.autoBitrateOpts&&(v.autoBitrateOpts.isPlayAutoDefi=!0):(r.currentDefitionFromPlayer&&(v.defaultDefinition=r.currentDefitionFromPlayer.definition),v.autoBitrateOpts&&(v.autoBitrateOpts.isPlayAutoDefi=!1)),r._pluginInst._hasUsedBackUrl=!0,r._pluginInst.next(d.currentTime,"REPLAY",v,!0,"dash"),d.emit("playCatch","dash",e),c.ZP.log("playCatch dash",JSON.stringify(e)),r._emitDegradeEvent(e,"dash");return}g&&g.updateDashType(!0),e&&(null===(i=e)||void 0===i?void 0:i.errorCode)===p.Z.BACK_URL_FAIL&&(d.fallBackFail=!0),r._handleDegradeToMp4(e)}}),this._pluginInst=t,this._errors=[],this._initProfile(),this._proxyPlayer(),this._initialize(),this._bindEvents()},[{key:"changeState",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!this._pTime&&(this._pTime=g.Z.nowTime());var r=g.Z.nowTime()-this._pTime,i=g.Z.nowTime()-this._sTime;c.ZP.log(null===(t=this._pluginInst)||void 0===t||null===(t=t.config)||void 0===t?void 0:t.vid,">>>changeState[".concat(e,"]"),r,i,JSON.stringify(n));var a={state:e,t1:r,t2:i,data:n};!this.states[e]&&(this.states[e]=a),this.allPhases.push(a),this._pTime=g.Z.nowTime()}},{key:"_initProfile",value:function(){this.states={},this.preloadMap={},this.allPhases=[]}},{key:"setNodeTime",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.changeState(e,t),n&&this.setPreloadData(e,t),"initmse_sbopendone"===e&&(c.ZP.log("clear Timeout sbopendone",performance.now()),this._clearMseOpenTimeout())}},{key:"setPreloadData",value:function(e,t){this.preloadMap[e]=t}},{key:"_proxyPlayer",value:function(){var e=this._pluginInst.player;this._originSwitchURL=e.switchURL,this._originErrorHandler=e.errorHandler,e.switchURL=this._switchURL.bind(this),e._startInit=this.start,e.dash=!0,e.errorHandler=this._errorHandler}},{key:"_info",value:function(e){this._pluginInst&&this._pluginInst.info(e)}},{key:"_onWasmReady",value:(r=(0,a.x)((0,a.l5)().mark(function e(t){var n,r,i,s,u,d,l,f,_,p,v,m,y=this;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._checkHasDestroy("_onWasmReady")){e.next=2;break}return e.abrupt("return");case 2:return n=t.url,i=(r=this._pluginInst).player,s=r.config,d=(u=this.__dash__).dash,i.dashState=h.WX,i.emit("dashStateChange",h.WX),c.ZP.log("监听到wasm_ready"),this._info({msg:"wasm_ready"}),g.Z.on(d,"error",this._errorHandler,"destroy"),u.bindComEvent(),e.prev=12,e.next=15,d.init(n);case 15:if(l=e.sent){e.next=19;break}return this._info({msg:"isDestroy ".concat(!i,", isMseNull ").concat(!l)}),e.abrupt("return");case 19:c.ZP.time("initReady cost",new Date().getTime()-u.startTimestamp),i.dashState=h._6,i.emit("dashStateChange",h._6),c.ZP.log("dash init完成"),d.mpd.mediaList.video.length>0&&(!s.defaultDefinition&&(s.defaultDefinition=s.dashOpts.dynamic_video.dynamic_video_list[0].definition,u.lastDefiIdx=0),!u.isOpenAutoDefi&&(u.isCurrentAutoDefi=!1,u.abrInstance.isCurrentInAbr=!1),f=s.defaultDefinition.toString(),this._initDefinitionList(f),(!(_=u.definitions.some(function(e){return e.selected}))||void 0===u.lastDefiIdx)&&(!_&&(u.definitions[0].selected=!0,p=u.definitions[0].definition,this._pluginInst.setCurrentDefitionInfos(p,u.definition2item[p])),i.emit("initialUrl",d.mpd.mediaList.video[0].baseURL),u.curBitrate=s.dashOpts.dynamic_video.dynamic_video_list[0].bitrate,u.lastDefiIdx=0),this._afterInitDefinitionList()),this._pluginInst.originStartInit.call(i,l.url),c.ZP.time("start call cost",new Date().getTime()-u.startTimestamp),i.dashState=h.vL,i.emit("dashStateChange",h.vL),u.startCheckCanplayTimer(),u.isDashCanUse=!0,u.mse=l,u.emitMenuResolutionChange(),"safari"===o.Sniffer.browser&&(o.Util.addClass(i.root,"canplay"),v=function(){o.Util.removeClass(i.root,"xgplayer-is-enter")},g.Z.once(i,"waiting",v)),m=function(){if(!y._checkHasDestroy("onStartPlay"))i.emit("dash_start_play"),y._info({msg:"dash_start_play"}),i.dashState=h.i4,y._info({msg:"START_PLAY ready"}),i.emit("dashStateChange",h.i4),i.emit("playInterfaceInfo",s.dashOpts||{}),!u.isCurrentAutoDefi&&c.ZP.time("onStartPlay cost not abr",new Date().getTime()-u.startTimestamp),u.startProgressTimer(),c.ZP.time("onStartPlay cost",new Date().getTime()-u.startTimestamp),u.setCurrentDefinition()},g.Z.once(d,"start_play",m),this._info({msg:"START_PLAY dashready"}),i.emit("dashready"),e.next=42;break;case 39:e.prev=39,e.t0=e.catch(12),i.errorHandler(e.t0);case 42:case"end":return e.stop()}},e,this,[[12,39]])})),function(e){return r.apply(this,arguments)})},{key:"_initDefinitionList",value:function(e){var t=this;e=e.toString();var n=this._pluginInst,r=n.player,i=n.config,o=this.__dash__,s=o.dash,u=i.dashOpts.dynamic_video.dynamic_video_list;o.definitions=[];for(var d=0;d<u.length;d++){var l=u[d];o.bandwidth2item[l.bitrate]=l,o.definition2item[l.definition]=l}s.mpd.mediaList.video.sort(function(e,t){return t.height-e.height}),s.mpd.mediaList.video.forEach(function(n,u){var d=o.bandwidth2item[n.bandwidth];if(!!d){var l=d.definition.toString(),h=!!(l===e&&(!o.isOpenAutoDefi||!o.isPlayAutoDefi));o.definitions.push((0,a.Zj)((0,a.Zj)({name:i.definitionText&&i.definitionText[l]||l,selected:h,fps:d.fps},d),{},{url:Array.isArray(n.url)?n.url:n.id,definition:String(d.definition)})),n.frameRate=n.frameRate||d.fps||25;var f=d.bitrate;o.updateAbrCacheData(u,o.isPlayAutoDefi,d),l===e&&(c.ZP.log("dashDefinition",l),r.emit("initialUrl",s.mpd.mediaList.video[u].baseURL),o.curBitrate=f,o.lastDefiIdx=u),h&&t._pluginInst.setCurrentDefitionInfos(d.definition,d)}})}},{key:"_afterInitDefinitionList",value:function(){var e=this._pluginInst,t=e.player,n=e.config,r=this.__dash__;t.emit("resourceReady",r.definitions,n.dashOpts.dynamic_video.dynamic_video_list),r.abrInstance.updateBitrate(r.curBitrate);var i=r.definitions.filter(function(e){return e.selected})[0];r.setPlayerCurDefinition(i);var a=r.definitions.filter(function(e){return e.bitrate===r.curBitrate&&"__auto__"!==e.url})[0];this.abrInstance&&a&&(this.abrInstance.isCurrentHDR=!!a.isHDR)}},{key:"_filterBy",value:function(e,t,n){var r=[],i=[];t.forEach(function(t){r.push(t),t[e]&&i.push(t[e])}),Array.isArray(n)&&n.forEach(function(t){t.isExtra=!0,t[e]&&!i.includes(t[e])&&r.push(t)});var a=[],o=r.filter(function(e){return"video"===e.mediaType});o.sort(function(e,t){return e.bitrate<t.bitrate?-1:1});var s=r.filter(function(e){return"audio"===e.mediaType});return s.sort(function(e,t){return e.bitrate<t.bitrate?-1:1}),a=(a=a.concat(o)).concat(s)}},{key:"_processFeedData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._pluginInst,n=t.player,r=t.config,i=n.config;if(r.playInfoType===v.zB.FEED&&i.definition){var a,o=r.dashOpts.Data,s=i.definition.list,u=i.definition.extraList||[],d=e?s:(null==o?void 0:o.vid)===r.vid&&(null==o?void 0:o.playInfoList)||s;d=d.filter(function(e){return!e.isExtra}),r.defaultDefinition=i.defaultDefinition||i.definition.defaultDefinition,i.definition.list=d.filter(function(e){return e.vtype.toUpperCase()===y.l0.DASH&&"video"===e.mediaType});var c=d.concat(u)||[];null!==(a=d[0])&&void 0!==a&&a.file_id&&(c=this._filterBy("file_id",d,u)),r.dashOpts.Data={vid:i.vid,duration:i.duration,playInfoList:JSON.parse(JSON.stringify(c))};var l=c.filter(function(e){return e.vtype.toUpperCase()===y.l0.MP4});if(l.length>0||i.downgradeUrl){var h=l.length>0?l:[{url:i.downgradeUrl,definition:"1",vtype:"MP4",size:0,codecType:"h264"}];r.mp4Opts={mp4List:h}}else r.mp4Opts=null}}},{key:"_processData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._pluginInst,n=t.player,r=t.config,i=n.config;this._processFeedData(e),r.dashOpts.Data&&(r.playInfoType===v.zB.TOP||r.playInfoType===v.zB.FEED)&&this._playInfoInit(),r.dashOpts.dynamic_video&&(r.dashOpts.dynamic_video.dynamic_video_list=r.dashOpts.dynamic_video.dynamic_video_list||[],r.dashOpts.dynamic_video.dynamic_audio_list=r.dashOpts.dynamic_video.dynamic_audio_list||[],[r.dashOpts.dynamic_video.dynamic_video_list,r.dashOpts.dynamic_video.dynamic_audio_list].forEach(function(e){e.forEach(function(e){if(e.bitrate=parseInt(e.real_bitrate||e.bitrate),i&&"function"==typeof i.preProcessUrl){var t=i.preProcessUrlOptions||{};e.main_url=i.preProcessUrl(e.main_url,t).url,e.backup_url_1=i.preProcessUrl(e.backup_url_1,t).url;var n=Object.assign({},t,{isFallback:!0});e.fallback_url=i.preProcessUrl(e.fallback_url,n).url}})}))}},{key:"_initialize",value:function(){var e=this._pluginInst,t=e.player,n=e.config;if(c.ZP.log(null==n?void 0:n.vid,"执行dashKernal"),this._processData(),!n.dashOpts){this._info({msg:"dashOpts is null",startMs:Date.now(),name:"_initialize",add:!0});return}var r=h.iS,i=new _.Z({pluginInst:this._pluginInst});this.__dash__=i;var a=d.d1.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"');a?i.changeMainBackUrl(r.INIT,this._hasUsedBackUrl):(this._info({msg:"isCodecSupported ".concat(a),add:!0}),null==t||t.errorHandler(new p.Z(u.wb.MEDIA,u.wb.SUB_TYPES.MEDIA_ERR_CODEC_NOT_SUPPORTED,{message:"init"})))}},{key:"_bindEvents",value:function(){var e=this._pluginInst.player;e.on(o.Events.LOAD_START,this._onLoadStart),e.on(o.Events.LOADED_DATA,this._onLoadData)}},{key:"_clearMseOpenTimeout",value:function(){this._mseOpenTimeoutId&&(clearTimeout(this._mseOpenTimeoutId),this._mseOpenTimeoutId=null)}},{key:"beforeLoadStartCostTime",get:function(){return this._beforeLoadStartCostTime}},{key:"_switchURL",value:(i=(0,a.x)((0,a.l5)().mark(function e(t){var n,r,i=arguments;return(0,a.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=!(i.length>1)||void 0===i[1]||i[1],r=this.__dash__,e.next=4,r.switchURL(t,n);case 4:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"onPreChangeDefinition",value:function(e){if(!Array.isArray(e)||!this.__dash__||!this.__dash__.dash||this.__dash__.dash._hasDestroyed)return[];var t=this._pluginInst,n=t.player,r=t.config,i=n.config,o=null===(s=this.__dash__)||void 0===s||null===(s=s.dash)||void 0===s?void 0:s.mpd;if(o){var s,u,d,c,l,h=(c=null===(l=this.__dash__)||void 0===l||null===(l=l.dash)||void 0===l||null===(l=l.mpd)||void 0===l?void 0:l.getCurrDefition()).videoFileId,f=r.dashOpts.dynamic_video;if(0===e.filter(function(e){return e.file_id===h}).length){var g=f.dynamic_video_list.filter(function(e){return e.file_id===h});g.length>0&&e.push.apply(e,(0,a.u)(g))}var _=c.audioFileId;if(0===e.filter(function(e){return e.file_id===_}).length){var p=f.dynamic_audio_list.filter(function(e){return e.file_id===_});p&&e.push.apply(e,(0,a.u)(p))}}if(i.definition.list=e,this._processData(!0),null===(u=this.__dash__)||void 0===u||null===(u=u.dash)||void 0===u||null===(u=u.mpd)||void 0===u||u.init(!1,c),o){var v=o.mediaList.video,m=v.selectedIdx;this.__dash__.curVideoInitSegmentIdx=m,this.__dash__.curVideoFileId=v[m].fileId}var y=r.defaultDefinition.toString();return this._initDefinitionList((null===(d=n.curDefinition)||void 0===d?void 0:d.definition)||y),this._afterInitDefinitionList(),this.__dash__.definitions}},{key:"_playInfoInit",value:function(){var e=this._pluginInst,t=e.config,n=e.playerConfig,r=t.dashOpts.Data;t.vid=r.VideoID||r.Vid||r.vid,n.vid=t.vid,t.playInfoType===v.zB.TOP?(0,v.NK)(t):t.playInfoType===v.zB.FEED&&(0,v.LY)(t)}},{key:"_getCode",value:function(e,t){return u.WE[e][t]}},{key:"_emitDegradeEvent",value:function(e,t){if(this._pluginInst){var n=this._pluginInst.player,r=e.errorCode,i=e.errorMessage,o=(0,a.Zj)((0,a.Zj)({},e),{},{vtype:t,errc:r,err_msg:i||(null==e?void 0:e.message)});n.pause(),n.emit("degrade",o),c.ZP.log("degrade event emit",JSON.stringify(o))}}},{key:"_handleDegradeToMp4",value:function(e){var t=this;if(!this._checkHasDestroy("_handleDegradeToMp4")){var n=this._pluginInst,r=n.player,i=n.config;if(i.mp4Opts&&!this._hasDegradeMp4){c.ZP.log(i.vid,"_handleDegradeToMp4"),this._hasDegradeMp4=!0,r.dashState=h.mD;var o=i.startTime||r.currentTime||0;setTimeout(function(){var n;if(!t._checkHasDestroy("degrademp4"))t._pluginInst._setStartTime("destroy",o,!0,!1),r.emit("playertypechange"),r.dashState=h.x3,r.emit("playCatch","dash_mp4_2",(0,a.Zj)((0,a.Zj)({},e),{},{url:(null==r||null===(n=r.config)||void 0===n?void 0:n.downgradeUrl)||""})),c.ZP.log(i.vid,"playCatch dash_mp4_2",JSON.stringify(e)),t._emitDegradeEvent(e,"dash_mp4_2"),i.defaultFormat="mp4",t._pluginInst.changeKernal(!0,!1,"dash_mp4_2"),r.once("canplay",function(){if(r.config.autoplay){var e=r.video.play();e&&e.catch(function(){})}})},0)}else!i.mp4Opts&&(r.dashState=h.wL,r.emit("dashDestroy"),r.emit("error",e),c.ZP.log("_handleDegradeToMp4 throw error"))}}},{key:"abrInstance",get:function(){return this.__dash__.abrInstance}},{key:"destroy",value:function(){var e=this._pluginInst.player;this.__dash__&&(this.__dash__.destroy(),this.__dash__=null),e.off(o.Events.LOAD_START,this._onLoadStart),e.off(o.Events.LOADED_DATA,this._onLoadData),e.errorHandler=this._originErrorHandler,e._startInit=this._pluginInst._originStartInit,e.switchURL=this._originSwitchURL,this._pluginInst=null,this._hasStart=!1,c.ZP.log("dashKernal destroy"),this._clearMseOpenTimeout()}},{key:"_checkHasDestroy",value:function(e){return!this._pluginInst&&(this._info({msg:"dashKernal destroy ".concat(e),add:!0}),c.ZP.log("checkHasDestroy",e),!0)}},{key:"executeReady",value:function(){if(!this._checkHasDestroy("executeReady")){var e=this._pluginInst.player;g.Z.once(e,"dash_start_play",function(){e.dashState=h.Y9,e.emit("nextEnded")})}}},{key:"getStat",value:function(){if(!this._checkHasDestroy("getStat")){var e={};e.dvps=!!this._pluginInst.pvStartup,e.daps=!!this._pluginInst.paStartup,e.preLoadData=this.getPreloadStat();var t={},n={};if(this.__dash__&&this.__dash__.dash&&this.__dash__.dash.mse){var r=this.__dash__.dash.mse;if(r._sourceBuffer){for(var i=Object.keys(r._sourceBuffer),a=0;a<i.length;a++){var o=i[a],s=(r._queue[o]||[]).map(function(e){return{opName:e.opName,context:e.context}});n[o]={updating:r._sourceBuffer[o].updating,queue:s.slice(0,Math.max(5,s.length)),queueEmpty:!r._queue[o]}}}}e.mseStat=n,this.__dash__&&this.__dash__.dash&&this.__dash__.dash.mpd&&(t.video=this.__dash__.dash.mpd._getBuffered("video"),t.audio=this.__dash__.dash.mpd._getBuffered("audio")),e.bfs=t;var u=this._pluginInst.player;e.currentTime=u.currentTime;var d=u.video.error;return e.dVideoError=d?{code:d.code,message:d.message}:null,e.errors=this._errors,e.performance=this.states,e.stage=this._getKeyCost(),e}}},{key:"_getKeyCost",value:function(){var e=this,t=function(t,n){var r=e.states[n],i=e.states[t],a=(null==r?void 0:r.t2)-(null==i?void 0:i.t2);return Number.isFinite(a)?a:-1};return{mseopen_to_msedone:t("initmse_sbopen","initmse_sbopendone"),videometastart_to_metadone:t("initvideo_metastart","initvideo_metadone"),audiometastart_to_metadone:t("initaudio_metastart","initaudio_metadone"),videosegstart_to_segdone:t("initvideo_segstart","initvideo_segdone"),audiosegstart_to_segdone:t("initaudio_segstart","initaudio_segdone"),mseopen_to_loadeddata:t("initmse_sbopen","loaddata"),videoappend_to_loadeddata:t("initvideoSegmentAppend","loaddata"),audioappend_to_loadeddata:t("initaudioSegmentAppend","loaddata")}}},{key:"getPreloadStat",value:function(){for(var e={length:0,byteLength:0,load:[],duration:0,audioDuration:0},t=Object.keys(this.preloadMap),n=0;n<t.length;n++){var r=this.preloadMap[t[n]]||{};if(r&&r.fromCache&&r.byteLength){if(e.length+=r.byteLength,e.byteLength+=r.byteLength,e.load.push(r),!r.isInitSegment&&!r.duration)try{var i,a=this.__dash__.dash.mpd.mediaList[r.mediaType],o=null===(i=a[a.selectedIdx].mediaSegments)||void 0===i?void 0:i[0].endRaw;r.duration=o}catch(e){r.duration=5}var s=r.duration;"video"===r.mediaType?e.duration+=s||0:e.audioDuration+=s||0}}return e.loadLength=e.load.length,e}},{key:"pcdnReq",get:function(){var e,t=null===(e=this.__dash__)||void 0===e?void 0:e.dash;return null==t?void 0:t.pcdnReqCnt()}},{key:"pcdnVVStat",value:function(){var e,t=null===(e=this.__dash__)||void 0===e?void 0:e.dash;return null==t?void 0:t.pcdnVVStat()}},{key:"encryptedType",get:function(){return this.__dash__.encryptedType}},{key:"replay",value:function(){var e=this.__dash__;e&&e.abrInstance&&e.abrInstance.isCurrentInAbr&&e.abrInstance.start()}},{key:"bandwidth",get:function(){var e,t=this.__dash__;return t&&t.dash&&t.dash.loadInfo?null===(e=t.dash)||void 0===e?void 0:e.loadInfo:{cdn:{size:0},pcdn:{size:0}}}},{key:"setAudioDefinition",value:function(){var e;null===(e=this.__dash__)||void 0===e||e.setAudioDefinition()}},{key:"isSuspendLoading",get:function(){var e;return(null===(e=this.__dash__)||void 0===e?void 0:e.isSuspendLoading)||!1}},{key:"suspendLoading",value:function(){var e;null===(e=this.__dash__)||void 0===e||e.suspendLoading()}},{key:"resumeLoading",value:function(){var e;null===(e=this.__dash__)||void 0===e||e.resumeLoading()}}])},127685:function(e,t,n){n.d(t,{Z:function(){return a}});var r=n(22450);n(994269);var i=n(264001),a=(0,r.qH)(function e(t,n,a,o){(0,r.PA)(this,e),this.adaptRangeRes=[],o&&(this.adaptRange=new i.Q(t,n,a,o))},[{key:"push",value:function(e){var t;null===(t=this.adaptRangeRes)||void 0===t||t.push(e)}},{key:"pop",value:function(){var e;return null===(e=this.adaptRangeRes)||void 0===e?void 0:e.shift()}},{key:"updateBitrate",value:function(e){var t;null===(t=this.adaptRange)||void 0===t||t.updateBitrate(e)}},{key:"getAdaptCacheBuffer",value:function(e){var t,n=null===(t=this.adaptRange)||void 0===t?void 0:t.getAdaptCacheBuffer();return(Number.isNaN(n)||!n)&&(n=e),n}},{key:"destroy",value:function(){this.adaptRange=null,this.adaptRangeRes=[]}}])},906579:function(e,t,n){n.r(t),n.d(t,{AV1MimeTypes:function(){return l},checkWebAssemblySupport:function(){return d},getDrmServerUrl:function(){return v},isAV1Supported:function(){return f},isCodecSupported:function(){return h},isEMESupported:function(){return g},isEncryptSupported:function(){return p},isSupported:function(){return _}});var r=n(22450);n(511141),n(469577),n(110617),n(675373),n(826893),n(179133),n(792315),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(486201),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680);var i=n(262416);function a(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");return t>0||n>0}function o(){return window.navigator.userAgent.toLowerCase().indexOf("qqbrowser")>-1}function s(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function u(){return navigator.userAgent.indexOf("Edge")>0}function d(){try{if(("undefined"==typeof WebAssembly?"undefined":(0,r.Ac)(WebAssembly))==="object"&&"function"==typeof WebAssembly.instantiate){var e=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(e instanceof WebAssembly.Module)return new WebAssembly.Instance(e) instanceof WebAssembly.Instance}}catch(e){}return!1}function c(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported}var l=['video/mp4; codecs="av01.0.01M.08,mp4a.40.5"'];function h(e){if(!c())return!1;for(var t=0;t<e.length;t++){var n=e[t];if(MediaSource.isTypeSupported(n))return!0}return!1}function f(){return h(l)}function g(){var e,t,n,r,o;return!!navigator.requestMediaKeySystemAccess&&(e=s(),t=a(),r=(n=window.navigator.userAgent,!(window.location.search.indexOf("firefox_dash=true")>-1||i.Xb.getItem("firefox_dash"))&&n.toLowerCase().indexOf("firefox")>-1),o=u(),!e&&!t&&!r&&!o)}function _(){return d()&&c()&&!a()}function p(){return d()&&c()&&!a()&&!o()}function v(e){return new Promise(function(t){(!d()||!c()||!navigator.requestMediaKeySystemAccess)&&t(void 0);var n=s(),r=navigator.userAgent.toLowerCase().indexOf("chrome")>-1,i=u();r&&!o()?navigator.requestMediaKeySystemAccess("com.widevine.alpha",[{initDataTypes:["keyids","webm"],audioCapabilities:[{contentType:'audio/mp4; codecs="mp4a.40.2"'}],videoCapabilities:[{contentType:'video/mp4; codecs="avc1.42c01e"'}]}]).then(function(){t("https://".concat(e,"/video/drm/v1/widevine?aid=32&kid="))},function(){t(void 0)}):i?t("https://".concat(e,"/video/drm/v1/playready?aid=32&kid=")):t(void 0)})}},327408:function(e,t,n){n.d(t,{KR:function(){return u},Rr:function(){return s},dJ:function(){return o}});var r,i,a,o=((r=o||{})[r.DURATION=0]="DURATION",r[r.SIZE=1]="SIZE",r);var s=((i=s||{})[i.INDEXDB=0]="INDEXDB",i[i.MEMORY=1]="MEMORY",i);var u=((a=u||{}).PRELOAD_NEXT="PRELOAD_NEXT",a.PRELOAD_START="PRELOAD_START",a.PRELOAD_CANCEL="PRELOAD_CANCEL",a)},349674:function(e,t,n){n.d(t,{Z:function(){return r}});function r(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}},300883:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(288773);n(110617),n(675373);var i=function(){function e(){(0,r.PA)(this,e);var t,n,i=new Promise(function(e,r){t=e,n=r});return i.resolve=t,i.reject=n,i}return(0,r.qH)(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}()},219139:function(e,t,n){n.d(t,{Z:function(){return y}}),n(223047);var r=n(874838),i=n(758698),a=n(569395),o=n(812523),s=n(151176),u=n(53285),d=n(344137);n(836654),n(691842),n(511141),n(110617),n(792315),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680),n(742611);var c=n(682238),l=n(153978),h=n(164),f=n(521419),g=n(540931),_=n(761690),p=n(875089),v=n(675161),m=(0,_.tT)().maxDecodeOnceWasm,y=function(e){(0,o.Z)(y,e);var t,n,c=(t=y,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,u.Z)(t);return e=n?Reflect.construct(r,arguments,(0,u.Z)(this).constructor):r.apply(this,arguments),(0,s.Z)(this,e)});function y(){var e;(0,r.Z)(this,y);for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=c.call.apply(c,[this].concat(n)),(0,d.Z)((0,a.Z)(e),"TAG","WasmController"),(0,d.Z)((0,a.Z)(e),"_avccpushed",!1),(0,d.Z)((0,a.Z)(e),"_maxDecodeOnce",m),(0,d.Z)((0,a.Z)(e),"_continueDecodeThreshold",m/2),(0,d.Z)((0,a.Z)(e),"_wasmInitCost",0),(0,d.Z)((0,a.Z)(e),"_threadSupported",(0,_.Bo)()&&(0,_.tT)().canUseThreadMode),(0,d.Z)((0,a.Z)(e),"_simdSuppported",(0,_.yJ)()),(0,d.Z)((0,a.Z)(e),"_decoderMode","undefined"!=typeof window&&window.WebAssembly?3:4),e}return(0,i.Z)(y,[{key:"wasmInitCost",get:function(){var e;return null===(e=this._decoderWorker)||void 0===e?void 0:e._wasmInitCost}},{key:"isHevc",get:function(){var e;return null===(e=this._parent)||void 0===e?void 0:e.isHevc}},{key:"_selectDecodeWorker",value:function(){this.analyse.addWasmInit();var e,t=(0,_.P_)(),n=t.H264_DECODER_URL,r=t.H265_DECODER_URL,i=t.H265_THREAD_DECODER_URL,a=t.H265_SIMD_DECODER_URL,o=t.ASM_H264_DECODER_URL,s=t.ASM_H265_DECODER_URL;if(v.kg.log(this.TAG,"start init wasm worker:",performance.now(),"hevc:",this.isHevc,"decoderMode:",this._decoderMode),this.isHevc){if(!(e=1===this._decoderMode?i:2===this._decoderMode?a:3===this._decoderMode?r:s)){this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode));return}return{decoder:1===this._decoderMode?new h.Z:new l.Z,url:e}}if(!(e=4===this._decoderMode?o:n)){this._workerErrorCallback("no found decoder url, decodeMode:".concat(this._decoderMode));return}return{decoder:new f.Z,url:e}}},{key:"_initWorker",value:function(){this.isHevc&&(this._threadSupported&&(this._decoderMode=1),this._simdSuppported&&(this._decoderMode=2)),this._initDecodeWorkerInternal()}},{key:"_initDecodeWorkerInternal",value:function(){var e=p.Z.getCachedDecoder(this.isHevc);if(e){v.kg.warn(this.TAG,"select decoder from cache"),this.analyse.addWasmInit(),this._avccpushed=!1,this._bindWorkerEvent(e),this._decoderWorker=e,e.ready&&(this._decoderReady=!0,this._initDecoderWithConfiguration(e,this.meta),this._workerMessageCallback({type:"DECODER_READY",data:e}),v.kg.log(this.TAG,"decoder ready!"));return}var t=this._selectDecodeWorker()||{},n=t.decoder,r=t.url;n&&(this._avccpushed=!1,this._bindWorkerEvent(n),n.isHevc=this.isHevc,n.postMessage({msg:"init",meta:this.meta,batchDecodeCount:m,url:r}),this._decoderWorker=n)}},{key:"_bindWorkerEvent",value:function(e){var t=this,n=function(n,r){v.kg.log(t.TAG,"worker failed: ",n,r),t._terminateWorker(e),t._decoderWorker=null,!1===(0,_.tT)().wasmFallbackToAsm||4===t._decoderMode?t._workerErrorCallback(n):(t._decoderMode=1===t._decoderMode||2===t._decoderMode?3:4,t._initDecodeWorkerInternal())};e._onMessage=function(r){var i,a;switch(r.data.msg){case"DECODER_READY":if(v.kg.log(t.TAG,"wasm worker ready!","cost:",r.data.cost),t._decoderReady=!0,e._wasmInitCost=parseInt(r.data.cost),!t.meta)return;!t._avccpushed&&t._initDecoderWithConfiguration(e,t.meta),t.emit(g.ZP.VIDEO.VIDEO_DECODER_INIT,e),t._workerMessageCallback({type:"DECODER_READY",data:e});break;case"DECODED":if(t._inDecoding=!0,(null===(i=r.data)||void 0===i?void 0:null===(a=i.info)||void 0===a?void 0:a.id)!==t._id)return;t._workerMessageCallback({type:"RECEIVE_FRAME",data:r.data});break;case"BATCH_FINISH_FLAG":if(t._inDecoding=!1,!t._workerMessageCallback)return;t._workerMessageCallback({type:"BATCH_FINISH"});break;case"INIT_FAILED":n(r.data.log,1)}},e._onError=function(e){n(e.message,2)},e.addEventListener("message",e._onMessage),e.addEventListener("error",e._onError)}},{key:"_initDecoderWithConfiguration",value:function(e,t){v.kg.log(this.TAG,"init decoder with configuration"),this._avccpushed=!0,e.postMessage({msg:"updatemeta",meta:t});var n=[t.rawVps||t.vps[0],t.rawSps||t.sps[0],t.rawPps||t.pps[0]].filter(Boolean),r=new Uint8Array(n.reduce(function(e,t){return e+(t.byteLength+4)},0)),i=0;n.forEach(function(e){r.set([0,0,0,1],i),i+=4,r.set(e,i),i+=e.byteLength}),e.postMessage({msg:"initDecoder",data:r})}},{key:"destroy",value:function(){if(this._decoderWorker){if((0,_.tT)().reuseWasmDecoder){this._offWorkerBind(this._decoderWorker),p.Z.cacheDecoder(this._decoderWorker),this._decoderWorker=null;return}this._terminateWorker(this._decoderWorker),this._decoderWorker=null}}},{key:"_offWorkerBind",value:function(e){e.removeEventListener("message",e._onMessage),e.removeEventListener("error",e._onError),e.postMessage({msg:"flush"}),e._onMessage=null,e._onError=null,v.kg.log(this.TAG,"flush decoder and unbind worker event")}},{key:"_terminateWorker",value:function(e){this._offWorkerBind(e),e.postMessage({msg:"destroy"}),e.terminate(),v.kg.log(this.TAG,"destroy decoder worker")}}]),y}(c.Z)},111795:function(e,t,n){n.d(t,{Z:function(){return m}}),n("223047");var r=n("874838"),i=n("758698"),a=n("569395"),o=n("284016"),s=n("812523"),u=n("151176"),d=n("53285");n("836654"),n("777180");var c=n("675161"),l=n("905718"),h=n("608394");function f(e){var t;(null===(t=e.buffer)||void 0===t?void 0:t.close)&&e.buffer.close()}n("891555"),n("691842"),n("742611");var g=function(){function e(t){(0,r.Z)(this,e),this.TAG="FrameQueue",this._parent=t,this._lastGopId=0,this._frames=[]}return(0,i.Z)(e,[{key:"currentTimeDts",get:function(){return this._parent.preciseVideoDts}},{key:"length",get:function(){return this._frames.length}},{key:"frames",get:function(){return this._frames}},{key:"append",value:function(e){if(!e.info){f(e);return}this._frames.push(e)}},{key:"appendVodFrame",value:function(e){this._frames.push(e)}},{key:"nextFrame",value:function(){var e=this._frames.length;return 1===this._parent.noAudio&&e>3&&(this._frames=this._frames.slice(e-2)),this._frames[0]}},{key:"shift",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._frames.shift();return this.deletePassed(e),t}},{key:"deletePassed",value:function(e){this._frames=this._frames.filter(function(t){return!!t.info&&!!(t.info.dts>e)||(f(t),!1)})}},{key:"empty",value:function(){this._frames.forEach(function(e){return f(e)}),this._frames=[]}},{key:"destroy",value:function(){this.empty(),this._lastGopId=0}}]),e}(),_=n("611210"),p=n("68914"),v=n("540931"),m=function(e){(0,s.Z)(m,e);var t,n,l=(t=m,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,r=(0,d.Z)(t);return e=n?Reflect.construct(r,arguments,(0,d.Z)(this).constructor):r.apply(this,arguments),(0,u.Z)(this,e)});function m(e,t){var n;return(0,r.Z)(this,m),(n=l.call(this,e,t))._timeRange=new h.Z((0,a.Z)(n)),n._decodeEstimate=new _.Z((0,a.Z)(n)),n._frameQueue=new g((0,a.Z)(n)),n._lastTimeupdate=0,n._renderCost=0,n._canAutoPlay=!0,n._videoDecode=!1,n._inSeeking=!1,n._frameRender=null,n._configuration=null,n._canvasLayoutDone=!1,n._render=n._render.bind((0,a.Z)(n)),n._renderWorker=new p.Z(n._render,e,(0,a.Z)(n)),n._canvas=n._renderWorker.canvas,n._bindEvents(),n}return(0,i.Z)(m,[{key:"canAutoPlay",get:function(){return this._canAutoPlay}},{key:"canvas",get:function(){return this._canvas}},{key:"timescale",get:function(){return 1e3}},{key:"fps",get:function(){return this._decodeEstimate.fps||this._meta&&this._meta.fpsNum/this._meta.fpsDen||24}},{key:"decodeFps",get:function(){return this._decodeEstimate.decodeFps}},{key:"decodeCost",get:function(){return this._decodeEstimate.decodeCost}},{key:"renderCost",get:function(){return this._renderCost}},{key:"totalSize",get:function(){return this._timeRange.totalSize}},{key:"bitrate",get:function(){return this._timeRange.bitrate},set:function(e){this._timeRange.bitrate=e}},{key:"gopLength",get:function(){return this._decodeEstimate.gopLength}},{key:"is540p",get:function(){return this._canvas.height<720}},{key:"buffered",get:function(){return this._timeRange.buffered}},{key:"inSeeking",get:function(){return this._inSeeking}},{key:"interval",get:function(){return Math.floor(1e3/this.fps/this.playbackRate)}},{key:"playbackRate",get:function(){return this._playbackRate||1}},{key:"baseDts",get:function(){return this._timeRange.baseDts}},{key:"currentTime",get:function(){return this._timeRange.getCurrentTime(this.preciseVideoDts)}},{key:"timelinePosition",get:function(){return this._parent.timelinePosition}},{key:"lastTimelinePosition",get:function(){return this._lastTimelinePosition||0},set:function(e){this._lastTimelinePosition=e}},{key:"audioSyncDts",get:function(){return this._audioDts||this.baseDts},set:function(e){this._audioDts=e}},{key:"preciseVideoDts",get:function(){return this.audioSyncDts+Math.floor((this.timelinePosition-this.lastTimelinePosition)*1e3)}},{key:"readyState",get:function(){var e=this._frameQueue.length||(this.currentTime?1:0);return e?e>=8?4:e>=4?3:e>=2?2:1:0}},{key:"isHevc",get:function(){return!("hev1.1.6.L93.B0"!==(this._meta||{}).codec)}},{key:"videoDecode",get:function(){return this._videoDecode}},{key:"decoderMode",get:function(){var e;return null===(e=this._decodeController)||void 0===e?void 0:e.decoderMode}},{key:"configuration",get:function(){var e,t;return this._configuration?this._configuration:(this._configuration=this._meta.configuration||(0,c.Mv)(null===(e=this._meta)||void 0===e?void 0:e.sps[0],null===(t=this._meta)||void 0===t?void 0:t.pps[0]),this._configuration)},set:function(e){this._configuration=e.configuration||(0,c.Mv)(e.sps[0],e.pps[0])}},{key:"setSeekingStatus",value:function(e){this._inSeeking=e}},{key:"getDtsOfTime",value:function(e){return this._timeRange.getDtsOfTime(e)}},{key:"updateReady",value:function(){this._whenReady()}},{key:"forceRender",value:function(){this._render(!0)}},{key:"getSeekStartPosition",value:function(e,t){return this._timeRange.getSeekStartPosition(e,t)}},{key:"getSeekStartPositionBehind",value:function(e,t){return this._timeRange.getSeekStartPositionBehind(e,t)}},{key:"canSeek",value:function(){throw Error("need override by children")}},{key:"emitResizeEvent",value:function(){this===null||void 0===this||this._emitTimelineEvents(v.ZP.TIMELINE.PLAY_EVENT,v.ZP.VIDEO_EVENTS.RESIZE)}},{key:"_assembleErr",value:function(e,t){var n=Error(e);return n.code=3,n.subCode=t,n}},{key:"_emitError",value:function(e,t){this._emitTimelineEvents(v.ZP.TIMELINE.PLAY_EVENT,v.ZP.VIDEO_EVENTS.ERROR,this._assembleErr(e,t))}},{key:"_emitTimelineEvents",value:function(e,t,n){var r;null===(r=this._parent)||void 0===r||r.emit(e,t,n)}},{key:"_bindEvents",value:function(){var e=this;(0,o.Z)((0,d.Z)(m.prototype),"_bindEvents",this).call(this);var t=function(t){var n=t.width,r=t.height,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e._canvas,s=o.width,u=o.height,d=r*s/u,l=n*u/s,h=n-d,f=r-l,g=h*i+"px",_=f*a+"px";e._canvas.style.left=g,e._canvas.style.top=_,c.kg.warn(e.TAG,"cvsWidth=".concat(s,", cvsHeight=").concat(u,", scaleCvsWidth=").concat(d,", scaleCvsHeight=").concat(l)),c.kg.warn(e.TAG,"cover position: deltaX=".concat(h,", deltaY=").concat(f,", width=").concat(n,", height=").concat(r,", pX=").concat(g,", pY=").concat(_))};this._parent.on(v.ZP.VIDEO.UPDATE_VIDEO_FILLTYPE,function(n,r){var i=r.width,a=r.height,o=e._canvas,s=o.width,u=o.height,d=!i||i/a>s/u;if(c.kg.warn(e.TAG,"UPDATE_VIDEO_FILLTYPE isGapX =",d,"type =",n,s,u,i,a),e._canvas.style.maxWidth="initial",e._canvas.style.maxHeight="initial","cover"===n){if(d){e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.height="auto",e._canvas.style.width="100%",t({width:i,height:a},0,.5);return}e._canvas.style.left=0,e._canvas.style.top=0,e._canvas.style.width="auto",e._canvas.style.height="100%",t({width:i,height:a},.5,0);return}if("fill"===n){e._canvas.style.width="100%",e._canvas.style.height="100%";return}e._canvas.style.top=0,e._canvas.style.bottom=0,e._canvas.style.left=0,e._canvas.style.right=0,e._canvas.style.maxWidth="100%",e._canvas.style.maxHeight="100%",e._canvas.style.width="initial",e._canvas.style.height="initial",s<i&&u<a&&(s/i>u/a?e._canvas.style.width="100%":e._canvas.style.height="100%")}),this._parent.on(v.ZP.VIDEO.UPDATE_VIDEO_COVER_POSITION,t),this._parent.on(v.ZP.TIMELINE.SYNC_DTS,function(t){var n,r=e._frameQueue.nextFrame(),i=r&&r.info&&r.info.dts;if(e.lastTimelinePosition=e.timelinePosition,e.noAudio){var a=e._timeRange.nextFrame();t=t||i||a&&a.dts||0}if(e.audioSyncDts=t,i&&i-t>500&&e._emitTimelineEvents(v.ZP.TIMELINE.PLAY_EVENT,v.ZP.VIDEO_EVENTS.LARGE_AV_GAP,{aDts:t,vDts:i,frameLength:e._frameQueue.length,currentTime:e._parent.currentTime,duration:e._parent.duration}),c.kg.log(e.TAG,"audio current buffer play finish, next buffer dts=",t,"currentTime:",e._parent.currentTime,"preciseVideoDts:",e.preciseVideoDts,"next video frame dts:",i,"frame length:",e._frameQueue.length),!e._isLive&&!(null!==(n=e._parent)&&void 0!==n&&n.seeking)){var o=e._timeRange.nextFrame();if(o){var s=(o.dts-o.baseDts)/1e3;e._parent.currentTime-s>1&&(c.kg.warn(e.TAG,"丢帧!"),e.ajustSeekTime(e._parent.currentTime))}}}),this._parent.on(v.ZP.TIMELINE.UPDATE_GL_OPTIONS,function(t){e._config.glCtxOptions=t}),this._parent.on(v.ZP.TIMELINE.UPDATE_SEGMENT_END,this._updateSegmentEnd.bind(this)),this.on(v.ZP.VIDEO.AUTO_RUN,this._startRender.bind(this)),this._parent.on(v.ZP.TIMELINE.SET_PLAYBACKRATE,function(t){e._playbackRate=t,e._startRender()})}},{key:"ajustSeekTime",value:function(){throw Error("need override by children")}},{key:"_resetDts",value:function(e,t){"audio"!==t&&this._timeRange.resetDts(e)}},{key:"_setMetadata",value:function(e,t){if("audio"!==e){c.kg.warn(this.TAG,"video set metadata"),this._meta=t;var n=t&&t.frameRate&&t.frameRate.fps;n?c.kg.log(this.TAG,"detect fps:",n):c.kg.warn(this.TAG,"no detect fps,start estimate"),this._initDecoder()}}},{key:"_initDecoder",value:function(){throw Error("need override by children")}},{key:"_whenDecoderReady",value:function(){throw Error("need override by children")}},{key:"_appendChunk",value:function(){throw Error("need override by children")}},{key:"_startDecode",value:function(){throw Error("need override by children")}},{key:"_receiveFrame",value:function(e,t){if(!!this._parent&&!!this._timeRange){var n=e.info||{};if(this._decodeEstimate.addDecodeInfo(n),this._checkCanvasLayout(e),!this._isLive&&((n.output||n.keyframe)&&(this.setSeekingStatus(!1),c.kg.warn(this.TAG,"set seeking status=",!1)),this.inSeeking)){c.kg.log(this.TAG,"drop frame"),f(e);return}this._isLive?this._frameQueue.append(e):this._frameQueue.appendVodFrame(e),t&&t(),!this._ready&&this.readyState>=1&&this._whenReady()}}},{key:"_checkCanvasLayout",value:function(e){!this._canvasLayoutDone&&e.width===this._canvas.width&&(e.width/e.height).toFixed(2)===(this._canvas.width/this._canvas.height).toFixed(2)&&(this===null||void 0===this||this._emitTimelineEvents(v.ZP.TIMELINE.PLAY_EVENT,v.ZP.VIDEO_EVENTS.CANVAS_LAYOUT),this._canvasLayoutDone=!0)}},{key:"_startRender",value:function(){c.kg.log(this.TAG,"start render"),this._renderWorker.startLoop(this.interval)}},{key:"_render",value:function(){throw Error("need override by children")}},{key:"_updateSegmentEnd",value:function(){throw Error("need override by children")}},{key:"_whenReady",value:function(){this._ready=!0,this.emit(v.ZP.VIDEO.VIDEO_READY),this.noAudio&&this._emitTimelineEvents(v.ZP.TIMELINE.PLAY_EVENT,v.ZP.VIDEO_EVENTS.PLAYING)}},{key:"_doPlay",value:function(){this._renderWorker.startLoop()}},{key:"_doPause",value:function(){this._renderWorker.stopLoop()}},{key:"_doSeek",value:function(){this._ready=!1,this._frameQueue.destroy()}},{key:"_doChaseFrame",value:function(){throw Error("need override by children")}},{key:"destroy",value:function(e){var t,n,r,i,a,o;null===(t=this._renderWorker)||void 0===t||t.destroy(e),null===(n=this._timeRange)||void 0===n||n.destroy(),null===(r=this._frameQueue)||void 0===r||r.destroy(),null===(i=this._frameRender)||void 0===i||null===(a=i.destroy)||void 0===a||a.call(i),null===(o=this._decodeEstimate)||void 0===o||o.destroy(),this._renderWorker=null,this._canvas=null,this._timeRange=null,this._frameQueue=null,this._frameRender=null,this._decodeEstimate=null,this._parent=null,this.removeAllListeners()}}]),m}(l.Z)},921180:function(e,t,n){function r(){var e,t,n=new Promise(function(n,r){e=n,t=r});return n.used=!1,n.resolve=function(){return n.used=!0,e.apply(void 0,arguments)},n.reject=function(){return n.used=!0,t.apply(void 0,arguments)},n}n.d(t,{Q:function(){return r}}),n(110617),n(675373)},689594:function(e,t,n){n.d(t,{j:function(){return r}});var r="undefined"!=typeof window},263287:function(e,t,n){n.d(t,{Fc:function(){return s},WE:function(){return o},wb:function(){return a}});var r,i=n(83399),a={MANIFEST:"manifest",NETWORK:"network",NETWORK_TIMEOUT:"network_timeout",NETWORK_FORBIDDEN:"network_forbidden",NETWORK_NOTFOUND:"network_notfound",NETWROK_RANGE_NOT_SATISFIABLE:"network_range_not_satisfiable",DEMUX:"demux",REMUX:"remux",MEDIA:"media",DRM:"drm",OTHER:"other",RUNTIME:"runtime",SUB_TYPES:{FLV:"FLV",HLS:"HLS",MP4:"MP4",FMP4:"FMP4",MSE_ADD_SB:"MSE_ADD_SB",MSE_APPEND_BUFFER:"MSE_APPEND_BUFFER",MSE_OTHER:"MSE_OTHER",MSE_FULL:"MSE_FULL",OPTION:"OPTION",DASH:"DASH",LICENSE:"LICENSE",CUSTOM_LICENSE:"CUSTOM_LICENSE",MSE_HIJACK:"MSE_HIJACK",EME_HIJACK:"EME_HIJACK",SIDX:"SIDX",NO_CANPLAY_ERROR:"NO_CANPLAY_ERROR",BUFFERBREAK_ERROR:"BUFFERBREAK_ERROR",WAITING_TIMEOUT_ERROR:"WAITING_TIMEOUT_ERROR",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_CODEC_NOT_SUPPORTED:"MEDIA_ERR_CODEC_NOT_SUPPORTED",MEDIA_ERR_URL_EMPTY:"MEDIA_ERR_URL_EMPTY"}},o=(r={},(0,i._x)(r,a.MANIFEST,{HLS:1100,DASH:1200}),(0,i._x)(r,a.NETWORK,2100),(0,i._x)(r,a.NETWORK_TIMEOUT,2101),(0,i._x)(r,a.NETWORK_FORBIDDEN,2103),(0,i._x)(r,a.NETWORK_NOTFOUND,2104),(0,i._x)(r,a.NETWROK_RANGE_NOT_SATISFIABLE,2116),(0,i._x)(r,a.DEMUX,{FLV:3100,HLS:3200,MP4:3300,FMP4:3400,SIDX:3410}),(0,i._x)(r,a.REMUX,{FMP4:4100,MP4:4200}),(0,i._x)(r,a.MEDIA,{MEDIA_ERR_ABORTED:5101,MEDIA_ERR_NETWORK:5102,MEDIA_ERR_DECODE:5103,MEDIA_ERR_SRC_NOT_SUPPORTED:5104,MEDIA_ERR_CODEC_NOT_SUPPORTED:5105,MEDIA_ERR_URL_EMPTY:5106,MSE_ADD_SB:5200,MSE_APPEND_BUFFER:5201,MSE_OTHER:5202,MSE_FULL:5203,MSE_HIJACK:5204,EME_HIJACK:5301}),(0,i._x)(r,a.DRM,{LICENSE:7100,CUSTOM_LICENSE:7200}),(0,i._x)(r,a.OTHER,8e3),(0,i._x)(r,a.RUNTIME,{NO_CANPLAY_ERROR:9001,BUFFERBREAK_ERROR:9002,WAITING_TIMEOUT_ERROR:9003}),r),s=function(e){(0,i.XW)(n,e);var t=(0,i.WY)(n);function n(e,r,s,u,d){var c;return(0,i.PA)(this,n),(c=t.call(this,d||(null==s?void 0:s.message))).errorType=e===a.NETWORK_TIMEOUT?a.NETWORK:e,c.originError=s,c.ext=u,c.errorCode=o[e][r]||o[e],c.errorMessage=c.message,!c.errorCode&&(c.errorType=a.OTHER,c.errorCode=o[c.errorType]),c}return(0,i.qH)(n,null,[{key:"create",value:function(e,t,r,i,o){return e instanceof n?e:(e instanceof Error&&(r=e,e=""),!e&&(e=a.OTHER),new n(e,t,r,i,o))}},{key:"network",value:function(e){var t;return new n(null!=e&&e.isTimeout?a.NETWORK_TIMEOUT:a.NETWORK,null,e instanceof Error?e:null,{url:null==e?void 0:e.url,response:null==e?void 0:e.response,httpCode:null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status})}}]),n}((0,i.wm)(Error))},300491:function(e,t,n){n.d(t,{J_:function(){return s},Kn:function(){return a},PO:function(){return o}});var r=n(83399),i=Object.prototype.toString;function a(e){return null!==e&&"object"===(0,r.Ac)(e)}function o(e){if("[object Object]"!==i.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function s(e){return"[object Date]"===i.call(e)}},979860:function(e,t,n){function r(){var e,t,n=new Promise(function(n,r){e=n,t=r});return n.used=!1,n.resolve=function(){return n.used=!0,e.apply(void 0,arguments)},n.reject=function(){return n.used=!0,t.apply(void 0,arguments)},n}function i(){try{return parseInt(performance.now(),10)}catch(e){return new Date().getTime()}}n.d(t,{Q:function(){return r},j:function(){return i}})},137037:function(e,t,n){n.d(t,{j:function(){return c}});var r=n(670537),i=n(468425),a=n(833524),o=n(145594),s=n(913898),u=n(879146),d=n.n(u),c=function(e){(0,r.XW)(u,e);var t,n=(0,r.WY)(u);function u(){var e;return(0,r.PA)(this,u),e=n.call(this),(0,r._x)((0,r.Lc)(e),"_abortController",null),(0,r._x)((0,r.Lc)(e),"_timeoutTimer",null),(0,r._x)((0,r.Lc)(e),"_reader",null),(0,r._x)((0,r.Lc)(e),"_response",null),(0,r._x)((0,r.Lc)(e),"_aborted",!1),(0,r._x)((0,r.Lc)(e),"_index",-1),(0,r._x)((0,r.Lc)(e),"_range",null),(0,r._x)((0,r.Lc)(e),"_receivedLength",0),(0,r._x)((0,r.Lc)(e),"_running",!1),(0,r._x)((0,r.Lc)(e),"_logger",null),(0,r._x)((0,r.Lc)(e),"_vid",""),(0,r._x)((0,r.Lc)(e),"_onProcessMinLen",0),(0,r._x)((0,r.Lc)(e),"_onCancel",null),(0,r._x)((0,r.Lc)(e),"_priOptions",null),e}return(0,r.qH)(u,[{key:"load",value:function(e){var t,n=this,u=e.url,d=e.vid,c=e.timeout,l=e.responseType,h=e.onProgress,f=e.index,g=e.onTimeout,_=e.onCancel,p=e.range,v=e.transformResponse,m=e.request,y=e.params,b=e.logger,E=e.method,T=e.headers,k=e.body,x=e.mode,R=e.credentials,w=e.cache,I=e.redirect,O=e.referrer,S=e.referrerPolicy,D=e.onProcessMinLen,A=e.priOptions;this._logger=b,this._aborted=!1,this._onProcessMinLen=D,this._onCancel=_,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=f,this._range=p||[0,0],this._vid=d||u,this._priOptions=A||{};var L={method:E,headers:T,body:k,mode:x,credentials:R,cache:w,redirect:I,referrer:O,referrerPolicy:S,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},C=!1;clearTimeout(this._timeoutTimer),u=(0,a.G7)(u,y);var P=(0,a.Gu)(p);P&&(T=m?m.headers:L.headers=L.headers||(Headers?new Headers:{}),Headers&&T instanceof Headers?T.append("Range",P):T.Range=P),c&&(this._timeoutTimer=setTimeout(function(){if(C=!0,n.cancel(),g){var e=new i.C(u,L,null,"timeout");e.isTimeout=!0,g(e,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})}},c));var M=Date.now();return this._logger.debug("[fetch load start], index,",f,",range,",p),new Promise(function(e,t){var d;fetch(m||u,m?void 0:L).then((d=(0,r.x)((0,r.l5)().mark(function d(c){var g,_,m,y;return(0,r.l5)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(clearTimeout(n._timeoutTimer),n._response=c,!(n._aborted||!n._running)){r.next=4;break}return r.abrupt("return");case 4:if(v&&(c=v(c,u)||c),c.ok){r.next=7;break}throw new i.C(u,L,c,"bad network response");case 7:if(g=Date.now(),l!==o.U.TEXT){r.next=15;break}return r.next=11,c.text();case 11:case 18:_=r.sent,n._running=!1,r.next=37;break;case 15:if(l!==o.U.JSON){r.next=22;break}return r.next=18,c.json();case 22:if(!h){r.next=29;break}return n.resolve=e,n.reject=t,n._loadChunk(c,h,M,g),r.abrupt("return");case 29:return r.next=31,c.arrayBuffer();case 31:_=new Uint8Array(_=r.sent),n._running=!1,m=Date.now()-M,y=(0,a.pl)(_.byteLength,m),n.emit(s.K.REAL_TIME_SPEED,{speed:y,len:_.byteLength,time:m,vid:n._vid,index:n._index,range:n._range,priOptions:n._priOptions});case 37:n._logger.debug("[fetch load end], index,",f,",range,",p),e((0,a.rO)(_,!0,c,c.headers.get("Content-Length"),c.headers.get("age"),M,g,f,p,n._vid,n._priOptions));case 39:case"end":return r.stop()}},d)})),function(e){return d.apply(this,arguments)})).catch(function(e){var r;clearTimeout(n._timeoutTimer),n._running=!1,(!n._aborted||C)&&((e=e instanceof i.C?e:new i.C(u,L,null,null===(r=e)||void 0===r?void 0:r.message)).startTime=M,e.endTime=Date.now(),e.isTimeout=C,e.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},t(e))})})}},{key:"cancel",value:(t=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(e){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,n,o){var u,d,c,l,h=this;if(!e.body||!e.body.getReader){this._running=!1;var f=new i.C(e.url,"",e,"onProgress of bad response.body.getReader");f.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(f);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(2097152),this._writeIdx=0);var g=this._reader=e.body.getReader();var _=(u=(0,r.x)((0,r.l5)().mark(function i(){var u,f,p,v,m,y,b,E;return(0,r.l5)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=Date.now(),r.prev=1,r.next=4,g.read();case 4:d=r.sent,l=Date.now(),r.next=13;break;case 8:return r.prev=8,r.t0=r.catch(1),l=Date.now(),!h._aborted&&(h._running=!1,r.t0.options={index:h._index,range:h._range,vid:h._vid,priOptions:h._priOptions},h.reject(r.t0)),r.abrupt("return");case 13:if(p=(f=(null===(u=h._range)||void 0===u?void 0:u.length)>0?h._range[0]:0)+h._receivedLength,!h._aborted){r.next=19;break}return h._running=!1,t(void 0,!1,{range:[p,p],vid:h._vid,index:h._index,startTime:c,endTime:l,st:n,firstByteTime:o,priOptions:h._priOptions},e),r.abrupt("return");case 19:v=d.value?d.value.byteLength:0,h._receivedLength+=v,h._logger.debug("【fetchLoader,onProgress call】,task,",h._range,", start,",p,", end,",f+h._receivedLength,", done,",d.done),h._onProcessMinLen>0?h._writeIdx+v>=h._onProcessMinLen||d.done?((m=new Uint8Array(h._writeIdx+v)).set(h._cache.slice(0,h._writeIdx),0),v>0&&m.set(d.value,h._writeIdx),h._writeIdx=0,h._logger.debug("【fetchLoader,onProgress enough】,done,",d.done,",len,",m.byteLength,", writeIdx,",h._writeIdx)):v>0&&h._writeIdx+v<2097152?(h._cache.set(d.value,h._writeIdx),h._writeIdx+=v,h._logger.debug("【fetchLoader,onProgress cache】,len,",v,", writeIdx,",h._writeIdx)):v>0&&(y=new Uint8Array(h._writeIdx+v+2048),h._logger.debug("【fetchLoader,onProgress extra start】,size,",h._writeIdx+v+2048,", datalen,",v,", writeIdx,",h._writeIdx),y.set(h._cache.slice(0,h._writeIdx),0),v>0&&y.set(d.value,h._writeIdx),h._writeIdx+=v,delete h._cache,h._cache=y,h._logger.debug("【fetchLoader,onProgress extra end】,len,",v,", writeIdx,",h._writeIdx)):m=d.value,(m&&m.byteLength>0||d.done)&&t(m,d.done,{range:[h._range[0]+h._receivedLength-(m?m.byteLength:0),h._range[0]+h._receivedLength],vid:h._vid,index:h._index,startTime:c,endTime:l,st:n,firstByteTime:o,priOptions:h._priOptions},e),d.done?(b=Date.now()-n,E=(0,a.pl)(h._receivedLength,b),h.emit(s.K.REAL_TIME_SPEED,{speed:E,len:h._receivedLength,time:b,vid:h._vid,index:h._index,range:h._range,priOptions:h._priOptions}),h._running=!1,h._logger.debug("[fetchLoader onProgress end],task,",h._range,",done,",d.done),h.resolve((0,a.rO)(d,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),n,o,h._index,h._range,h._vid,h._priOptions))):_();case 25:case"end":return r.stop()}},i,null,[[1,8]])})),function(){return u.apply(this,arguments)});_()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof fetch}}]),u}(d())},145594:function(e,t,n){n.d(t,{U:function(){return i},t:function(){return r}});var r={FETCH:"fetch",XHR:"xhr"},i={ARRAY_BUFFER:"arraybuffer",TEXT:"text",JSON:"json"}},861674:function(e,t,n){n.d(t,{i:function(){return a}});var r=n(768947),i=n(382541);function a(e){return(0,r.Zj)({loaderType:i.t.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:i.U.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0},e)}},962326:function(e,t,n){n.d(t,{j:function(){return c}});var r=n(768947),i=n(314765),a=n(773542),o=n(382541),s=n(805229),u=n(879146),d=n.n(u),c=function(e){(0,r.XW)(u,e);var t,n=(0,r.WY)(u);function u(){var e;return(0,r.PA)(this,u),e=n.call(this),(0,r._x)((0,r.Lc)(e),"_abortController",null),(0,r._x)((0,r.Lc)(e),"_timeoutTimer",null),(0,r._x)((0,r.Lc)(e),"_reader",null),(0,r._x)((0,r.Lc)(e),"_response",null),(0,r._x)((0,r.Lc)(e),"_aborted",!1),(0,r._x)((0,r.Lc)(e),"_index",-1),(0,r._x)((0,r.Lc)(e),"_range",null),(0,r._x)((0,r.Lc)(e),"_receivedLength",0),(0,r._x)((0,r.Lc)(e),"_running",!1),(0,r._x)((0,r.Lc)(e),"_logger",null),(0,r._x)((0,r.Lc)(e),"_vid",""),(0,r._x)((0,r.Lc)(e),"_onProcessMinLen",0),(0,r._x)((0,r.Lc)(e),"_onCancel",null),(0,r._x)((0,r.Lc)(e),"_priOptions",null),e}return(0,r.qH)(u,[{key:"load",value:function(e){var t,n=this,u=e.url,d=e.vid,c=e.timeout,l=e.responseType,h=e.onProgress,f=e.index,g=e.onTimeout,_=e.onCancel,p=e.range,v=e.transformResponse,m=e.request,y=e.params,b=e.logger,E=e.method,T=e.headers,k=e.body,x=e.mode,R=e.credentials,w=e.cache,I=e.redirect,O=e.referrer,S=e.referrerPolicy,D=e.onProcessMinLen,A=e.priOptions;this._logger=b,this._aborted=!1,this._onProcessMinLen=D,this._onCancel=_,this._abortController="undefined"!=typeof AbortController&&new AbortController,this._running=!0,this._index=f,this._range=p||[0,0],this._vid=d||u,this._priOptions=A||{};var L={method:E,headers:T,body:k,mode:x,credentials:R,cache:w,redirect:I,referrer:O,referrerPolicy:S,signal:null===(t=this._abortController)||void 0===t?void 0:t.signal},C=!1;clearTimeout(this._timeoutTimer),u=(0,a.G7)(u,y);var P=(0,a.Gu)(p);P&&(T=m?m.headers:L.headers=L.headers||(Headers?new Headers:{}),Headers&&T instanceof Headers?T.append("Range",P):T.Range=P),c&&(this._timeoutTimer=setTimeout(function(){if(C=!0,n.cancel(),g){var e=new i.C(u,L,null,"timeout");e.isTimeout=!0,g(e,{index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions})}},c));var M=Date.now();return this._logger.debug("[fetch load start], index,",f,",range,",p),new Promise(function(e,t){var d;fetch(m||u,m?void 0:L).then((d=(0,r.x)((0,r.l5)().mark(function d(c){var g,_,m,y;return(0,r.l5)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(clearTimeout(n._timeoutTimer),n._response=c,!(n._aborted||!n._running)){r.next=4;break}return r.abrupt("return");case 4:if(v&&(c=v(c,u)||c),c.ok){r.next=7;break}throw new i.C(u,L,c,"bad network response");case 7:if(g=Date.now(),l!==o.U.TEXT){r.next=15;break}return r.next=11,c.text();case 11:case 18:_=r.sent,n._running=!1,r.next=37;break;case 15:if(l!==o.U.JSON){r.next=22;break}return r.next=18,c.json();case 22:if(!h){r.next=29;break}return n.resolve=e,n.reject=t,n._loadChunk(c,h,M,g),r.abrupt("return");case 29:return r.next=31,c.arrayBuffer();case 31:_=new Uint8Array(_=r.sent),n._running=!1,m=Date.now()-M,y=(0,a.pl)(_.byteLength,m),n.emit(s.K.REAL_TIME_SPEED,{speed:y,len:_.byteLength,time:m,vid:n._vid,index:n._index,range:n._range,priOptions:n._priOptions});case 37:n._logger.debug("[fetch load end], index,",f,",range,",p),e((0,a.rO)(_,!0,c,c.headers.get("Content-Length"),c.headers.get("age"),M,g,f,p,n._vid,n._priOptions));case 39:case"end":return r.stop()}},d)})),function(e){return d.apply(this,arguments)})).catch(function(e){var r;clearTimeout(n._timeoutTimer),n._running=!1,(!n._aborted||C)&&((e=e instanceof i.C?e:new i.C(u,L,null,null===(r=e)||void 0===r?void 0:r.message)).startTime=M,e.endTime=Date.now(),e.isTimeout=C,e.options={index:n._index,range:n._range,vid:n._vid,priOptions:n._priOptions},t(e))})})}},{key:"cancel",value:(t=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._aborted){e.next=2;break}return e.abrupt("return");case 2:if(this._aborted=!0,this._running=!1,!this._response){e.next=14;break}if(e.prev=5,!this._reader){e.next=9;break}return e.next=9,this._reader.cancel();case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:this._response=this._reader=null;case 14:if(this._abortController){try{this._abortController.abort()}catch(e){}this._abortController=null}this._onCancel&&this._onCancel({index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions});case 16:case"end":return e.stop()}},e,this,[[5,11]])})),function(){return t.apply(this,arguments)})},{key:"_loadChunk",value:function(e,t,n,o){var u,d,c,l,h=this;if(!e.body||!e.body.getReader){this._running=!1;var f=new i.C(e.url,"",e,"onProgress of bad response.body.getReader");f.options={index:this._index,range:this._range,vid:this._vid,priOptions:this._priOptions},this.reject(f);return}this._onProcessMinLen>0&&(this._cache=new Uint8Array(2097152),this._writeIdx=0);var g=this._reader=e.body.getReader();var _=(u=(0,r.x)((0,r.l5)().mark(function i(){var u,f,p,v,m,y,b,E;return(0,r.l5)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return c=Date.now(),r.prev=1,r.next=4,g.read();case 4:d=r.sent,l=Date.now(),r.next=13;break;case 8:return r.prev=8,r.t0=r.catch(1),l=Date.now(),!h._aborted&&(h._running=!1,r.t0.options={index:h._index,range:h._range,vid:h._vid,priOptions:h._priOptions},h.reject(r.t0)),r.abrupt("return");case 13:if(p=(f=(null===(u=h._range)||void 0===u?void 0:u.length)>0?h._range[0]:0)+h._receivedLength,!h._aborted){r.next=19;break}return h._running=!1,t(void 0,!1,{range:[p,p],vid:h._vid,index:h._index,startTime:c,endTime:l,st:n,firstByteTime:o,priOptions:h._priOptions},e),r.abrupt("return");case 19:v=d.value?d.value.byteLength:0,h._receivedLength+=v,h._logger.debug("【fetchLoader,onProgress call】,task,",h._range,", start,",p,", end,",f+h._receivedLength,", done,",d.done),h._onProcessMinLen>0?h._writeIdx+v>=h._onProcessMinLen||d.done?((m=new Uint8Array(h._writeIdx+v)).set(h._cache.slice(0,h._writeIdx),0),v>0&&m.set(d.value,h._writeIdx),h._writeIdx=0,h._logger.debug("【fetchLoader,onProgress enough】,done,",d.done,",len,",m.byteLength,", writeIdx,",h._writeIdx)):v>0&&h._writeIdx+v<2097152?(h._cache.set(d.value,h._writeIdx),h._writeIdx+=v,h._logger.debug("【fetchLoader,onProgress cache】,len,",v,", writeIdx,",h._writeIdx)):v>0&&(y=new Uint8Array(h._writeIdx+v+2048),h._logger.debug("【fetchLoader,onProgress extra start】,size,",h._writeIdx+v+2048,", datalen,",v,", writeIdx,",h._writeIdx),y.set(h._cache.slice(0,h._writeIdx),0),v>0&&y.set(d.value,h._writeIdx),h._writeIdx+=v,delete h._cache,h._cache=y,h._logger.debug("【fetchLoader,onProgress extra end】,len,",v,", writeIdx,",h._writeIdx)):m=d.value,(m&&m.byteLength>0||d.done)&&t(m,d.done,{range:[h._range[0]+h._receivedLength-(m?m.byteLength:0),h._range[0]+h._receivedLength],vid:h._vid,index:h._index,startTime:c,endTime:l,st:n,firstByteTime:o,priOptions:h._priOptions},e),d.done?(b=Date.now()-n,E=(0,a.pl)(h._receivedLength,b),h.emit(s.K.REAL_TIME_SPEED,{speed:E,len:h._receivedLength,time:b,vid:h._vid,index:h._index,range:h._range,priOptions:h._priOptions}),h._running=!1,h._logger.debug("[fetchLoader onProgress end],task,",h._range,",done,",d.done),h.resolve((0,a.rO)(d,!0,e,e.headers.get("Content-Length"),e.headers.get("age"),n,o,h._index,h._range,h._vid,h._priOptions))):_();case 25:case"end":return r.stop()}},i,null,[[1,8]])})),function(){return u.apply(this,arguments)});_()}},{key:"receiveLen",get:function(){return this._receivedLength}},{key:"running",get:function(){return this._running},set:function(e){this._running=e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof fetch}}]),u}(d())},380653:function(e,t,n){function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if((t=t.filter(Boolean)).length<2)return t[0];var r=new Uint8Array(t.reduce(function(e,t){return e+t.byteLength},0)),i=0;return t.forEach(function(e){r.set(e,i),i+=e.byteLength}),r}function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(t){return setTimeout(t,e)})}n.d(t,{_v:function(){return i},gJ:function(){return r}})},107864:function(e,t,n){n.d(t,{b:function(){return l}});var r=n(375234),i=n(684042),a=n(874838),o=n(758698),s=n(344137);n(691842),n(110617),n(511141),n(792315),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680),n(742611),n(465132),n(836654),n(464135),n(469577);var u=n(167186),d=n(103121),c=4294967295,l=function(){function e(){(0,a.Z)(this,e)}return(0,o.Z)(e,null,[{key:"box",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=8+(n=n.filter(Boolean)).reduce(function(e,t){return e+t.byteLength},0),a=new Uint8Array(i);a[0]=i>>24&255,a[1]=i>>16&255,a[2]=i>>8&255,a[3]=255&i,a.set(e,4);var o=8;return n.forEach(function(e){a.set(e,o),o+=e.byteLength}),a}},{key:"ftyp",value:function(t){return t.find(function(e){return e.type===d.Vc.VIDEO&&e.codecType===d._e.HEVC})?e.FTYPHEV1:e.FTYPAVC1}},{key:"initSegment",value:function(t){return(0,u.gJ)(e.ftyp(t),e.moov(t))}},{key:"moov",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat((0,i.Z)(t.map(function(t){return e.trak(t)})),[e.mvex(t)]))}},{key:"mvhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdia(t))}},{key:"tkhd",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,i>>8&255,255&i,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minf(t))}},{key:"mdhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9e4;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24&255,t>>16&255,t>>8&255,255&t,85,196,0,0]))}},{key:"hdlr",value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])}},{key:"minf",value:function(t){return e.box(e.types.minf,t.type===d.Vc.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stbl(t))}},{key:"stbl",value:function(t){return e.box(e.types.stbl,e.stsd(t),e.STTS,e.STSC,e.STSZ,e.STCO)}},{key:"stsd",value:function(t){return e.box(e.types.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),t.type===d.Vc.VIDEO?e.avc1hev1(t):e.mp4a(t))}},{key:"avc1hev1",value:function(t){var n=t.codecType===d._e.HEVC,r=n?e.types.hvc1:e.types.avc1,i=n?e.hvcC(t):e.avcC(t),a=[new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),i];return t.sarRatio&&t.sarRatio.length>1&&a.push(e.pasp(t.sarRatio)),e.box.apply(e,[r].concat(a))}},{key:"avcC",value:function(t){var n,r=[],a=[];return t.sps.forEach(function(e){n=e.byteLength,r.push(n>>>8&255),r.push(255&n),r.push.apply(r,(0,i.Z)(e))}),t.pps.forEach(function(e){n=e.byteLength,a.push(n>>>8&255),a.push(255&n),a.push.apply(a,(0,i.Z)(e))}),e.box(e.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(a)))}},{key:"hvcC",value:function(t){var n,r=t.hvcC;if(r instanceof ArrayBuffer)return r;var a=t.vps,o=t.sps,s=t.pps;if(r){var u=r.generalProfileCompatibilityFlags,d=r.generalConstraintIndicatorFlags,c=(a.length&&1)+(o.length&&1)+(s.length&&1);n=[1,r.generalProfileSpace<<6|r.generalTierFlag<<5|r.generalProfileIdc,u>>>24,u>>>16,u>>>8,u,d[0],d[1],d[2],d[3],d[4],d[5],r.generalLevelIdc,240,0,252,252|r.chromaFormatIdc,248|r.bitDepthLumaMinus8,248|r.bitDepthChromaMinus8,0,0,r.numTemporalLayers<<3|r.temporalIdNested<<2|3,c];var l=function(e){var t;n.push(e.length>>8,e.length),(t=n).push.apply(t,(0,i.Z)(e))};a.length&&(n.push(160,0,a.length),a.forEach(l)),o.length&&(n.push(161,0,o.length),o.forEach(l)),s.length&&(n.push(162,0,s.length),s.forEach(l))}else n=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return e.box(e.types.hvcC,new Uint8Array(n))}},{key:"pasp",value:function(t){var n=(0,r.Z)(t,2),i=n[0],a=n[1];return e.box(e.types.pasp,new Uint8Array([i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a]))}},{key:"mp4a",value:function(t){return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),t.config.length?e.esds(t.config):void 0)}},{key:"esds",value:function(t){var n=t.length;return e.box(e.types.esds,new Uint8Array([0,0,0,0,3,23+n,0,0,0,4,15+n,64,21,0,6,0,0,0,218,192,0,0,218,192,5].concat([n]).concat(t).concat([6,1,2])))}},{key:"mvex",value:function(t){return e.box.apply(e,[e.types.mvex].concat((0,i.Z)(t.map(function(t){return e.trex(t.id)}))))}},{key:"trex",value:function(t){return e.box(e.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"moof",value:function(t,n){return e.box.apply(e,[e.types.moof,e.mfhd(t)].concat((0,i.Z)(n.map(function(t){return e.traf(t)}))))}},{key:"mfhd",value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"traf",value:function(t){return e.box(e.types.traf,e.tfhd(t.id),e.tfdt(t.baseMediaDecodeTime),e.trun(t.samples,76))}},{key:"tfhd",value:function(t){return e.box(e.types.tfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))}},{key:"tfdt",value:function(t){var n=Math.floor(t/(c+1)),r=Math.floor(t%(c+1));return e.box(e.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r]))}},{key:"trun",value:function(t,n){var r=t.length,i=12+16*r;n+=8+i;var a=new Uint8Array(i);a.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var o=0;o<r;o++){var s=t[o],u=s.duration,d=s.size,c=s.flag,l=void 0===c?{}:c,h=s.cts,f=void 0===h?0:h;a.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,d>>>24&255,d>>>16&255,d>>>8&255,255&d,l.isLeading<<2|(null==l.dependsOn?1:l.dependsOn),l.isDependedOn<<6|l.hasRedundancy<<4|l.paddingValue<<1|(null==l.isNonSyncSample?1:l.isNonSyncSample),61440&l.degradationPriority,15&l.degradationPriority,f>>>24&255,f>>>16&255,f>>>8&255,255&f],12+16*o)}return e.box(e.types.trun,a)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}},{key:"moovMP4",value:function(t){return e.box.apply(e,[e.types.moov,e.mvhd(t[0].duration,t[0].timescale)].concat((0,i.Z)(t.map(function(t){return e.trackMP4(t)}))))}},{key:"trackMP4",value:function(t){return e.box(e.types.trak,e.tkhd(t.id,t.duration,t.width,t.height),e.mdiaMP4(t))}},{key:"mdiaMP4",value:function(t){return e.box(e.types.mdia,e.mdhd(t.duration,t.timescale),e.hdlr(t.type),e.minfMP4(t))}},{key:"minfMP4",value:function(t){return e.box(e.types.minf,t.type===d.Vc.VIDEO?e.VMHD:e.SMHD,e.DINF,e.stblMP4(t))}},{key:"stblMP4",value:function(t){var n=t.ext,r=[e.stsd(t),e.stts(n.stts),e.stsc(n.stsc),e.stsz(n.stsz),e.stco(n.stco)];return n.stss.length&&r.push(e.stss(n.stss)),n.ctts.length&&r.push(e.ctts(n.ctts)),e.box.apply(e,[e.types.stbl].concat(r))}},{key:"stts",value:function(t){var n=t.length,r=new Uint8Array(8*n),i=0;return t.forEach(function(e){var t=e.value,n=e.count;r.set([n>>24,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8}),e.box(e.types.stts,(0,u.gJ)(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stsc",value:function(t){var n=t.length,r=new Uint8Array(12*n),i=0;return t.forEach(function(e){var t=e.firstChunk,n=e.samplesPerChunk,a=e.sampleDescIndex;r.set([t>>24,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,a>>24,a>>16&255,a>>8&255,255&a],i),i+=12}),e.box(e.types.stsc,(0,u.gJ)(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stsz",value:function(t){var n=t.length,r=new Uint8Array(4*n),i=0;return t.forEach(function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4}),e.box(e.types.stsz,(0,u.gJ)(new Uint8Array([0,0,0,0,0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stco",value:function(t){var n=t.length,r=new Uint8Array(4*n),i=0;return t.forEach(function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4}),e.box(e.types.stco,(0,u.gJ)(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"stss",value:function(t){var n=t.length,r=new Uint8Array(4*n),i=0;return t.forEach(function(e){r.set([e>>24,e>>16&255,e>>8&255,255&e],i),i+=4}),e.box(e.types.stss,(0,u.gJ)(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}},{key:"ctts",value:function(t){var n=t.length,r=new Uint8Array(8*n),i=0;return t.forEach(function(e){var t=e.value,n=e.count;r.set([n>>24,n>>16&255,n>>8&255,255&n,t>>24,t>>16&255,t>>8&255,255&t],i),i+=8}),e.box(e.types.ctts,(0,u.gJ)(new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n]),r))}}]),e}();(0,s.Z)(l,"types",["avc1","avcC","hvc1","hvcC","dinf","dref","esds","ftyp","hdlr","mdat","mdhd","mdia","mfhd","minf","moof","moov","mp4a","mvex","mvhd","pasp","stbl","stco","stsc","stsd","stsz","stts","tfdt","tfhd","traf","trak","trun","trex","tkhd","vmhd","smhd","ctts","stss"].reduce(function(e,t){return e[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)],e},Object.create(null))),(0,s.Z)(l,"HDLR_TYPES",{video:new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),audio:new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0])}),(0,s.Z)(l,"FTYPAVC1",l.box(l.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))),(0,s.Z)(l,"FTYPHEV1",l.box(l.types.ftyp,new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,104,101,118,49]))),(0,s.Z)(l,"DINF",l.box(l.types.dinf,l.box(l.types.dref,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])))),(0,s.Z)(l,"VMHD",l.box(l.types.vmhd,new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))),(0,s.Z)(l,"SMHD",l.box(l.types.smhd,new Uint8Array([0,0,0,0,0,0,0,0]))),(0,s.Z)(l,"StblTable",new Uint8Array([0,0,0,0,0,0,0,0])),(0,s.Z)(l,"STTS",l.box(l.types.stts,l.StblTable)),(0,s.Z)(l,"STSC",l.box(l.types.stsc,l.StblTable)),(0,s.Z)(l,"STSZ",l.box(l.types.stsz,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]))),(0,s.Z)(l,"STCO",l.box(l.types.stco,l.StblTable))},306492:function(e,t,n){function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,s(r.key),r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t,n){return(t=s(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{PA:function(){return r},_x:function(){return o},qH:function(){return a}});function s(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}}}]);