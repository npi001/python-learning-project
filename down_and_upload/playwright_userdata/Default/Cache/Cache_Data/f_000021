/*! For license information please see player-7.30c0b4f8.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).xss={})}(this,function(e){"use strict";var t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function n(e,t,n){if(n||2==arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var r=/[^a-zA-Z0-9\\_:.-]/gim,i=/</g,a=/>/g,o=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,l=/&colon;?/gim,u=/&newline;?/gim,c=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,d=/u\s*r\s*l\s*\(.*/gi,h=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,f=/"/g,g=function(e){return e.replace(i,"&lt;").replace(a,"&gt;")},p={indexOf:function(e,t){var n,r;for(n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return -1},forEach:function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)t.call(n,e[r],r,e)},some:function(e,t,n){var r,i;for(r=0,i=e.length;r<i;r++)if(t.call(n,e[r],r,e))return!0;return!1},trim:function(e){return e.replace(/(^\s*)|(\s*$)/g,"")},includes:function(e,t){if("string"==typeof e)return -1!==e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return!0;return!1},spaceIndex:function(e){var t=/\s|\n|\t/.exec(e);return t?t.index:-1},uniq:function(e){for(var t={},n=[],r=0;r<e.length;r++)t[e[r]]||(n.push(e[r]),t[e[r]]=!0);return n},from:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t},keys:function(e){var t=[];for(var n in e)t.push(n);return t}};function v(e){return null==e}function m(e){var t;return'"'===(t=e)[0]&&'"'===t[t.length-1]||"'"===t[0]&&"'"===t[t.length-1]?e.substr(1,e.length-2):e}function _(e){var t,n,r,i,a,o,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",c=0;for(e=function(e){e=e.replace(/rn/g,"n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):r>127&&r<2048?t+=String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):t+=String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128)}return t}(e);c<e.length;)i=(t=e.charCodeAt(c++))>>2,a=(3&t)<<4|(n=e.charCodeAt(c++))>>4,o=(15&n)<<2|(r=e.charCodeAt(c++))>>6,s=63&r,isNaN(n)?o=s=64:isNaN(r)&&(s=64),u=u+l.charAt(i)+l.charAt(a)+l.charAt(o)+l.charAt(s);return u}function y(e){var t,n,r,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");u<e.length;)t=s.indexOf(e.charAt(u++))<<2|(i=s.indexOf(e.charAt(u++)))>>4,n=(15&i)<<4|(a=s.indexOf(e.charAt(u++)))>>2,r=(3&a)<<6|(o=s.indexOf(e.charAt(u++))),l+=String.fromCharCode(t),64!==a&&(l+=String.fromCharCode(n)),64!==o&&(l+=String.fromCharCode(r));return function(e){for(var t="",n=0,r=0,i=0,a=0;n<e.length;)(r=e.charCodeAt(n))<128?(t+=String.fromCharCode(r),n++):r>191&&r<224?(t+=String.fromCharCode((31&r)<<6|63&(a=e.charCodeAt(n+1))),n+=2):(a=e.charCodeAt(n+1),t+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&(i=e.charCodeAt(n+2))),n+=3);return t}(l)}function b(e,t,n){var r="",i=0,a=!1,o=!1,s=0,l=e.length,u="",c="";e:for(s=0;s<l;s++){var d=e.charAt(s);if(!1===a){if("<"===d){a=s;continue}}else if(!1===o){if("<"===d){r+=n(e.slice(i,s)),a=s,i=s;continue}if(">"===d||s===l-1){r+=n(e.slice(i,a)),u=function(e){var t,n=p.spaceIndex(e);return t=-1===n?e.slice(1,-1):e.slice(1,n+1),"/"===(t=p.trim(t).toLowerCase()).slice(0,1)&&(t=t.slice(1)),"/"===t.slice(-1)&&(t=t.slice(0,-1)),t}(c=e.slice(a,s+1)),r+=t(a,r.length,u,c,"</"===c.slice(0,2)),i=s+1,a=!1;continue}if('"'===d||"'"===d)for(var h=1,f=e.charAt(s-h);""===f.trim()||"="===f;){if("="===f){o=d;continue e}f=e.charAt(s-++h)}}else if(d===o){o=!1;continue}}return i<l&&(r+=n(e.substr(i))),r}function S(e,t){var n=0,i=0,a=[],o=!1,s=e.length;function l(e,n){if(!((e=(e=p.trim(e)).replace(r,"").toLowerCase()).length<1)){var i=t(e,n||"");i&&a.push(i)}}for(var u=0;u<s;u++){var c=e.charAt(u),d=void 0;if(!1!==o||"="!==c){if(!1===o||u!==i){if(/\s|\n|\t/.test(c)){if(e=e.replace(/\s|\n|\t/g," "),!1===o){if(-1===(d=function(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"="===n?t:-1}return -1}(e,u))){l(p.trim(e.slice(n,u))),o=!1,n=u+1;continue}u=d-1;continue}if(-1===(d=function(e,t){for(;t>0;t--){var n=e[t];if(" "!==n)return"="===n?t:-1}return -1}(e,u-1))){l(o,m(p.trim(e.slice(n,u)))),o=!1,n=u+1;continue}}}else{if(-1===(d=e.indexOf(c,u+1)))break;l(o,p.trim(e.slice(i+1,d))),o=!1,n=(u=d)+1}}else o=e.slice(n,u),n=u+1,i='"'===e.charAt(n)||"'"===e.charAt(n)?n:function(e,t){for(;t<e.length;t++){var n=e[t];if(" "!==n)return"'"===n||'"'===n?t:-1}return -1}(e,u+1)}return n<e.length&&(!1===o?l(e.slice(n)):l(o,m(p.trim(e.slice(n))))),p.trim(a.join(" "))}function T(e,t,n){if(n=function(e){return e=function(e){for(var t="",n=0,r=e.length;n<r;n++)t+=32>e.charCodeAt(n)?" ":e.charAt(n);return p.trim(t)}(e=(e=(e=e.replace(s,'"')).replace(o,function(e,t){return"x"===t[0]||"X"===t[0]?String.fromCharCode(parseInt(t.substr(1),16)):String.fromCharCode(parseInt(t,10))})).replace(l,":").replace(u," "))}(n),"href"===t||"src"===t){if("#"===(n=p.trim(n)))return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"data:image/"!==n.substr(0,11)&&"ftp://"!==n.substr(0,6)&&"./"!==n.substr(0,2)&&"../"!==n.substr(0,3)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===t){if(c.lastIndex=0,c.test(n))return""}else if("style"===t&&(h.lastIndex=0,h.test(n)||(d.lastIndex=0,d.test(n)&&(c.lastIndex=0,c.test(n)))))return"";return n=function(e){return e=g(e=e.replace(f,"&quot;"))}(n)}var k=function(e){return"string"==typeof e?e.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},x=function(){function e(e){var t=function(e){var t={};for(var n in e)t[n]=e[n];return t}(e||{});t.stripIgnoreTag&&(t.onIgnoreTag,t.onIgnoreTag=function(){return""}),t.whiteList={},t.onTag=function(){},t.onTagAttr=function(){},t.onIgnoreTag=function(){},t.onIgnoreTagAttr=function(){},t.safeAttrValue=T,t.escapeHtml=g,this.options=Object.assign(t,e)}return e.prototype.process=function(e){if(!(e=(e=e||"").toString()))return"";var t,n,r,i,a,o,s=this.options,l=s.whiteList,u=s.onTag,c=s.onIgnoreTag,d=s.onTagAttr,h=s.onIgnoreTagAttr,f=s.safeAttrValue,g=s.escapeHtml;s.stripBlankChar&&(e=(t=(t=e.split("")).filter(function(e){var t=e.charCodeAt(0);return!(127===t||t<=31&&10!==t&&13!==t)})).join("")),s.allowCommentTag||(e=function(e){for(var t="",n=0;n<e.length;){var r=e.indexOf("\x3c!--",n);if(-1===r){t+=e.slice(n);break}t+=e.slice(n,r);var i=e.indexOf("--\x3e",r);if(-1===i)break;n=i+3}return t}(e));var v=!1;s.stripIgnoreTagBody&&(n=s.stripIgnoreTagBody,"function"!=typeof(r=c)&&(r=function(){}),i=!Array.isArray(n),a=[],o=!1,c=(v={onIgnoreTag:function(e,t,s){var l;if(l=e,i||-1!==p.indexOf(n,l)){if(s.isClosing){var u="[/removed]",c=s.position+u.length;return a.push([!1!==o?o:s.position,c]),o=!1,u}return o||(o=s.position),"[removed]"}return r(e,t,s)},remove:function(e){var t="",n=0;return p.forEach(a,function(r){t+=e.slice(n,r[0]),n=r[1]}),t+=e.slice(n)}}).onIgnoreTag);var m=b(e,function(e,t,n,r,i){var a={sourcePosition:e,position:t,isClosing:i,isWhite:Object.prototype.hasOwnProperty.call(l,n)},o=u(n,r,a);if(null!=o)return o;if(a.isWhite){if(a.isClosing)return"</".concat(n,">");var s=function(e){var t=p.spaceIndex(e);if(-1===t)return{html:"",closing:"/"===e[e.length-2]};var n="/"===(e=p.trim(e.slice(t+1,-1)))[e.length-1];return n&&(e=p.trim(e.slice(0,-1))),{html:e,closing:n}}(r),v=l[n],m=S(s.html,function(e,t){var r=-1!==p.indexOf(v,e),i=d(n,e,t,r);return null==i?r?(t=f(n,e,t,null))?"".concat(e,'="').concat(t,'"'):e:null==(i=h(n,e,t,r))?void 0:i:i});return r="<".concat(n),m&&(r+=" ".concat(m)),s.closing&&(r+=" /"),r+=">"}return null==(o=c(n,r,a))?g(r):o},g);return v&&(m=v.remove(m)),m},e}(),E=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),L=new(function(){function e(){var e=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var t,n,r="douyin_web";if(!p.includes(r,"bid"))return r;if(e.config&&e.config.bid)return e.config.bid;if(E&&E._xssBid)return E._xssBid;if(E&&E.slardar&&"function"==typeof E.slardar.config){var i=(E.slardar.config()||{}).bid;if(i)return i}if(E&&E.Slardar&&"function"==typeof E.Slardar.config){var a=(E.Slardar.config()||{}).bid;if(a)return a}return(null===(n=null===(t=null==E?void 0:E.Slardar)||void 0===t?void 0:t._baseParams)||void 0===n?void 0:n.bid)||"argus"},this.getConfigRegion=function(){var t;return p.includes("cn","region")?e.config&&e.config.region?e.config.region:((null===(t=null==E?void 0:E.gfdatav1)||void 0===t?void 0:t.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var t={cn:y("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:y("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:y("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:y("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[e.getConfigRegion()];if(t)return t+e.getSlardarBid()}}return e.prototype.setConfig=function(e){this.config=e},e.prototype.upload=function(){var e=this,t=this.gerReportUrl();!this.lock&&t&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var n=e.batchData.slice(0,100);e.batchData=e.batchData.slice(100),E.fetch(t,{method:"post",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).catch(function(e){}),e.lock=!1,e.upload()},this.timeout))},e.prototype.generateKey=function(e){return e.collectKey?[e.collectMode,e.collectKey].join("___"):""},e.prototype.push=function(e){this.batchData.push(e),this.upload()},e.prototype.report=function(e){var t=this.generateKey(e);if(E.fetch&&e.collectKey){var n="object"==typeof window?window.location.href:"SSR";e.documentUrl=n;var r={age:Math.floor(Date.now()),type:"xss",url:n,body:e,"user-agent":""};"enforce"===e.disposition&&"SSR"!==n||(r.url=t),"SSR"===n&&(r.url="SSR___".concat(r.url),r.body.ssr=!0),this.push(r)}},e}()),R=function(e){for(var t=0,n=function(n){Array.isArray(e[n])?0===e[n].length?delete e[n]:(e[n]=p.from(p.uniq(e[n])),t+=e[n].length):0===p.keys(e[n]).length?delete e[n]:p.keys(e[n]).forEach(function(r){e[n][r]=p.from(p.uniq(e[n][r])),t+=e[n][r].length})},r=0,i=p.keys(e);r<i.length;r++)n(i[r]);return{count:t,ret:e}};function w(e,t){return L.setConfig(t),new x(t).process(e)}function A(e){var t,n=(t=/\s|\n|\t/.exec(e))?t.index:-1;if(-1===n)return{html:"",closing:"/"===e[e.length-2]};var r="/"===(e=e.slice(n+1,-1).trim())[e.length-1];return r&&(e=e.slice(0,-1).trim()),{html:e,closing:r}}var O=function(e){return -1===(e=(e=(e=(e=e.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?e.trim().toLowerCase():e.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(e,t,n,r){return String.fromCharCode(t?parseInt(n,16):parseInt(r))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function D(e,t){if(void 0===e&&(e=""),"string"!=typeof e)return!0;if(e=O(e),p.includes(e,"base64")&&!function(e){if(""===e||""===e.trim())return!0;try{return!p.includes(e,"data:text/html;base64")}catch(e){return!0}}(e))return t&&t("data:text/html;base64"),!1;var n=["expression(","behavior:","view-source:"];if(p.some(n,function(t){return -1!==e.indexOf(t)}))return p.forEach(n,function(n){-1!==e.indexOf(n)&&t&&t(n)}),!1;var r=["data:application","data:javascript","data:text/html","data:texthtml"];if(p.some(r,function(t){return -1!==e.indexOf(t)}))return p.forEach(r,function(n){-1!==e.indexOf(n)&&t&&t(n)}),!1;if(e.indexOf("javascript:")>0)return t&&t("javascript:"),!1;if(/^javascript:/i.test(e)){var i=e.slice(11).replace(/\s/g,"").trim();return!!p.some(["void","void(0)","void0","false","undefined",";"],function(e){return e===i})||(t&&t("javascript:"),!1)}return!0}var C=function(e,t){var n,r,i="<%= isSaveValidUrl =>";if("string"!=typeof e||(r=Number("<%= urlLimit =>"),void 0!==n&&(r=n),"NaN"!==e.toString()&&-1!==r&&e.length>=r)||D(e,t))return e;try{if(!0===(i=JSON.parse(i))||"true"===i){var a=new URL(e);return a.origin+a.pathname}}catch(e){}return"#"};function P(e,t,r){if(void 0===e&&(e=""),void 0===t&&(t=[]),"string"!=typeof e)return!0;if(!D(e=O(e)))return!1;var i,a={url:(i=e.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:i[1],slash:i[2],host:i[3],port:i[4],path:i[5],query:i[6],hash:i[7]},o=a.scheme,s=a.host;return r?!!r(e):!(!o||!s)&&(!p.includes(["http","https","file"],o)||("object"==typeof window&&window&&(t=n(n([],t,!0),[location.host],!1)),p.some(t,function(e){return!!(e instanceof RegExp&&e.test(s))||e===s})))}var I={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},B={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var e=R(this.collect),t=e.count,n=e.ret;return this.collect=null,{collectKey:0===t?null:JSON.stringify(n),collectMode:"white"}},onIgnoreTagAttr:function(e,t,r){return e&&p.indexOf(["href","src"],t)>-1?B.domainWhiteList&&Array.isArray(B.domainWhiteList)&&B.domainWhiteList.length>0&&!P(r,n([],B.domainWhiteList,!0))?"":"".concat(t,'="').concat(C(r,function(e){var t;null===(t=B.collect)||void 0===t||t.filterProtocol.push(e)}),'"'):e&&(p.indexOf(["style","class","id"],t)>-1||t.indexOf("data-")>-1)?"".concat(t,'="').concat(r,'"'):(B.collect.whiteList[e]=B.collect.whiteList[e]||[],void B.collect.whiteList[e].push(t))},onIgnoreTag:function(e,t){if("style"===e)return t;b(t,function(e,t,n,r){S(A(r).html.replace("/",""),function(e){B.collect.whiteList[n]=B.collect.whiteList[n]||[],B.collect.whiteList[n].push(e)})},g)},whiteList:I,mergeWhiteList:function(e){for(var t,n={},r=0,i=p.keys(I);r<i.length;r++)n[t=i[r]]=p.from(I[t]);for(var a=0,o=p.keys(e);a<o.length;a++)n[t=o[a]]=t in I?I[t].concat(e[t]):p.from(e[t]);return n},setWhiteList:function(e){for(var t=0,n=p.keys(e);t<n.length;t++){var r=n[t];this.whiteList[r]=r in I?I[r].concat(e[r]):p.from(e[r])}}};try{var N={},M="merge";p.includes(M,"override")&&(B.whiteList=N.whiteList),p.includes(M,"merge")&&B.setWhiteList(N.whiteList)}catch(e){}var U=function(e,t){for(var n={},r=0,i=p.keys(e);r<i.length;r++){var a=i[r];Array.isArray(e[a])?n[a]=p.from(e[a]):n[a]=U({},e[a])}for(var o=0,s=p.keys(t);o<s.length;o++)(a=s[o])in e?Array.isArray(e[a])?n[a]=e[a].concat(t[a]):n[a]=U(e[a],t[a]):Array.isArray(t[a])?n[a]=p.from(t[a]):n[a]=U({},t[a]);return n},F={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var j={};j.blackAttrRegExps&&(j.blackAttrRegExps=j.blackAttrRegExps.map(function(e){return new RegExp(e.toString().slice(1,e.toString().length-1))}));var z="merge";p.includes(z,"override")&&(F=j),p.includes(z,"merge")&&(F=U(F,j))}catch(e){}var G={mode:"black",whiteList:{},blackConfig:F,collect:null,initCollect:function(){G.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var e=R(G.collect),t=e.count,n=e.ret;return G.collect=null,{collectKey:0===t?null:JSON.stringify(n),collectMode:"black"}},onIgnoreTag:function(e,t){var n;if(!p.includes(F.blackTags,e))return b(t,function(e,t,n,r,i){if(-1!==n.indexOf("/"))return g(r);if(i)return"</".concat(n,">");var a=A(r),o=S(a.html,function(e,t){var r,i=0;if(F.blackList[n]&&p.includes(F.blackList[n],e)&&(G.collect.blackList[n]=G.collect.blackList[n]||[],G.collect.blackList[n].push(e),i++),F.blackAttrRegExps.length&&F.blackAttrRegExps.some(function(t){return t.test(e)})&&p.forEach(F.blackAttrRegExps,function(t){t.test(e)&&(G.collect.blackAttrRegExps.push("".concat(t.toString(),"->").concat(e)),i++)}),F.blackAttrs.length&&p.includes(F.blackAttrs,e)&&(F.blackAttrs.push(e),i++),!i){if(F.filterList&&F.filterList[n]&&p.includes(F.filterList[n],e)){var a=C(t,function(e){var t;null===(t=G.collect)||void 0===t||t.filterProtocol.push(e)});return a!==t&&(G.collect.filterList[n]=G.collect.filterList[n]||[],G.collect.filterList[n].push(e)),t?"".concat(e,"='").concat(a,"'"):e}return F.filterAttrs&&p.includes(F.filterAttrs,e)?((a=C(t,function(e){var t;null===(t=G.collect)||void 0===t||t.filterProtocol.push(e)}))!==t&&(null===(r=G.collect)||void 0===r||r.filterAttrs.push(e)),t?"".concat(e,"='").concat(a,"'"):e):t?"".concat(e,"='").concat(t,"'"):e}});return r="<".concat(n),o&&(r+=" ".concat(o)),a.closing&&(r+=" /"),r+=">"},g);null===(n=G.collect)||void 0===n||n.blackTags.push(e)}},q=function(e){var t=e.reportOnly,n=void 0===t||t,r=e.block;return n&&"all"===n?"report":("string"==typeof n&&("true"===n&&(n=!0),"false"===n&&(n=!1)),r?"enforce":n?"report":"enforce")},W=function(e){return function(n,r,i){if(!n||"string"!=typeof n)return n;var a=r;e===w&&(a=B).initCollect();var o=e(n,a);if(k(o)===k(n))return n;if(!i)return o;var s=i.logType,l=q(i),u=a.removeCollect();return L.report(t(t({type:s,disposition:l},u),{sourceText:_(n),filterText:_(o)})),"enforce"===l?o:n}},H=W(function(e,t){return void 0===t&&(t={}),t&&t.whiteList||(t.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new x(t).process(e)}),V=W(w),Z=function(e,t,n){var r=[],i=C(e,function(e){r.push(e)});if(i===e)return e;r=p.from(p.uniq(r));var a=t||n||{};if(!a)return i;var o=a.logType,s=q(n);return L.report({type:o,disposition:s,collectKey:r.join("___"),collectData:JSON.stringify(r),collectMode:"black",sourceText:_(e),filterText:_(i)}),"enforce"===s?i:e},J=E._xssProject||{},Y=E.xssNamespace||{},K="3.0.26",Q={FilterXSS:x,version:K,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:H,_filterXSS:V,filterUrl:Z,Config:B,BlackConfig:G,project:J,setProjectName:function(e){J[e]=this,E._xssProjectName=e}};Y.douyin_web=Q,E.xssNamespace=Y,E.Math&&!E.Math.xssNamespace&&(E.Math.xssNamespace=Y),J[K]=Q,E.globalThis=E,E.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:Q},E.xss=Q,E.isSafeUrl=P,E.isSafeDomain=P,E.isSafeProtocol=D,E._xssProject=J,E._xssProjectName&&(J[E._xssProjectName]=Q);var X=Q.setProjectName.bind(Q);e.BlackConfig=G,e.Config=B,e.FilterXSS=x,e._filterXSS=V,e.filterUrl=Z,e.filterXSS=H,e.isSafeDomain=P,e.isSafeProtocol=D,e.isSafeUrl=P,e.project=J,e.setProjectName=X,e.setXssNamespace=function(e){var t=e.appId,n=e.bid,r=e.region;Y[t]=Q;B.bid=n,B.region=r,B.enabled=!0},e.xssNamespace=Y,Object.defineProperty(e,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["10264"],{526956:function(e,t,n){n.d(t,{LH:function(){return u},O1:function(){return a},T3:function(){return v},UK:function(){return m},YL:function(){return h},av:function(){return l},bB:function(){return d},bJ:function(){return g},bT:function(){return r},c3:function(){return c},co:function(){return p},fp:function(){return s},iR:function(){return i},kU:function(){return o},qC:function(){return f}});var r={ONE_PLAY:"videoplayer_oneplay",ONE_OPERA:"videoplayer_oneopera",ONE_ERROR:"videoplayer_oneerror",ONE_EVENT:"videoplayer_oneevent",ONE_TEMP:"videoplayer_onetemp"},i={data:1e3,runtime:1002,parse:1004,network:1003,no_error_handler:9997,custom_error:9998,other:9999,notSupport:1005},a={1:-499991,2:-499992,3:-499993,4:-499994,5:-499995},o={STOP:0,PLAYING:1,PAUSE:2,ERROR:3,LOADING:4},s={UNKNOWN:0,PLAYABLE:1,STALLED:2,ERROR:3},l={UNSPECIFIED:0,ERROR:1,NEXT:2,ENDED:3,UNLOAD:4,DESTROY:5,PLAY_CATCH:6,PLAY_ERROR:7,PROGRESS_LEAVE:8},u={RETRY:"error_retry",ONEERROR:"oneerror",ONEEVENT:"oneevent",ONETEMP:"onetemp"},c={NO_CACHE:0,CACHED:1},d=864e5,h=36e5,f=["tag","subtag","device_type"],g=200,p=6e4,v=6e4,m={NO_FULLSCREEN:0,FULLSCREEN:1,CSS:2}},13457:function(e,t,n){n.d(t,{O1:function(){return o},iR:function(){return s},oO:function(){return l},zO:function(){return u}});var r=n(452006),i=n(263287),a=n(956333),o={416:i.WE[i.wb.NETWROK_RANGE_NOT_SATISFIABLE],403:i.WE[i.wb.NETWORK_FORBIDDEN],404:i.WE[i.wb.NETWORK_NOTFOUND],timeout:i.WE[i.wb.NETWORK_TIMEOUT],networkError:i.WE[i.wb.NETWORK],lenNotMatch:2130,mse:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_OTHER],mseOpen:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_ADD_SB],mseAppend:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_APPEND_BUFFER],mse_hijack:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.MSE_HIJACK],eme_hijack:i.WE[i.wb.MEDIA][i.wb.SUB_TYPES.EME_HIJACK],metaError:i.WE[i.wb.DEMUX][i.wb.SUB_TYPES.MP4],muxError:i.WE[i.wb.REMUX][i.wb.SUB_TYPES.FMP4],other:i.WE[i.wb.OTHER],waitTimeout:i.WE[i.wb.RUNTIME][i.wb.SUB_TYPES.BUFFERBREAK_ERROR],waitTimeoutWithHidden:i.WE[i.wb.RUNTIME][i.wb.SUB_TYPES.WAITING_TIMEOUT_ERROR],drm:i.WE[i.wb.DRM][i.wb.SUB_TYPES.LICENSE],custom_drm:i.WE[i.wb.DRM][i.wb.SUB_TYPES.CUSTOM_LICENSE]},s=i.wb,l=(0,r.qH)(function e(t,n,i){(0,r.PA)(this,e);var s,l=0,u=0;null!=i&&i.range&&i.range.length>1&&(l=i.range[0],u=i.range[1]);var c=o[s=n]||s;this.headers=(null==i?void 0:i.headers)||null,this.errorCode=c,this.errorType=t,this.errorMessage=(null==i?void 0:i.httpText)||(null==i?void 0:i.message),this.url=null==i?void 0:i.url,this.httpCode=n,this.version=a.i,this.rangeStart=l,this.rangeEnd=u,this.ext=i,this.mediaError={code:c,message:(null==i?void 0:i.httpText)||(null==i?void 0:i.message)}}),u=(0,r.qH)(function e(t,n,i){(0,r.PA)(this,e),this.version=a.i,this.errorCode=n,this.errorType=t,this.errorMessage=i.msg,this.ext=i,this.mediaError={code:n,message:i.msg}})},185236:function(e,t,n){n.d(t,{Dh:function(){return E}});var r=n(452006);n(836654),n(465132),n(499045),n(511141),n(464135),n(891555),n(469577),n(721911),n(429532),n(98601),n(110617),n(675373),n(792315),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680),n(742611);var i=n(266510),a=n(288950),o=n(546041),s=n(896167),l=n(174908),u=n.n(l),c=n(750367),d=n(336397),h=n(594461),f=n(298028),g=n(73988),p=n(235879),v=n(94701),m=n(603384),_=n(19815),y=n(843544),b=n(446215),S=n(231986),T=n(855381),k=n(930105),x=0,E=function(e){var t,n,a,l,E,L,R,w,A,O;function D(e,t){(0,r.PA)(this,D),(a=(0,r.$w)(this,D,[e,t]))._pendingTask={resolve:void 0,data:void 0},a._nextPreloadCount=0,a._updateRealTimeSpeed=function(e){x=e.speed,a.emit(f.kW,e)};var n,i,a,o=(0,k._K)();Object.keys(t).forEach(function(e){o[e]=t[e]}),a.options=o,a.playerId=(null===(n=e.player)||void 0===n?void 0:n.playerId)||"default";var s=a.options.logCacheConfig,l=s.logCacheLevel,u=s.logMaxSize;return a.logger=new d.Y("[Mp4Preloader]",{logCacheLevel:l,logMaxSize:u}),void 0===t.supportHevc&&(0,S.G9)()&&(a.options.supportHevc=!0),a.loadRangeType=(null===(i=a.options)||void 0===i?void 0:i.loadRangeType)||f.TJ.GOP,a.log(d._.DEBUG,"[Preloader] new preloader, playerId",a.playerId),a}return(0,r.XW)(D,e),(0,r.qH)(D,[{key:"currentPreloadInst",get:function(){return this.preloadManager.currentPreloadInst}},{key:"allCachedKeys",get:function(){return this.preloadManager.getAllCachedDataKeys()}},{key:"cacheInst",get:function(){return this.preloadManager.cacheInst}},{key:"realTimeSpeed",get:function(){return x}},{key:"taskInProgress",get:function(){return!!this._pendingTask.resolve&&!!this._pendingTask.data}},{key:"log",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];T.cM.apply(void 0,[this.logger,e,t].concat(r))}},{key:"getPreloadUnuseInfo",value:function(){return this.preloadManager.getPreloadUnuseInfo()}},{key:"generateUniqueKey",value:function(e){var t=e.vid,n=e.definition,r=e.mediaType,i=e.codecType,a=e.vtype;return D.generateUniqueKey({vid:t,mediaType:r,definition:n,codecType:i,vtype:a})}},{key:"_beforeStart",value:function(e,t){var n=e.payload||[];if(0===n.length)return this.log(d._.LOG,"preload_is_null"),null;var i=e.vid,a=e.steps,s=e.stepIdx,l=e.targetDefinition,u=e.vtype||o.l0.MP4,c=e.codecType||k.vr.H264,h=this.getUserSelectDefinition(),f=this.checkCacheKey(i,n,h,u,c);if(this.log(d._.LOG,"".concat(this.playerId," ").concat(i),"codecType:".concat(c," vtype:").concat(u," hasCache:").concat(f)),f&&!this.stepwise||"MP3"===u)return this.log(d._.LOG,"vtype_".concat(u)),null;var g=l||this.getInitDefinition(n,t);if(this.log(d._.LOG," ".concat(this.playerId," ").concat(i," getInitDefinition"),null==g?void 0:g.definition),!g)return this.log(d._.WARN,"definition_error"),null;var p=g.definition,v=g.orgDefinition,m=this.stepwise?a[e.stepIdx]:e.preloadTime||this.options.preloadTime,_=this.stepwise?a[e.stepIdx]*Math.floor(g.bitrate/8):e.preloadSize||this.options.preloadSize||390624,y=this.generateUniqueKey({vid:i,definition:p,vtype:u,codecType:c});this._nextPreloadCount>0&&this._nextPreloadCount--,this.log(d._.LOG,"".concat(this.playerId," ").concat(i),"cacheKey:".concat(y," duration:").concat(g.duration," preloadTime:").concat(m));var b=(0,r.Zj)({vid:i,definition:p,orgDefinition:v,preloadTime:m,preloadSize:_,cacheKey:y,codecType:c,vtype:u,steps:a,stepIdx:s,payload:e},g);return e.reqOptions&&(b.reqOptions=e.reqOptions),this.log(d._.LOG,"start preload,".concat(i," playerId:").concat(this.playerId)),b}},{key:"start",value:(t=(0,r.x)((0,r.l5)().mark(function e(t,n){var i,a,o,l,u,c,d,h,g;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._beforeStart(t,n)){e.next=3;break}return e.abrupt("return",{remove:!0});case 3:if(l=(o=Promise.withResolvers()).promise,u=o.resolve,c=a.codecType,this._pendingTask.resolve=u,this._pendingTask.data=a,null!==(i=this.options)&&void 0!==i&&null!==(i=i.pcdnConfig)&&void 0!==i&&i.openPreloadPCDN&&(d=Object.assign({},{productConfig:f.tE},this.options.pcdnConfig),this._pcdn=new s.e(d,void 0,void 0,void 0)),h=null,!this.stepwise){e.next=13;break}return e.next=12,this.getPreLoadData(a);case 12:h=e.sent;case 13:return g=t.loadRangeType||this.loadRangeType,(c!==k.vr.H265||this.options.supportHevc)&&g!==f.TJ.UNMUX?g===f.TJ.GOP?this.loadByPreloadTime(a,h):g===f.TJ.SIZE?this.loadByChunkSize(a,h):g===f.TJ.ONLY_SIZE&&this.loadByChunkSizeOnly(a,h):this.loadByChunkSizeUnMux(a,h),e.next=17,l;case 17:return e.abrupt("return",{remove:!this.stepwise});case 18:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"_getRangeByOffsetMap",value:function(e,t){var n=this,r=null==e?void 0:e.find(function(e){var r;return(null==e?void 0:e.time)===((null===(r=n.options)||void 0===r?void 0:r.firstLoadTimePos)||t)});return null==r?void 0:r.offset}},{key:"_decideRequestRange",value:function(e){var t=e.pktOffsetMap,n=e.bitrate,r=e.size,i=e.duration,a=[0,k.GX],o=this._getRangeByOffsetMap(t,f.he),s=0;if("number"==typeof o&&o>0)a[1]=o,s=f.he;else{var l=r||b.Z.getFileSize(n,i),u=(0,g.T)(i,k.GX,l);a[1]=u,s=1}return{range:a,duration:s}}},{key:"loadByChunkSizeOnly",value:(n=(0,r.x)((0,r.l5)().mark(function e(t,n){var i,a,o,s,l,u,c,f,g,v,m,S,T,k,x,E,L,R,w,A,O,D,C,P,I,B;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.vid,a=t.cacheKey,o=t.definition,s=t.orgDefinition,l=t.duration,u=t.bitrate,c=t.codecType,f=t.vtype,g=t.size,v=this._getLoadUrl(t)){e.next=5;break}return this._endLoadFragments(!1),e.abrupt("return");case 5:return v=b.Z.extUrl(v,{__vid:i}),S=(m=this._decideRequestRange({bitrate:u,size:g,duration:l,pktOffsetMap:t.pktOffsetMap})).range,T=m.duration,this.log(d._.LOG,"".concat(i," loadByChunkSize ").concat(S[0],"-").concat(S[1]),t.cacheKey,t.definition,T),k={vid:i,definition:o,orgDefinition:s,cacheKey:a,codecType:c,vtype:f,fileSize:g,bitrate:u||0,byteLength:0,preloadTime:T,buffer:new ArrayBuffer(0)},x=this.getRequestOption((0,r.Zj)((0,r.Zj)({},t),{},{url:v})),E=new h.mf({responseType:"arraybuffer"}),L=b.Z.nowTime(),e.prev=12,e.next=15,E.load(v,(0,r.Zj)({range:S},x));case 15:w=e.sent,!k.fileSize&&(A=(0,y.Xz)(w.headers),k.fileSize=A),(null==w||null===(R=w.data)||void 0===R?void 0:R.byteLength)>0&&(C=(D=w.data).byteLength||0,(P={codecType:c,vtype:f,vid:i,definition:o,orgDefinition:s,cacheKey:a,bitrate:u,memory:0,byteLength:C,preloadSize:C,preloadTime:0,buffer:D,fileSize:k.fileSize}).preloadTime=T||0,P.buffer&&P.buffer.byteLength>0&&(P.memory+=(null==D?void 0:D.byteLength)||0,this.setItem(t,P)),I=(null==w||null===(O=w.options)||void 0===O||null===(O=O.priOptions)||void 0===O?void 0:O.type)||p._R.CDN,B=(0,_.pl)(C,b.Z.nowTime()-L),this.bwEventEmit(i,I,C,B,a,!0)),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(12);case 23:this._endLoadFragments(!1);case 24:case"end":return e.stop()}},e,this,[[12,20]])})),function(e,t){return n.apply(this,arguments)})},{key:"getInitDefinition",value:function(e,t){for(var n=null,r=0,i=0;i<e.length;i++)if(e[i].definition===t){r=i;break}return!(n=e[r])&&(n=e[0]),n}},{key:"getPreLoadData",value:function(e){var t=this,n=Promise.withResolvers(),a=n.promise,o=n.resolve,s=n.reject;return this.getItemSameVid(e).then(function(e){if(t.log(d._.DEBUG,"[Preloader] getPreLoadData",!!e.value),e.value){var n=e.value,a=n.mediaSegList,s=n.meta,l=n.type,u=n.buffer,c=n.preloadTime,h=n.vid,f=n.cacheKey,g=n.definition,p=n.orgDefinition,v=n.byteLength,m=n.duration,_=n.fileSize,y=n.from,b=n.vtype,S=n.codecType,T=n.initSeg,k=n.bitrate,x=n.adaptTimeRange,E=n.repeatData,L=n.repeatDataStartPos,R=n.memory;o((0,r.Zj)({generateBy:"preloader",vid:h,type:l,vtype:b,codecType:S,definition:g,orgDefinition:p,bitrate:k,cacheKey:f,duration:m||0,byteLength:v,from:y,adaptTimeRange:x,repeatData:E,repeatDataStartPos:L,memory:R,meta:s,preloadTime:c,fileSize:_||0},l===i.dJ.SIZE?{buffer:u}:{initSeg:T,mediaSegList:a}))}else o(null)}).catch(function(e){s(e)}),a}},{key:"setPreLoadData",value:(a=(0,r.x)((0,r.l5)().mark(function e(t,n){var a,o,s,l,u,c,h,f,g,p,v,m,_,y,b,S,T,k,x,E,L,R,w,A,O=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=n.mediaSegList,o=n.meta,s=n.vid,l=n.definition,u=n.orgDefinition,c=n.type,h=n.buffer,f=n.duration,g=n.byteLength,p=n.preloadTime,v=n.fileSize,m=n.from,_=n.vtype,y=n.codecType,b=n.initSeg,S=n.bitrate,T=n.adaptTimeRange,k=n.repeatData,x=n.repeatDataStartPos,L={codecType:y,vtype:_,vid:s,definition:l,orgDefinition:u,cacheKey:E=n.cacheKey,type:c,from:m,meta:o,fileSize:v,adaptTimeRange:T,repeatData:k,repeatDataStartPos:x,bitrate:S,memory:0},L.memory+=(null==k?void 0:k.byteLength)||0,c===i.dJ.SIZE?(L.buffer=h,L.byteLength=g||0,L.preloadSize=g||0,L.preloadTime=p||0,L.fileSize=v,L.buffer&&L.buffer.byteLength>0&&(L.memory+=(null==h?void 0:h.byteLength)||0,this.setItem(t,L))):(L.mediaSegList=[],L.duration=f,L.byteLength=g||0,L.preloadTime=p||0,L.initSeg=b,L.memory+=(null==b?void 0:b.byteLength)||0,L.fileSize=v,null==a||a.forEach(function(e){var t;L.memory+=(null==e||null===(t=e.buffer)||void 0===t?void 0:t.byteLength)||0,L.mediaSegList.push(e)}),o&&0===a.length?(this.log(d._.LOG,"[Preloader] meta setPreLoadData1 success",E,null==L||null===(R=L.mediaSegList)||void 0===R?void 0:R.length),this.setItem(t,L)):(A=a.every(function(e){return!!e.buffer&&e.state}),this.log(d._.LOG,"[Preloader] mediaSegList setPreLoadData1 success",E,null==L||null===(w=L.mediaSegList)||void 0===w?void 0:w.length,A),A&&this.setItem(t,L).then(function(){O.log(d._.LOG,"[Preloader] setPreLoadData1 success",E)})));case 4:case"end":return e.stop()}},e,this)})),function(e,t){return a.apply(this,arguments)})},{key:"getInitCacheData",value:function(e,t){var n={type:e,meta:null,byteLength:0,fileSize:0,bitrate:0,preloadTime:0};return e===i.dJ.DURATION?(n.mediaSegList=[],n.initSeg=null,n.duration=0):n.buffer=null,Object.keys(t).map(function(e){n[e]=t[e]}),n}},{key:"updatePreCacheData",value:function(e,t,n,r,a,o,s,l,c,h){var f,g=e.mediaSegList;if(e.type===i.dJ.SIZE||-1===a)return e.buffer=u()(Uint8Array,(null===(f=e.buffer)||void 0===f?void 0:f.buffer)||[],new Uint8Array(t)),e;var p=-1;if(g){for(var v=0;v<g.length;v++)if(g[v].index===a){p=v;break}}var m=o||[0,0];if(p>-1&&g)t&&(g[p].buffer=u()(Uint8Array,g[p].buffer||[],new Uint8Array(t))),n.length>1&&(g[p].range.length>1?g[p].range[1]=n[1]:g[p].range=n),s&&-1!==s[1]&&(r=g[p].range[1]>=s[1]),g[p].state=r;else{e.duration=m[1],g&&g.push({buffer:t,range:n||[],index:a,totalRange:s||[],timeRange:[m[0],m[1]],muxSampleIdxRange:l,unMuxPos:c,state:r});var _="".concat(null==t?void 0:t.byteLength,",").concat(JSON.stringify(n),",").concat(a,",").concat(JSON.stringify(s),",").concat(JSON.stringify(o));this.log(d._.DEBUG,"[Preloader] ".concat(e.cacheKey," mediaSegList set, dataLen"),_)}return r&&(e.byteLength+=n[1]-n[0],e.preloadTime+=h),r}},{key:"checkCacheKey",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o.l0.MP4,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:o.u7.H264;if(n){var a=this.generateUniqueKey({vid:e,definition:n,vtype:r,codecType:i});return a&&this.hasItemSameVid(a)?a:null}for(var s=0;s<t.length;s++){var l=this.generateUniqueKey({vid:e,definition:t[s].definition,vtype:r,codecType:i});if(l&&this.hasItemSameVid(l))return l}return null}},{key:"getRangeStartPos",value:function(e){var t,n=this,r=null==e||null===(t=e.pktOffsetMap)||void 0===t?void 0:t.find(function(e){var t;return(null==e?void 0:e.time)===((null===(t=n.options)||void 0===t?void 0:t.firstLoadTimePos)||f.he)});return null==r?void 0:r.offset}},{key:"loadByChunkSizeUnMux",value:(l=(0,r.x)((0,r.l5)().mark(function e(t,n){var a,o,s,l,u,h,v,m,S,x,E,L,R,w,A,O,D,C,P,I,B,N,M,U,F,j,z,G=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.vid,o=t.cacheKey,s=t.definition,l=t.orgDefinition,u=t.duration,h=t.bitrate,v=t.codecType,m=t.vtype,S=t.size,x=t.uri,E=t.file_id,L=this.options,R=this._getLoadUrl(t)){e.next=6;break}return this._endLoadFragments(!1),e.abrupt("return");case 6:if(R=b.Z.extUrl(R,{__vid:a}),w=S||b.Z.getFileSize(h,u),O=null==(A=null==t||null===(z=t.pktOffsetMap)||void 0===z?void 0:z.find(function(e){return(null==e?void 0:e.time)===((null==L?void 0:L.firstLoadTimePos)||f.he)}))?void 0:A.offset,D=(0,g.T)(u,k.GX,w),this.log(d._.LOG,"".concat(a," loadByChunkSizeUnMux"),t.cacheKey,t.definition,O||D),C=this.getInitCacheData(i.dJ.SIZE,{vid:a,definition:s,orgDefinition:l,cacheKey:o,codecType:v,vtype:m,fileSize:S,bitrate:h||0}),P=this.getRequestOption((0,r.Zj)((0,r.Zj)({},t),{},{url:R})),this.startPCDN(R,x,a,h,E,m.toLowerCase()||"mp4",Math.floor(u),w),this.mp4Loader=new c.b({url:R,vid:"".concat(a,"-").concat(h),retry:L.retryCount||2,retryDelay:L.retryDelay||1e3,timeout:L.timeout||3e3,reqOptions:P,loaderType:L.loaderType,retryCheckFunc:_.Wp,openLog:(0,T.qw)(),memoryOpt:this.options.memoryOpt,audioGroupingStrategy:L.audioGroupingStrategy,fixEditListOffset:L.fixEditListOffset,fixEditListOffsetThreshold:L.fixEditListOffsetThreshold}),this.mp4Loader.on(f.kW,function(e){if((null==e?void 0:e.len)>0){var t,n=(null==e||null===(t=e.priOptions)||void 0===t?void 0:t.type)||p._R.CDN,r=(0,_.pl)(e.len,e.time);G.bwEventEmit(a,n,e.len,r,o)}}),e.prev=17,I=new Uint8Array(3145728),B=0,N=0,M=-1,U=null,F=null,j=function(){var e=(0,r.x)((0,r.l5)().mark(function e(n,i,s,l,u){var c,h,f,g,v,m,_,S,T,k,x,E,L,w,A,O;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:!C.fileSize&&(C.fileSize=Number((0,y.Xz)(u.headers))),n&&(M>0?(c=I.slice(M-B,B+N),(null==n?void 0:n.byteLength)+N>I.byteLength?((h=b.Z.newUint8Array(I.byteLength+n.byteLength)).set(c,0),h.set(n,c.byteLength),I=h):(I.set(c,0),I.set(n,c.byteLength)),B=M,N=c.byteLength+n.byteLength):((null==n?void 0:n.byteLength)>(null===(f=I)||void 0===f?void 0:f.byteLength)&&(I=b.Z.newUint8Array(I.byteLength+n.byteLength)),I.set(n,0),N+=(null==n?void 0:n.byteLength)||0,B=s.range[0])),s.meta&&(v=(null==n||null===(g=n.priOptions)||void 0===g?void 0:g.type)||p._R.CDN,G.bwEventEmit(a,v,N,null,o),_=(m=s.meta).videoSegments,S=m.audioSegments,!C.fileSize&&(C.fileSize=b.Z.getEndFramePos(_,S)),M=b.Z.getFirstFrameStartRange(_,S),F=(0,r.Zj)((0,r.Zj)({},m.meta),{},{ext:{videoTrak:_,audioTrak:S}}),C.meta=F,U=b.Z.getFragRange(0,_,S),C.buffer=I.subarray(0,N),C.byteLength=C.buffer.byteLength,T=b.Z.getFragRange(1,_,S),k=[],T[0]<T[1]&&U[1]>T[0]&&(k=[T[0],U[1]]),E=(x=(null==_?void 0:_.length)>0?_:S)[0].startTime,w={startTime:E,endTime:L=x[0].endTime,range:(0,r.u)(U),repeatRange:k,duration:L-E,downloaded:!1,isLoading:!1,timeRangeIdx:[0,1]},C.adaptTimeRange=[w],G.log(d._.LOG,"".concat(a," loadMetaProcess ret"),o,I.byteLength,JSON.stringify(U),C.buffer.byteLength,JSON.stringify(k)),G.setPreLoadData(t,C),O=[A=B+N,U[1]],G.log(d._.LOG,"".concat(o," loadMetaProcess end, loadOneChunk start"),i,JSON.stringify(O),A,I.byteLength),G.loadOneChunk(C,O,R,w.duration,t));case 3:case"end":return e.stop()}},e)}));return function(t,n,r,i,a){return e.apply(this,arguments)}}(),!this.mp4Loader){e.next=28;break}return e.next=28,this.mp4Loader.loadMetaProcess(this.mp4Loader.cache,[0,O||D],j,{});case 28:e.next=34;break;case 30:e.prev=30,e.t0=e.catch(17),this._endLoadFragments(!1);case 34:case"end":return e.stop()}},e,this,[[17,30]])})),function(e,t){return l.apply(this,arguments)})},{key:"loadOneChunk",value:(E=(0,r.x)((0,r.l5)().mark(function e(t,n,i,a,o){var s,l,u,c,h,f,g,v,m,_,S;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((null==n?void 0:n.length)>0&&n[0]>=n[1])){e.next=3;break}return this._endLoadFragments(),e.abrupt("return");case 3:return(l=(null===(s=this._pcdnNodeList)||void 0===s?void 0:s.length)>0?b.Z.extUrl(this._pcdnNodeList[0].url,{__vid:t.vid}):null)&&p.Yx.pcdn_download_request_cnt++,this.log(d._.LOG,"".concat(null==t?void 0:t.cacheKey," loadOneChunk start"),JSON.stringify(n),",loadType,",!!l),u=l||i,c=t.vid,h=t.cacheKey,f=t.buffer,e.prev=8,e.next=11,null===(g=this.mp4Loader)||void 0===g?void 0:g.loadData(n,this.mp4Loader.cache,{index:0,url:u,headers:l?{"X-Origin-Server-Host":b.Z.getHostFromUrl(i)}:null,priOptions:{type:l?p._R.PCDN:p._R.CDN}});case 11:v=e.sent,this.log(d._.LOG,"".concat(c," loadOneChunk"),JSON.stringify(n),h),m=v.response,(_=v.data)?(this._endLoadFragments(),m&&m.headers&&(S=Number((0,y.Xz)(m.headers)))&&(t.fileSize=S),t.buffer=b.Z.concatData(f,_),t.byteLength=t.buffer.byteLength,t.preloadTime+=a,this.log(d._.LOG,"".concat(c," loadOneChunk ret"),h,t.buffer.byteLength,null==_?void 0:_.byteLength),t.from=4,this.setPreLoadData(o,t)):(p.Yx.pcdn_download_failed_cnt++,this._endLoadFragments(!1)),e.next=21;break;case 17:e.prev=17,e.t0=e.catch(8),this.log(d._.ERROR,"[Preloader] ".concat(c," loadByChunkSize error"),null===e.t0||void 0===e.t0?void 0:e.t0.message),this._endLoadFragments(!1);case 21:case"end":return e.stop()}},e,this,[[8,17]])})),function(e,t,n,r,i){return E.apply(this,arguments)})},{key:"loadByPreloadTime",value:(L=(0,r.x)((0,r.l5)().mark(function e(t,n){var a,o,s,l,u,c,h,f,g,m,_,y,S,T,k,x,E,L,R,w,A,O=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.vid,o=t.cacheKey,s=t.preloadTime,l=t.definition,u=t.orgDefinition,c=t.duration,h=t.bitrate,f=t.codecType,g=t.vtype,m=t.size,_=t.uri,y=t.file_id,S=this._getLoadUrl(t)){e.next=6;break}return this._endLoadFragments(!1),e.abrupt("return");case 6:return S=b.Z.extUrl(S,{__vid:a}),T=s>=this.options.segmentMinDuration?this.options.segmentMinDuration:s,k=this.getRequestOption((0,r.Zj)((0,r.Zj)({},t),{},{_url:S})),this.log(d._.DEBUG,"[Preloader] loadByPreloadTime","".concat(t.cacheKey,", definition:").concat(t.definition,",segmentMinDuration:").concat(T),k),x=m||b.Z.getFileSize(h,c),E=this.getRangeStartPos(t),L=this.createConfig(t,k,E,x,T),this.mp4=new v.Z(S,h,L,[],"[Preloader]"),R=this.getInitCacheData(i.dJ.DURATION,{vid:a,definition:l,orgDefinition:u,cacheKey:o,codecType:f,vtype:g,bitrate:h||0}),this.startPCDN(S,_,a,h,y,g.toLowerCase()||"mp4",Math.floor(c),x),null!=n&&null!==(w=n.meta)&&void 0!==w&&w.ext?(this.uddatePreCacheInfoByCache(n,R),this.updateMP4InfoByCache(n)):this.mp4.once(p.kL.META_READY,function(){var e=(0,r.x)((0,r.l5)().mark(function e(n,i){var a;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!i||i.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:return O.log(d._.DEBUG,"[Preloader] ".concat(t.vid," metaReady ").concat(null==R||null===(a=R.mediaSegList)||void 0===a?void 0:a.length)),R.meta=n,R.from=2,R.fileSize=i.size,e.next=8,i.cancelLoading();case 8:if(!i.hasDestroyed){e.next=10;break}return e.abrupt("return");case 10:return i.metaLoading=!1,e.next=13,O.setPreLoadData(t,R);case 13:if(!i.hasDestroyed){e.next=15;break}return e.abrupt("return");case 15:O.startLoadByFragments(R,t);case 16:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),this.mp4EventAdd(t.vid,R.cacheKey),e.next=20,this.mp4.init(n);case 20:if(this.mp4){e.next=22;break}return e.abrupt("return");case 22:null!=n&&null!==(A=n.meta)&&void 0!==A&&A.ext&&this.startLoadByFragments(R,t);case 23:case"end":return e.stop()}},e,this)})),function(e,t){return L.apply(this,arguments)})},{key:"bwEventEmit",value:function(e,t,n,r,i,a){var s,l,u=(null===(s=this._pendingTask.data)||void 0===s?void 0:s.duration)||0,c=(null===(l=this._pendingTask.data)||void 0===l?void 0:l.bitrate)||0;this.preloadManager.bwEventEmit({vid:e,loadType:t,size:n,speed:r,cacheKey:i,vtype:o.l0.MP4,duration:u,bitrate:c,isV2Player:a})}},{key:"startPCDN",value:function(e,t,n,r,i,a,o,s){var l=this;if(this._pcdn){if(null===(u=this.mp4)||void 0===u||u.updatePCDNState(p.oy.OPEN),!(0,_.Pj)(e)){;e=document.location.protocol+e}this.curPCDNReqId=(c=t||n,h=r,c.slice(-20)+h);var u,c,h,f={vid:t,cdn_url:e,sfid:i,file_type:a,bitrate:r,duration:Math.floor(o),size:s};this.log(d._.DEBUG,"[Preloader] ".concat(n," get peer start")),this._pcdn.fetchPCDNNode(null,f,this.curPCDNReqId).then(function(e){var t;if(null!=e&&e.req_id&&e.req_id!==l.curPCDNReqId){l.log(d._.LOG,",[Preloader] fetchPCDNNode not match reqId",l.curPCDNReqId,", pcdnRet.req_id",e.req_id);return}l.log(d._.LOG,"[Preloader] ".concat(n," get peer end,pcdn node update,"),null==e||null===(t=e.nodes)||void 0===t?void 0:t.length),l.mp4?l.mp4.updateNode(null==e?void 0:e.nodes):l._pcdnNodeList=(null==e?void 0:e.nodes)||null}).catch(function(t){var n,r,i,a=b.Z.checkUrlIsExpired(e);1===a&&l._pcdn&&(l._pcdn=void 0);var o=(null==t||null===(n=t.response)||void 0===n?void 0:n.url)||(null===(r=l.options)||void 0===r||null===(r=r.pcdnConfig)||void 0===r?void 0:r.trackerUrl);l.emit("source_error",{host:b.Z.getHostFromUrl(o),src:o,errorCode:null==t||null===(i=t.response)||void 0===i?void 0:i.status,message:"".concat(null==t?void 0:t.message,"-").concat(a,"_preload")})})}}},{key:"_getLoadUrl",value:function(e){var t="Array"===b.Z.typeOf(e.url)?e.url[0].src:e.url;return this.preloadManager.preProcessUrl&&(t=this.preloadManager.preProcessUrl(t).url),t}},{key:"mp4EventAdd",value:function(e,t){var n,r=this;this.mp4.on(p.kL.ERROR,function(t){r.log(d._.ERROR,"[Preloader] ".concat(e," load error ").concat(null==t?void 0:t.errorCode,", ").concat((null==t?void 0:t.errorMessage)||(null==t?void 0:t.message)," ")),r._endLoadFragments(!1)}),this.mp4.on(p.kL.REMOVE_PCDN_NODE,function(e){r._pcdn&&e&&r._pcdn.removePCDNNode(e.vid,e.bitrate,e.url)}),this.mp4.on(p.kL.CANCEL_LOADED_LEN,function(n){r.bwEventEmit(e,n.load_type,n.len,null,t)}),null===(n=this.mp4.MP4Loader)||void 0===n||n.on(f.kW,function(n){if((null==n?void 0:n.len)>0){var i,a=(null==n||null===(i=n.priOptions)||void 0===i?void 0:i.type)||p._R.CDN,o=(0,_.pl)(n.len,n.time);r.bwEventEmit(e,a,n.len,o,t)}})}},{key:"createConfig",value:function(e,t,n,r,i){var a=e.vid,o=e.duration,s=this.options,l=s.preloadSize,u=s.memoryOpt,c=s.supportHevc,d=s.emitMediaListControl,h=s.audioGroupingStrategy,f=s.fixEditListOffsetThreshold,g=s.fixEditListOffset,p=s.segmentMinDuration;return{segmentDuration:i||p,codecType:this.codecType,chunkSize:l,firstLoadSize:n,duration:o,fileSize:r,playerId:this.playerId,vid:a,useUrlRange:!1,retryCount:1,retryDelay:1e3,supportHevc:c,retryCheckFunc:_.Wp,switchPCDNMaxCnt:Number.MAX_VALUE,logger:this.logger,reqOptions:t,memoryOpt:u,emitMediaListControl:d,audioGroupingStrategy:h,fixEditListOffset:g,fixEditListOffsetThreshold:f,loadRangeType:this.loadRangeType}}},{key:"uddatePreCacheInfoByCache",value:function(e,t){t.meta=e.meta,t.from=5,t.fileSize=e.fileSize,t.mediaSegList=e.mediaSegList||t.mediaSegList||[],t.repeatData=e.repeatData,t.repeatDataStartPos=e.repeatDataStartPos,t.initSeg=e.initSeg,t.adaptTimeRange=e.adaptTimeRange,t.byteLength=e.byteLength}},{key:"updateMP4InfoByCache",value:function(e){var t;if(e.initSeg&&(this.mp4._needInitSegment=!1),e.adaptTimeRange&&(this.mp4.adaptTimeRange=e.adaptTimeRange),(null===(t=e.mediaSegList)||void 0===t?void 0:t.length)>0){var n=e.mediaSegList,r=n[n.length-1].muxSampleIdxRange,i=r.video,a=r.audio;this.mp4.lastDemuxSampleIdxRange.video=i,this.mp4.lastDemuxSampleIdxRange.audio=a}}},{key:"loadByChunkSize",value:(R=(0,r.x)((0,r.l5)().mark(function e(t,n){var a,o,s,l,u,c,h,f,v,_,y,S,T,x,E,L,R,w,A,O=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.vid,o=t.cacheKey,s=t.definition,l=t.orgDefinition,u=t.duration,c=t.bitrate,h=t.codecType,f=t.vtype,v=t.size,_=t.uri,y=t.file_id,this.options,S=this._getLoadUrl(t)){e.next=6;break}return this._endLoadFragments(!1),e.abrupt("return");case 6:if(S=b.Z.extUrl(S,{__vid:a}),T=v||b.Z.getFileSize(c,u),x=this.getRangeStartPos(t),E=(0,g.T)(u,k.GX,T),this.log(d._.LOG,"".concat(a," loadByChunkSize"),t.cacheKey,t.definition,x||E),L=this.getInitCacheData(i.dJ.DURATION,{vid:a,definition:s,orgDefinition:l,cacheKey:o,codecType:h,vtype:f,fileSize:v,bitrate:c||0}),R=this.getRequestOption((0,r.Zj)((0,r.Zj)({},t),{},{url:S})),this.startPCDN(S,_,a,c,y,f.toLowerCase()||"mp4",Math.floor(u),T),w=this.createConfig(t,R,x||E,T,null),this.mp4=new m.Z(S,c,w,[],"[Preloader]"),this.mp4EventAdd(t.vid,L.cacheKey),A=-1,!(null!=n&&n.meta)){e.next=26;break}return this.uddatePreCacheInfoByCache(n,L),this.updateMP4InfoByCache(n),e.next=23,this.mp4.init(n);case 23:this.startLoadBySize(L,t),e.next=29;break;case 26:this.mp4.once(p.kL.META_READY,function(){var e=(0,r.x)((0,r.l5)().mark(function e(n,i){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!i||i.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:return O.log(d._.DEBUG,"[Preloader] ".concat(t.vid," metaReady, metaReq, ").concat(A)),L.meta=n,L.from=2,L.fileSize=i.size,e.next=8,O.setPreLoadData(t,L);case 8:if(!i.hasDestroyed){e.next=10;break}return e.abrupt("return");case 10:1===A&&(A=2,O.startLoadBySize(L,t));case 11:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()),this.mp4.once(p.kL.META_REQ_DONE,function(e){if(!!e&&!e.hasDestroyed){O.log(d._.DEBUG,"[Preloader] ".concat(t.vid," metaReq done,meta: ").concat(!!e.meta));var n=e.repeatInfo,r=n.curDataPos,i=n.startPos,a=n.data;r>0&&(L.repeatData=a.subarray(0,r),L.repeatDataStartPos=i),e.meta?(A=2,O.startLoadBySize(L,t)):A=1}}),this.mp4.init(n);case 29:case"end":return e.stop()}},e,this)})),function(e,t){return R.apply(this,arguments)})},{key:"findLoadAdaptTimeRangeIdx",value:function(e){var t,n,r=this,i=e.steps,a=e.stepIdx,s=e.preloadTime,l=0,u=null===(t=this.mp4)||void 0===t?void 0:t.adaptTimeRange,c=!(null!==(n=this.options)&&void 0!==n&&n.openStepwiseType)||this.options.openStepwiseType.toUpperCase()===o.l0.MP4;if(this.stepwise&&c&&Array.isArray(i)&&i.length>0&&"number"==typeof a){var d,h=i[a];if((!u||(null==u?void 0:u.length)<(null==i?void 0:i.length))&&i.map(function(e,t,n){return e-(0===t?0:n[t-1])}).forEach(function(e){if(!Array.isArray(u)||0===u.length||u[u.length-1].endTime<i[i.length-1]){var t;null===(t=r.mp4)||void 0===t||t.updateAdaptTimeRange(null,e||s||5)}}),u)for(var f=0;f<u.length;f++)if(u[f].startTime<=h)l=f;else break;null===(d=this.mp4)||void 0===d||d.getFragRange(l)}else if(!u||(null==u?void 0:u.length)===0){var g,p,v=null===(g=this.mp4)||void 0===g?void 0:g.updateAdaptTimeRange(null,s||5);null===(p=this.mp4)||void 0===p||p.getFragRange(v),l=v}return l}},{key:"updateAdaptTimeRangeState",value:function(e,t){var n=e.mediaSegList;if(!!n&&!((null==n?void 0:n.length)<=0))n.forEach(function(e,n){var r;e.state&&(null==e||null===(r=e.buffer)||void 0===r?void 0:r.byteLength)>0&&n<(null==t?void 0:t.length)&&(t[n].downloaded=!0)})}},{key:"startLoadBySize",value:(w=(0,r.x)((0,r.l5)().mark(function e(t,n){var i,a,o,s,l,u,c,h,f,g,p,v=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.vid,a=this.mp4,o=this.findLoadAdaptTimeRangeIdx(n),!(!(s=null==a?void 0:a.adaptTimeRange)||!(null!=s&&s.length))){e.next=8;break}return this.log(d._.ERROR,"[Preloader] ".concat(i," adaptTimeRange is null")),this._endLoadFragments(!1),e.abrupt("return");case 8:if(this.updateAdaptTimeRangeState(t,s),(l=s.findIndex(function(e){return!e.downloaded}))>=0&&(o=Math.min(l,o)),u=s[o].range,this.log(d._.LOG,"[Preloader] ".concat(i,"$ startLoadBySize, loading ").concat(o),s?s[o].downloaded:"",s),!(s&&s[o].downloaded)){e.next=16;break}return this._endLoadFragments(),e.abrupt("return");case 16:if(e.prev=16,c=function(e){v.log(d._.ERROR,"[Preloader] ".concat(i," failedCallback error"),null==e?void 0:e.message),v._endLoadFragments(!1)},h=function(){var e=(0,r.x)((0,r.l5)().mark(function e(i){var a,o,l,u,f,g,m,_,y,b,S,T,k;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(null!=i&&i.mp4)||null!=i&&i.mp4.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:if(o=i.mp4,l=i.buffer,u=i.state,f=i.context,g=i.initSeg,m=i.lastRemainBufferInfo,_=o.adaptTimeRange,y=f.fragIndex,b=f.timeRange,S=null===(a=_[y])||void 0===a?void 0:a.range,!t.initSeg&&g&&(t.initSeg=g,t.adaptTimeRange=_),T=o.lastDemuxSampleIdxRange,t.repeatData=m.data,t.repeatDataStartPos=m.pos,v.log(d._.LOG,"[Preloader] ".concat(t.cacheKey," lastUnMuxData, ").concat(y,", \n            appendLastUnMuxData start: ").concat(t.repeatDataStartPos," \n            end: ").concat(t.repeatDataStartPos+t.repeatData.byteLength)),k=v.updatePreCacheData(t,l,S,u,y,b,S,T,m.pos,_[y].duration),v.log(d._.LOG,"[Preloader] ".concat(t.cacheKey," successCallback"),f.fragIndex,u,k),t.from=3,!k){e.next=27;break}return e.next=18,v.setPreLoadData(n,t);case 18:if(!(s&&y>=s.length-1||v.stepwise)){e.next=24;break}return v.log(d._.LOG,"[Preloader] ".concat(t.cacheKey," mp4.load end"),y),v._endLoadFragments(!0),e.abrupt("return");case 24:return v.appendLastUnMuxData(y+1,t),e.next=27,o.loadAllFragmentData(y+1,h,c,!1,p);case 27:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),f=t.repeatData,g=t.repeatDataStartPos,!this.checkCacheIsHasAllData(u,t)){e.next=26;break}return this.log(d._.LOG,"[Preloader] ".concat(i," startLoadBySize loadIdx:").concat(o," , cache has all data,loadIdx:").concat(o," range:").concat(u)),this.mp4._loadSuccessCallBack=h,this.mp4._mux(f.subarray(u[0]-g),u[0],o,!0),e.abrupt("return");case 26:return p=[(null==f?void 0:f.byteLength)>0&&g<=u[0]&&g+f.byteLength<u[1]?g+f.byteLength:u[0],s[o].range[1]],this.appendLastUnMuxData(o,t),e.next=31,this.mp4.loadAllFragmentData(o,h,c,!1,p);case 31:e.next=37;break;case 33:e.prev=33,e.t0=e.catch(16),this.log(d._.ERROR,"[Preloader] ".concat(t.cacheKey," mp4.load error"),o),this._endLoadFragments(!1);case 37:case"end":return e.stop()}},e,this,[[16,33]])})),function(e,t){return w.apply(this,arguments)})},{key:"checkCacheIsHasAllData",value:function(e,t){var n=t.repeatData,r=t.repeatDataStartPos;return!!((null==n?void 0:n.byteLength)>0)&&!!((null==e?void 0:e[0])>=r)&&!!((null==e?void 0:e[1])<=r+(null==n?void 0:n.byteLength))||!1}},{key:"appendLastUnMuxData",value:function(e,t){var n;(null===(n=t.repeatData)||void 0===n?void 0:n.byteLength)>0&&(this.log(d._.LOG,"[Preloader] ".concat(t.cacheKey," appendLastUnMuxData, ").concat(e,", \n            appendLastUnMuxData start: ").concat(t.repeatDataStartPos," \n            end: ").concat(t.repeatDataStartPos+t.repeatData.byteLength)),this.mp4.setLastMuxRemainBufferInfo(t.repeatData,t.repeatDataStartPos))}},{key:"startLoadByFragments",value:(A=(0,r.x)((0,r.l5)().mark(function e(t,n){var i,a,o,s,l,u,c,h=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.vid,this.log(d._.LOG,"[Preloader] ".concat(i," startLoadByFragments"),n),a=this.findLoadAdaptTimeRangeIdx(n),!(!(o=null===(c=this.mp4)||void 0===c?void 0:c.adaptTimeRange)||!(null!=o&&o.length))){e.next=8;break}return this.log(d._.ERROR,"[Preloader] ".concat(i," adaptTimeRange is null")),this._endLoadFragments(!1),e.abrupt("return");case 8:if(this.updateAdaptTimeRangeState(t,o),(s=o.findIndex(function(e){return!e.downloaded}))>=0&&(a=Math.min(s,a)),this.log(d._.LOG,"[Preloader] loading ".concat(a),o?o[a].downloaded:"",o),!(o&&o[a].downloaded)){e.next=15;break}return this._endLoadFragments(),e.abrupt("return");case 15:if(l=function(e){h.log(d._.ERROR,"[Preloader] ".concat(i," failedCallback error"),null==e?void 0:e.message),h._endLoadFragments(!1)},u=function(){var e=(0,r.x)((0,r.l5)().mark(function e(i){var a,s,c,f,g,p,v,m,_,y,b,S,T,k,x,E;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!(null!=i&&i.mp4)||null!=i&&null!==(a=i.mp4)&&void 0!==a&&a.hasDestroyed)){e.next=2;break}return e.abrupt("return");case 2:if(f=i.mp4,g=i.buffer,p=i.context,v=i.state,m=i.initSeg,_=p.fragIndex,y=p.range,b=p.timeRange,S=f.repeatInfo,k=null===(s=(T=f.adaptTimeRange)[_])||void 0===s?void 0:s.range,!t.initSeg&&m&&(t.initSeg=m,t.adaptTimeRange=T),x=f.lastDemuxSampleIdxRange,t.repeatData=(null===(c=S.data)||void 0===c?void 0:c.slice(0,S.curDataPos))||[],E=h.updatePreCacheData(t,g,y,v,_,b,k,x,-1,T[_].duration),h.log(d._.LOG,"[Preloader] ".concat(t.cacheKey," successCallback"),_,v,E),t.from=3,!E){e.next=25;break}return e.next=16,h.setPreLoadData(n,t);case 16:if(!(o&&_>=o.length-1||h.stepwise)){e.next=22;break}return h.log(d._.LOG,"[Preloader] ".concat(t.cacheKey," mp4.load end"),_),h._endLoadFragments(!0),e.abrupt("return");case 22:return h.log(d._.LOG,"[Preloader] ".concat(t.cacheKey," mp4.load start"),_+1),e.next=25,f.loadAllFragmentData(_+1,u,l);case 25:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),!this.mp4){e.next=20;break}return e.next=20,this.mp4.loadAllFragmentData(a,u,l);case 20:case"end":return e.stop()}},e,this)})),function(e,t){return A.apply(this,arguments)})},{key:"_endLoadFragments",value:function(e){this.log(d._.LOG,"[Preloader] _endLoadFragments ".concat(this.playerId)),null!==(t=this._pendingTask)&&void 0!==t&&t.resolve&&(null===(i=this._pendingTask)||void 0===i||i.resolve(),this._pendingTask.resolve=void 0);var t,n,r,i,a=!(null!==(n=this.options)&&void 0!==n&&n.openStepwiseType)||this.options.openStepwiseType.toUpperCase()===o.l0.MP4;null!==(r=this._pendingTask)&&void 0!==r&&r.data&&(this.stepwise&&(!1===e||!a)&&this._pendingTask.data.payload&&(this._pendingTask.data.payload.stepIdx=1/0),this._pendingTask.data=void 0),this.mp4&&(this.mp4.destroy(),this.mp4.cancelLoading(),this.mp4=void 0),this.mp4Loader&&(this.mp4Loader.cancel(),this.mp4Loader.destroy(),this.mp4Loader=void 0)}},{key:"hasItemSameVid",value:function(e){if(!e)return null;for(var t=e.split("#"),n=this.allCachedKeys,r=0;r<n.length;r++){var i=n[r];if(i===e)return i;var a=i.split("#");if(a.length>=4&&t.length>=4&&a[0]===t[0]){if(0===a[2].indexOf("pretime")&&0===t[2].indexOf("pretime"))return i;var o=[parseInt(a[2]),parseInt(a[3])],s=[parseInt(t[2]),parseInt(t[3])];if(s[0]>=o[0]&&s[1]>s[0]&&s[1]<=o[1])return i}}return null}},{key:"getItemSameVid",value:(O=(0,r.x)((0,r.l5)().mark(function e(t){var n,i,a;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i=(n=D.generateUniqueKey(t))&&this.hasItemSameVid(n),this.log(d._.DEBUG,"getItemSameVid: key:".concat(n," checkResult:").concat(i)),i){e.next=5;break}return e.abrupt("return",{});case 5:return e.next=7,this.preloadManager.getItem(t);case 7:return a=e.sent,e.abrupt("return",{value:a,key:i});case 9:case"end":return e.stop()}},e,this)})),function(e){return O.apply(this,arguments)})},{key:"setItem",value:function(e,t){return this.preloadManager.setItem(e,t,!1)}},{key:"clearPreloaderList",value:function(){(0,r.Vx)(D,"clearPreloaderList",this,3)([])}},{key:"setUserSelectDefinition",value:function(e){this.preloadManager&&this.preloadManager.setUserSelectDefinition(e)}},{key:"getUserSelectDefinition",value:function(){return this.preloadManager.getUserSelectDefinition()}},{key:"cancel",value:function(){this.log(d._.LOG,"cancelLoading"),this._endLoadFragments()}},{key:"destroy",value:function(){this.cancel()}},{key:"on",value:function(e,t){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];(0,r.Vx)(D,"on",this,3)([e,t].concat(i))}},{key:"off",value:function(e,t){for(var n=arguments.length,i=Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];(0,r.Vx)(D,"off",this,3)([e,t].concat(i))}}],[{key:"vtype",get:function(){return o.l0.MP4}},{key:"PRELOAD_TYPES",get:function(){return i.dJ}},{key:"getDefaultConfig",value:function(){return(0,k._K)()}},{key:"getInfoByUniqueKey",value:function(e){var t=e.split("#"),n=["vid","mediaType","codecType","vtype","definition"],r={};return t.forEach(function(e,t){r[n[t]]=e}),r}},{key:"generateUniqueKey",value:function(e){var t=e.vid,n=e.mediaType,r=e.definition,i=e.codecType,a=e.vtype,s=e.bitrate;return(n=n||"video",r=r||"-1",i=i||o.u7.H264,a=a||o.l0.MP4,s=s||0,t)?"".concat(t,"#").concat(n,"#").concat(i,"#").concat(a,"#").concat(r,"#").concat(s):null}}])}(a.d)},603384:function(e,t,n){n.d(t,{Z:function(){return s}});var r=n(452006);n(836654),n(465132),n(499045),n(464135),n(499953),n(721911),n(110617);var i=n(336397),a=n(298028),o=n(446215),s=function(e){function t(e,n,i,o,s){var l;return(0,r.PA)(this,t),(l=(0,r.$w)(this,t,[e,n,i,o,s])).logTag="".concat(s,"_").concat(a.TJ.SIZE)||"",l.fillGopDataInfo=null,l}return(0,r.XW)(t,e),(0,r.qH)(t,[{key:"updateAdaptTimeRange",value:function(e,t){this.lastTargetDur=t,!this.adaptTimeRange&&(this.adaptTimeRange=[]);var n=this.adaptTimeRange,r=this.timeRange;if(null!==e&&e>=0){var a=this.getAdaptIdxBySrcIdx(e,!0);if(null!==a&&a>=0)return this.log(i._.LOG," adaptTimeRange find range of timeRange,timeRangeIdx,",e,JSON.stringify(r[e])," ,addaptIdx,",a,JSON.stringify(n[a])),a}this.fillAdadptTimeRange(e,t);var o=this.createAdaptTimeRange(t);return o&&(n.push(o),this.log(i._.LOG,"update adaptTimeRange,startIdx",this.adaptTimeRange.length-1,JSON.stringify(o))),this.adaptTimeRange.length-1}},{key:"fillAdadptTimeRange",value:function(e,t){var n=this.adaptTimeRange,r=this.timeRange;if(null!==e&&e>=0){!(null!==(l=r[e])&&void 0!==l&&l.range)&&(r[e].range=this.calculateRange(e),this.log(i._.LOG,"adaptTimeRange update timeRange.range ,fragmentIdx",e,JSON.stringify(r[e])));for(var a=null===(u=n[n.length-1])||void 0===u?void 0:u.range,o=(null==a?void 0:a[1])||0;o<(null===(c=r[e])||void 0===c?void 0:c.range[0]);){var s=this.createAdaptTimeRange(t);if(s){if((null==s?void 0:s.range[1])>=(null===(d=r[e])||void 0===d?void 0:d.range[0])){this.log(i._.LOG,"gap adaptTimeRange ignore,adaptTimeRangeIdx",JSON.stringify(s));break}n.push(s);var l,u,c,d,h=n.length;n[h-1].isLoading=!0,n[h-1].downloaded=!0,o=n[n.length-1].range[1],this.log(i._.LOG,"gap adaptTimeRange,adaptTimeRangeIdx",this.adaptTimeRange.length-1,JSON.stringify(s))}}}}},{key:"calculateSize",value:function(e,t){var n,r,i,a,o=this.adaptTimeRange,s=this.timeRange,l=this.videoTrak,u=this.audioTrak;!(null!==(v=s[0])&&void 0!==v&&v.range)&&(s[0].range=this.calculateRange(0));var c=(null==o?void 0:o.length)||0,d=c>0&&o[c-1].range?o[c-1].range[1]:s[0].range[0],h=null;l&&l.length>0&&(h=this.getEndFrame("video",e));var f=null===(m=h)||void 0===m?void 0:m.endFrame,g=null;u&&u.length>0&&(g=this.getEndFrame("audio",e));var p=null===(_=g)||void 0===_?void 0:_.endFrame;if(f&&p){var v,m,_,y,b,S,T=f.offset+f.size,k=p.offset+p.size;T>k?(y=this.getFrameByPos("audio",null===(b=g)||void 0===b?void 0:b.newSegmentIdx,p.index,T))&&(p=y):(y=this.getFrameByPos("video",null===(S=h)||void 0===S?void 0:S.newSegmentIdx,f.index,k))&&(f=y)}if(f&&p)return{endAudioFrame:p,endVideoFrame:f,segmentIdx:Math.min(null===(n=h)||void 0===n?void 0:n.newSegmentIdx,null===(r=g)||void 0===r?void 0:r.newSegmentIdx),size:Math.max(f.offset+f.size,p.offset+p.size)-d};if(f)return{segmentIdx:null===(i=h)||void 0===i?void 0:i.newSegmentIdx,size:f.offset+f.size-d,endVideoFrame:f};if(p)return{segmentIdx:null===(a=g)||void 0===a?void 0:a.newSegmentIdx,endAudioFrame:p,size:p.offset+p.size-d}}},{key:"getFrameByPos",value:function(e,t,n,r){var i="video"===e?this.videoTrak:this.audioTrak;if(!(null!=i&&i.length))return null;for(var a=!1,o=n+1,s=t;s<i.length;s++){for(var l,u,c,d,h,f=(null===(h=l=(null===(d=i[s])||void 0===d?void 0:d.frames)||[])||void 0===h||null===(h=h[0])||void 0===h?void 0:h.index)||0;o<=l[l.length-1].index;o++)if((u=l[o-f]).offset+u.size<=r)c=u;else{a=!0;break}if(a)break}return c}},{key:"getEndFrame",value:function(e,t){if("video"===e?(o=this.videoTrak,s=t*this.meta.videoTimescale):(o=this.audioTrak,s=t*this.meta.audioTimescale),!(null!==(n=o)&&void 0!==n&&n.length))return null;for(var n,r,a,o,s,l=this.adaptTimeRange,u=null,c=-1,d=(null==l?void 0:l.length)>0?l[l.length-1]:null,h=(null===(r="video"===e?null==d?void 0:d.endVideoFrame:null==d?void 0:d.endAudioFrame)||void 0===r?void 0:r.index)||0,f=(null==d?void 0:d.segmentIdx)||0,g=Math.round(s/o[0].frames[0].duration),p=f;p<o.length;p++){var v=o[p].frames;if((null==v?void 0:v.length)>0&&(v[v.length-1].index-h>=g||p===o.length-1)){var m=o[o.length-1].frames,_=Math.min(m[m.length-1].index,h+g)-v[0].index;u=v[_],c=c<0?p:Math.min(c,p);break}}return this.log(i._.LOG,"calculateSize, type: ".concat(e,", frameNum: ").concat(g,", idx: ").concat(h,"-").concat(null===(a=u)||void 0===a?void 0:a.index)),{newSegmentIdx:c,endFrame:u}}},{key:"createAdaptTimeRange",value:function(e,t){var n,r,a,o=this.calculateSize(e,t),s=o.size-1;if(this.log(i._.LOG,"createAdaptTimeRange, mergeDuration: ".concat(e,", adaptIdx:").concat(t,", loadSize:").concat(s)),0===s)return null;var l=this.adaptTimeRange,u=!t||t<=0?l.length-1:t-1,c=u>=0?l[u]:null,d=(null==c||null===(n=c.range)||void 0===n?void 0:n[1])+1||this.timeRange[0].range[0];if(d>=this.fileSize)return null;var h=Math.min(d+s-1,this.fileSize-1),f=(null==c?void 0:c.endTime)||this.timeRange[0].startTime,g=Math.min(null!=o&&null!==(r=o.endVideoFrame)&&void 0!==r&&r.pts?o.endVideoFrame.pts/this.meta.videoTimescale:Number.MAX_VALUE,null!=o&&null!==(a=o.endAudioFrame)&&void 0!==a&&a.pts?o.endAudioFrame.pts/this.meta.audioTimescale:Number.MAX_VALUE),p=o.endAudioFrame,v=o.endVideoFrame;return{startTime:f,endTime:g,range:[d,h],duration:e,downloaded:!1,isLoading:!1,endAudioFrame:p,endVideoFrame:v,segmentIdx:o.segmentIdx}}},{key:"getCurLoadSize",value:function(e){return(!e||e<=0)&&(e=5),Math.ceil(e*Math.floor(this._bitRate/8||this.fileSize/this.meta.duration))}},{key:"getFragRange",value:function(e){var t,n=this.adaptTimeRange;if(e<n.length&&null!==(t=n[e])&&void 0!==t&&t.range)return this.log(i._.LOG,"getFragRange exist",e,JSON.stringify(n[e].range)),n[e].range;var r=this.updateAdaptTimeRange(null,n[e].duration);return this.adaptTimeRange[r].range}},{key:"getSamplesRange",value:function(e,t){var n=[0,0],r="video"===t?this.videoTrak:this.audioTrak;if(!!(null!=r&&r.length)){var i=this.lastDemuxSampleIdxRange[t],a=this.adaptTimeRange[e],o=("video"===t?a.endVideoFrame:a.endAudioFrame).index;return n[0]=i+1,n[1]=o,n}}},{key:"getAdaptIdxBySrcIdx",value:function(e,t){var n=this.adaptTimeRange,r=this.timeRange;if(!(null!=n&&n.length)||!(null!=r&&r.length))return -1;var a=n.length;if(t)return this.getAdaptIdx(e);var o=this.getAdaptIdx(e);if(o>=0)return this.log(i._.LOG,",getAdaptIdxBySrcIdx, fragIndex, ",e,",adaptIdx,",o),o;if(n[a-1].range[1]<this.fileSize-1)for(;(null===(s=r[e].range)||void 0===s?void 0:s[1])>=(null===(l=n[n.length-1].range)||void 0===l?void 0:l[1]);){this.updateAdaptTimeRange(e,this.lastTargetDur||5);var s,l,u=this.getAdaptIdx(e);if(u>0)return this.log(i._.LOG,"new make, getAdaptIdxBySrcIdx, fragIndex: ",e,",adaptIdx: ",o),u}return this.adaptTimeRange.length-1}},{key:"getAdaptIdx",value:function(e){var t,n=this.adaptTimeRange,r=this.timeRange,a=null===(t=r[e])||void 0===t?void 0:t.range;!a&&(a=o.Z.getFragRange(e,this.videoTrak,this.audioTrak),r[e].range=a,this.log(i._.LOG,",updateTimeRange.range, fragIndex: ",e,JSON.stringify(r[e])));var s=n.findIndex(function(e){var t,n;return(null==e?void 0:e.range[0])<=(null===(t=a)||void 0===t?void 0:t[0])&&(null==e?void 0:e.range[1])>=(null===(n=a)||void 0===n?void 0:n[0])});return this.log(i._.LOG,",getAdaptIdx, srcIdx: ",e,JSON.stringify(r[e]),", adaptIdx: ",JSON.stringify(n[s])),s}},{key:"resetFragmentLoadState",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.log(i._.LOG,", resetFragmentLoadState, fragIndex: ",e,",changeBitrate: ",n),n){var r=this.adaptTimeRange.length;this.adaptTimeRange.splice(e+1,r-e-1),t=this.adaptTimeRange.map(function(e){return e.duration}),this.adaptTimeRange=[]}else t=this.adaptTimeRange;for(var a=this.adaptTimeRange,o=0;o<t.length;o++)if(a[o]&&(o<e?(a[o].downloaded=!0,a[o].isLoading=!0):(a[o].downloaded=!1,a[o].isLoading=!1)),n){var s=this.createAdaptTimeRange(t[o],o);s&&(o<e&&(s.downloaded=!0,s.isLoading=!0),this.adaptTimeRange.push(s))}}},{key:"getSubRange",value:function(e,t,n){var r,a,o=this.adaptTimeRange,s=this.timeRange,l=null===(r=o[e])||void 0===r?void 0:r.range,u=this.getFragmentIdx(t);!(null!==(a=s[u])&&void 0!==a&&a.range)&&(s[u].range=this.calculateRange(u));var c=[s[u].range[0],l[1]];return this.log(i._.LOG,">>>>>getSubRange finalRange ",JSON.stringify(c),",oldRange,",JSON.stringify(n),",adaptIdx,",e,",srcFragIndex,",u,JSON.stringify(s[u])),c}},{key:"calculateRange",value:function(e){return o.Z.getFragRange(e,this.videoTrak,this.audioTrak)}},{key:"fillGopData",value:function(e){var t=-1,n=-1,r=-1;if(this.videoTrak.length){var a=this.getEndFrameByTime("video",e);t=(null==a?void 0:a.index)||-1,r=a.offset+a.size;var o=this.getEndFrameByTime("audio",e);n=(null==o?void 0:o.index)||-1,r=Math.max(r,o.offset+o.size)}else{var s=this.getEndFrameByTime("audio",e);n=(null==s?void 0:s.index)||-1,r=s.offset+s.size}this.fillGopDataInfo={endVFrameIdx:t,endAFrameIdx:n,endRange:r},this.log(i._.LOG,"fillGopDataInfo: ".concat(t,", ").concat(n,", ").concat(r))}},{key:"getEndFrameByTime",value:function(e,t){var n="video"===e?this.videoTrak:this.audioTrak;if(n){var r=n.find(function(e){return e.startTime<=t&&e.endTime>t});if(r)return r.frames[r.frames.length-1]}}}])}(n(235879).Yx)},663153:function(e,t,n){n.d(t,{UV:function(){return l},ZP:function(){return c},_c:function(){return s}});var r,i=n(35345);n(836654),n(511141),n(464135),n(891555),n(981168),n(469577),n(206642),n(721911),n(777180),n(98601),n(110617),n(914613),n(769308),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680),n(271692),n(296702),n(828514),n(187562),n(166613),n(801402),n(862956),n(703327),n(573545),n(170399),n(544805),n(463724),n(279651),n(742611),n(874386);var a=n(262416),o=n(67743);var s=((r=s||{}).ABR_CHANGE="ABR_CHANGE_A",r.ABR_UPDATE_SPEC="ABR_UPDATE_SPEC",r.START_ABR="START_ABR",r.UPDATE_AUTO_DESC="UPDATE_AUTO_DESC",r.ABR_START_PROGRESS="ABR_START_PROGRESS",r.MAX_BUFFER_CHANGE="MAX_BUFFER_CHANGE",r.NEXT_SEGMENT_PREDICT="NEXT_SEGMENT_PREDICT",r.ABR_STAT="ABR_STAT",r.ABR_DEFINITION_REAL_CHANGE="ABR_DEFINITION_REAL_CHANGE",r.ABR_LIMIT_BITRATE="ABR_LIMIT_BITRATE",r),l="__auto__",u={PLAYBACK_BITRATE:"avg_play_bitrate",DOWNLOAD_BITRATE:"avg_download_bitrate",DOWNLOAD_NETWORK_SPEED:"avg_download_speed",PREDICT_NETWORK_SPEED:"avg_predict_speed",BUFFER_LENGTH:"avg_buffer_length",QOE:"avg_qoe"},c=function(e){function t(e,n,r,o,s){var l,c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{logger:function(){},openLog:!1};(0,i.PA)(this,t),(l=(0,i.$w)(this,t,[n,r,o,s,c]))._bufferRange=new Map,l._sortedBufferRange=[],l._lastCheckResolutionStamp=0,l._currentDefinition=null,l._isSeeking=!1,l._waitingStartTime=0,l._stallCount=0,l._seekState=0,l._stallState=0,l._videoCurrentTime=0,l._hasStart=!1,l._isPaused=!1,l._hasAddFragment=!1,l._eventInfo={local_time_ms:0,internet_speed:0,buffer_length:0,last_bitrate:0,now_bitrate:0,play_speed:1},l._bitrateSet=[],l._generalInfo={},l._currentInAbr=!1,l._hasCalcTimelineLog=!1,l._abr_play_info={start_play_time_ms:0,is_hint:0,playback_info:{internet_speed_record:[],play_bitrate_record:[],buffer_length_record:[],play_speed_record:[],qoe_record:[],qoe_a_record:[],qoe_b_record:[],qoe_c_record:[]}},l._tickCount=0,l._fps=30,l.startTime=performance.now(),l._prevDefinitionItem=null,l._currentItem=null,l._switchCount=0,l._switchBitrate=0,l._avgStatItems={},l._qoeArgs=[0,0,0,0],l._abrUsed=-1,l._abrAlwaysOn=1,l._preloadInfo=null,l._hasLogStartInfo=!1,l._hasExecuteAbrAlgo=!1,l._lastExecuteTimeInMs=0,l._isSegmentDrive=!1,l._prevCurrentTime=-1,l._abrChangeTimeMap={},l._underFlowDecodeCount=0,l._onSegmentPredict=function(e){if(!!l.isCurrentInAbr){if(l._isSegmentDrive){var t=Math.floor(l.player.downloadSpeed);!e.isInitSegment&&"video"===e.mediaType&&l._loopAbr(t,e.start,e.fix?e.end:0,e)}}},l._onPlay=function(){l._hasStart=!0,l.logger("onplay")},l._onSeeking=function(){var e,t;l._isSeeking=!0,l.player.currentTime<l._videoCurrentTime?l._seekState=-1:l._seekState=1,null===(e=l.module)||void 0===e||null===(t=e._updateSeekInfo)||void 0===t||t.call(e,l._seekState),l.logger("seekState",l._seekState)},l._onSeekEnd=function(){l._isSeeking=!1,l.checkRestart()},l._onWaiting=function(){if(!l._isSeeking&&!(l._waitingStartTime>0)){for(var e=l.player.video.buffered,t=l.player.currentTime,n=!0,r=0;r<e.length;r++){var i=e.start(r),a=e.end(r);if(i<=t&&t<a-(l.autoBitrateOpts.decodeUnderflowBuffer||1)&&l.player.readyState<HTMLVideoElement.HAVE_ENOUGH_DATA){l._underFlowDecodeCount++,n=!1;break}}var o=l._underFlowDecodeCount>=(l.autoBitrateOpts.decodeUnderflowCount||1),s=l._defaultMaxBitrate>0||l._underflowBitrate>0,u=1===l.autoBitrateOpts.decodeUnderflowMode&&l._isSegmentDrive;if(o&&(s||u)){var c=!0;if(u){var d=l._maxBitrate;l._maxBitrate=l._minBitrate,c=l._maxBitrate!==d}l.player.emit("ABR_LIMIT_BITRATE",{removed:c}),l._underflowBitrate>0&&(l._maxBitrate=l._underflowBitrate)}l._waitingStartTime=new Date().getTime(),l._stallId=setTimeout(function(){var e,t;clearTimeout(l._stallId),l._stallCount++,l._stallState=1,null===(e=l.module)||void 0===e||null===(t=e.updateWaitingState)||void 0===t||t.call(e,n)},200)}},l._onPlaying=function(){l._waitingStartTime=0,l._stallState=0,clearTimeout(l._stallId),l.checkRestart()},l._onTimeUpdate=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!l._sortedBufferRange||0===l._sortedBufferRange.length||!l._currentInAbr||!l.player)return;l._videoCurrentTime=l.player.currentTime;var n=Date.now();if(!(n-l._lastCheckResolutionStamp<1e3)||0===l._lastCheckResolutionStamp||!!t){l._lastCheckResolutionStamp=n;for(var r=l.player.currentTime,i=0,a=l._sortedBufferRange.length-1,o=null;i<=a;){var s=Math.floor(i+(a-i)/2),u=l._sortedBufferRange[s];if(r<u.start)a=s-1;else if(r>=u.end)i=s+1;else{o=u;break}}if(o){var c,d=null===(c=l._bitrateToDefinitionConfig)||void 0===c?void 0:c.get(o.bandwidth),h=null==d?void 0:d.definition;if(l._currentDefinition===h&&!t||!h){!h&&l.logger("error definition, mpd");return}l._currentDefinition=h,l._prevDefinitionItem=l._currentItem,l._currentFps=d.fps,l._currentItem=d,l._emitAutoDescChange(h,!1,l._currentFps,d),l._prevDefinitionItem&&l._currentDefinition&&l._prevDefinitionItem.definition!==l._currentDefinition.definition&&l._emitDefinitionRealChange(o)}}},l._onCanPlay=function(){if(!!l._currentInAbr&&!!l._currentDefinition)l._updateId=setTimeout(function(){clearTimeout(l._updateId),l._emitAutoDescChange(l._currentDefinition,!1,l._currentFps,l._currentItem)},0)},l._onBufferRangeUpdate=function(e){if(void 0!==e.start){null===l._currentItem&&l._onTimeUpdate(null,!0);var t=e.start;l._hasAddFragment=!0,l._bufferRange.set(t,e);var n=(0,i.u)(l._bufferRange.values());l._sortedBufferRange=n.sort(function(e,t){return e.start-t.start}),l.avgStat(u.DOWNLOAD_BITRATE,e.bandwidth)}},l._onReplay=function(){l.checkRestart()},l._onEnded=function(){l.stop()},l._onError=function(){l.stop()},l.start=function(){if(l.logger("start"),l._isPaused=!1,!l._hasCalcTimelineLog){var e=1===Math.floor(100*Math.random());l._abr_play_info.is_hint=e?1:0}l._hasCalcTimelineLog=!0,l._loop()},l.stop=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];!0===e&&(l._abrAlwaysOn=-1),clearTimeout(l.timerId),l._isPaused=!0,l.logger("stop")},l.logger("constructor",n,r,o,s,l.bitrate),l.player=e,l.isOpenAutoDefi=!!l.autoBitrateOpts.isOpenAutoDefi,l._isSegmentDrive=1===l.autoBitrateOpts.abrDriveMode,l.onPlayRateChange=l._onPlayrateChange.bind(l),l._onWinSizeChange=(0,a.Ds)(l.onWinElemSizeChange.bind(l),1e3,!1),l._maxDefinition=l.autoBitrateOpts.maxDefinition||null,l._maxBitrate=-1,l.listeners=[{evt:"MAX_BUFFER_CHANGE",handler:l._onMaxBufferChange.bind(l)},{evt:"playbackrateChange",handler:l.onPlayRateChange},{evt:"replay",handler:l._onReplay},{evt:"ended",handler:l._onEnded},{evt:"error",handler:l._onError},{evt:"timeupdate",handler:l._onTimeUpdate},{evt:"addVideoBufferEnd",handler:l._onBufferRangeUpdate},{evt:"canplay",handler:l._onCanPlay},{evt:"play",handler:l._onPlay},{evt:"seeking",handler:l._onSeeking},{evt:"seeked",handler:l._onSeekEnd},{evt:"waiting",handler:l._onWaiting},{evt:"playing",handler:l._onPlaying},{evt:"video_resize",handler:l._onWinSizeChange},{evt:"NEXT_SEGMENT_PREDICT",handler:l._onSegmentPredict}],l.listeners.forEach(function(e){var t=e.evt,n=e.handler;l.player.on(t,n)}),l._abrMethod=l.autoBitrateOpts.method||0,l._loopInterval=l.initInterval,a.E8.install(),l._maxCacheTimeVideo=l.config.preloadTime||5,l._maxCacheTimeAudio=l._maxCacheTimeVideo;for(var h=Object.keys(u),f=0;f<h.length;f++){var g=u[h[f]];l._avgStatItems[g]=new d}return l}return(0,i.XW)(t,e),(0,i.qH)(t,[{key:"init",value:function(e){return this._mediaList=e,this.isOpenAutoDefi?this._onLoadWasm():this._wasmPromise.resolve(),this._wasmPromise}},{key:"execute",value:function(){return this.listenSize(),this.initFps(),this.onWinElemSizeChange(),this._execDecision()}},{key:"initFps",value:function(){this.fpsDetection=new a.E8,this.fpsDetection.start(),this._fps=this.fpsDetection.fps,this._hasDeviceInfoChanged=!0}},{key:"listenSize",value:function(){window.removeEventListener("resize",this._onWinSizeChange),window.addEventListener("resize",this._onWinSizeChange)}},{key:"onWinElemSizeChange",value:function(){var e,t,n=(null===(e=this.player)||void 0===e?void 0:e.media)||(null===(t=this.player)||void 0===t?void 0:t.video);if(n){var r=n.getBoundingClientRect();this._videoWidth=Math.floor(r.width),this._videoHeight=Math.floor(r.height),this._hasDeviceInfoChanged=!0}}},{key:"execTimeUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._onTimeUpdate(null,e)}},{key:"_onMaxBufferChange",value:function(e){var t=e.videoCacheTime,n=e.audioCacheTime;this._maxCacheTimeAudio=n,this._maxCacheTimeVideo=t}},{key:"_emitAutoDescChange",value:function(e,t,n,r){var i;this.logger("[ABR],emitAutoDescChange, definition, ",e,",item,",r,",pre_item,",this._prevDefinitionItem),null===(i=this.player)||void 0===i||i.emit("UPDATE_AUTO_DESC",{definition:e,reset:t,fps:n,item:r,pre_item:this._prevDefinitionItem})}},{key:"_emitDefinitionRealChange",value:function(e){var t,n=0,r=e.start;this._abrChangeTimeMap[r]&&(this._abrChangeTimeMap[r]=0,delete this._abrChangeTimeMap[r],n=1),null===(t=this.player)||void 0===t||t.emit("ABR_DEFINITION_REAL_CHANGE",{orgDefinition:this._prevDefinitionItem.definition,orgBitrate:this._prevDefinitionItem.bitrate||this._prevDefinitionItem.bandwidth,currentDefinition:this._currentItem.definition,currentBitrate:this._currentItem.bitrate||this._currentItem.bandwidth,abrChange:n})}},{key:"_onPlayrateChange",value:function(){this.module&&this.updateBufferInfo()}},{key:"_execDecision",value:function(){if(!this.isOpenAutoDefi)return 0;var e=0;try{this.logger("exec decision"),this.updateSwitchInfo(),this.transformMediaInfo(),this.updateDeviceInfo();var t=!!this.autoBitrateOpts.isPlayAutoDefi;if(this.isOpenAutoDefi&&t){this._abrUsed=1;var n=this._getDefaultSpeed(this.player);!this._isSegmentDrive&&(e=this._loopAbr(n)),this.start(),this._changeLoopInterval(),this.logger("time start progress",new Date().getTime()),this.logger("time costTime",performance.now()-this.startTime)}}catch(e){this.logger("decision error",e),this.logger("time costTime err",performance.now()-this.startTime)}return e}},{key:"_changeLoopInterval",value:function(){var e=this;this.startTimer&&(clearTimeout(this.startTimer),this.startTimer=null),this.startTimer=setTimeout(function(){e._loopInterval=e.interval,e.startTimer&&clearTimeout(e.startTimer),e.logger("interval change")},5e3)}},{key:"_loop",value:function(){var e=this;if(!this._isPaused&&!this._isSegmentDrive)clearTimeout(this.timerId),this.timerId=setTimeout(function(){var t,n=e.player,r=e.config;if(e._hasStart&&null!==(t=r.autoBitrateOpts)&&void 0!==t&&t.stillRunWhenPaused||!n.paused||!n.config.autoplay&&!e._hasStart){var i=e._hasAddFragment?void 0:e._getDefaultSpeed(n);e._loopAbr(i)}e._loop()},this._loopInterval)}},{key:"checkRestart",value:function(){var e;null!==(e=this.config.autoBitrateOpts)&&void 0!==e&&e.autoRestartAbr&&this._currentInAbr&&this._isPaused&&this.start()}},{key:"updateDeviceInfo",value:function(){try{if(this.fpsDetection){var e=this.fpsDetection.fps;e!==this._fps&&(this._fps=e,this._hasDeviceInfoChanged=!0)}this._updateDeviceInfo(this._fps)}catch(e){}}},{key:"updateBufferInfo",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this.player.playbackRate,o=this.bufferLength;i>0&&this.player&&(o=i-this.player.video.currentTime);var s=e||Math.floor(this.player.downloadSpeed);this._tickCount<5&&0===s&&(s=this._getDefaultSpeed(this.player),this.logger("initSpeed fix"));var l=-1===this._maxBitrate?this._defaultMaxBitrate:this._maxBitrate;return this.logger("downloadSpeed:",s,"buffer:",o,"maxCacheTimeAudio:",this._maxCacheTimeAudio,"maxCacheVideoTime",this._maxCacheTimeVideo,"seekState",this._seekState,"stallState",this._stallState,"segmentBufferStart",r,"segmentBufferEnd",i),null===(t=this.module)||void 0===t||t._updateBufferInfo(a,this._maxCacheTimeAudio,this._maxCacheTimeVideo,o,this._isSegmentDrive?i:o,s,this._seekState,null===(n=this.player)||void 0===n?void 0:n.currentTime,this._stallState,l),this._seekState=0,this._eventInfo={internet_speed:s,buffer_length:o,last_bitrate:this.bitrate,play_speed:a},this.logger("playRate:",a,"buff:",o,"downloadSpeed:",s),{buffer:o,downloadSpeed:s}}},{key:"updateSwitchInfo",value:function(){var e,t,n=new Date().getTime();this._openTimeMs=n,this._abr_play_info.start_play_time_ms=n;var r=(null===(e=this.player)||void 0===e?void 0:e.config.preloadTime)||50,i=(0,o.C)(n),a=this.autoBitrateOpts.noStallCheckTime||5,s=this.openLog;this.logger("openTime:",n,"this.logger",s),null===(t=this.module)||void 0===t||t._updateSwitchInfo(i.low,i.high,a,s,this.stall_penalty,this.switch_penalty);var l=this._mediaList.video,u=l.map(function(e){var t=e.bandwidth,n=e.bitrate;return t||n});this._bitrateSet=u.map(function(e,t){return{bitrate:e,codecs:l[t].codecs||l[t].codec_type||""}}),this._generalInfo={max_cache_time:r,bitrate_set:this._bitrateSet,segment_duration:this.segment_duration,preload_info:{},startup_info:{}}}},{key:"updatePreloadCacheInfo",value:function(e){try{this._preloadInfo=e,this.logger("update preloadInfo",e),e&&e.item_num!==e.items.length&&(this.logger("preloadInfo invalid"),this._preloadInfo=null)}catch(e){this.logger("updatePreloadCacheInfo",e),this._preloadInfo=null}}},{key:"updatePreloadLogInfo",value:function(e){this._generalInfo.preload_info=e||{}}},{key:"_loopAbr",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._tickCount++;var a=-1,o=[];if(!this.module||!this.player)return this.bitrate;try{var s=new Date().getTime(),l=this.player;this.updateDeviceInfo();var u=this.updateBufferInfo(e,t,n),c=u.downloadSpeed,d=u.buffer;if(this.module.updateDropFrame&&l.video.getVideoPlaybackQuality){var h,f,g=l.video.getVideoPlaybackQuality(),p=g.droppedVideoFrames,v=g.totalVideoFrames;null===(f=this.module)||void 0===f||f.updateDropFrame(p/v)}a=this.module._getPredictedBitrate(this.bitrate,this._abrMethod);for(var m=0;m<7;m++)o.push(this.module.HEAP32[a/Int32Array.BYTES_PER_ELEMENT+m]);var _=o[0],y=1===o[1];this._eventInfo.now_bitrate=_,this._eventInfo.local_time_ms=new Date().getTime();var b=0;if(_!==this.bitrate&&0!==_||this.autoBitrateOpts.reportVerboseAbrLog){var S=this.player.currentTime;if(this.module.getStat){var T=this.module.getStat();l.emit("ABR_STAT",(0,i.Zj)((0,i.Zj)({v_time:S,diff_current_position:-1===this._prevCurrentTime?0:S-this._prevCurrentTime,net_speed:8*c,costTime:new Date().getTime()-s,download_time:null==r?void 0:r.costTime},T),{},{gop_size:null==r?void 0:r.gopSize,audio_buffer:null==r?void 0:r.audioBuffer})),this._abrChangeTimeMap[T.download_position]=1}this._prevCurrentTime=S}if(_!==this.bitrate&&0!==_){var k=this.bitrate;b=Math.abs(k-_);for(var x=[],E=(l.media||l.video).buffered,L=0;L<E.length;L++)x.push({start:E.start(L),end:E.end(L)});var R=this._videoWidth||Number(this.config.width),w=this._videoHeight||Number(this.config.height),A=new Date().getTime(),O={speed:"".concat(c," KB/s"),buffer_length:"".concat(d," s"),video_pos:l.currentTime,all_buffers:x,seek_state:this._seekState,stall_state:this._stallState,screen_width:R,screen_height:w,dpr:window&&window.devicePixelRatio,playbackRate:l.playbackRate,bitrateSet:this._bitrateSet,abrMethod:this._abrMethod,delta:this._hasExecuteAbrAlgo?A-this._lastExecuteTimeInMs:0};this._lastExecuteTimeInMs=A,this._hasExecuteAbrAlgo=!0,this.logger("abr predicate: ".concat(_,", prevBitrate: ").concat(k,","),"willStall: ".concat(y,", switchBitrate: ").concat(b)),this.updateBitrate(_),l.emit("ABR_CHANGE_A",k,_,y,JSON.stringify(O))}!this._hasLogStartInfo&&(this._hasLogStartInfo=!0,this._generalInfo.startup_info={predict_bitrate:_,download_speed:c,screen_width:this._videoWidth||Number(this.config.width),screen_height:this._videoHeight||Number(this.config.height),device_pixel_ratio:window&&window.devicePixelRatio,screen_fps:this._fps,startup_method:this._abrMethod}),null===(h=this.player)||void 0===h||h.emit("ABR_LOOP"),this.onAbrLoop(c,o[2],b,o.slice(3))}catch(e){this.logger("abr error",e)}finally{a>-1&&this.module._free(a)}return this.bitrate}},{key:"destroy",value:function(){var e,t=this;this.stop(),this.listeners.forEach(function(e){var n,r=e.evt,i=e.handler;null===(n=t.player)||void 0===n||n.off(r,i)}),this._maxBitrate=-1,this.player=null,this._heightToDefinitionConfig=null,this._bitrateToDefinitionConfig=null,this._bitrateToDefinitionConfig=null,this._bufferRange.clear(),this._sortedBufferRange=[],this.module=null,clearTimeout(this._stallId),clearTimeout(this._updateId),this.startTimer&&clearTimeout(this.startTimer),window.removeEventListener("resize",this._onWinSizeChange),null===(e=this.fpsDetection)||void 0===e||e.stop()}},{key:"eventInfo",get:function(){return this._eventInfo}},{key:"generalInfo",get:function(){return this._generalInfo}},{key:"bufferLength",get:function(){var e,t,n=(null===(e=this.player)||void 0===e?void 0:e.getBufferedRange())||[],r=((null===(t=this.player)||void 0===t?void 0:t.video)||{currentTime:0}).currentTime;return parseFloat(Math.max(0,n[1]-Math.max(n[0],r)).toFixed(2))}},{key:"downloadSpeed",get:function(){return Math.floor(this.player.downloadSpeed)}},{key:"nowBitrate",get:function(){return this.bitrate}},{key:"openTimeMs",get:function(){return this._openTimeMs}},{key:"isCurrentInAbr",get:function(){return this._currentInAbr},set:function(e){this._currentInAbr=e}},{key:"isCurrentHDR",get:function(){return this._isCurrentHDR},set:function(e){this._isCurrentHDR=e}},{key:"onAbrLoop",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(this._qoeArgs=i,this._currentItem&&this.avgStat(u.PLAYBACK_BITRATE,this._currentItem.bitrate),this.avgStat(u.DOWNLOAD_NETWORK_SPEED,8e3*e),this.avgStat(u.PREDICT_NETWORK_SPEED,n),this.avgStat(u.BUFFER_LENGTH,this.bufferLength),this.avgStat(u.QOE,this.getQoeRelValue(0)),r>0&&(this._switchCount++,this._switchBitrate+=r),!!this._abr_play_info.is_hint){var a=(new Date().getTime()-this.openTimeMs)/1e3;a=parseFloat(a.toFixed(2)),this._abr_play_info.playback_info.internet_speed_record.push([a,this.downloadSpeed]),this._abr_play_info.playback_info.play_bitrate_record.push([a,this.nowBitrate]),this._abr_play_info.playback_info.buffer_length_record.push([a,this.bufferLength]),this._abr_play_info.playback_info.play_speed_record.push([a,(null===(t=this.player)||void 0===t?void 0:t.playbackRate)||-1]),this._abr_play_info.playback_info.qoe_record.push([a,this.getQoeRelValue(0)]),this._abr_play_info.playback_info.qoe_a_record.push([a,this.getQoeRelValue(1)]),this._abr_play_info.playback_info.qoe_b_record.push([a,this.getQoeRelValue(2)]),this._abr_play_info.playback_info.qoe_c_record.push([a,this.getQoeRelValue(3)])}}},{key:"getQoeRelValue",value:function(e){return this._qoeArgs[e]/100}},{key:"avgStat",value:function(e,t){var n=this._avgStatItems[e];n&&n.add(t)}},{key:"getAbrPlayInfo",value:function(){return this._abr_play_info}},{key:"updateAbrMethod",value:function(e){this._abrMethod=e}},{key:"getAbrMethod",value:function(){return this._abrMethod}},{key:"updateSegmentDuration",value:function(e){var t;this.segment_duration=e,null!==(t=this.module)&&void 0!==t&&t.updateSegmentDuration&&this.module.updateSegmentDuration(e)}},{key:"getAbrVVStats",value:function(){for(var e={},t=Object.keys(u),n=0;n<t.length;n++){var r=u[t[n]],i=this._avgStatItems[r];e[r]=i.avg()}return e.switch_counts=this._switchCount,e.avg_switch_bitrate=0===this._switchCount?0:this._switchBitrate/this._switchCount,e.abr_qoe=this.getQoeRelValue(0),e.abr_qoe_a=this.getQoeRelValue(1),e.abr_qoe_b=this.getQoeRelValue(2),e.abr_qoe_c=this.getQoeRelValue(3),e.abr_method=this._abrMethod,e.abr_used=this._abrUsed,e.abr_always_on=this._abrAlwaysOn,this.logger("abrVVStats",e),e}}])}(o.Z),d=(0,i.qH)(function e(){(0,i.PA)(this,e),this.total=0,this.count=0},[{key:"add",value:function(e){this.total+=e,this.count++}},{key:"avg",value:function(){return 0===this.count?0:Math.floor(this.total/this.count)}}])},237177:function(e,t,n){n.d(t,{Z:function(){return i}});var r=n(858301);n(464135),n(98601),n(110617);let i=(0,r.qH)(function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,r.PA)(this,e),this.config={size:30,severeBlockDuration:1500,slightBlockDuration:100,highBitrateRatio:1.5,lowBitrateRatio:.8,highLadderSelectedCnt:1,lowLadderSelectedCnt:1,blockSumMaxTime:6e5},Object.keys(n).map(function(e){t.config[e]=n[e]}),this.timerId=null,this.setTimer()},[{key:"setConfig",value:function(e){var t=this;Object.keys(e).map(function(n){t.config[n]=e[n]})}},{key:"resetCurrent",value:function(){this._info.currentBlockDur=0}},{key:"setTimer",value:function(){var e=this;this._blockQueue=[],this._tBQueue=[],this._sBQueue=[],this._hCount=0,this._lCount=0,this._info={blockDurationSum:0,currentBlockDur:0,targetBitrateAvg:0,selectedBitrateAvg:0,higherSelectedCnt:0,lowerSelectedCnt:0},this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.timerId=setTimeout(function(){e.setTimer()},this.config.blockSumMaxTime)}},{key:"targetBitRate",set:function(e){if(!!e&&"number"==typeof e){this._tBQueue.push(parseInt(e,10)),this._tBQueue.length>this.config.size&&this._tBQueue.shift(0,1);var t=0;this._tBQueue.map(function(e){t+=e}),this._info.targetBitrateAvg=t/this._tBQueue.length}}},{key:"selectBitRate",set:function(e){if(!!e&&"number"==typeof e){this._sBQueue.push(e),this._sBQueue.length>this.config.size&&this._sBQueue.shift(0,1);var t=0;this._sBQueue.map(function(e){t+=e}),this._info.selectedBitrateAvg=t/this._sBQueue.length}}},{key:"blockDuration",set:function(e){this._blockQueue.push(e),this._blockQueue.length>this.config.size&&this._blockQueue.shift(0,1);var t=0;this._blockQueue.map(function(e){t+=e}),this._info.blockDurationSum=t}},{key:"currentBlockDur",set:function(e){this._info.currentBlockDur+=e}},{key:"updateBitRateInfo",value:function(e,t){if(!!e&&!!t)e>t?this._info.higherSelectedCnt++:e<t&&this._info.lowerSelectedCnt++}},{key:"checkDefinition",value:function(){var e=this.config,t=this._info;return t.blockDurationSum>e.severeBlockDuration&&(t.selectedBitrateAvg>t.targetBitrateAvg*e.highBitrateRatio&&t.higherSelectedCnt>=e.highLadderSelectedCnt||t.currentBlockDur>e.severeBlockDuration)?1:t.blockDurationSum<e.slightBlockDuration&&t.selectedBitrateAvg<t.targetBitrateAvg*e.lowBitrateRatio&&t.lowerSelectedCnt>=e.lowLadderSelectedCnt?2:0}}])},124378:function(e,t,n){n.d(t,{d:function(){return a}});var r=n(858301),i=n(156144),a=(0,r.qH)(function e(){(0,r.PA)(this,e),(0,r._x)(this,"analysis",void 0)},[{key:"select",value:function(e,t,n){if(e.length<=1)return e[0];var r,a=n.autoBitrateParams,o=a.paramA,s=a.paramB,l=a.paramC,u=a.paramD,c=n.defaultBitrate,d=-1===t?c:o*Math.pow(t,3)+s*Math.pow(t,2)+l*t+u;return!(r=(0,i.v2)(e,d,n.selectAlgType))&&(r=e[e.length-1]),r._targetBitrate=d,r}}])},42787:function(e,t,n){n.d(t,{$w:function(){return a},PA:function(){return o},Vx:function(){return v},XW:function(){return h},_x:function(){return u},l5:function(){return g},qH:function(){return l},x:function(){return i}});function r(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)})}}function a(e,t,n){return t=d(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,f()?Reflect.construct(t,n||[],d(e).constructor):t.apply(e,n))}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function l(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,n){return(t=m(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!({}).hasOwnProperty.call(e,t)&&null!==(e=d(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}}).apply(null,arguments)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&p(e,t)}function f(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(f=function(){return!!e})()}function g(){g=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},a="function"==typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(e){u=function(e,t,n){return e[t]=n}}function c(t,n,r,a){var o=Object.create((n&&n.prototype instanceof m?n:m).prototype);return i(o,"_invoke",{value:function(t,n,r){var i=h;return function(a,o){if(i===f)throw Error("Generator is already running");if(i===p){if("throw"===a)throw o;return{value:e,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var l=function t(n,r){var i=r.method,a=n.iterator[i];if(a===e)return r.delegate=null,"throw"===i&&n.iterator.return&&(r.method="return",r.arg=e,t(n,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=TypeError("The iterator does not provide a '"+i+"' method")),v;var o=d(a,n.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,v;var s=o.arg;return s?s.done?(r[n.resultName]=s.value,r.next=n.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,v):s:(r.method="throw",r.arg=TypeError("iterator result is not an object"),r.delegate=null,v)}(s,r);if(l){if(l===v)continue;return l}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===h)throw i=p,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var u=d(t,n,r);if("normal"===u.type){if(i=r.done?p:"suspendedYield",u.arg===v)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(i=p,r.method="throw",r.arg=u.arg)}}}(t,r,new w(a||[]))}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=c;var h="suspendedStart",f="executing",p="completed",v={};function m(){}function _(){}function y(){}var b={};u(b,o,function(){return this});var S=Object.getPrototypeOf,T=S&&S(S(A([])));T&&T!==n&&r.call(T,o)&&(b=T);var k=y.prototype=m.prototype=Object.create(b);function x(e){["next","throw","return"].forEach(function(t){u(e,t,function(e){return this._invoke(t,e)})})}function E(e,t){var n;i(this,"_invoke",{value:function(i,a){function o(){return new t(function(n,o){!function n(i,a,o,s){var l=d(e[i],e,a);if("throw"!==l.type){var u=l.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?t.resolve(c.__await).then(function(e){n("next",e,o,s)},function(e){n("throw",e,o,s)}):t.resolve(c).then(function(e){u.value=e,o(u)},function(e){return n("throw",e,o,s)})}s(l.arg)}(i,a,n,o)})}return n=n?n.then(o,o):o()}})}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function w(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function A(t){if(t||""===t){var n=t[o];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,a=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return a.next=a}}throw TypeError(typeof t+" is not iterable")}return _.prototype=y,i(k,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:_,configurable:!0}),_.displayName=u(y,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,u(e,l,"GeneratorFunction")),e.prototype=Object.create(k),e},t.awrap=function(e){return{__await:e}},x(E.prototype),u(E.prototype,s,function(){return this}),t.AsyncIterator=E,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new E(c(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then(function(e){return e.done?e.value:o.next()})},x(k),u(k,l,"Generator"),u(k,o,function(){return this}),u(k,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=A,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(R),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,v):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;R(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:A(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}function p(e,t){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function v(e,t,n,r){var i=c(d(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof i?function(e){return i.apply(n,e)}:i}function m(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}},546041:function(e,t,n){n.d(t,{Ye:function(){return l},_R:function(){return d},kW:function(){return c},l0:function(){return s},l1:function(){return h},sm:function(){return f},u7:function(){return u}});var r,i,a,o=n(42787);var s=((r=s||{}).MP4="MP4",r.MP4_MSE_SOFT="MP4_MSE_SOFT",r.MP4_MSE="MP4_MSE",r.MP4_0="MP4_0",r.MP4_1="MP4_1",r.MP4_2="MP4_2",r.DASH="DASH",r.HLS="HLS",r);var l=((i=l||{})[i.Normal=0]="Normal",i[i.Ad=1]="Ad",i);var u=((a=u||{})[a.AVC=0]="AVC",a[a.HEVC=1]="HEVC",a[a.VVC=2]="VVC",a.H264="h264",a.H265="h265",a.H266="h266",a),c="real_time_speed",d={CDN:"cdn",PCDN:"pcdn"},h={BEFEORE_START:0,NOT_SUPPORTED:1,START_INIT_DESTROY:2,NO_PRELOAD:3,CLOSE_DWNGRADE:4,INIT_PROMISE_CATCH:5,PLAYER_ERROR:6,HTTP_ERROR:7,MSE_ERROR:8,DESTROY:9},f=(0,o._x)((0,o._x)((0,o._x)((0,o._x)((0,o._x)((0,o._x)((0,o._x)((0,o._x)((0,o._x)((0,o._x)({},h.BEFEORE_START,"before start"),h.NOT_SUPPORTED,"codec not support"),h.START_INIT_DESTROY,"start init destroy"),h.NO_PRELOAD,"no preload"),h.CLOSE_DWNGRADE,"close downgrade"),h.INIT_PROMISE_CATCH,"init promise catch"),h.PLAYER_ERROR,"player error"),h.HTTP_ERROR,"http error"),h.MSE_ERROR,"mse error"),h.DESTROY,"destroy")},288773:function(e,t,n){function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(r.key),r)}}function a(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}n.d(t,{PA:function(){return r},qH:function(){return a}})},132477:function(e,t,n){n.d(t,{d1:function(){return d}});var r=n(83399),i=n(979860),a=n(841921),o=n(263287),s=n(689594),l=n(336397),u=function(){try{return s.j?window.MediaSource:null}catch(e){}}(),c={APPEND:"appendBuffer",REMOVE:"removeBuffer",UPDATE_DURATION:"updateDuration"},d=function(){var e,t,n;function s(e,t){var n=this;(0,r.PA)(this,s),(0,r._x)(this,"media",null),(0,r._x)(this,"mediaSource",null),(0,r._x)(this,"_openPromise",(0,i.Q)()),(0,r._x)(this,"_queue",Object.create(null)),(0,r._x)(this,"_sourceBuffer",Object.create(null)),(0,r._x)(this,"_mseFullFlag",{}),(0,r._x)(this,"_st",0),(0,r._x)(this,"_opst",0),(0,r._x)(this,"_logger",null),(0,r._x)(this,"_config",null),(0,r._x)(this,"_url",null),(0,r._x)(this,"_onSBUpdateEnd",function(e){var t=n._queue[e];if(t){var r=t[0];if((null==r?void 0:r.opName)!==c.UPDATE_DURATION&&t.shift(),r){var a=(0,i.j)()-n._opst;n._logger.debug("UpdateEnd",r.opName,a,r.context),r.promise.resolve({name:r.opName,context:r.context,costtime:a}),n._startQueue(e)}}}),(0,r._x)(this,"_onSBUpdateError",function(e,t){var r=n._queue[e];if(r){var i=r[0];i&&(n._logger.error("UpdateError",e,i.opName,i.context),i.promise.reject(new o.Fc(o.wb.MEDIA,o.wb.SUB_TYPES.MSE_APPEND_BUFFER,t)))}}),this._config=Object.assign(s.getDefaultConfig(),t),e&&this.bindMedia(e),this._logger=new l.Y("MSE"),this._config.openLog&&l.Y.enable()}return(0,r.qH)(s,[{key:"isOpened",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)==="open"}},{key:"url",get:function(){return this._url}},{key:"duration",get:function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.duration)||-1}},{key:"isEnded",get:function(){return!!this.mediaSource&&"ended"===this.mediaSource.readyState}},{key:"isFull",value:function(e){return e?this._mseFullFlag[e]:this._mseFullFlag[s.VIDEO]}},{key:"updateDuration",value:function(e){var t=this,n=this.mediaSource&&this.mediaSource.duration>e;if(this.mediaSource&&this.mediaSource.duration>e){var r=0;if(Object.keys(this._sourceBuffer).forEach(function(e){try{r=Math.max(t.bufferEnd(e)||0,r)}catch(e){}}),e<r)return Promise.resolve()}return this._enqueueBlockingOp(function(){if(t.isEnded){t._logger.debug("[debug mse] setDuration ended");return}t.mediaSource&&(t.mediaSource.duration=e,t._logger.debug("[debug mse] setDuration"))},c.UPDATE_DURATION,{isReduceDuration:n})}},{key:"open",value:function(){var e=this;if(this._openPromise.used&&!this.isOpened&&this.mediaSource){var t=this.mediaSource;t.addEventListener("sourceopen",function n(){var r=(0,i.j)()-e._st;e._logger.debug("MSE OPEN",r),t.removeEventListener("sourceopen",n),e._openPromise.resolve({costtime:r})}),this._openPromise=(0,i.Q)()}return this._openPromise}},{key:"bindMedia",value:(e=(0,r.x)((0,r.l5)().mark(function e(t){var n,a,o=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.mediaSource||this.media)){e.next=3;break}return e.next=3,this.unbindMedia();case 3:if(!(!t||!u)){e.next=5;break}throw Error("Param media or MediaSource does not exist");case 5:return this.media=t,n=this.mediaSource=new u,this._st=(0,i.j)(),a=function e(){var r=(0,i.j)()-o._st;o._logger.debug("MSE OPEN"),n.removeEventListener("sourceopen",e),URL.revokeObjectURL(t.src),o._openPromise.resolve({costtime:r}),t.dispatchEvent(new CustomEvent("mseAttached"))},n.addEventListener("sourceopen",a),this._url=URL.createObjectURL(n),t.src=this._url,t.dispatchEvent(new CustomEvent("mseAttaching")),e.abrupt("return",this._openPromise);case 14:case"end":return e.stop()}},e,this)})),function(t){return e.apply(this,arguments)})},{key:"unbindMedia",value:(t=(0,r.x)((0,r.l5)().mark(function e(){var t,n,a,o=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._openPromise.used&&this._openPromise.resolve(),t=this.mediaSource){if(Object.keys(this._queue).forEach(function(e){var t=o._queue[e];t&&t.forEach(function(e){var t,n;return null===(t=e.promise)||void 0===t?void 0:null===(n=t.resolve)||void 0===n?void 0:n.call(t)})}),n=!!this.media&&this.media.readyState>=1,a="open"===t.readyState,n&&a)try{t.endOfStream()}catch(e){}Object.keys(this._sourceBuffer).forEach(function(e){try{t.removeSourceBuffer(o._sourceBuffer[e])}catch(e){}})}if(this.media){this.media.removeAttribute("src");try{this.media.load()}catch(e){}this.media=null}this.mediaSource=null,this._openPromise=(0,i.Q)(),this._queue=Object.create(null),this._sourceBuffer=Object.create(null);case 8:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"createSource",value:function(e,t){var n;if(!this._sourceBuffer[e]&&this.mediaSource){try{n=this._sourceBuffer[e]=this.mediaSource.addSourceBuffer(t)}catch(e){throw new o.Fc(o.wb.MEDIA,o.wb.SUB_TYPES.MSE_ADD_SB,e)}n.mimeType=t,n.addEventListener("updateend",this._onSBUpdateEnd.bind(this,e)),n.addEventListener("error",this._onSBUpdateError.bind(this,e))}}},{key:"changeType",value:function(e,t){var n=this,r=this._sourceBuffer[e];return this.mediaSource&&r&&r.mimeType!==t?"function"!=typeof r.changeType?Promise.reject():this._enqueueOp(e,function(){r.changeType(t),r.mimeType=t,n._onSBUpdateEnd(e)},"changeType",{mimeType:t}):Promise.resolve()}},{key:"createOrChangeSource",value:function(e,t){return this.createSource(e,t),this.changeType(e,t)}},{key:"append",value:function(e,t,n){var r=this;return t&&t.byteLength&&this._sourceBuffer[e]?this._enqueueOp(e,function(){var a;r.mediaSource&&!r.media.error&&(r._logger.debug("MSE APPEND START",n),r._opst=(0,i.j)(),null===(a=r._sourceBuffer[e])||void 0===a||a.appendBuffer(t))},c.APPEND,n):Promise.resolve()}},{key:"remove",value:function(e,t,n,r){var a=this,o=!1;return this._mseFullFlag[e]&&(o=!0),this._enqueueOp(e,function(){if(a.mediaSource&&!a.media.error){var o=a._sourceBuffer[e];if(t>=n||!o){a._onSBUpdateEnd(e);return}a._opst=(0,i.j)(),a._logger.debug("MSE REMOVE START",e,t,n,r),o.remove(t,n)}},c.REMOVE,r,o)}},{key:"clearBuffer",value:function(e,t){var n,r=this;return Object.keys(this._sourceBuffer).forEach(function(i){n=r.remove(i,e,t)}),n||Promise.resolve()}},{key:"clearAllBuffer",value:function(){var e,t=this;return Object.keys(this._sourceBuffer).forEach(function(n){var r=t._sourceBuffer[n];e=t.remove(n,0,a.l.end(a.l.get(r)))}),e}},{key:"clearOpQueues",value:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];this._logger.debug("MSE clearOpQueue START");var n=this._queue[e],r=this._sourceBuffer[e],i=!1;if(null!=r&&r.updating&&(i=!0),t&&n){var a=i?Math.max(n.length-1,0):n.length;a>0&&n.splice(0,a);return}}},{key:"endOfStream",value:function(e){var t=this;return this.mediaSource&&"open"===this.mediaSource.readyState?this._enqueueBlockingOp(function(){var n=t.mediaSource;n&&"open"===n.readyState&&(t._logger.debug("MSE endOfStream START"),e?n.endOfStream(e):n.endOfStream())},"endOfStream"):Promise.resolve()}},{key:"setLiveSeekableRange",value:function(e,t){var n=this.mediaSource;!(e<0)&&!(t<e)&&null!=n&&n.setLiveSeekableRange&&"open"===n.readyState&&n.setLiveSeekableRange(e,t)}},{key:"getSourceBuffer",value:function(e){return this._sourceBuffer[e]}},{key:"buffered",value:function(e){return a.l.get(this._sourceBuffer[e])}},{key:"bufferStart",value:function(e){return a.l.start(this.buffered(e))}},{key:"bufferEnd",value:function(e){return a.l.end(this.buffered(e))}},{key:"_enqueueOp",value:function(e,t,n,r,a){var o=this;if(!this.mediaSource)return Promise.resolve();var s=this._queue[e]=this._queue[e]||[],l={exec:t,promise:(0,i.Q)(),opName:n,context:r};return a?(s.splice(0,0,l),this._mseFullFlag[e]=!1,this._startQueue(e)):s.push(l),this.isOpened||this.isEnded?1===s.length&&this._startQueue(e):this._openPromise.then(function(){1===s.length&&o._startQueue(e)}),l.promise}},{key:"_enqueueBlockingOp",value:(n=(0,r.x)((0,r.l5)().mark(function e(t,n,a){var o,s,l=this;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mediaSource){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:if((o=Object.keys(this._sourceBuffer)).length){e.next=5;break}return e.abrupt("return",t());case 5:return s=[],o.forEach(function(e){var t=l._queue[e],r=(0,i.Q)();s.push(r),t.push({exec:function(){r.resolve()},promise:r,opName:n,context:a}),1===t.length&&l._startQueue(e)}),e.abrupt("return",Promise.all(s).then(function(){try{return t()}finally{o.forEach(function(e){var t=l._queue[e],n=l._sourceBuffer[e];null==t||t.shift(),(!n||!n.updating)&&l._startQueue(e)})}}));case 8:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"_startQueue",value:function(e){var t=this._queue[e];if(t){var n=t[0];if(n&&!this._mseFullFlag[e])try{n.exec()}catch(r){r&&r.message&&r.message.indexOf("SourceBuffer is full")>=0?(this._mseFullFlag[e]=!0,this._logger.error("[MSE error],  context,",n.context," ,name,",n.opName,",err,SourceBuffer is full"),n.promise.reject(new o.Fc(o.wb.MEDIA,o.wb.SUB_TYPES.MSE_FULL,r))):(this._logger.error(r),n.promise.reject(new o.Fc(o.wb.MEDIA,o.wb.SUB_TYPES.MSE_OTHER,r)),t.shift(),this._startQueue(e))}}}},{key:"setTimeoffset",value:function(e,t,n){var r=this;return this._enqueueOp(e,function(){t<0&&(t+=.001),r._sourceBuffer[e].timestampOffset=t,r._onSBUpdateEnd(e)},"setTimeoffset",n)}},{key:"abort",value:function(e,t){var n=this;return this.isOpened?this._enqueueOp(e,function(){var t;null===(t=n._sourceBuffer[e])||void 0===t||t.abort(),n._onSBUpdateEnd(e)},"abort",t):Promise.resolve()}}],[{key:"getDefaultConfig",value:function(){return{openLog:!1}}},{key:"isSupported",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(!u)return!1;try{return u.isTypeSupported(e)}catch(t){return this._logger.error(e,t),!1}}}]),s}();(0,r._x)(d,"VIDEO","video"),(0,r._x)(d,"AUDIO","audio")},630669:function(e,t,n){n.d(t,{i:function(){return c}});var r=n(83399),i=n(715146),a=n(655832),o=n(854174),s=n(979860),l=n(336397),u=["retry","retryDelay","onRetryError","transformError"],c=function(){var e;function t(e,n){(0,r.PA)(this,t),this.promise=(0,s.Q)(),this.alive=!!n.onProgress,n.logger||(n.logger=new l.Y("Loader")),this._loaderType=e,this._loader=e===o.t.FETCH&&window.fetch?new i.j:new a.c,this._config=n,this._retryCount=0,this._retryTimer=null,this._canceled=!1,this._retryCheckFunc=n.retryCheckFunc,this._logger=n.logger}return(0,r.qH)(t,[{key:"exec",value:function(){var e,t=this,n=this._config,i=n.retry,a=n.retryDelay,o=n.onRetryError,s=n.transformError,l=(0,r.Kd)(n,u);var c=(e=(0,r.x)((0,r.l5)().mark(function e(){var n,u,d;return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t._loader.load(l);case 3:n=e.sent,t.promise.resolve(n),e.next=27;break;case 7:if(e.prev=7,e.t0=e.catch(0),t._loader.running=!1,t._logger.debug("[task request catch err]",e.t0),!t._canceled){e.next=13;break}return e.abrupt("return");case 13:if(e.t0.loaderType=t._loaderType,e.t0.retryCount=t._retryCount,u=e.t0,s&&(u=s(u)||u),o&&t._retryCount>0&&o(u,t._retryCount,{index:l.index,vid:l.vid,range:l.range,priOptions:l.priOptions}),t._retryCount++,d=!0,t._retryCheckFunc&&(d=t._retryCheckFunc(e.t0)),!(d&&t._retryCount<=i)){e.next=26;break}return clearTimeout(t._retryTimer),t._logger.debug("[task request setTimeout],retry",t._retryCount,",retry range,",l.range),t._retryTimer=setTimeout(c,a),e.abrupt("return");case 26:t.promise.reject(u);case 27:case"end":return e.stop()}},e,null,[[0,7]])})),function(){return e.apply(this,arguments)});return c(),this.promise}},{key:"cancel",value:(e=(0,r.x)((0,r.l5)().mark(function e(){return(0,r.l5)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return clearTimeout(this._retryTimer),this._canceled=!0,this._loader.running=!1,e.abrupt("return",this._loader.cancel());case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"running",get:function(){return this._loader&&this._loader.running}},{key:"loader",get:function(){return this._loader}}]),t}()},445655:function(e,t,n){n.d(t,{_v:function(){return a},gJ:function(){return r},xf:function(){return i}});function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if((t=t.filter(Boolean)).length<2)return t[0];var r=i(t.reduce(function(e,t){return e+t.byteLength},0)),a=0;return t.forEach(function(e){r.set(e,a),a+=e.byteLength}),r}function i(e){for(var t,n=0;n<10;)try{if(t=new Uint8Array(e),t.byteLength>0)break;n++}catch(e){if(n<10)n++;else throw Error("new array failed final,".concat(null==e?void 0:e.message))}return t}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(function(t){return setTimeout(t,e)})}},954584:function(e,t,n){n.d(t,{Y:function(){return u}});var r=n(670537),i=1,a=2,o=3,s=4,l=["Boolean","Number","String","Undefined","Null","Date","Object"],u=function(){function e(t,n){(0,r.PA)(this,e),this.name=t||"",this._prefix="[".concat(this.name,"]"),this.logCacheLevel=(null==n?void 0:n.logCacheLevel)||3,this.logMaxSize=(null==n?void 0:n.logMaxSize)||204800,this.logSize=0,this.logTextArray=[]}return(0,r.qH)(e,[{key:"debug",value:function(){for(var t,n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];this.logCache.apply(this,[i].concat(r)),!e.disabled&&(t=console).debug.apply(t,[this._prefix,c()].concat(r))}},{key:"log",value:function(){for(var t,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[a].concat(r)),!e.disabled&&(t=console).log.apply(t,[this._prefix,c()].concat(r))}},{key:"warn",value:function(){for(var t,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[o].concat(r)),!e.disabled&&(t=console).warn.apply(t,[this._prefix,c()].concat(r))}},{key:"error",value:function(){for(var t,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];this.logCache.apply(this,[s].concat(r)),!e.disabled&&(t=console).error.apply(t,[this._prefix,c()].concat(r))}},{key:"logCache",value:function(e){if(!(e<this.logCacheLevel)){var t="";try{for(var n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];var o=i.map(function(e){return function e(t,n,i){!i&&(i=1),!n&&(n=2);var a={};if(!t||"object"!==(0,r.Ac)(t))return t;var o=Object.prototype.toString.call(t).slice(8,-1);if(!l.includes(o))return o;if(!(i>n)){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(i===n?a[s]=function(e){if("object"!==(0,r.Ac)(e))return e;var t=Object.prototype.toString.call(e).slice(8,-1);switch(t){case"Array":case"Uint8Array":case"ArrayBuffer":return t+"["+e.length+"]";case"Object":return"{}";default:return t}}(t[s]):"object"===(0,r.Ac)(t[s])?a[s]=e(t[s],n,i+1):a[s]=t[s]);return a}}(e)});t=this._prefix+c()+JSON.stringify(o)}catch(e){return}if(e>=this.logCacheLevel&&(this.logSize+=t.length,this.logTextArray.push(t)),this.logSize>this.logMaxSize){var s=this.logTextArray.shift();this.logSize-=s.length}}}},{key:"getLogCache",value:function(){var e=this.logTextArray.join("\n");return this.reset(),e}},{key:"reset",value:function(){this.logTextArray=[],this.logSize=0}},{key:"table",value:function(){var t;!e.disabled&&(t=console).table.apply(t,arguments)}},{key:"setLogLevel",value:function(e){this.logCacheLevel=e}}],[{key:"enable",value:function(){e.disabled=!1}},{key:"disable",value:function(){e.disabled=!0}}]),e}();function c(){return new Date().toLocaleString()}(0,r._x)(u,"disabled",!0)},833524:function(e,t,n){n.d(t,{G7:function(){return o},Gu:function(){return i},pl:function(){return l},rO:function(){return s}});var r=n(715443);function i(e){if(!!e&&null!==e[0]&&void 0!==e[0]&&(0!==e[0]||null!==e[1]&&void 0!==e[1])){var t="bytes="+e[0]+"-";return e[1]&&(t+=e[1]),t}}function a(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function o(e,t){if(e){if(!t)return e;var n,i=Object.keys(t).map(function(e){if(null!=(n=t[e]))return Array.isArray(n)?e+="[]":n=[n],n.map(function(t){return(0,r.J_)(t)?t=t.toISOString():(0,r.Kn)(t)&&(t=JSON.stringify(t)),"".concat(a(e),"=").concat(a(t))}).join("&")}).filter(Boolean).join("&");if(i){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}}function s(e,t,n,r,i,a,o,s,l,u,c){return i=null!=i?parseFloat(i):null,Number.isNaN(r=parseInt(r||"0",10))&&(r=0),{data:e,done:t,options:{range:l,vid:u,index:s,contentLength:r,age:i,startTime:a,firstByteTime:o,endTime:Date.now(),priOptions:c},response:n}}function l(e,t){return Math.round(8e3*e/t/1024)}},167186:function(e,t,n){function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=new Uint8Array((t=t.filter(Boolean)).reduce(function(e,t){return e+t.byteLength},0)),i=0;return t.forEach(function(e){r.set(e,i),i+=e.byteLength}),r}n.d(t,{gJ:function(){return r}}),n(691842),n(110617),n(511141),n(792315),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680),n(742611),n(927234)},2619:function(e,t,n){n.d(t,{X:function(){return i}});var r=n(758772),i=(0,r.qH)(function e(t,n,i,a){(0,r.PA)(this,e),(0,r._x)(this,"duration",1024),(0,r._x)(this,"flag",{dependsOn:2,isNonSyncSample:0}),(0,r._x)(this,"keyframe",!0),this.originPts=this.pts=this.dts=t,this.data=n,this.size=n.byteLength,this.sampleOffset=a,i&&(this.duration=i)})}}]);