(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["52405"],{591699:function(t,e,i){"use strict";i.d(e,{Z:function(){return v}});var n=i("117801"),r=i("682904");class o extends n.Z{constructor(t){super(t)}}var a=i("215153"),s=i("381751"),c=i("663037"),l=i("754843"),u=i("954063"),h=i("67902"),f=i("517853");class d{_getBandwidth(){if(!performance.getEntries)return -1;let t=performance.getEntries().filter(({initiatorType:t,decodedBodySize:e})=>"img"===t&&e>0),e=t.reduce((t,{decodedBodySize:e,responseEnd:i,responseStart:n})=>t+1e3*e/(i-n),0);return t.length?e/t.length/1024:0}getScore(){return new Promise((t,e)=>{try{let e=this._getBandwidth(),i=0;e>0&&e<1e6&&(i=e<1?60*performance_speed:e<5?(performance_speed-1)*.4+6.01:(performance_speed-5)*.02+7.61),t({score:i,origin:e})}catch(e){t({score:0,origin:-1})}})}}var p=new d,g=i("97399"),y=i("422288");let _={plugins:{cpu:{cls:r.Z,factor:8,plugins:{cpu_core_number:{factor:4,instance:c.Z},decodeImg:{factor:3,instance:l.Z}}},memory:{cls:o,factor:0,plugins:{copy:{factor:5,instance:u.Z},usage:{factor:5,instance:h.Z}}},net:{cls:a.Z,factor:9,plugins:{downlink:{factor:5,instance:f.Z},performance:{factor:4,instance:p}}},render:{cls:s.Z,factor:0,plugins:{avc:{factor:5,instance:g.Z},hevc:{factor:5,instance:y.Z}}}}};class v extends n.Z{constructor(t){super(Object.assign({},_,t))}setPlayer(t,e){var i,n;(null==(i=this.options.plugins.render)?void 0:i.instance)&&(null==(n=this.options.plugins.render)||n.instance.setPlayer(t,e))}}},616275:function(t,e,i){"use strict";function n(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?n(Object(i),!0).forEach(function(e){l(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function a(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,A(n.key),n)}}function c(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t,e,i){return(e=A(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function u(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}function h(t){return(h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function d(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function p(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return p(t)}function y(t){var e=d();return function(){var i,n=h(t);return i=e?Reflect.construct(n,arguments,h(this).constructor):n.apply(this,arguments),g(this,i)}}function _(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=h(t)););return t}function v(){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=_(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}function m(t){return b(t)||E(t)||w(t)||S()}function b(t){if(Array.isArray(t))return k(t)}function E(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function w(t,e){if(t){if("string"==typeof t)return k(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return k(t,e)}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function S(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function A(t){var e=T(t,"string");return"symbol"==typeof e?e:String(e)}i.d(e,{Ac:function(){return o},IP:function(){return h},PA:function(){return a},U2:function(){return v},WY:function(){return y},XW:function(){return u},Zj:function(){return r},qH:function(){return c},u:function(){return m}})},546771:function(t,e,i){"use strict";i.d(e,{ZP:function(){return m}});var n=i("616275"),r=i("156731"),o=i("837463"),a=i("619603");function s(t,e){o.Z.logError("[".concat(t,"] event or callback cant be undefined or null when call ").concat(e))}var c=function(){function t(e){(0,n.PA)(this,t),r.Z.checkIsFunction(this.beforeCreate)&&this.beforeCreate(e),(0,a.ZP)(this),this.__args=e,this.__events={},this.__onceEvents={},this.config=e.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(e)}return(0,n.qH)(t,[{key:"beforeCreate",value:function(t){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(t){this.player=t.player,this.playerConfig=t.player&&t.player.config,this.pluginName=t.pluginName?t.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=t.player&&t.player.logger}},{key:"updateLang",value:function(t){!t&&(t=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var t=r.Z.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&("touch"===this.playerConfig.domEventType||"mouse"===this.playerConfig.domEventType)&&(t=this.playerConfig.domEventType),t}},{key:"on",value:function(t,e){var i=this;if(!t||!e||!this.player){s(this.pluginName,"plugin.on(event, callback)");return}"string"==typeof t?(this.__events[t]=e,this.player.on(t,e)):Array.isArray(t)&&t.forEach(function(t){i.__events[t]=e,i.player.on(t,e)})}},{key:"once",value:function(t,e){var i=this;if(!t||!e||!this.player){s(this.pluginName,"plugin.once(event, callback)");return}"string"==typeof t?(this.__onceEvents[t]=e,this.player.once(t,e)):Array.isArray(t)&&t.forEach(function(n){i.__onceEvents[n]=e,i.player.once(t,e)})}},{key:"off",value:function(t,e){var i=this;if(!t||!e||!this.player){s(this.pluginName,"plugin.off(event, callback)");return}"string"==typeof t?(delete this.__events[t],this.player.off(t,e)):Array.isArray(t)&&t.forEach(function(n){delete i.__events[t],i.player.off(n,e)})}},{key:"offAll",value:function(){var t=this;["__events","__onceEvents"].forEach(function(e){Object.keys(t[e]).forEach(function(i){t[e][i]&&t.off(i,t[e][i]),i&&delete t[e][i]})}),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(t){var e;if(!!this.player){for(var i=arguments.length,n=Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];(e=this.player).emit.apply(e,[t].concat(n))}}},{key:"emitUserAction",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!!this.player){var r=(0,n.Zj)((0,n.Zj)({},i),{},{pluginName:this.pluginName});this.player.emitUserAction(t,e,r)}}},{key:"hook",value:function(t,e){return a.z3.call.apply(a.z3,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(t,e){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return a.xn.call.apply(a.xn,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(t,e){for(var i=arguments.length,n=Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return a.v8.call.apply(a.v8,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(!!this.player)return i&&(e.pluginName=i),this.player.registerPlugin({plugin:t,options:e})}},{key:"getPlugin",value:function(t){return this.player?this.player.getPlugin(t):null}},{key:"__destroy",value:function(){var t=this,e=this.player,i=this.pluginName;this.offAll(),r.Z.clearAllTimers(this),r.Z.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map(function(e){t[e]=null}),e.unRegisterPlugin(i),(0,a.Qs)(this)}}],[{key:"defineGetterOrSetter",value:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&Object.defineProperty(t,i,e[i])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),t}(),l=i("886944"),u={CONTROLS:"controls",ROOT:"root"},h={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},f="xg-icon-disable";function d(t){return!!t&&t.indexOf&&/^(?:http|data:|\/)/.test(t)}function p(t,e){return"object"===(0,n.Ac)(t)&&t.class&&"string"==typeof t.class?"".concat(e," ").concat(t.class):e}function g(t,e){return"object"===(0,n.Ac)(t)&&t.attr&&"object"===(0,n.Ac)(t.attr)&&Object.keys(t.attr).map(function(i){e[i]=t.attr[i]}),e}function y(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",s=null;if(t instanceof window.Element)return r.Z.addClass(t,i),Object.keys(n).map(function(e){t.setAttribute(e,n[e])}),t;if(d(t)||d(t.url))return n.src=d(t)?t:t.url||"",s=r.Z.createDom(t.tag||"img","",n,"xg-img ".concat(i));if("function"==typeof t)try{if((s=t())instanceof window.Element)return r.Z.addClass(s,i),Object.keys(n).map(function(t){s.setAttribute(t,n[t])}),s;o.Z.logWarn("warn>>icons.".concat(e," in config of plugin named [").concat(a,"] is a function mast return an Element Object"));return null}catch(t){return o.Z.logError("Plugin named [".concat(a,"]:createIcon"),t),null}return"string"==typeof t?r.Z.createDomFromHtml(t,n,i):(o.Z.logWarn("warn>>icons.".concat(e," in config of plugin named [").concat(a,"] is invalid")),null)}function _(t,e){var i=e.config.icons||e.playerConfig.icons;Object.keys(t).map(function(n){var r=t[n],o=r&&r.class?r.class:"",a=r&&r.attr?r.attr:{},s=null;i&&i[n]&&(o=p(i[n],o),a=g(i[n],a),s=y(i[n],n,o,a,e.pluginName)),!s&&r&&(s=y(r.icon?r.icon:r,a,o,{},e.pluginName)),e.icons[n]=s})}function v(t,e){Object.keys(t).map(function(i){Object.defineProperty(e.langText,i,{get:function(){var n=e.lang,r=e.i18n;return r[i]?r[i]:t[i]&&t[i][n]||""}})})}var m=function(t){(0,n.XW)(i,t);var e=(0,n.WY)(i);function i(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,n.PA)(this,i),(t=e.call(this,r)).__delegates=[],t}return(0,n.qH)(i,[{key:"__init",value:function(t){if((0,n.U2)((0,n.IP)(i.prototype),"__init",this).call(this,t),!!t.root){var e=t.root,a=null;this.icons={},this.root=null,this.parent=null,_(this.registerIcons()||{},this),this.langText={},v(this.registerLanguageTexts()||{},this);var s="";try{s=this.render()}catch(t){throw o.Z.logError("Plugin:".concat(this.pluginName,":render"),t),Error("Plugin:".concat(this.pluginName,":render:").concat(t.message))}if(s)(a=i.insert(s,e,t.index)).setAttribute("data-index",t.index);else{if(!t.tag)return;(a=r.Z.createDom(t.tag,"",t.attr,t.name)).setAttribute("data-index",t.index),e.appendChild(a)}this.root=a,this.parent=e;var c=this.config.attr||{},l=this.config.style||{};this.setAttr(c),this.setStyle(l),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var t=this;if(!!this.root){this._children=[];var e=this.children();e&&"object"===(0,n.Ac)(e)&&Object.keys(e).length>0&&Object.keys(e).map(function(i){var o,a,s=i,c=e[s],l={root:t.root};"function"==typeof c?(o=t.config[s]||{},a=c):"object"===(0,n.Ac)(c)&&"function"==typeof c.plugin&&(o=c.options?r.Z.deepCopy(t.config[s]||{},c.options):t.config[s]||{},a=c.plugin),l.config=o,void 0!==o.index&&(l.index=o.index),o.root&&(l.root=o.root),t.registerPlugin(a,l,s)})}}},{key:"updateLang",value:function(t){function e(t,i){for(var n=0;n<t.children.length;n++)t.children[n].children.length>0?e(t.children[n],i):i(t.children[n])}!t&&(t=this.lang);var i=this.root,n=this.i18n,r=this.langText;i&&e(i,function(e){var i=e.getAttribute&&e.getAttribute("lang-key");if(!!i){var o=n[i.toUpperCase()]||r[i];o&&(e.innerHTML="function"==typeof o?o(t):o)}})}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.i18n||{},n=this.langText;t.setAttribute&&t.setAttribute("lang-key",e);var r=i[e]||n[e]||"";r&&(t.innerHTML=r)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,r.Z.addClass(this.find(".xgplayer-icon"),f)}},{key:"enable",value:function(){this.config.disable=!1,r.Z.removeClass(this.find(".xgplayer-icon"),f)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e.root=e.root||this.root;var o=(0,n.U2)((0,n.IP)(i.prototype),"registerPlugin",this).call(this,t,e,r);return this._children.push(o),o}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(t){if(!!this.root)return this.root.querySelector(t)}},{key:"bind",value:function(t,e,n){var r=this;if(arguments.length<3&&"function"==typeof e)Array.isArray(t)?t.forEach(function(t){r.bindEL(t,e)}):this.bindEL(t,e);else{var o=i.delegate.call(this,this.root,t,e,n);this.__delegates=this.__delegates.concat(o)}}},{key:"unbind",value:function(t,e){var i=this;if(arguments.length<3&&"function"==typeof e)Array.isArray(t)?t.forEach(function(t){i.unbindEL(t,e)}):this.unbindEL(t,e);else{for(var n="".concat(t,"_").concat(e),r=0;r<this.__delegates.length;r++)if(this.__delegates[r].key===n){this.__delegates[r].destroy(),this.__delegates.splice(r,1);break}}}},{key:"setStyle",value:function(t,e){var i=this;if(!!this.root){if("String"===r.Z.typeOf(t))return this.root.style[t]=e;"Object"===r.Z.typeOf(t)&&Object.keys(t).map(function(e){i.root.style[e]=t[e]})}}},{key:"setAttr",value:function(t,e){var i=this;if(!!this.root){if("String"===r.Z.typeOf(t))return this.root.setAttribute(t,e);"Object"===r.Z.typeOf(t)&&Object.keys(t).map(function(e){i.root.setAttribute(e,t[e])})}}},{key:"setHtml",value:function(t,e){if(!!this.root)this.root.innerHTML=t,"function"==typeof e&&e()}},{key:"bindEL",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!!this.root)"on".concat(t) in this.root&&"function"==typeof e&&this.root.addEventListener(t,e,i)}},{key:"unbindEL",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!!this.root)"on".concat(t) in this.root&&"function"==typeof e&&this.root.removeEventListener(t,e,i)}},{key:"show",value:function(t){if(!!this.root){if(this.root.style.display=void 0!==t?t:"block","none"===window.getComputedStyle(this.root,null).getPropertyValue("display"))return this.root.style.display="block"}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(t,e){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!e||!(e instanceof window.Element))return null;try{if("string"==typeof t)return this.find(t).appendChild(e);return t.appendChild(e)}catch(t){return o.Z.logError("Plugin:appendChild",t),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var t=this,e=this.player;this.__delegates.map(function(t){t.destroy()}),this.__delegates=[],this._children instanceof Array&&(this._children.map(function(t){e.unRegisterPlugin(t.pluginName)}),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),(0,n.U2)((0,n.IP)(i.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map(function(e){t[e]=null})}}],[{key:"insert",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e.children.length,r=Number(i),o=t instanceof window.Node;if(!n)return o?e.appendChild(t):e.insertAdjacentHTML("beforeend",t),e.children[e.children.length-1];for(var a=0,s=null,c="";a<n;a++){var l=Number((s=e.children[a]).getAttribute("data-index"));if(l>=r){c="beforebegin";break}l<r&&(c="afterend")}return o?"afterend"===c?e.appendChild(t):e.insertBefore(t,s):s.insertAdjacentHTML(c,t),"afterend"===c?e.children[e.children.length-1]:e.children[a]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(t,e,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=[];if(t instanceof window.Node&&"function"==typeof n){if(Array.isArray(i))i.forEach(function(i){var a=(0,l.Z)(t,e,i,n,r);a.key="".concat(e,"_").concat(i),o.push(a)});else{var a=(0,l.Z)(t,e,i,n,r);a.key="".concat(e,"_").concat(i),o.push(a)}}return o}},{key:"ROOT_TYPES",get:function(){return u}},{key:"POSITIONS",get:function(){return h}}]),i}(c)},567678:function(t,e,i){"use strict";function n(){n=function(){return t};var t={},e=Object.prototype,i=e.hasOwnProperty,r=Object.defineProperty||function(t,e,i){t[e]=i.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(t,e,i){return Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,i){return t[e]=i}}function u(t,e,i,n){var o=Object.create((e&&e.prototype instanceof d?e:d).prototype);return r(o,"_invoke",{value:w(t,i,new A(n||[]))}),o}function h(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function d(){}function p(){}function g(){}var y={};l(y,a,function(){return this});var _=Object.getPrototypeOf,v=_&&_(_(O([])));v&&v!==e&&i.call(v,a)&&(y=v);var m=g.prototype=d.prototype=Object.create(y);function b(t){["next","throw","return"].forEach(function(e){l(t,e,function(t){return this._invoke(e,t)})})}function E(t,e){var n;function o(n,r,a,s){var c=h(t[n],t,r);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&i.call(u,"__await")?e.resolve(u.__await).then(function(t){o("next",t,a,s)},function(t){o("throw",t,a,s)}):e.resolve(u).then(function(t){l.value=t,a(l)},function(t){return o("throw",t,a,s)})}s(c.arg)}r(this,"_invoke",{value:function(t,i){function r(){return new e(function(e,n){o(t,i,e,n)})}return n=n?n.then(r,r):r()}})}function w(t,e,i){var n="suspendedStart";return function(r,o){if("executing"===n)throw Error("Generator is already running");if("completed"===n){if("throw"===r)throw o;return P()}for(i.method=r,i.arg=o;;){var a=i.delegate;if(a){var s=k(a,i);if(s){if(s===f)continue;return s}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===n)throw n="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);n="executing";var c=h(t,e,i);if("normal"===c.type){if(n=i.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:i.done}}"throw"===c.type&&(n="completed",i.method="throw",i.arg=c.arg)}}}function k(t,e){var i=e.method,n=t.iterator[i];if(void 0===n)return e.delegate=null,"throw"===i&&t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method)||"return"!==i&&(e.method="throw",e.arg=TypeError("The iterator does not provide a '"+i+"' method")),f;var r=h(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,f;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,f):o:(e.method="throw",e.arg=TypeError("iterator result is not an object"),e.delegate=null,f)}function S(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function T(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(S,this),this.reset(!0)}function O(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return p.prototype=g,r(m,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:p,configurable:!0}),p.displayName=l(g,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,c,"GeneratorFunction")),t.prototype=Object.create(m),t},t.awrap=function(t){return{__await:t}},b(E.prototype),l(E.prototype,s,function(){return this}),t.AsyncIterator=E,t.async=function(e,i,n,r,o){void 0===o&&(o=Promise);var a=new E(u(e,i,n,r),o);return t.isGeneratorFunction(i)?a:a.next().then(function(t){return t.done?t.value:a.next()})},b(m),l(m,c,"Generator"),l(m,a,function(){return this}),l(m,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=Object(t),i=[];for(var n in e)i.push(n);return i.reverse(),function t(){for(;i.length;){var n=i.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=O,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(i,n){return a.type="throw",a.arg=t,e.next=i,n&&(e.method="next",e.arg=void 0),!!n}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),T(i),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;T(i)}return r}}throw Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:O(t),resultName:e,nextLoc:i},"next"===this.method&&(this.arg=void 0),f}},t}function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e,i,n,r,o,a){try{var s=t[o](a),c=s.value}catch(t){i(t);return}s.done?e(c):Promise.resolve(c).then(n,r)}function a(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var a=t.apply(e,i);function s(t){o(a,n,r,s,c,"next",t)}function c(t){o(a,n,r,s,c,"throw",t)}s(void 0)})}}function s(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,E(n.key),n)}}function l(t,e,i){return e&&c(t.prototype,e),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e,i){return(e=E(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function d(t,e){return(d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function p(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function g(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function y(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return g(t)}function _(t){var e=p();return function(){var i,n=f(t);return i=e?Reflect.construct(n,arguments,f(this).constructor):n.apply(this,arguments),y(this,i)}}function v(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=f(t)););return t}function m(){return(m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=v(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}function b(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function E(t){var e=b(t,"string");return"symbol"==typeof e?e:String(e)}i.d(e,{Ac:function(){return r},IP:function(){return f},PA:function(){return s},U2:function(){return m},WY:function(){return _},XW:function(){return h},_x:function(){return u},l5:function(){return n},qH:function(){return l},x:function(){return a}})},569550:function(t,e,i){"use strict";i.d(e,{Z:function(){return r}});var n=i(567678),r=function(){function t(e){if((0,n.PA)(this,t),(0,n._x)(this,"_bytesAvailable",void 0),(0,n._x)(this,"_bitsAvailable",0),(0,n._x)(this,"_word",0),!e)throw Error("ExpGolomb data params is required");this._data=e,this._bytesAvailable=e.byteLength,this._bytesAvailable&&this._loadWord()}return(0,n.qH)(t,[{key:"_loadWord",value:function(){var t=this._data.byteLength-this._bytesAvailable,e=Math.min(4,this._bytesAvailable);if(0===e)throw Error("No bytes available");var i=new Uint8Array(4);i.set(this._data.subarray(t,t+e)),this._word=new DataView(i.buffer).getUint32(0),this._bitsAvailable=8*e,this._bytesAvailable-=e}},{key:"bitsPos",value:function(){return 8*this._bytesAvailable-this._bitsAvailable}},{key:"bitsLeft",value:function(){return 8*this._data.length-this.bitsPos()}},{key:"byteAligned",value:function(){return 0===this.bitsPos()||this.bitsPos()%8==0}},{key:"skipBits",value:function(t){if(this._bitsAvailable>t)this._word<<=t,this._bitsAvailable-=t;else{var e=Math.floor((t-=this._bitsAvailable)/8);t-=8*e,this._bytesAvailable-=e,this._loadWord(),this._word<<=t,this._bitsAvailable-=t}}},{key:"readBits",value:function(t){if(t>32)throw Error("Cannot read more than 32 bits");var e=Math.min(this._bitsAvailable,t),i=this._word>>>32-e;return(this._bitsAvailable-=e,this._bitsAvailable>0?this._word<<=e:this._bytesAvailable>0&&this._loadWord(),(e=t-e)>0&&this._bitsAvailable)?i<<e|this.readBits(e):i}},{key:"skipLZ",value:function(){var t;for(t=0;t<this._bitsAvailable;++t)if((this._word&2147483648>>>t)!=0)return this._word<<=t,this._bitsAvailable-=t,t;return this._loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"skipScalingList",value:function(t){for(var e=8,i=8,n=0;n<t;n++)0!==i&&(i=(e+this.readEG()+256)%256),e=0===i?e:i}}]),t}()},737614:function(t,e,i){"use strict";i.d(e,{Z:function(){return h}});var n=i(567678),r=i(237308),o=i(967989),a=i(53985),s=i(779148),c=i(872536),l=s.Z.DEMUX_EVENTS,u=r.Z.EVENTS,h=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};(0,n.PA)(this,t),this.TAG="FLV_DEMUXER",this._cfg=e,this._firstFragmentLoaded=!1,this._trackNum=0,this._hasScript=!1,this._videoMetaChange=!1,this._audioMetaChange=!1,this._hasVideoSequence=!1,this._hasAudioSequence=!1,this._onMetaData=null,this.awManager=new c.Z,this.keyStr=e.keyStr||t.keyStr,this.demuxer=new r.Z(this.awManager)}return(0,n.qH)(t,[{key:"keyStr",set:function(t){t&&this.awManager.descryptKey(t)}},{key:"init",value:function(){this.on(l.DEMUX_START,this.demux.bind(this)),this.demuxer.on(u.FILE_HEADER_PARSED,this.handleFileHeaderParsed.bind(this)),this.demuxer.on(u.SCRIPT_TAG_PARSED,this.handleScriptTagParsed.bind(this)),this.demuxer.on(u.AUDIO_META_PARSED,this.handleAudioMetaParsed.bind(this)),this.demuxer.on(u.VIDEO_META_PARSED,this.handleVideoMetaParsed.bind(this)),this.demuxer.on(u.VIDEO_SAMPLE_PARSED,this.handleVideoSampleParsed.bind(this)),this.demuxer.on(u.AUDIO_SAMPLE_PARSED,this.handleAudioSampleParsed.bind(this)),this.demuxer.on(u.VIDEO_SEI_PARSED,this.handleSeiParsed.bind(this))}},{key:"handleAudioMetaParsed",value:function(t){if(!this._cfg.onlyVideo){if(!!this.tracks&&!!this.tracks.audioTrack){if(this._context.mediaInfo.hasAudio=!0,this.tracks.audioTrack.meta=t,this.tracks.audioTrack.hasSpecificConfig=!0,!t.channelCount){this._context.mediaInfo.hasAudio=!1;return}this._hasAudioSequence?this.emit(l.AUDIO_METADATA_CHANGE,"audio"):this.emit(l.METADATA_PARSED,"audio")}}}},{key:"handleVideoMetaParsed",value:function(t){if(!this._cfg.onlyAudio)this.tracks&&this.tracks.videoTrack&&(this._onMetaData&&this._onMetaData.framerate&&t.frameRate&&(t.frameRate.fps=this._onMetaData.framerate),this._context.mediaInfo.hasVideo=!0,this.tracks.videoTrack.meta=t,this.tracks.videoTrack.hasSpecificConfig=!0,this._hasVideoSequence?this.emit(l.VIDEO_METADATA_CHANGE,"video"):(this.emit(l.METADATA_PARSED,"video"),this._hasVideoSequence=!0))}},{key:"handleSeiParsed",value:function(t){this.emit(l.SEI_PARSED,t)}},{key:"handleVideoSampleParsed",value:function(t){if(!this._cfg.onlyAudio)this.tracks&&this.tracks.videoTrack&&(t.isKeyframe&&this.emit(l.ISKEYFRAME,t.dts+t.cts,t.cts),this.tracks.videoTrack.samples.push(t))}},{key:"handleAudioSampleParsed",value:function(t){var e;if(!this._cfg.onlyVideo){if(!this.tracks||!this.tracks.audioTrack||!(null!==(e=this.tracks.audioTrack)&&void 0!==e&&e.meta.channelCount))return;this.tracks.audioTrack.samples.push(t)}}},{key:"handleScriptTagParsed",value:function(t){if(t){this._onMetaData=t;var e=this.tracks,i=e.videoTrack,n=e.audioTrack;if(this._context.mediaInfo.duration=t.duration,"boolean"==typeof t.hasAudio&&(this._context.mediaInfo.hsaAudio=!this._cfg.onlyVideo&&t.hasAudio),"boolean"==typeof t.hasVideo&&(this._context.mediaInfo.hasVideo=!this._cfg.onlyAudio&&t.hasVideo),this.emit(l.MEDIA_INFO),this._hasScript=!0,n&&!n.hasSpecificConfig){var r=n.meta;switch(t.audiosamplerate&&(r.sampleRate=t.audiosamplerate),t.audiochannels&&(r.channelCount=t.audiochannels),t.audiosamplerate){case 44100:r.sampleRateIndex=4;break;case 22050:r.sampleRateIndex=7;break;case 11025:r.sampleRateIndex=10}}if(i&&!i.hasSpecificConfig){var o=i.meta;if("number"==typeof t.framerate){var a=Math.floor(1e3*t.framerate);if(a>0){var s=a/1e3;!o.frameRate&&(o.frameRate={}),o.frameRate.fixed=!0,o.frameRate.fps=s,o.frameRate.fps_num=a,o.frameRate.fps_den=1e3}}}}}},{key:"handleFileHeaderParsed",value:function(t){var e=t.hasVideo,i=t.hasAudio;this._context.mediaInfo.hasVideo=!this._cfg.onlyAudio&&e,this._context.mediaInfo.hasAudio=!this._cfg.onlyVideo&&i,this.initVideoTrack(),this.initAudioTrack()}},{key:"demux",value:function(){if(this.loaderBuffer){try{this.demuxer.demux(this.loaderBuffer)}catch(t){this.emit(l.DEMUX_ERROR,this.TAG,t);return}this.emit(l.DEMUX_COMPLETE)}}},{key:"initVideoTrack",value:function(){this._trackNum++;var t=new o.qT;t.meta=new a.l,t.id=t.meta.id=this._trackNum,this.tracks.videoTrack=t}},{key:"initAudioTrack",value:function(){this._trackNum++;var t=new o.WP;t.meta=new a.h,t.id=t.meta.id=this._trackNum,this.tracks.audioTrack=t}},{key:"loaderBuffer",get:function(){var t=this._context.getInstance("LOADER_BUFFER");if(t)return t;this.emit(l.DEMUX_ERROR,this.TAG,Error("no found loaderBuffer"))}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"logger",get:function(){return this._context.getInstance("LOGGER")}},{key:"destroy",value:function(){this.demuxer&&this.demuxer.destroy()}}],[{key:"getPlayType",value:function(t){var e={hasVideo:!1,hasAudio:!1};return!0&t&&(e.hasVideo=!0),!0&t&&(e.hasAudio=!0),e}}]),t}()},827095:function(t,e,i){"use strict";i.d(e,{Z:function(){return c}});var n=i(567678),r=i(75508),o=i(569550),a=r.Z,s=function(){function t(e){(0,n.PA)(this,t),this._buffer=e,this._offset=0,this._heldBits=0,this._numHeldBits=0}return(0,n.qH)(t,[{key:"readUint8",value:function(){return this._buffer[this._offset++]}},{key:"readUint16",value:function(){return this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint32",value:function(){return this._buffer[this._offset++]<<24|this._buffer[this._offset++]<<16|this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint8Array",value:function(t){var e=this._buffer.slice(this._offset,this._offset+t);return this._offset+=t,e}},{key:"streamRead1Bytes",value:function(){this._heldBits=this.readUint8(),this._numHeldBits=8}},{key:"streamRead2Bytes",value:function(){this._heldBits=this.readUint16(),this._numHeldBits=16}},{key:"extractBits",value:function(t){var e=this._heldBits>>this._numHeldBits-t&(1<<t)-1;return this._numHeldBits-=t,e}}]),t}(),c=function(){function t(){(0,n.PA)(this,t)}return(0,n.qH)(t,null,[{key:"parseVVCDecoderConfigurationRecord",value:function(e){var i,n,r,o,a,c,l,u,h=new s(e);h.streamRead1Bytes(),h.extractBits(5);var f=h.extractBits(2)+1,d=h.extractBits(1),p={};d&&(h.streamRead2Bytes(),i=h.extractBits(9),n=h.extractBits(3),r=h.extractBits(2),o=h.extractBits(2),h.streamRead1Bytes(),a=h.extractBits(3),h.extractBits(5),p=t.parseVVCPTLRecord(h,n),c=h.readUint16(),l=h.readUint16(),u=h.readUint16());for(var g=12,y=13,_=h.readUint8(),v=[],m=[],b=[],E=null,w=0;w<_;w++){h.streamRead1Bytes(),h.extractBits(1),h.extractBits(2);var k=h.extractBits(5),S=1;k!==y&&k!==g&&(S=h.readUint16());for(var T=0;T<S;T++){var A=h.readUint16();switch(k){case 14:v.push(h.readUint8Array(A));break;case 15:var O=h.readUint8Array(A);!E&&(E=t.parseSPS(t.removeEPB(O))),m.push(O);break;case 16:b.push(h.readUint8Array(A))}}}return{vvcC:e,nalUnitSize:f,ptlPresentFlag:d,olsIdx:i,numSublayers:n,constantFrameRate:r,chromaFormatIdc:o,bitDepthLumaMinus8:a,ptlRecord:p,maxPictrueWidth:c,maxPictureHeight:l,avgFrameRate:u,numOfArrays:_,vpsArr:v,spsArr:m,ppsArr:b,spsParsed:E}}},{key:"parseVVCPTLRecord",value:function(t,e){t.streamRead2Bytes(),t.extractBits(2);var i=t.extractBits(6),n=t.extractBits(7),r=t.extractBits(1),o=t.readUint8();t.streamRead1Bytes();var a=t.extractBits(1),s=t.extractBits(1),c=new Uint8Array(i);if(i){for(var l=0;l<i-1;l++){var u=t.extractBits(6);t.streamRead1Bytes();var h=t.extractBits(2);c[l]=u<<2|h}c[i-1]=t.extractBits(6)}else t.extractBits(6);var f=[];if(e>1){t.streamRead1Bytes();for(var d=0,p=e-2;p>=0;--p)d|=t.extractBits(1)<<p;for(var g=e;g<=8&&e>1;++g)t.extractBits(1);for(var y=e-2;y>=0;--y)d&1<<y&&(f[y]=t.readUint8())}var _=t.readUint8(),v=[];if(_)for(var m=0;m<_;m++)v.push(t.readUint32());return{generalProfileIdc:n,generalTierFlag:r,generalLevelIdc:o,ptlFrameOnlyConstraintFlag:a,ptlMultilayerEnabledFlag:s,generalConstraintInfo:c,subLayerLevelIdc:f,generalSubProfileIdc:v,ptlNumSubProfiles:_,numBytesConstraintInfo:i}}},{key:"getAvccNals",value:function(t){for(var e=[];t.position<t.length-4;){var i=t.dataview.getInt32(t.dataview.position);if(t.length-t.position>=i){var n=t.buffer.slice(t.position,t.position+4);t.skip(4);var r=new Uint8Array(t.buffer.slice(t.position,t.position+i));t.skip(i),e.push({header:n,body:r});continue}break}return e}},{key:"analyseNal",value:function(t){var e=(248&t.body[1])>>3;switch(t.type=e,e){case 23:case 24:try{t.sei=a.parse(t.body.slice(1))}catch(t){}break;case 7:case 8:t.key=!0;break;case 14:t.vps=!0;break;case 15:t.sps=!0;break;case 16:t.pps=!0;break;case 17:t.aps=!0}}},{key:"removeEPB",value:function(t){for(var e=t.byteLength,i=[],n=1;n<e-2;)0===t[n]&&0===t[n+1]&&3===t[n+2]?(i.push(n+2),n+=2):n++;if(!i.length)return t;var r=e-i.length,o=new Uint8Array(r),a=0;for(n=0;n<r;a++,n++)a===i[0]&&(a++,i.shift()),o[n]=t[a];return o}},{key:"parseVps",value:function(){}},{key:"parseSPS",value:function(e){var i=new o.Z(e);i.readUByte(),i.readUByte(),i.skipBits(4);var n=i.readBits(4),r=i.readBits(3),a=i.readBits(2),s=420;a<=3&&(s=[0,420,422,444][a]),i.readBits(2),i.readBits(1);var c=t._parseProfileTierLevel(i,1,r);i.readBits(1),i.readBits(1)&&i.readBits(1);var l=i.readUEG();return{width:l,height:i.readUEG(),spsMaxSubLayerMinus1:r,spsVideoParameterSetId:n,chromaFormatIdc:a,chromaFormat:s,ptlInfo:c}}},{key:"_parseProfileTierLevel",value:function(e,i,n){var r,o=e.readBits(7),a=e.readBits(1),s=e.readBits(8),c=e.readBits(1),l=e.readBits(1);i&&(r=t._parseGeneralConstraintsInfo(e));for(var u=n-1,h=[],f=[],d=[],p=u;p>=0;--p)h[p]=e.readBits(1);for(;!e.byteAligned();)e.readBits(1);for(var g=u;g>=0;--g)h[g]&&(f[g]=e.readUByte());if(i){for(var y=e.readUByte(),_=0;_<y;_++)d[_]=e.readBits(32)}return{generalProfileIdc:o,generalTierFlag:a,generalLevelIdc:s,ptlFrameOnlyConstraintFlag:c,ptlMultilayerEnabledFlag:l,ptlSublayerLevelPresentFlags:h,ptlSublayerLevelIdcs:f,ptlSubProfileIdcs:d,gciInfo:r}}},{key:"_parseGeneralConstraintsInfo",value:function(t){var e=t.readBits(1);if(e){t.skipBits(71);var i=t.readBits(8);i&&t.skipBits(i)}var n=8-t.bitsPos()%8;return t.skipBits(n),{gciPresentFlag:e}}}]),t}()},308602:function(__unused_webpack_module,exports){!function(t,e){e(exports)}(0,function(exports){"use strict";function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(i),!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(Object(i)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}var device_id_key="xgplayer_device_id",user_id_key="xgplayer_user_id",getCookie=function(t){if(!document.cookie)return null;for(var e=document.cookie.split(";"),i=0,n=e.length;i<n;i++){var r=e[i];if(e[i].indexOf(t)>=0)return r.split("=")[1]||null}},genRandomID=function(t){return String(Math.floor(Math.random()*Math.pow(10,t)))},getDeviceID=function(){var t=getCookie(device_id_key);if(t)return t;var e=genRandomID(11);return document.cookie=device_id_key+"="+e+";max-age=31536000;path=/",e},getUserId=function(){var t=getCookie(user_id_key);if(t)return t;var e=genRandomID(12);return document.cookie=user_id_key+"="+e+";max-age=31536000;path=/",e},getLogId=function(){return genRandomID(12)};function getBrowser(){var t=navigator.userAgent.toLowerCase(),e={},i={IE:window.ActiveXObject||"ActiveXObject"in window,Chrome:t.indexOf("chrome")>-1&&t.indexOf("safari")>-1,Firefox:t.indexOf("firefox")>-1,Opera:t.indexOf("opera")>-1,Safari:t.indexOf("safari")>-1&&-1==t.indexOf("chrome"),Edge:t.indexOf("edge")>-1,QQBrowser:/qqbrowser/.test(t),WeixinBrowser:/MicroMessenger/i.test(t)};for(var n in i)if(i[n]){var r="";if("IE"===n)r=t.match(/(msie\s|trident.*rv:)([\w.]+)/)[2];else if("Chrome"===n){for(var o in navigator.mimeTypes)"application/360softmgrplugin"===navigator.mimeTypes[o].type&&(n="360");var a=t.match(/chrome\/([\d.]+)/);r=a?a[1]:"-1"}else if("Firefox"===n){var s=t.match(/firefox\/([\d.]+)/);r=s?s[1]:"-1"}else if("Opera"===n){var c=t.match(/opera\/([\d.]+)/);r=c?c[1]:"-1"}else if("Safari"===n){var l=t.match(/version\/([\d.]+)/);r=l?l[1]:"-1"}else if("Edge"===n){var u=t.match(/edge\/([\d.]+)/);r=u?u[1]:"-1"}else if("QQBrowser"===n){var h=t.match(/qqbrowser\/([\d.]+)/);r=h?h[1]:"-1"}e.type=n,e.versions=parseInt(r)}return e}var sniffer={get device(){return sniffer.os.isPc?"pc":"mobile"},get browser(){var t=getBrowser();return t.type+"_"+t.versions},get os(){var t=navigator.userAgent,e=(navigator.platform.toLowerCase(),/(?:Windows Phone)/.test(t)),i=/(?:SymbianOS)/.test(t)||e,n=/(?:Android)/.test(t),r=/(?:Firefox)/.test(t),o=/(?:iPad|PlayBook)/.test(t)||n&&!/(?:Mobile)/.test(t)||r&&/(?:Tablet)/.test(t),a=/(?:iPhone)/.test(t)&&!o;return{isTablet:o,isPhone:a,isAndroid:n,isPc:!(a||n||i||o),isSymbian:i,isWindowsPhone:e,isFireFox:r}},get operation_os(){var t=navigator.userAgent,e=navigator.platform.toLowerCase();return"win32"===e||"windows"===e?"windows":"mac68k"===e||"macppc"===e||"macintosh"===e||"macintel"===e?"mac":t.toLowerCase().match(/android/i)?"android":t.toLowerCase().match(/ipad|ipod|iphone/i)?"ios":String(e).indexOf("linux")>-1?"linux":void 0}},_iteratorSymbol="undefined"!=typeof Symbol?Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")):"@@iterator",_asyncIteratorSymbol="undefined"!=typeof Symbol?Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")):"@@asyncIterator";function _catch(t,e){try{var i=t()}catch(t){return e(t)}return i&&i.then?i.then(void 0,e):i}var getBatteryLevel=function(){return Promise.resolve(_catch(function(){return Promise.resolve(navigator.getBattery()).then(function(t){return t.level})},function(){return -1}))},getStorageUsage=function(){return Promise.resolve(_catch(function(){return Promise.resolve(navigator.storage.estimate()).then(function(t){return Math.round(t.usage/(t.quota+1e-4)*100)/100})},function(){return -1}))};function getCurrentTime(){return Date.now()}function getPlayFormat(t){return"string"!=typeof t?"unknown":t.indexOf(".flv")>-1?"flv":t.indexOf(".m3u8")>-1?"m3u8":t.indexOf(".mp4")>-1?"mp4":t.indexOf(".sdp")>-1?"rts":"unknown"}function getDeviceInfo(){var t={cpu_core_number:-1,memory_usage:-1,network_downlink:-1};try{t.cpu_core_number=navigator.hardwareConcurrency||-1,t.memory_usage=navigator.deviceMemory||-1,t.network_downlink=navigator.connection&&navigator.connection.downlink,null==t.network_downlink&&(t.network_downlink=-1)}catch(t){}return t}function isCodecSupport(t){return"undefined"!=typeof MediaSource?+MediaSource.isTypeSupported("video/mp4; codecs="+t):0}function getUrlQuery(t,e){if("string"==typeof t)return new URLSearchParams(t.split("?")[1]).get(e)}var firstframesKey="xg-firstframe";function cacheFirstframe(t,e){try{var i=localStorage.getItem(firstframesKey);i=i?i.split(","):Array(48).fill("0/0");var n=Math.floor(t/30),r=i[n].split("/");e&&(r[0]=+r[0]+1),r[1]=+r[1]+1,i[n]=r.join("/"),localStorage.setItem(firstframesKey,i.join(","))}catch(t){}}var pixelRatio=function(){return"undefined"==typeof window?1:devicePixelRatio||1}();function getPlayerCore(t){if(t.plugins){if(t.plugins.flvlive)return t.plugins.flvlive;if(t.plugins.hlslive)return t.plugins.hlslive;if(t.plugins.hlsvod)return t.plugins.hlsvod;if(t.plugins.hlslivemobile)return t.plugins.hlslivemobile;if(t.plugins.flvlivemobile)return t.plugins.flvlivemobile;if(t.plugins.rts)return t.plugins.rts}return t.newHls||t.newFlv||t.__core__||t.flv}function getDefaultOptions(t){return{device_id:t.device_id||getDeviceID(),user_id:t.user_id||getUserId(),error_report_stop:void 0===t.error_report_stop||!!t.error_report_stop,project_key:t.project_key||"xigua_live",product_line:t.product_line||"live",onReport:t.onReport||function(){}}}function getDefaultLog(){return{start_play:{start_play_time:0,event_key:"start_play"},first_frame:{start:0,first_frame_view:0,event_key:"first_frame",first_sei_delay:0,ntp_sync:0,ntp_delta:0,ttfb:-1,ttdb:-1,ttfb_end:0},first_frame_failed:{code:void 0,msg:"",event_key:"first_frame_failed"},stall_start:{ready_state:-1,stall_start_time:0,event_key:"stall_start"},stalling:{event_key:"stalling"},stall:{reason:0,stall_start:0,stall_end:0,ready_state:0,event_key:"stall"},play_stop:{code:0,stop_time:0,drop_percent:0,is_stream_received:0,stall_count:0,stall_time:0,retry_count:0,duration:0,stall_count_per_100sec:0,stall_time_per_100sec:0,event_key:"play_stop",dns_parse_time:-1,redirect:-1,ttfb:-1,buffered:[],is_firstframe_received:0,meta:null},playing:{index:0,stall_count:0,stall_time:0,play_time:1e4,retry_count:0,is_last:0,video_buffer_time:0,audio_buffer_time:0,speed_switch_count:0,speed_switch_info:"none",download_speed:0,decode_fps:0,render_fps:0,drop_count:0,drop_percent:0,sei_source:"",sei_delay:0,ntp_sync:0,ntp_delta:0,event_key:"playing",stop_time:0,duration:0,stall_count_per_100sec:0,stall_time_per_100sec:0},play_error:{code:void 0,info:"",event_key:"play_error"},play_low_decode:{fps:-1,decode_fps:-1,bitrate:-1,url:-1,msg:"",event_key:"play_low_decode"},play_av_unsync:{aDts:-1,vDts:-1,frameLength:-1,currentTime:-1,duration:0,event_key:"play_av_unsync"},play_loadstream:{loadstream_url:"",event_key:"play_loadstream"},play_stream_loaded:{event_key:"play_stream_loaded"},play_metadata_loaded:{metadata_type:"",event_key:"play_metadata_loaded"},play_demux_error:{msg:"",event_key:"play_demux_error"},play_stream_discontinue:{type:"",dts:-1,event_key:"play_stream_discontinue"},pause:{event_key:"pause"},play_url_change:{event_key:"play_url_change"},source_opened:{event_key:"source_opened"},source_updateend:{event_key:"source_updateend"},play_result:{event_key:"play_result",result:0,threshold:15e3,is_threshold:0,start:0},degrade:{event_key:"degrade",payload:{}},play_ended:{event_key:"play_ended"},play_chase_frame:{event_key:"play_chase_frame"},play_audio_gap:{event_key:"play_audio_gap"},play_audio_overlap:{event_key:"play_audio_overlap"},black_screen:{event_key:"black_screen"}}}function getCommonLog(t){var e=t.player;return _objectSpread2({project_key:t.project_key,live_sdk_version:getPlayerCore(e)||e.hlsOps?"2":"-1",player_sdk_version:e.version,logger_version:"0.2.8-beta.52",report_version:"5",product_line:t.product_line,user_id:t.user_id,device_id:t.device_id,uuid:t.user_unique_id||"unknown",logger_id:getLogId(),app_name:t.app_name,cdn_ip:t.cdn_ip,is_wasm:["mobile-video","live-video"].indexOf(e.config.mediaType)>-1?1:0,review_is_live:e.config.isLive?2:1,aid:t.aid,live_id:t.live_id||t.aid+"-"+t.user_id+"-"+Date.now(),is_preview:t.is_preview?1:0,codec_type:t.codec_type||"h264",width:Math.floor(e.config.width),height:Math.floor(e.config.height),browser:sniffer.browser,ua:navigator.userAgent,href:window.location.href,timestamp:0,fps:-1,logger_init_time:Date.now(),play_current_time:0,cdn_play_url:e.config.url&&e.config.url.startsWith("//")?window.location.protocol+e.config.url:e.config.url,play_format:getPlayFormat(e.config.url),decode_img_fps:-1,copy_fps:-1,performance_speed:-1,avc_fps:-1,hevc_fps:-1,cpu_score:-1,video_score:-1,bandwidth_score:-1,device_score:-1,dpr:devicePixelRatio||1,gpu_score:-1},t.ext)}function Utf8ArrayToStr(t){var e,i,n,r,o;for(e="",n=t.length,i=0;i<n;)switch((r=t[i++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:e+=String.fromCharCode(r);break;case 12:case 13:e+=String.fromCharCode((31&r)<<6|63&(o=t[i++]));break;case 14:o=t[i++],e+=String.fromCharCode((15&r)<<12|(63&o)<<6|(63&t[i++])<<0)}return e}var getResourceTiming=function(t){var e=performance.getEntriesByType("resource").filter(function(e){return e.name===t});if(e.length){var i=e[0],n=e[e.length-1];return{dns_parse_time:Number.parseInt(i.domainLookupEnd-i.domainLookupStart),redirect:Number.parseInt(i.redirectEnd-i.redirectStart),ttfb:Number.parseInt(n.responseStart-n.requestStart)}}return{dns_parse_time:-1,redirect:-1,ttfb:-1}},video_error={1:"MEDIA_ERR_ABORTED",2:"MEDIA_ERR_NETWORK",3:"MEDIA_ERR_DECODE",4:"MEDIA_ERR_SRC_NOT_SUPPORTED"},__assign=function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function __rest(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&0>e.indexOf(n)&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)0>e.indexOf(n[r])&&(i[n[r]]=t[n[r]])}return i}function __values(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}}function __read(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return a}function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}var lastEventId,Hook=function(){function t(){this._hooks={},this._cache=[],this._hooksCache={}}return t.prototype.on=function(t,e){t&&e&&"function"==typeof e&&(this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(e))},t.prototype.once=function(t,e){var i=this;t&&e&&"function"==typeof e&&this.on(t,function n(r){e(r),i.off(t,n)})},t.prototype.off=function(t,e){if(t&&this._hooks[t]&&this._hooks[t].length){if(e){var i=this._hooks[t].indexOf(e);-1!==i&&this._hooks[t].splice(i,1)}else this._hooks[t]=[]}},t.prototype.emit=function(t,e,i){i?!!t&&(-1!==this._cache.indexOf(i)?this._emit(t,e):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(t)||(this._hooksCache[i][t]=[]),this._hooksCache[i][t].push(e))):this._emit(t,e)},t.prototype._emit=function(t,e){t&&this._hooks[t]&&this._hooks[t].length&&__spread(this._hooks[t]).forEach(function(t){try{t(e)}catch(t){}})},t.prototype.set=function(t){t&&-1===this._cache.indexOf(t)&&this._cache.push(t)},t}(),isObject=function(t){return null!=t&&"[object Object]"==Object.prototype.toString.call(t)},isNumber=function(t){return"number"==typeof t&&!isNaN(t)},isString=function(t){return"string"==typeof t},isArray=function(t){return Array.isArray(t)},getIndex=(lastEventId=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return lastEventId+=1}),decrypto=function(t,e,i){if("string"==typeof t&&"number"==typeof e&&"number"==typeof i){var n,r=[],o=String.fromCharCode((i=i<=25?i:i%25)+97);n=t.split(o);for(var a=0;a<n.length;a++){var s=parseInt(n[a],i),c=String.fromCharCode(s=1*s^e);r.push(c)}return r.join("")}},decodeUrl=function(t){return decrypto(t,64,25)},beforePageUnload=function(t){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",t,!1):window.addEventListener("beforeunload",t,!1)},getIframeUrl=function(){try{return JSON.parse(atob(window.name))||void 0}catch(t){return}},loadScript=function(t,e,i){var n=document.createElement("script");n.src=t,n.onerror=function(){i(t)},n.onload=function(){e()},document.getElementsByTagName("head")[0].appendChild(n)},isSupVisChange=function(){var t=0;return["hidden","msHidden","webkitHidden"].forEach(function(e){void 0!==document[e]&&(t=1)}),t},selfAdjust=function(t,e){void 0===t&&(t=function(){}),void 0===e&&(e=1e3);var i,n=Date.now()+e;return i=window.setTimeout(function r(){var o=Date.now()-n;t(),n+=e,i=window.setTimeout(r,Math.max(0,e-o))},e),function(){window.clearTimeout(i)}},stringify=function(t,e,i){void 0===e&&(e=""),void 0===i&&(i={});var n=t;"/"===(n=n.split("#")[0].split("?")[0])[t.length-1]&&(n=n.substr(0,t.length-1)),n="/"===e[0]?n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?)(\/[.\w-]+)*\/?$/,"$1"+e):n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?(\/[.\w-]+)*?)(\/[.\w-]+)?\/?$/,"$1/"+e);var r=Object.keys(i).map(function(t){return t+"="+i[t]}).join("&");return r.length>0?n+"?"+r:n},parseURL=function(t){var e=document.createElement("a");return e.href=t,e},parseUrlQuery=function(t){var e={};try{var i=parseURL(t).search;(i=i.slice(1)).split("&").forEach(function(t){var i,n,r=t.split("=");r.length&&(i=r[0],n=r[1]);try{e[i]=decodeURIComponent(void 0===n?"":n)}catch(t){e[i]=n}})}catch(t){}return e},hashCode=function(t){for(var e=0,i=0,n=(t+="").length,r=0;r<n;r++)((e=31*e+t.charCodeAt(i++))>0x7fffffffffff||e<-140737488355328)&&(e&=0xffffffffffff);return e<0&&(e+=0x7ffffffffffff),e};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var js_cookie=createCommonjsModule(function(t,e){var i;i=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var i=arguments[t];for(var n in i)e[n]=i[n]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function r(){}function o(e,i,o){if("undefined"!=typeof document){"number"==typeof(o=t({path:"/"},r.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var a=JSON.stringify(i);/^[\{\[]/.test(a)&&(i=a)}catch(t){}i=n.write?n.write(i,e):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var c in o)o[c]&&(s+="; "+c,!0!==o[c]&&(s+="="+o[c].split(";")[0]));return document.cookie=e+"="+i+s}}function a(t,i){if("undefined"!=typeof document){for(var r={},o=document.cookie?document.cookie.split("; "):[],a=0;a<o.length;a++){var s=o[a].split("="),c=s.slice(1).join("=");i||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=e(s[0]);if(c=(n.read||n)(c,l)||e(c),i)try{c=JSON.parse(c)}catch(t){}if(r[l]=c,t===l)break}catch(t){}}return t?r[t]:r}}return r.set=o,r.get=function(t){return a(t,!1)},r.getJSON=function(t){return a(t,!0)},r.remove=function(e,i){o(e,"",t(i,{expires:-1}))},r.defaults={},r.withConverter=i,r}(function(){})},t.exports=i()}),Memory=function(){function t(){this.cache={}}return t.prototype.setItem=function(t,e){this.cache[t]=e},t.prototype.getItem=function(t){return this.cache[t]},t.prototype.removeItem=function(t){this.cache[t]=void 0},t.prototype.getCookie=function(t){this.getItem(t)},t.prototype.setCookie=function(t,e){this.setItem(t,e)},t}();function isSupportLS(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(t){return!1}}function isSupportSession(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(t){return!1}}var LOG,local={getItem:function(t){try{var e=localStorage.getItem(t),i=e;try{e&&"string"==typeof e&&(i=JSON.parse(e))}catch(t){}return i||{}}catch(t){}return{}},setItem:function(t,e){try{var i="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(t,i)}catch(t){}},removeItem:function(t){try{localStorage.removeItem(t)}catch(t){}},getCookie:function(t,e){try{return js_cookie.get(t,{domain:e||document.domain})}catch(t){return""}},setCookie:function(t,e,i,n){try{var r=n||document.domain,o=+new Date+i;js_cookie.set(t,e,{expires:new Date(o),path:"/",domain:r})}catch(t){}},isSupportLS:isSupportLS()},session={getItem:function(t){try{var e=sessionStorage.getItem(t),i=e;try{e&&"string"==typeof e&&(i=JSON.parse(e))}catch(t){}return i||{}}catch(t){}return{}},setItem:function(t,e){try{var i="string"==typeof e?e:JSON.stringify(e);sessionStorage.setItem(t,i)}catch(t){}},removeItem:function(t){try{sessionStorage.removeItem(t)}catch(t){}},getCookie:function(t){this.getItem(t)},setCookie:function(t,e){this.setItem(t,e)},isSupportSession:isSupportSession()},Storage=function(){function t(t,e){this._storage=e&&"session"===e?session:!t&&local.isSupportLS?local:new Memory}return t.prototype.getItem=function(t){return this._storage.getItem(t)},t.prototype.setItem=function(t,e){this._storage.setItem(t,e)},t.prototype.getCookie=function(t,e){return this._storage.getCookie(t,e)},t.prototype.setCookie=function(t,e,i,n){this._storage.setCookie(t,e,i,n)},t.prototype.removeItem=function(t){this._storage.removeItem(t)},t}(),UTM=function(t,e,i,n){var r=new Storage(!1),o=new Storage(!1,"session"),a=t?"_tea_utm_cache_"+t:"_tea_utm_cache",s=t?"_$utm_from_url_"+t:"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],u={ad_id:Number(e.ad_id)||void 0,campaign_id:Number(e.campaign_id)||void 0,creative_id:Number(e.creative_id)||void 0,utm_source:e.utm_source,utm_medium:e.utm_medium,utm_campaign:e.utm_campaign,utm_term:e.utm_term,utm_content:e.utm_content,tr_shareuser:e.tr_shareuser,tr_admaster:e.tr_admaster,tr_param1:e.tr_param1,tr_param2:e.tr_param2,tr_param3:e.tr_param3,tr_param4:e.tr_param4};try{var h=!1;for(var f in u)u[f]&&(-1!==l.indexOf(f)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[f]=u[f]):c[f]=u[f],h=!0);if(h)o.setItem(s,"1"),r.setCookie(a,JSON.stringify(c),n,i);else{var d=r.getCookie(a,i);d&&(c=JSON.parse(d))}o.getItem(s)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(t){return u}return c},Client=function(){function t(t,e,i){this.appid=t,this.domain=e,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}return t.prototype.init=function(){var t=window.navigator.userAgent,e=window.navigator.language,i=document.referrer,n=i?parseURL(i).hostname:"",r=parseUrlQuery(window.location.href),o=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web";this.utm=UTM(this.appid,r,this.domain,this.cookie_expire);var a=this.browser(),s=this.os();return{browser:a.browser,browser_version:a.browser_version,platform:o,os_name:s.os_name,os_version:s.os_version,userAgent:t,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:e,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},t.prototype.last=function(t,e){var i="",n="",r="",o=location.hostname,a=!1;if(t&&e&&o!==e){i=t,n=e,a=!0;var s=parseUrlQuery(t);s.keyword&&(r=s.keyword)}return{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:r,isLast:a}},t.prototype.browser=function(){var t,e,i="",n=""+parseFloat(this.appVersion),r=this.userAgent;return -1!==r.indexOf("Edge")||-1!==r.indexOf("Edg")?(i="Microsoft Edge",-1!==r.indexOf("Edge")?(t=r.indexOf("Edge"),n=r.substring(t+5)):(t=r.indexOf("Edg"),n=r.substring(t+4))):-1!==(t=r.indexOf("MSIE"))?(i="Microsoft Internet Explorer",n=r.substring(t+5)):-1!==(t=r.indexOf("Lark"))?(i="Lark",n=r.substring(t+5,t+11)):-1!==(t=r.indexOf("MetaSr"))?(i="sougoubrowser",n=r.substring(t+7,t+10)):-1!==r.indexOf("MQQBrowser")||-1!==r.indexOf("QQBrowser")?(i="qqbrowser",-1!==r.indexOf("MQQBrowser")?(t=r.indexOf("MQQBrowser"),n=r.substring(t+11,t+15)):-1!==r.indexOf("QQBrowser")&&(t=r.indexOf("QQBrowser"),n=r.substring(t+10,t+17))):-1!==r.indexOf("Chrome")?-1!==(t=r.indexOf("MicroMessenger"))?(i="weixin",n=r.substring(t+15,t+20)):-1!==(t=r.indexOf("360"))?(i="360browser",n=r.substring(r.indexOf("Chrome")+7)):-1!==r.indexOf("baidubrowser")||-1!==r.indexOf("BIDUBrowser")?(-1!==r.indexOf("baidubrowser")?(t=r.indexOf("baidubrowser"),n=r.substring(t+13,t+16)):-1!==r.indexOf("BIDUBrowser")&&(t=r.indexOf("BIDUBrowser"),n=r.substring(t+12,t+15)),i="baidubrowser"):-1!==(t=r.indexOf("xiaomi"))?-1!==r.indexOf("openlanguagexiaomi")?(i="openlanguage xiaomi",n=r.substring(t+7,t+13)):(i="xiaomi",n=r.substring(t-7,t-1)):-1!==(t=r.indexOf("TTWebView"))?(i="TTWebView",n=r.substring(t+10,t+23)):(-1!==(t=r.indexOf("Chrome"))||-1!==(t=r.indexOf("Chrome")))&&(i="Chrome",n=r.substring(t+7)):-1!==r.indexOf("Safari")?-1!==(t=r.indexOf("QQ"))?(i="qqbrowser",n=r.substring(t+10,t+16)):-1!==(t=r.indexOf("Safari"))&&(i="Safari",n=r.substring(t+7),-1!==(t=r.indexOf("Version"))&&(n=r.substring(t+8))):-1!==(t=r.indexOf("Firefox"))?(i="Firefox",n=r.substring(t+8)):-1!==(t=r.indexOf("MicroMessenger"))?(i="weixin",n=r.substring(t+15,t+20)):-1!==(t=r.indexOf("QQ"))&&(i="qqbrowser",n=r.substring(t+3,t+8)),-1!==(e=n.indexOf(";"))&&(n=n.substring(0,e)),-1!==(e=n.indexOf(" "))&&(n=n.substring(0,e)),-1!==(e=n.indexOf(")"))&&(n=n.substring(0,e)),{browser:i,browser_version:n}},t.prototype.os=function(){for(var t="",e="",i=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],n=0;n<i.length;n++){var r=i[n];if(r.r.test(this.userAgent)){"Mac OS X"===(t=r.s)&&this.isNewIpad()&&(t="iOS");break}}var o,a,s=function(t,e){var i=t.exec(e);return i&&i[1]?i[1]:""},c=function(t,e){var i=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+t+")","i").exec(e);return i?i.slice(1)[0]:""};switch(/Windows/.test(t)&&(e=s(/Windows (.*)/,t),t="windows"),t){case"Mac OS X":e=c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),t="mac";break;case"Android":(a=s(/Android ([\.\_\d]+)/,o=this.userAgent))||(a=s(/Android\/([\.\_\d]+)/,o)),e=a,t="android";break;case"iOS":e=this.isNewIpad()?c("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(e=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?e[1]+"."+e[2]+"."+(0|e[3]):"",t="ios"}return{os_name:t,os_version:e}},t.prototype.getDeviceModel=function(t){var e="";try{if("android"===t)navigator.userAgent.split(";").forEach(function(t){t.indexOf("Build/")>-1&&(e=t.slice(0,t.indexOf("Build/")))});else if("ios"===t||"mac"===t||"windows"===t){if(this.isNewIpad())e="iPad";else{var i=navigator.userAgent.replace("Mozilla/5.0 (",""),n=i.indexOf(";");e=i.slice(0,n)}}}catch(t){}return e.trim()},t.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&navigator.maxTouchPoints>1},t}();LOG={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"};var Types,e,LOG_URL=LOG,SDK_VERSION="5.0.24",VISUAL_EDITOR_RANGERS="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-editor-rangers.js",VISUAL_AB_CORE="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-core.js",VISUAL_AB_LOADER="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-loader.js",HOT_PIC_URL="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/heatmap-core",VISUAL_URL_INSPECTOR="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector",undef=void 0,date=new Date,timeZoneMin=date.getTimezoneOffset(),timezone=parseInt(""+-timeZoneMin/60,10),tz_offset=60*timeZoneMin,WEBID_URL="/webid",TOB_URL="/tobid",REPORT_URL="/list",COOKIE_EXPIRE=6048e5,ConfigManager=function(){function t(t){this.is_first_time=!0,this.configPersist=!1,this.initConfig=t;var e=new Client(t.app_id,t.cookie_domain||"",t.cookie_expire||COOKIE_EXPIRE).init(),i="__tea_cache_first_"+t.app_id;this.configKey="__tea_cache_config_"+t.app_id,this.sessionStorage=new Storage(!1,"session"),this.localStorage=new Storage(!1,"local"),t.configPersist&&(this.configPersist=!0,this.storage=1===t.configPersist?this.sessionStorage:this.localStorage);var n=this.localStorage.getItem(i);n&&1==n?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(i,"1")),this.envInfo={user:{user_unique_id:undef,user_type:undef,user_id:undef,user_is_auth:undef,user_is_login:undef,device_id:undef,web_id:undef,ip_addr_id:undef},header:{app_id:undef,app_name:undef,app_install_id:undef,install_id:undef,app_package:undef,app_channel:undef,app_version:undef,os_name:e.os_name,os_version:e.os_version,device_model:e.device_model,ab_client:undef,traffic_type:undef,client_ip:undef,device_brand:undef,os_api:undef,access:undef,language:e.language,region:undef,app_language:undef,app_region:undef,ab_version:undef,creative_id:e.utm.creative_id,ad_id:e.utm.ad_id,campaign_id:e.utm.campaign_id,log_type:undef,rnd:undef,platform:e.platform,sdk_version:SDK_VERSION,sdk_lib:"js",province:undef,city:undef,timezone:timezone,tz_offset:tz_offset,tz_name:undef,sim_region:undef,carrier:undef,resolution:e.screen_width+"x"+e.screen_height,browser:e.browser,browser_version:e.browser_version,referrer:e.referrer,referrer_host:e.referrer_host,width:e.screen_width,height:e.screen_height,screen_width:e.screen_width,screen_height:e.screen_height,utm_term:e.utm.utm_term,utm_content:e.utm.utm_content,utm_source:e.utm.utm_source,utm_medium:e.utm.utm_medium,utm_campaign:e.utm.utm_campaign,tracer_data:JSON.stringify(e.utm.tracer_data),custom:{},wechat_unionid:undef,wechat_openid:undef}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return t.prototype.initDomain=function(){this.domain=this.initConfig.channel_domain||decodeUrl(LOG_URL[this.initConfig.channel])},t.prototype.setDomain=function(t){this.domain=t},t.prototype.getDomain=function(){return this.domain},t.prototype.setAbVersion=function(t){this.ab_version=t},t.prototype.getAbVersion=function(){return this.ab_version},t.prototype.getUrl=function(t){var e="";switch(t){case"event":e=this.initConfig.report_url||REPORT_URL;break;case"webid":e=WEBID_URL;break;case"tobid":e=TOB_URL}var i="";return this.initConfig.caller&&(i="?sdk_version="+SDK_VERSION+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+e+i},t.prototype.set=function(t){var e=this;Object.keys(t).forEach(function(i){if(null!=t[i]||e.delete(i),"evtParams"===i)e.evtParams=__assign({},e.evtParams||{},t.evtParams||{});else if("_staging_flag"===i)e.evtParams=__assign({},e.evtParams||{},{_staging_flag:t._staging_flag});else if("reportErrorCallback"===i&&"function"==typeof t[i])e.reportErrorCallback=t[i];else{var n="",r="";if(i.indexOf(".")>-1){var o=i.split(".");n=o[0],r=o[1]}n?"user"===n||"header"===n?e.envInfo[n][r]=t[i]:e.envInfo.header.custom[r]=t[i]:e.envInfo.user.hasOwnProperty(i)?["user_type","ip_addr_id"].indexOf(i)>-1?e.envInfo.user[i]=t[i]?Number(t[i]):t[i]:["user_id","web_id","user_unique_id"].indexOf(i)>-1?e.envInfo.user[i]=t[i]?String(t[i]):t[i]:["user_is_auth","user_is_login"].indexOf(i)>-1?e.envInfo.user[i]=!!t[i]:"device_id"===i&&(e.envInfo.user[i]=t[i]):e.envInfo.header.hasOwnProperty(i)?e.envInfo.header[i]=t[i]:e.envInfo.header.custom[i]=t[i]}})},t.prototype.get=function(t){try{return t?"evtParams"===t?this.evtParams:"reportErrorCallback"===t?this[t]:this.envInfo.user.hasOwnProperty(t)?this.envInfo.user[t]:this.envInfo.header.hasOwnProperty(t)?this.envInfo.header[t]:JSON.parse(JSON.stringify(this.envInfo[t])):JSON.parse(JSON.stringify(this.envInfo))}catch(t){}},t.prototype.setStore=function(t){try{if(!this.configPersist)return;var e=this.storage.getItem(this.configKey)||{};if(e&&Object.keys(t).length){var i=Object.assign(t,e);this.storage.setItem(this.configKey,i)}}catch(t){}},t.prototype.getStore=function(){try{if(!this.configPersist)return null;var t=this.storage.getItem(this.configKey);return t&&Object.keys(t).length?t:null}catch(t){return null}},t.prototype.delete=function(t){try{if(!this.configPersist)return;var e=this.storage.getItem(this.configKey);e&&e.hasOwnProperty(t)&&(delete e[t],this.storage.setItem(this.configKey,e))}catch(t){}},t}(),Logger=function(){function t(t,e){this.isLog=e||!1,this.name=t||""}return t.prototype.info=function(t){this.isLog},t.prototype.warn=function(t){this.isLog},t.prototype.error=function(t){this.isLog},t.prototype.throw=function(t){throw this.error(this.name),Error(t)},t}();e=Types||(Types={}),e.Init="init",e.Config="config",e.Start="start",e.Ready="ready",e.TokenComplete="token-complete",e.TokenStorage="token-storage",e.TokenFetch="token-fetch",e.TokenError="token-error",e.ConfigUuid="config-uuid",e.ConfigWebId="config-webid",e.ConfigDomain="config-domain",e.CustomWebId="custom-webid",e.TokenChange="token-change",e.TokenReset="token-reset",e.ConfigTransform="config-transform",e.EnvTransform="env-transform",e.SessionReset="session-reset",e.SessionResetTime="session-reset-time",e.Event="event",e.Events="events",e.EventNow="event-now",e.CleanEvents="clean-events",e.BeconEvent="becon-event",e.SubmitBefore="submit-before",e.SubmitScuess="submit-scuess",e.SubmitAfter="submit-after",e.SubmitError="submit-error",e.SubmitVerify="submit-verify",e.Stay="stay",e.ResetStay="reset-stay",e.StayReady="stay-ready",e.SetStay="set-stay",e.RouteChange="route-change",e.RouteReady="route-ready",e.Ab="ab",e.AbVar="ab-var",e.AbAllVars="ab-all-vars",e.AbConfig="ab-config",e.AbExternalVersion="ab-external-version",e.AbVersionChangeOn="ab-version-change-on",e.AbVersionChangeOff="ab-version-change-off",e.AbOpenLayer="ab-open-layer",e.AbCloseLayer="ab-close-layer",e.AbReady="ab-ready",e.AbComplete="ab-complete",e.Profile="profile",e.ProfileSet="profile-set",e.ProfileSetOnce="profile-set-once",e.ProfileUnset="profile-unset",e.ProfileIncrement="profile-increment",e.ProfileAppend="profile-append",e.ProfileClear="profile-clear",e.Autotrack="autotrack",e.AutotrackReady="autotrack-ready",e.CepReady="cep-ready",e.TracerReady="tracer-ready";var Types$1=Types,AppBridge=function(){function t(t){this.native=t}var e=t.prototype;return e.bridgeInject=function(){try{return!!this.native&&!!AppLogBridge}catch(t){return!1}},e.bridgeReady=function(){var t=this;return new Promise(function(e,i){try{t.bridgeInject()?AppLogBridge.hasStarted(function(t){t?e(!0):i(!1)}):i(!1)}catch(t){i(!1)}})},e.setConfig=function(t){var e=this;try{Object.keys(t).forEach(function(i){"user_unique_id"===i?e.setUserUniqueId(t[i]):config[i]?e.addHeaderInfo(i,t[i]):e.removeHeaderInfo(i)})}catch(t){}},e.setUserUniqueId=function(t){try{AppLogBridge.setUserUniqueId(t)}catch(t){}},e.addHeaderInfo=function(t,e){try{AppLogBridge.addHeaderInfo(t,e)}catch(t){}},e.setHeaderInfo=function(t){try{AppLogBridge.setHeaderInfo(JSON.stringify(t))}catch(t){}},e.removeHeaderInfo=function(t){try{AppLogBridge.removeHeaderInfo(t)}catch(t){}},e.reportPv=function(t){this.onEventV3("predefine_pageview",t)},e.onEventV3=function(t,e){try{AppLogBridge.onEventV3(t,e)}catch(t){}},e.profileSet=function(t){try{AppLogBridge.profileSet(t)}catch(t){}},e.profileSetOnce=function(t){try{AppLogBridge.profileSetOnce(t)}catch(t){}},e.profileIncrement=function(t){try{AppLogBridge.profileIncrement(t)}catch(t){}},e.profileUnset=function(t){try{AppLogBridge.profileUnset(t)}catch(t){}},e.profileAppend=function(t){try{AppLogBridge.profileAppend(t)}catch(t){}},t}(),ERROR={XHR_ON:500,TIMEOUT:5005};function fetch$1(t,e,i,n,r,o,a,s){try{var c=new XMLHttpRequest;c.open(s||"POST",""+t,!0),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),a&&c.setRequestHeader("X-MCS-AppKey",""+a),n&&(c.withCredentials=!0),c.onload=function(){if(r){var t=null;if(c.responseText){try{t=JSON.parse(c.responseText)}catch(e){t={}}r(t,e)}}},i&&(c.timeout=i,c.ontimeout=function(){o&&o(e,ERROR.TIMEOUT)}),c.onerror=function(){c.abort(),o&&o(e,ERROR.XHR_ON)},c.send(JSON.stringify(e))}catch(t){}}var GIF_URL="/gif",ERROR$1={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003},isSupportBeacon=function(){return!(!window.navigator||!window.navigator.sendBeacon)},encodePayload=function(t){var e="";for(var i in t)t.hasOwnProperty(i)&&void 0!==t[i]&&(e+="&"+i+"="+encodeURIComponent(JSON.stringify(t[i])));return"&"===e[0]?e.slice(1):e},sendByImg=function(t,e,i,n){try{var r,o=t.match(/\/v\d\//);r=o?o[0]:-1!==t.indexOf("/v1/")?"/v1/":"/v2/";var a=t.split(r)[0];if(!a)return void n(t,e,ERROR$1.NO_URL);e.forEach(function(r){var o=encodePayload(r),s=new Image(1,1);s.onload=function(){s=null,i&&i()},s.onerror=function(){s=null,n&&n(t,e,ERROR$1.IMG_ON)},s.src=""+a+GIF_URL+"?"+o})}catch(i){n&&n(t,e,ERROR$1.IMG_CATCH,i.message)}},request=function(t,e,i,n,r,o,a){var s=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===s.indexOf("MSIE 8.0")&&-1===s.indexOf("MSIE 9.0")){if(a)return isSupportBeacon()?void(window.navigator.sendBeacon(t,JSON.stringify(e))?r():o(t,e,ERROR$1.BEACON_FALSE)):void sendByImg(t,e,r,o)}else sendByImg(t,e,r,o);fetch$1(t,e,i,n,r,o)},Event$1=function(){function t(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.config=e,this.configManager=t.configManager,this.cacheStorgae=new Storage(!0),this.localStorage=new Storage(!1),this.maxReport=e.max_report||10,this.reportTime=e.reportTime||30,this.timeout=e.timeout||1e5,this.enable_ttwebid=e.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(Types$1.Ready,function(){i.reportAll(!1)}),this.collect.on(Types$1.ConfigDomain,function(){i.reportUrl=i.configManager.getUrl("event")}),this.collect.on(Types$1.Event,function(t){i.event(t)}),this.collect.on(Types$1.BeconEvent,function(t){i.beconEvent(t)}),this.collect.on(Types$1.CleanEvents,function(){i.reportAll(!1)}),this.linster()},t.prototype.linster=function(){var t=this;window.addEventListener("unload",function(){t.reportAll(!0)},!1),beforePageUnload(function(){t.reportAll(!0)}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.reportAll(!0)},!1)},t.prototype.reportAll=function(t){this.report(t),this.reportBecon()},t.prototype.event=function(t){var e=this;try{var i=__spread(t,this.cacheStorgae.getItem(this.eventKey)||[]);this.cacheStorgae.setItem(this.eventKey,i),this.reportTimeout&&clearTimeout(this.reportTimeout),i.length>=this.maxReport?this.report(!1):this.reportTimeout=setTimeout(function(){e.report(!1),e.reportTimeout=null},this.reportTime)}catch(t){}},t.prototype.beconEvent=function(t){var e=__spread(t,this.cacheStorgae.getItem(this.beconKey)||[]);this.cacheStorgae.setItem(this.beconKey,e),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(e)),!0))},t.prototype.reportBecon=function(){var t=this.cacheStorgae.getItem(this.beconKey)||[];t&&t.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},t.prototype.report=function(t){if(!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady){var e=this.cacheStorgae.getItem(this.eventKey)||[];e.length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(e,t))}},t.prototype.sliceEvent=function(t,e){if(t.length>this.eventLimit)for(var i=0;i<t.length;i+=this.eventLimit){n=t.slice(i,i+this.eventLimit);var n,r=this.split(this.merge(n));this.send(r,e)}else r=this.split(this.merge(t)),this.send(r,e)},t.prototype.merge=function(t){var e=this,i=this.configManager.get(),n=i.header,r=i.user;n.custom=JSON.stringify(n.custom);var o=this.configManager.get("evtParams"),a=JSON.parse(JSON.stringify({events:t.map(function(t){try{Object.keys(o).length&&(t.params=__assign({},o,t.params));var i=e.localStorage.getItem(e.abKey);return i&&i.uuid&&i.uuid===r.user_unique_id&&e.configManager.getAbVersion()&&(t.ab_sdk_version=e.configManager.getAbVersion()),t.session_id=e.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),t}catch(e){return t}}),user:r,header:n}));a.local_time=Math.floor(Date.now()/1e3),a.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0;var s=[];return s.push(a),s},t.prototype.split=function(t){return t.map(function(t){var e=[];return e.push(t),e})},t.prototype.send=function(t,e){var i=this;t.length&&t.forEach(function(t){try{var n=JSON.parse(JSON.stringify(t));i.config.filter&&(n=i.config.filter(n)),i.collect.eventFilter&&n&&(n=i.collect.eventFilter(n));var r=n||t;i.collect.emit(Types$1.SubmitBefore,r),i.collect.emit(Types$1.SubmitVerify,r),request(i.reportUrl,r,i.timeout,i.enable_ttwebid,function(t,e){t&&0!==t.e?i.collect.emit(Types$1.SubmitError,{type:"f_data",eventData:e,errorCode:t.e,response:t}):i.collect.emit(Types$1.SubmitScuess,{eventData:e,res:t})},function(t,e){i.configManager.get("reportErrorCallback")(t,e),i.collect.emit(Types$1.SubmitError,{type:"f_net",eventData:t,errorCode:e})},e),i.collect.emit(Types$1.SubmitAfter,r)}catch(t){}})},t}(),b=function t(e){return e?(e^16*Math.random()>>e/4).toString(10):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,t)},localWebId=function(){return b().replace(/-/g,"").slice(0,19)},Token=function(){function t(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.config=e,this.configManager=this.collect.configManager,this.storage=new Storage(!1),this.tokenKey="__tea_cache_tokens_"+e.app_id,this.enable_ttwebid=e.enable_ttwebid,this.enableCustomWebid=e.enable_custom_webid,this.collect.on(Types$1.ConfigUuid,function(t){i.setUuid(t)}),this.collect.on(Types$1.ConfigWebId,function(t){i.setWebId(t)}),this.enableCookie=e.cross_subdomain,this.expiresTime=e.cookie_expire||6048e5,this.cookieDomain=e.cookie_domain||"",this.checkStorage()},t.prototype.checkStorage=function(){var t=this;if(this.enableCookie){var e=this.storage.getCookie(this.tokenKey,this.cookieDomain);this.cacheToken=e&&"string"==typeof e?JSON.parse(e):{}}else this.cacheToken=this.storage.getItem(this.tokenKey)||{};this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(Types$1.CustomWebId,function(){t.tokenReady=!0,t.collect.emit(Types$1.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},t.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:localWebId(),user_unique_id:this.configManager.get("user_unique_id")||localWebId()}):this.remoteWebid()},t.prototype.checkEnv=function(){if(-1!==window.navigator.userAgent.indexOf("miniProgram")){var t=parseUrlQuery(window.location.href);if(t&&t.Web_ID){var e=this.configManager.get("user_unique_id");return this.complete({web_id:""+t.Web_ID,env_uuid:e}),!0}}return!1},t.prototype.remoteWebid=function(){var t=this;fetch$1(this.configManager.getUrl("webid"),{app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""},3e3,!1,function(e){e&&0===e.e?t.complete({web_id:t.configManager.get("web_id")||e.web_id,user_unique_id:t.configManager.get("user_unique_id")||e.web_id}):t.collect.emit(Types$1.TokenError)},function(){t.collect.emit(Types$1.TokenError)})},t.prototype.complete=function(t){var e=t.web_id,i=t.user_unique_id;t.timestamp=Date.now(),this.collect.configManager.set({web_id:e,user_unique_id:i}),this.setStorage(t),this.tokenReady=!0,this.collect.emit(Types$1.TokenComplete)},t.prototype.completeTtWid=function(t){var e=t.user_unique_id||"",i=this.configManager.get("user_unique_id");(i||e)&&this.configManager.set({user_unique_id:i||e}),this.setStorage(t),this.tokenReady=!0,this.collect.emit(Types$1.TokenComplete)},t.prototype.setUuid=function(t){if(t&&-1===["null","undefined","Null","None"].indexOf(t)){var e=String(t);(e!==this.configManager.get("user_unique_id")||e!==(this.cacheToken&&this.cacheToken.user_unique_id))&&(this.configManager.set({user_unique_id:e}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=e,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(Types$1.TokenChange,"uuid"),this.collect.emit(Types$1.SessionReset))}else this.clearUuid()},t.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(Types$1.TokenReset))},t.prototype.setWebId=function(t){if(t&&!this.config.enable_ttwebid){this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==t&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?t:this.cacheToken.user_unique_id,this.cacheToken.web_id=t):(this.cacheToken={},this.cacheToken.web_id=t,this.cacheToken.user_unique_id=t),this.cacheToken.timestamp=Date.now();var e=this.configManager.get("web_id"),i=this.configManager.get("user_unique_id");i&&i!==e||(this.configManager.set({user_unique_id:t}),this.collect.emit(Types$1.TokenChange,"uuid")),e!==t&&(this.configManager.set({web_id:t}),this.collect.emit(Types$1.TokenChange,"webid")),this.setStorage(this.cacheToken)}},t.prototype.setStorage=function(t){t._type_=this.enableCustomWebid?"custom":"default",delete t["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?this.storage.setCookie(this.tokenKey,t,this.expiresTime,this.cookieDomain):this.storage.setItem(this.tokenKey,t),this.cacheToken=t},t.prototype.getReady=function(){return this.tokenReady},t.prototype.getTobId=function(){var t=this,e=this.configManager.getUrl("tobid");return new Promise(function(i){fetch$1(e,{app_id:t.config.app_id,user_unique_id:t.configManager.get("user_unique_id"),web_id:t.configManager.get("web_id")},3e4,t.enable_ttwebid,function(t){i(t&&0===t.e?t.tobid:"")},function(){i("")})})},t}(),sessionId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},Session=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.storage=new Storage(!1,"session"),this.sessionKey="__tea_session_id_"+e.app_id,this.expireTime=e.expireTime||18e5,this.disableSession=e.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(Types$1.SessionReset,function(){i.resetSessionId()}),this.collect.on(Types$1.SessionResetTime,function(){i.updateSessionIdTime()}))},t.prototype.updateSessionIdTime=function(){var t=this.storage.getItem(this.sessionKey);if(t&&t.sessionId){var e=t.timestamp;Date.now()-e>this.expireTime?t={sessionId:sessionId(),timestamp:Date.now()}:t.timestamp=Date.now(),this.storage.setItem(this.sessionKey,t),this.resetExpTime()}},t.prototype.setSessionId=function(){var t=this,e=this.storage.getItem(this.sessionKey);e&&e.sessionId?e.timestamp=Date.now():e={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e),this.sessionExp=setInterval(function(){t.checkEXp()},this.expireTime)},t.prototype.getSessionId=function(){var t=this.storage.getItem(this.sessionKey);return this.disableSession?"":t&&t.sessionId?t.sessionId:""},t.prototype.resetExpTime=function(){var t=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){t.checkEXp()},this.expireTime))},t.prototype.resetSessionId=function(){var t={sessionId:sessionId(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,t)},t.prototype.checkEXp=function(){var t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&Date.now()-t.timestamp+30>=this.expireTime&&(t={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t))},t}(),AutoBase=function(t){var e=t.app_id,i=t.onTokenReady,n=LOG_URL[t.channel]+"/webid",r=new Storage(!1),o="__tea_cache_tokens_"+e,a=r.getItem(o);a&&a.web_id?i(a.web_id):request(n,{app_key:"",app_id:e,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,function(t){if(t&&0===t.e){i(t.web_id);var e={web_id:t.web_id,user_unique_id:t.web_id,timestamp:Date.now()};r.setItem(o,e)}else i("")},function(){i("")},!0)},pluginExtendList={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"}},sdk_type="base";sdk_type="full";var Collector=function(){function t(t){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=t,this.hook=new Hook,this.logger=new Logger(t),this.remotePlugin=new Map,this.Types=Types$1,this.adapters.fetch=fetch$1,this.adapters.storage=Storage}return t.usePlugin=function(e,i,n){if(i){for(var r=!1,o=0,a=t.plugins.length;o<a;o++)if(t.plugins[o].name===i){t.plugins[o].plugin=e,t.plugins[o].options=n||{},r=!0;break}r||t.plugins.push({name:i,plugin:e,options:n})}else t.plugins.push({plugin:e})},t.prototype.usePlugin=function(t,e,i){t&&("full"===sdk_type&&pluginExtendList.hasOwnProperty(t)||(e?"string"==typeof e?this.remotePlugin.get(t)||this.remotePlugin.set(t,{src:e,call:i}):this.remotePlugin.get(t)||this.remotePlugin.set(t,{instance:e}):this.remotePlugin.get(t)||this.remotePlugin.set(t,"sdk")))},t.prototype.init=function(e){var i=this;this.inited||e&&isObject(e)&&e.app_id&&isNumber(e.app_id)&&(!e.app_key||isString(e.app_key))&&(e.channel_domain||-1!==["cn","sg","va"].indexOf(e.channel)||(e.channel="cn"),this.appBridge=new AppBridge(e.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new ConfigManager(e),this.initConfig=e,this.bridgeReport||(this.configManager.set({app_id:e.app_id}),this.eventManager=new Event$1,this.tokenManager=new Token,this.sessionManager=new Session,Promise.all([new Promise(function(t){i.once(Types$1.TokenComplete,function(){t(!0)})}),new Promise(function(t){i.once(Types$1.Start,function(){t(!0)})})]).then(function(){try{t.plugins.reduce(function(t,e){var n=e.plugin,r=Object.assign(i.initConfig,e.options),o=new n;return o.apply(i,r),t.push(o),t},i.pluginInstances)}catch(t){}i.sdkReady=!0,i.emit(Types$1.Ready);try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(t){}e.disable_auto_pv&&(i.disableAutoPageView=!0),i.pageView(),i.on(Types$1.TokenChange,function(t){"webid"===t&&i.pageView()}),i.on(Types$1.TokenReset,function(){}),i.on(Types$1.RouteChange,function(t){t.init||e.disable_route_report||i.pageView()})}),this.tokenManager.apply(this,e),this.eventManager.apply(this,e),this.sessionManager.apply(this,e),this.emit(Types$1.Init)),this.inited=!0)},t.prototype.config=function(t){if(this.inited){if(t&&isObject(t)){if(this.bridgeReport)this.appBridge.setConfig(t);else{t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv);var e=__assign({},t);if(this.initConfig&&this.initConfig.configPersist){var i=this.configManager.getStore();i&&(e=Object.assign(i,t)),this.configManager.setStore(t)}var n=__rest(e,["web_id","user_unique_id"]);e.hasOwnProperty("web_id")&&this.emit(Types$1.ConfigWebId,e.web_id),e.hasOwnProperty("user_unique_id")&&this.emit(Types$1.ConfigUuid,e.user_unique_id),this.configManager.set(n)}}else this.logger.warn("config params is error, please check")}else this.logger.warn("config must be use after function init")},t.prototype.setDomain=function(t){this.configManager&&this.configManager.setDomain(t),this.emit(Types$1.ConfigDomain)},t.prototype.getConfig=function(t){return this.configManager.get(t)},t.prototype.send=function(){this.start()},t.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(Types$1.Start),this.bridgeReport&&this.pageView())},t.prototype.event=function(t,e){var i=this;try{if(this.initConfig&&this.initConfig.disable_track_event)return;var n=[];Array.isArray(t)?t.forEach(function(t){n.push(i.processEvent(t[0],t[1]||{}))}):n.push(this.processEvent(t,e)),this.bridgeReport?n.forEach(function(t){i.appBridge.onEventV3(t.event,JSON.stringify(t.params))}):n.length&&(this.emit(Types$1.Event,n),this.emit(Types$1.SessionResetTime))}catch(t){}},t.prototype.beconEvent=function(t,e){if(!this.initConfig||!this.initConfig.disable_track_event){if(Array.isArray(t));else{var i=[];i.push(this.processEvent(t,e||{})),i.length&&(this.emit(Types$1.BeconEvent,i),this.emit(Types$1.SessionResetTime))}}},t.prototype.processEvent=function(t,e){void 0===e&&(e={});try{var i=t;/^event\./.test(t)&&(i=t.slice(6));var n=e;"object"!=typeof n&&(n={}),n.profile?delete n.profile:n.event_index=getIndex();var r=void 0;return n.local_ms?(r=n.local_ms,delete n.local_ms):r=+new Date,{event:i,params:n,local_time_ms:r,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return{event:t,params:e}}},t.prototype.filterEvent=function(t){this.eventFilter=t},t.prototype.on=function(t,e){this.hook.on(t,e)},t.prototype.once=function(t,e){this.hook.once(t,e)},t.prototype.off=function(t,e){this.hook.off(t,e)},t.prototype.emit=function(t,e,i){this.hook.emit(t,e,i)},t.prototype.set=function(t){this.hook.set(t)},t.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},t.prototype.predefinePageView=function(t){void 0===t&&(t={});var e={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+this.configManager.is_first_time},i=__assign({},e,t);this.event("predefine_pageview",i)},t.prototype.clearEventCache=function(){this.emit(Types$1.CleanEvents)},t.prototype.setWebIDviaUnionID=function(t){if(t){var e=hashCode(t);this.config({web_id:""+e,wechat_unionid:t}),this.emit(Types$1.CustomWebId)}},t.prototype.setWebIDviaOpenID=function(t){if(t){var e=hashCode(t);this.config({web_id:""+e,wechat_openid:t}),this.emit(Types$1.CustomWebId)}},t.prototype.resetStayDuration=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=""),this.emit(Types$1.ResetStay,{url_path:t,title:e,url:i},Types$1.Stay)},t.prototype.resetStayParams=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=""),this.emit(Types$1.SetStay,{url_path:t,title:e,url:i},Types$1.Stay)},t.prototype.getToken=function(t,e){var i=this,n=!1,r=function(e){if(!n){n=!0;var r=i.configManager.get().user;return e&&(r.tobid=e,r["diss".split("").reverse().join("")]=e),t(__assign({},r))}},o=function(){i.tokenManager.getTobId().then(function(t){r(t)})};this.sdkReady?o():(e&&setTimeout(function(){r()},e),this.on(Types$1.Ready,function(){o()}))},t.prototype.profileSet=function(t){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(t)):this.emit(Types$1.ProfileSet,t,Types$1.Profile)},t.prototype.profileSetOnce=function(t){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(t)):this.emit(Types$1.ProfileSetOnce,t,Types$1.Profile)},t.prototype.profileIncrement=function(t){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(t)):this.emit(Types$1.ProfileIncrement,t,Types$1.Profile)},t.prototype.profileUnset=function(t){this.bridgeReport?this.appBridge.profileUnset(t):this.emit(Types$1.ProfileUnset,t,Types$1.Profile)},t.prototype.profileAppend=function(t){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(t)):this.emit(Types$1.ProfileAppend,t,Types$1.Profile)},t.prototype.setExternalAbVersion=function(t){this.emit(Types$1.AbExternalVersion,"string"==typeof t&&t?(""+t).trim():null,Types$1.Ab)},t.prototype.getVar=function(t,e,i){this.emit(Types$1.AbVar,{name:t,defaultValue:e,callback:i},Types$1.Ab)},t.prototype.getABconfig=function(t,e){this.emit(Types$1.AbConfig,{params:t,callback:e},Types$1.Ab)},t.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},t.prototype.onAbSdkVersionChange=function(t){var e=this;return this.emit(Types$1.AbVersionChangeOn,t,Types$1.Ab),function(){e.emit(Types$1.AbVersionChangeOff,t,Types$1.Ab)}},t.prototype.offAbSdkVersionChange=function(t){this.emit(Types$1.AbVersionChangeOff,t,Types$1.Ab)},t.prototype.openOverlayer=function(){this.emit(Types$1.AbOpenLayer,"",Types$1.Ab)},t.prototype.closeOverlayer=function(){this.emit(Types$1.AbCloseLayer,"",Types$1.Ab)},t.prototype.getAllVars=function(t){this.emit(Types$1.AbAllVars,t,Types$1.Ab)},t.prototype.autoInitializationRangers=function(t){AutoBase(t)},t.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(Types$1.TokenComplete))},t.plugins=[],t}(),STYLE_ID="__rangers_ab_style__";function openOverlayer(){if(!document.getElementById(STYLE_ID)){var t="body { opacity: 0 !important; }",e=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.id=STYLE_ID,i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i)}}function closeOverlayer(){var t=document.getElementById(STYLE_ID);t&&t.parentElement.removeChild(t)}var msgQueueMap={},allowdOrigins=[],addAllowdOrigin=function(t){t.length&&t.forEach(function(t){allowdOrigins.push(t)})};function dispatchMsg(t,e,i,n){var r=t&&t.source||window.opener||window.parent,o=t&&t.origin||n||"*";r.postMessage(JSON.stringify({type:e,payload:i}),o)}function receiveMsg(t,e){msgQueueMap[t]=msgQueueMap[t]||[],msgQueueMap[t].push(e)}function processMsg(t){if(allowdOrigins.some(function(t){return"*"===t})||allowdOrigins.some(function(e){return t.origin.indexOf(e)>-1})){var e=t.data;if("string"==typeof t.data)try{e=JSON.parse(t.data)}catch(t){e=void 0}if(e){var i=e.type,n=e.payload;msgQueueMap[i]&&msgQueueMap[i].forEach(function(e){"function"==typeof e&&e(t,n)})}}}function init(t,e){var i=__assign({},t);delete i.filter,(window.opener||window.parent).postMessage({type:"tea:sdk:info",copyConfig:i,version:e},"*"),window.addEventListener("message",processMsg,!1)}var VISUAL_URL="",isLoaded=!1;function loadEditorScript(t){var e=t.event;isLoaded||(isLoaded=!0,loadScript(t.editorUrl,function(){dispatchMsg(e,"abEditorScriptloadSuccess")},function(){e&&dispatchMsg(e,"abEditorScriptloadError"),isLoaded=!1}))}function readyToLoadEditor(t,e){window.TEAVisualEditor=window.TEAVisualEditor||{},addAllowdOrigin(["*"]);var i,n="";init(e,SDK_VERSION);var r="";try{var o=window.performance.getEntriesByType("resource");if(o&&o.length&&(o.forEach(function(t){"script"===t.initiatorType&&t.name&&-1!==t.name.indexOf("collect")&&(r=t.name)}),r||document.currentScript&&(r=document.currentScript.src),r&&(i=r.split("/"))&&i.length)){n="https:/";for(var a=2;a<i.length&&a!==i.length-1;a++)n=n+"/"+i[a];n+="/visual-ab-core"}}catch(t){}receiveMsg("tea:openVisualABEditor",function(i){var r=i.data;if("string"==typeof i.data)try{r=JSON.parse(i.data)}catch(t){r=void 0}if(r){var o=r.lang;if(r.appId!==e.app_id)return void dispatchMsg(i,"appIdError");var a=r.version;VISUAL_URL=a&&n?n+(a?"."+a:".1.0.1")+".js?query="+Date.now():VISUAL_AB_CORE+"?query="+Date.now(),window.TEAVisualEditor.lang=o,window.TEAVisualEditor.__ab_domin=e.channel_domain||"",loadEditorScript({event:i,editorUrl:VISUAL_URL,collectInstance:t})}})}var CallbackType,loadMuiltlink=function(t,e){window.TEAVisualEditor.appId=e.app_id,receiveMsg("tea:openTesterEventInspector",function(e){var i=e.data;if("string"==typeof e.data)try{i=JSON.parse(e.data)}catch(t){i=void 0}if(i){var n=i.lang,r=i.appId;window.TEAVisualEditor.__editor_ajax_domain=i.referrer||"",window.TEAVisualEditor.__ab_appId=r||"",window.TEAVisualEditor.lang=n||"",loadEditorScript({event:e,editorUrl:VISUAL_URL_INSPECTOR+".js?query="+Date.now(),collectInstance:t})}})},loadVisual=function(t){window.TEAVisualEditor.__ab_config=t,loadScript(VISUAL_AB_LOADER+"?query="+Date.now(),function(){},function(){})};!function(t){t[t.Var=0]="Var",t[t.All=1]="All"}(CallbackType||(CallbackType={}));var STORAGE_EXPRIRE=2592e6,API="/service/2/abtest_config/",DOMAINS={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},Ab=function(){function t(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1}return t.prototype.apply=function(t,e){var i=this;if(this.collect=t,this.config=e,this.config.enable_ab_test){var n=e.enable_multilink,r=e.enable_ab_visual,o=e.ab_channel_domain||decodeUrl(DOMAINS[e.channel||"cn"]),a=t.adapters,s=a.fetch;this.cacheStorgae=new a.storage(!1),this.fetch=s,this.enable_multilink=n,this.enable_ab_visual=r,this.abKey="__tea_sdk_ab_version_"+e.app_id,this.fetchUrl=""+o+API,this.reportUrl=""+t.configManager.getUrl("event");var c=this.collect.Types;this.types=c,this.collect.on(c.TokenChange,function(t){"uuid"===t&&i.readyStatus&&(i.clearCache(),i.fetchAB())}),this.collect.on(c.AbVar,function(t){i.getVar(t.name,t.defaultValue,t.callback)}),this.collect.on(c.AbAllVars,function(t){i.getAllVars(t)}),this.collect.on(c.AbConfig,function(t){i.getABconfig(t.params,t.callback)}),this.collect.on(c.AbExternalVersion,function(t){i.setExternalAbVersion(t)}),this.collect.on(c.AbVersionChangeOn,function(t){i.changeListener.set(t,t)}),this.collect.on(c.AbVersionChangeOff,function(t){i.changeListener.get(t)&&i.changeListener.delete(t)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(c.AbReady)}},t.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var i=this.collect.hook._hooksCache[t];if(!Object.keys(i).length)return;var n=function(t){i[t].length&&i[t].forEach(function(i){e.collect.hook.emit(t,i)})};for(var r in i)n(r)}},t.prototype.loadMode=function(){var t=getIframeUrl(),e="";if(t){var i=t.scenario,n=t.href;i?(this.editMode=!0,e=i):n&&(-1!==n.indexOf("datatester")||-1!==n.indexOf("visual-editor"))&&(this.editMode=!0,e="visual-editor")}this.enable_ab_visual&&(readyToLoadEditor(this.collect,this.config),"visual-editor"===e)?this.collect.destoryInstace():this.enable_multilink&&loadMuiltlink(this.collect,this.config)},t.prototype.checkLocal=function(){var t=this.getABCache(),e=t.ab_version,i=t.ab_ext_version,n=t.ab_version_multilink,r=t.data,o=this.checkFromUrl();o?this.mulilinkVersions.push(o):this.mulilinkVersions=n||[],this.extVersions=i||[],this.versions=e||[],this.data=r;var a=this.versions.concat(this.extVersions);this.enable_multilink&&(a=a.concat(this.mulilinkVersions)),this.configVersions(a.join(","))},t.prototype.checkFromUrl=function(){var t=parseUrlQuery(window.location.href);return t&&t.vid?t.vid:""},t.prototype.updateVersions=function(){var t=this.extVersions.length?this.versions.concat(this.extVersions):this.versions,e=t.concat(this.mulilinkVersions);this.configVersions(e.join(",")),this.updateABCache(),this.changeListener.size>0&&this.changeListener.forEach(function(e){"function"==typeof e&&e(t)})},t.prototype.configVersions=function(t){this.collect.configManager.setAbVersion(t)},t.prototype.getVar=function(t,e,i){if(!t)throw Error("variable must not be empty");if(void 0===e)throw Error("variable no default value");if("function"!=typeof i)throw Error("callback must be a function");var n={name:t,defaultValue:e,callback:i,type:CallbackType.Var};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(n,t):this.callbacks.push(n)},t.prototype.getRealVar=function(t,e){var i=t.name,n=t.defaultValue,r=t.callback,o=this.data;if(o){if(isObject(o[i])){var a=o[i].vid;return"$ab_url"===e?this.mulilinkVersions.includes(a)||this.mulilinkVersions.push(a):this.versions.includes(a)||this.versions.push(a),this.updateVersions(),this.fechEvent(a,e,n),void r(o[i].val)}r(n)}else r(n)},t.prototype.getAllVars=function(t){if("function"!=typeof t)throw Error("callback must be a function");var e={callback:t,type:CallbackType.All};"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(e):this.callbacks.push(e)},t.prototype.getRealAllVars=function(t){(0,t.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{})},t.prototype.fechEvent=function(t,e,i){var n=this;try{if(this.config.disable_track_event||!t)return;var r=this.collect.configManager.get(),o=r.header,a=r.user,s=this.getABCache();if(s&&s.uuid&&s.uuid!==a.user_unique_id)return;var c={event:"abtest_exposure",ab_sdk_version:""+t,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===e?i:window.location.href}),local_time_ms:Date.now()};o.custom=JSON.stringify(o.custom);var l={events:[c],user:a,header:o};"$ab_url"===e?window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([l])):this.fetch(this.reportUrl,[l],2e4):setTimeout(function(){n.fetch(n.reportUrl,[l],2e4)},16)}catch(t){}},t.prototype.setExternalAbVersion=function(t){this.extVersions=[t],this.updateVersions()},t.prototype.getABconfig=function(t,e){var i=Object.keys(t);i&&i.length&&this.collect.configManager.set(t),this.fetchAB(e)},t.prototype.getABCache=function(t){var e={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""};return e=this.cacheStorgae.getItem(this.abKey)||e,Date.now()-e.timestamp>=STORAGE_EXPRIRE?(this.cacheStorgae.removeItem(this.abKey),null):t?e[t]:e},t.prototype.updateABCache=function(){var t=this.getABCache();t.ab_version_multilink=this.mulilinkVersions,t.ab_ext_version=this.extVersions,t.ab_version=this.versions,t.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,t)},t.prototype.setAbCache=function(t){var e=this.getABCache();e.data=this.data,e.uuid=t,e.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,e)},t.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[]},t.prototype.openOverlayer=function(t){var e=this;if(openOverlayer(),t)var i=setTimeout(function(){e.closeOverlayer(),clearTimeout(i)},t)},t.prototype.closeOverlayer=function(){closeOverlayer()},t.prototype.fetchComplete=function(t,e){var i=this;if(t&&"[object Object]"==Object.prototype.toString.call(t)){this.data=t,this.setAbCache(e);var n=[];Object.keys(t).forEach(function(e){var i=t[e].vid;i&&n.push(i)}),this.versions=this.versions.filter(function(t){return n.includes(t)});var r=t.$ab_url,o=t.$ab_modification;if(o&&o.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,function(){loadVisual(o.val)})}else if(r&&this.enable_multilink){this.mulilinkVersions=this.mulilinkVersions.filter(function(t){return n.includes(t)});var a=r.val,s=r.vid;a&&s&&this.getVar("$ab_url",a,function(){i.editMode||a!==window.location.href&&setTimeout(function(){if(!i.collect.destroyInstance){var t=""+a;parseURL(t=-1===t.indexOf("http")?"https://"+t:t).host!==location.host&&(t=t+"&vid="+s),window.location.href=t}},100)})}this.closeOverlayer(),this.updateVersions()}this.callbacks.forEach(function(t){return i[t.type===CallbackType.Var?"getRealVar":"getRealAllVars"](t,"")}),this.callbacks=[]},t.prototype.fetchAB=function(t){var e=this,i=window.location.href,n=this.collect.configManager.get();this.fetch(this.fetchUrl,{header:__assign({aid:this.config.app_id},n.user||{},n.header||{},{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:i})},this.config.ab_timeout||3e3,!1,function(i){e.fetchStatus="complete";var r=i.data;"success"===i.message?(e.fetchComplete(r,n.user.user_unique_id),t&&t(r)):(e.fetchComplete(null,n.user.user_unique_id),t&&t(null)),e.collect.emit(e.types.AbComplete,r)},function(){e.fetchStatus="complete",e.fetchComplete(null,n.user.user_unique_id),t&&t(null),e.collect.emit(e.types.AbComplete,null)})},t.prototype.filterUrl=function(t){try{var e="";-1!==t.indexOf("&multilink=true")?e="&multilink=true[\0-\xff]*":-1!==t.indexOf("?multilink=true")&&(e="\\?multilink=true[\0-\xff]*");var i=RegExp(e,"g");t=t.replace(i,"")}catch(t){}return t},t}(),Et=function(){function t(){}return t.prototype.apply=function(t,e){var i=this,n=t.adapters.fetch;e.event_verify_url&&"string"==typeof e.event_verify_url&&(this.url=e.event_verify_url+"/v1/list_test",this.url&&t.on(t.Types.SubmitBefore,function(t){n(i.url,t,3e4)}))},t}(),Alive=function(){function t(t,e){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=t,this.config=e,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,isObject(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration))}return t.prototype.setParams=function(t,e,i){this.set_path=t,this.set_url=i,this.set_title=e},t.prototype.enable=function(t,e,i){this.url_path=t,this.url=i,this.title=e,this.disableCallback=this.enablePageAlive()},t.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},t.prototype.sendEvent=function(t){void 0===t&&(t=!1);var e=t?this.aliveDTime:Date.now()-this.sessionStartTime;e<0||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,__assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:e,is_support_visibility_change:isSupVisChange(),startTime:this.sessionStartTime},this.options.params)),this.sessionStartTime=Date.now())},t.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.setUpTimer=function(){var t=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-t.sessionStartTime>t.aliveDTime&&t.sendEvent(!0)},1e3)},t.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent()):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},t.prototype.beforeunload=function(){document.hidden||this.sendEvent()},t.prototype.enablePageAlive=function(){var t=this;this.timerHandler=this.setUpTimer();var e=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",e),beforePageUnload(i),function(){t.beforeunload(),document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},t}(),Close=function(){function t(t,e){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(t){}i.sendEventPageClose()},this.collect=t,this.config=e,this.maxDuration=e.maxDuration||864e5,this.pageStartTime=Date.now(),isObject(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration)),this.resetData()}return t.prototype.setParams=function(t,e,i){this.set_path=t,this.set_url=i,this.set_title=e},t.prototype.enable=function(t,e,i){this.url_path=t,this.url=i,this.title=e,this.disableCallback=this.enablePageClose()},t.prototype.disable=function(){this.disableCallback()},t.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0},t.prototype.sendEventPageClose=function(){var t=Date.now()-this.pageStartTime;this.totalTime<0||t<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,__assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:t,is_support_visibility_change:isSupVisChange()},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},t.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.enablePageClose=function(){var t=this,e=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",e),beforePageUnload(i),function(){t.beforeunload(),document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},t}(),Stay=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;if(this.collect=t,this.config=e,this.config.enable_stay_duration){this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new Alive(t,e),this.pageClose=new Close(t,e);var n=this.collect.Types;this.collect.on(n.ResetStay,function(t){i.resetStayDuration(t.url_path,t.title,t.url)}),this.collect.on(n.RouteChange,function(t){t.init||e.disable_route_report||i.resetStayDuration()}),this.collect.on(n.SetStay,function(t){i.setStayParmas(t.url_path,t.title,t.url)}),this.enable(this.url_path,this.title,this.url),this.ready(n.Stay),this.collect.emit(n.StayReady)}},t.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var i=this.collect.hook._hooksCache[t];if(!Object.keys(i).length)return;var n=function(t){i[t].length&&i[t].forEach(function(i){e.collect.hook.emit(t,i)})};for(var r in i)n(r)}},t.prototype.enable=function(t,e,i){this.pageAlive.enable(t,e,i),this.pageClose.enable(t,e,i)},t.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},t.prototype.setStayParmas=function(t,e,i){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=""),this.pageAlive.setParams(t,e,i),this.pageClose.setParams(t,e,i)},t.prototype.reset=function(t,e,i){this.disable(),this.enable(t,e,i)},t.prototype.resetStayDuration=function(t,e,i){this.reset(t,e,i)},t}(),Profile=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.config=e,this.duration=6e4,this.reportUrl=t.configManager.getDomain()+"/profile/list";var n=t.Types;this.fetch=t.adapters.fetch,this.cache={},this.collect.on(n.ProfileSet,function(t){i.setProfile(t)}),this.collect.on(n.ProfileSetOnce,function(t){i.setOnceProfile(t)}),this.collect.on(n.ProfileUnset,function(t){i.unsetProfile(t)}),this.collect.on(n.ProfileIncrement,function(t){i.incrementProfile(t)}),this.collect.on(n.ProfileAppend,function(t){i.appendProfile(t)}),this.collect.on(n.ProfileClear,function(){i.cache={}}),this.ready(n.Profile)},t.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var i=this.collect.hook._hooksCache[t];if(!Object.keys(i).length)return;var n=function(t){i[t].length&&i[t].forEach(function(i){e.collect.hook.emit(t,i)})};for(var r in i)n(r)}},t.prototype.report=function(t,e){void 0===e&&(e={});try{if(this.config.disable_track_event)return;var i=[];i.push(this.collect.processEvent(t,e));var n=this.collect.eventManager.merge(i);this.fetch(this.reportUrl,n)}catch(t){}},t.prototype.setProfile=function(t){var e=this.formatParams(t);e&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set",__assign({},e,{profile:!0})))},t.prototype.setOnceProfile=function(t){var e=this.formatParams(t,!0);e&&Object.keys(e).length&&(this.pushCache(e),this.report("__profile_set_once",__assign({},e,{profile:!0})))},t.prototype.incrementProfile=function(t){t&&this.report("__profile_increment",__assign({},t,{profile:!0}))},t.prototype.unsetProfile=function(t){if(t){var e={};e[t]="1",this.report("__profile_unset",__assign({},e,{profile:!0}))}},t.prototype.appendProfile=function(t){if(t){var e={};for(var i in t)("string"==typeof t[i]||"Array"===Object.prototype.toString.call(t[i]).slice(8,-1))&&(e[i]=t[i]);Object.keys(e).length&&this.report("__profile_append",__assign({},e,{profile:!0}))}},t.prototype.pushCache=function(t){var e=this;Object.keys(t).forEach(function(i){e.cache[i]={val:e.clone(t[i]),timestamp:Date.now()}})},t.prototype.formatParams=function(t,e){var i=this;void 0===e&&(e=!1);try{if(!t||"[object Object]"!==Object.prototype.toString.call(t))return;var n={};for(var r in t)("string"==typeof t[r]||"number"==typeof t[r]||"Array"===Object.prototype.toString.call(t[r]).slice(8,-1))&&(n[r]=t[r]);var o=Object.keys(n);if(!o.length)return;var a=Date.now();return o.filter(function(n){var r=i.cache[n];return e?!r:!(r&&i.compare(r.val,t[n])&&a-r.timestamp<i.duration)}).reduce(function(t,e){return t[e]=n[e],t},{})}catch(t){}},t.prototype.compare=function(t,e){try{return JSON.stringify(t)===JSON.stringify(e)}catch(t){return!1}},t.prototype.clone=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return t}},t.prototype.unReady=function(){},t}(),HeartBeat=function(){function t(){var t=this;this.setInterval=function(){t.clearIntervalFunc=selfAdjust(function(){t.isSessionhasEvent&&t.endCurrentSession()},t.sessionInterval)},this.clearInterval=function(){t.clearIntervalFunc&&t.clearIntervalFunc()}}return t.prototype.apply=function(t,e){var i=this;this.collect=t,e.disable_heartbeat||(this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval(),this.collect.on(this.collect.Types.SessionReset,function(){i.process()}))},t.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},t.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var t=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-t>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},t}(),SDK_USE_TYPE="npm",Monitor=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;if(this.collect=t,this.config=e,!(this.config.channel_domain||(this.fetch=t.adapters.fetch,e.disable_track_event||e.disable_sdk_monitor))){this.url=t.configManager.getUrl("event");var n=this.collect.Types;this.collect.on(n.Ready,function(){i.sdkOnload()}),this.collect.on(n.SubmitError,function(t){i.sdkError(t.eventData,t.errorCode)})}},t.prototype.sdkOnload=function(){var t=this;try{var e=this.collect.configManager.get(),i=e.header,n=e.user.web_id,r={events:[{event:"onload",params:JSON.stringify({app_id:i.app_id,app_name:i.app_name||"",sdk_version:i.sdk_version,sdk_type:SDK_USE_TYPE,sdk_config:this.config,sdk_desc:"TOC"}),local_time_ms:Date.now()}],user:{user_unique_id:n},header:{}};setTimeout(function(){t.fetch(t.url,[r],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(t){}},t.prototype.sdkError=function(t,e){var i=this;try{var n=t[0],r=n.user,o=n.header,a=[];t.forEach(function(t){t.events.forEach(function(t){a.push(t)})});var s={events:a.map(function(t){return{event:"on_error",params:JSON.stringify({error_code:e,app_id:o.app_id,app_name:o.app_name||"",error_event:t.event,sdk_version:o.sdk_version,local_time_ms:t.local_time_ms,tea_event_index:Date.now(),params:t.params,header:JSON.stringify(o),user:JSON.stringify(r)}),local_time_ms:Date.now()}}),user:{user_unique_id:r.user_unique_id},header:{}};setTimeout(function(){i.fetch(i.url,[s],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(t){}},t}();function isNeedElement(t,e){if(void 0===e&&(e="list"),!t)return!1;if(e&&"list"===e){if(["LI","TR","DL"].includes(t.nodeName)||t.dataset&&t.dataset.hasOwnProperty("teaIdx")||t.hasAttribute&&t.hasAttribute("data-tea-idx"))return!0}else if(["A","BUTTON"].includes(t.nodeName)||t.dataset&&t.dataset.hasOwnProperty("teaContainer")||t.hasAttribute&&t.hasAttribute("data-tea-container"))return!0;return!1}function getContainer(t){for(var e=t;e&&!isNeedElement(e,"container");){if("HTML"===e.nodeName||"BODY"===e.nodeName)return t;e=e.parentElement}return e||t}function getNodeText(t){var e="";return 3===t.nodeType?e=t.textContent.trim():t.dataset&&t.dataset.hasOwnProperty("teaTitle")||t.hasAttribute("ata-tea-title")?e=t.getAttribute("data-tea-title"):t.hasAttribute("title")?e=t.getAttribute("title"):"INPUT"===t.nodeName&&["button","submit"].includes(t.getAttribute("type"))?e=t.getAttribute("value"):"IMG"===t.nodeName&&t.getAttribute("alt")&&(e=t.getAttribute("alt")),e.slice(0,200)}function getText(t){var e=getContainer(t),i=[];return function t(e){var n=getNodeText(e);if(n&&-1===i.indexOf(n)&&i.push(n),e.childNodes.length>0)for(var r=e.childNodes,o=0;o<r.length;o++)8!==r[o].nodeType&&t(r[o])}(e),i}function getTextSingle(t){var e=getContainer(t),i="";return function t(e){var n=getNodeText(e);if(n&&(i+=n),e.childNodes.length>0)for(var r=e.childNodes,o=0;o<r.length;o++)3===r[o].nodeType&&t(r[o])}(e),i}function ignore(t){for(var e=t;e&&e.parentNode;){if(e.hasAttribute("data-tea-ignore"))return!0;if("HTML"===e.nodeName||"body"===e.nodeName)break;e=e.parentNode}return!1}var elementLevel=function(t){return!t.children.length||![].slice.call(t.children).some(function(t){return t.children.length>0})},isSVG=function(t){if("svg"===t.tagName.toLowerCase())return!0;for(var e=t.parentElement,i=!1;e;)"svg"===e.tagName.toLowerCase()?(e=null,i=!0):e=e.parentElement;return i};function isTrack(t,e){if(1!==t.nodeType||!e.svg&&isSVG(t)||["HTML","BODY"].includes(t.tagName.toUpperCase()))return!1;var i=t;return!("none"===i.style.display||!isNeedElement(i,"container")&&!elementLevel(i))}var Listener=function(){function t(t,e,i){var n=this;this.clickEvent=function(t){isTrack(t.target,n.options)&&n.eventHandel({eventType:"dom",eventName:"click"},t)},this.changeEvent=function(t){n.eventHandel({eventType:"dom",eventName:"change"},t)},this.submitEvent=function(t){n.eventHandel({eventType:"dom",eventName:"submit"},t)},this.getPageViewEvent=function(t,e){e&&"pushState"===e&&n.eventHandel({eventType:"dom",eventName:"beat"},__assign({beat_type:0},t)),n.eventHandel({eventType:"dom",eventName:"page_view"},t)},this.getPageLoadEvent=function(t){n.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:t})},this.config=i.getConfig().eventConfig,this.collect=e,this.options=t,this.beatTime=t.beat,this.statistics=!1}return t.prototype.init=function(t){this.eventHandel=t,this.addListener(this.config.mode)},t.prototype.addListener=function(t){var e=this;if("proxy-capturing"===t&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",function(t){e.getPageViewEvent(t.config,t.name)}),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){e.beatEvent(e.beatTime)});var i=0,n=null;window.addEventListener("scroll",function(){clearTimeout(n),n=setTimeout(r,500),i=document.documentElement.scrollTop||document.body.scrollTop});var r=function(){(document.documentElement.scrollTop||document.body.scrollTop)==i&&e.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})}}catch(t){}try{var o=window.performance&&window.performance.getEntriesByType("paint");o&&o.length?(new PerformanceObserver(function(t){var i=t.getEntries(),n=i[i.length-1];e.statistics||(e.getPageLoadEvent(n.renderTime||n.loadTime),e.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){e.statistics||(e.getPageLoadEvent(o[0].startTime||0),e.statistics=!0)},2e3)):this.getPageLoadEvent(0)}catch(t){this.getPageLoadEvent(0)}}},t.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},t.prototype.beatEvent=function(t){var e,i=this;try{this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(e=setInterval(function(){i.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},t)),beforePageUnload(function(){i.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),i.beatTime&&clearInterval(e)})}catch(t){}},t}(),defaultConfig={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},Config=function(){function t(t){this.config=t}return t.prototype.getConfig=function(){return this.config},t.prototype.setConfig=function(t){return this.config=t},t}();function getPositionData(t){if(t){var e=t.getBoundingClientRect();return{left:e.left,top:e.top,element_width:e.width,element_height:e.height}}}function getEventData(t,e){void 0===t&&(t={}),void 0===e&&(e={});var i=t.clientX,n=t.clientY,r=e.left,o=e.top;return{touch_x:Math.floor(i-r>=0?i-r:0),touch_y:Math.floor(n-o>=0?n-o:0)}}function getXpath(t){for(var e=[];null!==t.parentElement;)e.push(t),t=t.parentElement;var i=[],n=[];return e.forEach(function(t){var e=getXpathIndex(t),r=e.index;i.unshift(e.str),n.unshift(r)}),{element_path:"/"+i.join("/"),positions:n}}function getXpathIndex(t){if(null===t)return{str:"",index:0};var e=0,i=t.parentElement;if(i)for(var n=i.children,r=0;r<n.length&&n[r]!==t;r++)n[r].nodeName===t.nodeName&&e++;return{str:[t.nodeName.toLowerCase(),isNeedElement(t,"list")?"[]":""].join(""),index:e}}function getElementData(t,e,i){var n={element_path:"",positions:[],texts:[]},r=getPositionData(e),o=getEventData(t,r),a=r.element_width,s=r.element_height,c=o.touch_x,l=o.touch_y,u=getXpath(e),h=u.element_path,f=u.positions,d=getText(e),p=window.performance.timing.navigationStart,g=Date.now()-p,y=f.map(function(t){return""+t}),_=null;window.TEAVisualEditor.getOriginXpath&&(_=window.TEAVisualEditor.getOriginXpath({xpath:h,positions:y})),n.element_path=_&&_.xpath||h,n.positions=_&&_.positions||y,i&&!i.text&&(n.texts=d,n.element_title=getTextSingle(e)),n.element_id=e.getAttribute("id")||"",n.element_class_name=e.getAttribute("class")||"",n.element_type=e.nodeType,n.element_width=Math.floor(a),n.element_height=Math.floor(s),n.touch_x=c,n.touch_y=l,n.page_manual_key="",n.elememt_manual_key="",n.since_page_start_ms=g,n.page_start_ms=p,n.page_path=location.pathname,n.page_host=location.host;var v=getContainer(e);return"A"===v.tagName&&(n.href=v.getAttribute("href")),"IMG"===e.tagName&&(n.src=e.getAttribute("src")),n}function getEventData$1(t,e,i,n){return __assign({event:t},getElementData(e,i,n),{is_html:1,page_key:window.location.href,page_title:document.title})}function getExtraEventData(t,e){try{if("bav2b_change"===t)return e.hasAttribute("data-tea-track")?{value:e.value}:{}}catch(t){return{}}}var EventHandle=function(){function t(t,e){this.ignore={text:!0},this.initConfig=t,this.eventName=e&&"tea"===e.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics"},e&&!0===e.text&&(this.ignore.text=!1)}return t.prototype.handleEvent=function(t,e){try{if(ignore(t.target))return null;var i="bav2b_click";switch(e){case"click":return getEventData$1(i=this.eventName.click,t,t.target,this.ignore);case"change":return __assign({},getEventData$1(i="bav2b_change",t,t.target),getExtraEventData(i,t.target));case"submit":return getEventData$1(i="bav2b_submit",t,t.target)}}catch(t){return null}},t.prototype.handleViewEvent=function(t){t.event=this.eventName.page,t.page_title=document.title,t.page_total_width=window.innerWidth,t.page_total_height=window.innerHeight;try{var e=window.sessionStorage.getItem("_tea_cache_duration");if(e){var i=JSON.parse(e);t.refer_page_duration_ms=i?i.duration:"",t.refer_page_title=i?i.page_title:""}else t.refer_page_duration_ms="",t.refer_page_title="";t.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,t.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,t.page_start_ms=window.performance.timing.navigationStart}catch(t){}return t},t.prototype.handleStatisticsEvent=function(t){var e={};e.event=this.eventName.static,e.is_html=1,e.page_key=location.href,e.refer_page_key=document.referrer||"",e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"",e.refer_page_manual_key="";try{var i=window.performance.timing,n=i.loadEventEnd-i.navigationStart;e.page_init_cost_ms=parseInt(t.lcp||(n>0?n:0)),e.page_start_ms=i.navigationStart}catch(t){}return e},t.prototype.handleBeadtEvent=function(t){t.event=this.eventName.beat,t.page_key=window.location.href,t.is_html=1,t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{t.page_viewport_width=window.innerWidth,t.page_viewport_height=window.innerHeight,t.page_total_width=document.documentElement.scrollWidth,t.page_total_height=document.documentElement.scrollHeight,t.scroll_width=document.documentElement.scrollLeft+window.innerWidth,t.scroll_height=document.documentElement.scrollTop+window.innerHeight,t.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,t.page_start_ms=window.performance.timing.navigationStart}catch(t){}return t},t}(),Request=function(){function t(t){this.collect=t,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}return t.prototype.send=function(t,e){var i=t.eventSend,n=e.event;delete e.event,i&&"becon"===i?this.collect.beconEvent(n,e):this.collect.event(n,e)},t.prototype.get=function(t,e){fetch(t,Object.assign({headers:{"content-type":"application/json"},method:"GET"},e))},t.prototype.post=function(t,e){fetch(t,Object.assign({headers:{"content-type":"application/json"},method:"POST"},e))},t}(),COOKIE_KEY="_TEA_VE_OPEN",COOKIE_KEY_HOST="_TEA_VE_APIHOST",COOKIE_LANG="lang",COOKIE_EDIT_VERISON="_VISUAL_EDITOR_V",COOKIE_EDIT_URL="_VISUAL_EDITOR_U";function checkSession(){return"1"===js_cookie.get(COOKIE_KEY)}function checkSessionHost(){var t=js_cookie.get(COOKIE_KEY_HOST);try{t=JSON.parse(t)}catch(t){}return t}function checkEditUrl(){return js_cookie.get(COOKIE_EDIT_URL)}function setSession(){try{var t=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||js_cookie.get(COOKIE_LANG),e=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||js_cookie.get(COOKIE_KEY_HOST),i=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||js_cookie.get(COOKIE_EDIT_VERISON),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||js_cookie.get(COOKIE_EDIT_URL),r=+new Date,o=new Date(r+18e5);js_cookie.set(COOKIE_KEY,"1",{expires:o}),js_cookie.set(COOKIE_KEY_HOST,e,{expires:o}),js_cookie.set(COOKIE_EDIT_URL,n,{expires:o}),js_cookie.set(COOKIE_LANG,t,{expires:o}),js_cookie.set(COOKIE_EDIT_VERISON,i||"",{expires:o})}catch(t){}}var isLoaded$1=!1;function loadEditorScript$1(t){var e=t.event,i=t.autoTrackInstance;isLoaded$1||(isLoaded$1=!0,loadScript(t.editorUrl,function(){dispatchMsg(e,"editorScriptloadSuccess"),i.destroy()},function(){e&&dispatchMsg(e,"editorScriptloadError"),isLoaded$1=!1}))}function readyToLoadEditor$1(t,e){window.TEAVisualEditor=window.TEAVisualEditor||{};var i="",n=VISUAL_EDITOR_RANGERS+"?query="+Date.now();window.TEAVisualEditor.appId=e.app_id;var r=e.channel_domain,o="";if(addAllowdOrigin(["*"]),r){var a,s="";try{var c=window.performance.getEntriesByType("resource");if(c&&c.length&&(c.forEach(function(t){"script"===t.initiatorType&&t.name&&-1!==t.name.indexOf("collect")&&(s=t.name)}),s||document.currentScript&&(s=document.currentScript.src),s&&(a=s.split("/"))&&a.length)){o="https:/";for(var l=2;l<a.length&&l!==a.length-1;l++)o=o+"/"+a[l];o&&o.indexOf("/5.0")&&(o=o.split("/5.0")[0]||o)}}catch(t){}}if(init(e,SDK_VERSION),checkSession()){var u=checkSessionHost(),h="";u&&(window.TEAVisualEditor.__editor_ajax_domain=u,h=checkEditUrl()),loadEditorScript$1({event:null,editorUrl:h||n,autoTrackInstance:t}),setSession()}else try{receiveMsg("tea:openVisualEditor",function(e){var a=e.data;if("string"==typeof e.data)try{a=JSON.parse(e.data)}catch(t){a=void 0}if(a){var s=a.referrer,c=a.lang;if(s&&(window.TEAVisualEditor.__editor_ajax_domain=s),i=n,r){var l=a.version;i=o?o+(l?"/visual-editor-rangers-v"+l:"/visual-editor-rangers-v1.0.0")+".js":n,window.TEAVisualEditor.__editor_verison=l}window.TEAVisualEditor.__editor_url=i,window.TEAVisualEditor.lang=c,loadEditorScript$1({event:e,editorUrl:i,autoTrackInstance:t}),setSession()}}),window.TEAVisualEditor.openAutotrackEditor=function(){loadEditorScript$1({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:t})}}catch(t){}try{receiveMsg("tea:openHeatMapCore",function(e){loadEditorScript$1({event:e,editorUrl:HOT_PIC_URL+".js?query="+Date.now(),autoTrackInstance:t})})}catch(t){}}var State,defaultOpt={hashTag:!1,impr:!1},AutoTrack=function(){function t(){}return t.prototype.apply=function(t,e){if(this.autoTrackStart=!1,this.collect=t,this.config=e,e.autotrack){var i=t.Types;this.ready(i.Autotrack),this.collect.emit(i.AutotrackReady)}},t.prototype.ready=function(t){this.collect.set(t);var e=this.config.autotrack;e=Object.assign(defaultOpt,e="object"==typeof e?e:{}),this.destroyed=!1,this.options=e,this.Config=new Config(defaultConfig),this.Listener=new Listener(e,this.collect,this.Config),this.EventHandle=new EventHandle(this.config,e),this.Request=new Request(this.collect),this.autoTrackStart=!0,this.init(),readyToLoadEditor$1(this,this.config)},t.prototype.init=function(){this.Listener.init(this.handle.bind(this))},t.prototype.handle=function(t,e){"dom"===t.eventType&&this.handleDom(t,e)},t.prototype.handleDom=function(t,e){try{var i,n=t.eventName;if("click"===n||"change"===n||"submit"===n){var r=this.EventHandle.handleEvent(e,n);null!==r&&this.Request.send({eventType:"custom",eventName:"report_"+n+"_event",extra:{methods:"GET"}},r)}else if("page_view"===n||"page_statistics"===n)i="page_view"===n?this.EventHandle.handleViewEvent(e):this.EventHandle.handleStatisticsEvent(e),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},i);else if("beat"===n){var o=this.EventHandle.handleBeadtEvent(e);this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:t.eventSend},o)}}catch(t){}},t.prototype.destroy=function(){this.autoTrackStart&&(this.autoTrackStart=!1,this.Listener.removeListener())},t}();!function(t){t.Net="net",t.FailNet="f_net",t.FailData="f_data"}(State||(State={}));var EventList={pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]},Tracer=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;if(this.ready=e.app_id&&e.enable_tracer&&!e.disable_track_event,this.ready){this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=t,this.appid=e.app_id,this.reportUrl=t.configManager.getUrl("event");var n=this.collect.Types;this.fetch=t.adapters.fetch,this.collect.on(n.Event,function(){i.addCount("log")}),this.collect.on(n.SubmitError,function(t){i.addErrorCount(t.eventDate,t.type,t.errorCode,t.response)}),this.listener(),this.collect.emit(n.TracerReady)}},t.prototype.addCount=function(t,e,i){void 0===e&&(e="net"),void 0===i&&(i=1);try{this.tracerCache||(this.tracerCache=new Map);var n=void 0;if(this.tracerCache.has(t))(r=this.tracerCache.get(t)).has(e)?(n=r.get(e).params.count,n++,r.set(e,this.processTracer(n,t,e))):(n=i,r.set(e,this.processTracer(i,t,e)));else{var r=new Map;n=i,r.set(e,this.processTracer(i,t,e)),this.tracerCache.set(t,r)}"net"===e&&n>=this.limit[t]&&this.report(!1)}catch(t){}},t.prototype.addErrorCount=function(t,e,i,n){var r=this;try{if(t&&t.length){var o=t[0].events;o&&o.length&&("f_data"===e?(n&&n.hasOwnProperty("sc")?this.addCount("log",e,o.length-n.sc):this.addCount("log",e,o.length),this.errorCode[e]=i):o.forEach(function(t){var n="log";for(var o in EventList)if(-1!==EventList[o].indexOf(t.event)){n=o;break}r.addCount(n,e,1),r.errorCode[e]=i}))}}catch(t){}},t.prototype.report=function(t){if(this.tracerCache){var e=[];this.tracerCache.forEach(function(t){t.forEach(function(t){e.push(t)})}),e&&e.length&&this.sendTracer(e,t)}},t.prototype.sendTracer=function(t,e){try{var i=this.collect.eventManager.merge(t);e&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(i)):this.fetch(this.reportUrl,i),this.tracerCache=null}catch(t){}},t.prototype.processTracer=function(t,e,i){var n={count:t,state:i,key:e,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:SDK_VERSION};"f_net"!==i&&"f_data"!==i||(n.errorCode=this.errorCode[i]);var r=this.collect.processEvent("applog_trace",n);if(r&&r.event)return delete r.is_bav,r},t.prototype.listener=function(){var t=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.leavePage()}),beforePageUnload(function(){t.leavePage()})},t.prototype.leavePage=function(){this.report(!0)},t}(),dayjs_min=createCommonjsModule(function(t,e){t.exports=function(){var t="millisecond",e="second",i="minute",n="hour",r="day",o="week",a="month",s="quarter",c="year",l="date",u="Invalid Date",h=/^(\d{4})[-\/]?(\d{1,2})?[-\/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},p=function(t,e,i){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(i)+t},g={s:p,z:function(t){var e=-t.utcOffset(),i=Math.abs(e),n=Math.floor(i/60),r=i%60;return(e<=0?"+":"-")+p(n,2,"0")+":"+p(r,2,"0")},m:function t(e,i){if(e.date()<i.date())return-t(i,e);var n=12*(i.year()-e.year())+(i.month()-e.month()),r=e.clone().add(n,a),o=i-r<0,s=e.clone().add(n+(o?-1:1),a);return+(-(n+(i-r)/(o?r-s:s-r))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(u){return({M:a,y:c,w:o,d:r,D:l,h:n,m:i,s:e,ms:t,Q:s})[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},y="en",_={};_[y]=d;var v=function(t){return t instanceof w},m=function(t,e,i){var n;if(!t)return y;if("string"==typeof t)_[t]&&(n=t),e&&(_[t]=e,n=t);else{var r=t.name;_[r]=t,n=r}return!i&&n&&(y=n),n||!i&&y},b=function(t,e){if(v(t))return t.clone();var i="object"==typeof e?e:{};return i.date=t,i.args=arguments,new w(i)},E=g;E.l=m,E.i=v,E.w=function(t,e){return b(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var w=function(){function d(t){this.$L=m(t.locale,null,!0),this.parse(t)}var p=d.prototype;return p.parse=function(t){this.$d=function(t){var e=t.date,i=t.utc;if(null===e)return new Date(NaN);if(E.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(h);if(n){var r=n[2]-1||0,o=(n[7]||"0").substring(0,3);return i?new Date(Date.UTC(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)):new Date(n[1],r,n[3]||1,n[4]||0,n[5]||0,n[6]||0,o)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},p.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},p.$utils=function(){return E},p.isValid=function(){return this.$d.toString()!==u},p.isSame=function(t,e){var i=b(t);return this.startOf(e)<=i&&i<=this.endOf(e)},p.isAfter=function(t,e){return b(t)<this.startOf(e)},p.isBefore=function(t,e){return this.endOf(e)<b(t)},p.$g=function(t,e,i){return E.u(t)?this[e]:this.set(i,t)},p.unix=function(){return Math.floor(this.valueOf()/1e3)},p.valueOf=function(){return this.$d.getTime()},p.startOf=function(t,s){var u=this,h=!!E.u(s)||s,f=E.p(t),d=function(t,e){var i=E.w(u.$u?Date.UTC(u.$y,e,t):new Date(u.$y,e,t),u);return h?i:i.endOf(r)},p=function(t,e){return E.w(u.toDate()[t].apply(u.toDate("s"),(h?[0,0,0,0]:[23,59,59,999]).slice(e)),u)},g=this.$W,y=this.$M,_=this.$D,v="set"+(this.$u?"UTC":"");switch(f){case c:return h?d(1,0):d(31,11);case a:return h?d(1,y):d(0,y+1);case o:var m=this.$locale().weekStart||0,b=(g<m?g+7:g)-m;return d(h?_-b:_+(6-b),y);case r:case l:return p(v+"Hours",0);case n:return p(v+"Minutes",1);case i:return p(v+"Seconds",2);case e:return p(v+"Milliseconds",3);default:return this.clone()}},p.endOf=function(t){return this.startOf(t,!1)},p.$set=function(o,s){var u,h=E.p(o),f="set"+(this.$u?"UTC":""),d=((u={})[r]=f+"Date",u[l]=f+"Date",u[a]=f+"Month",u[c]=f+"FullYear",u[n]=f+"Hours",u[i]=f+"Minutes",u[e]=f+"Seconds",u[t]=f+"Milliseconds",u)[h],p=h===r?this.$D+(s-this.$W):s;if(h===a||h===c){var g=this.clone().set(l,1);g.$d[d](p),g.init(),this.$d=g.set(l,Math.min(this.$D,g.daysInMonth())).$d}else d&&this.$d[d](p);return this.init(),this},p.set=function(t,e){return this.clone().$set(t,e)},p.get=function(t){return this[E.p(t)]()},p.add=function(t,s){var l,u=this;t=Number(t);var h=E.p(s),f=function(e){var i=b(u);return E.w(i.date(i.date()+Math.round(e*t)),u)};if(h===a)return this.set(a,this.$M+t);if(h===c)return this.set(c,this.$y+t);if(h===r)return f(1);if(h===o)return f(7);var d=((l={})[i]=6e4,l[n]=36e5,l[e]=1e3,l)[h]||1,p=this.$d.getTime()+t*d;return E.w(p,this)},p.subtract=function(t,e){return this.add(-1*t,e)},p.format=function(t){var e=this,i=this.$locale();if(!this.isValid())return i.invalidDate||u;var n=t||"YYYY-MM-DDTHH:mm:ssZ",r=E.z(this),o=this.$H,a=this.$m,s=this.$M,c=i.weekdays,l=i.months,h=function(t,i,r,o){return t&&(t[i]||t(e,n))||r[i].substr(0,o)},d=function(t){return E.s(o%12||12,t,"0")},p=i.meridiem||function(t,e,i){var n=t<12?"AM":"PM";return i?n.toLowerCase():n},g={YY:String(this.$y).slice(-2),YYYY:this.$y,M:s+1,MM:E.s(s+1,2,"0"),MMM:h(i.monthsShort,s,l,3),MMMM:h(l,s),D:this.$D,DD:E.s(this.$D,2,"0"),d:String(this.$W),dd:h(i.weekdaysMin,this.$W,c,2),ddd:h(i.weekdaysShort,this.$W,c,3),dddd:c[this.$W],H:String(o),HH:E.s(o,2,"0"),h:d(1),hh:d(2),a:p(o,a,!0),A:p(o,a,!1),m:String(a),mm:E.s(a,2,"0"),s:String(this.$s),ss:E.s(this.$s,2,"0"),SSS:E.s(this.$ms,3,"0"),Z:r};return n.replace(f,function(t,e){return e||g[t]||r.replace(":","")})},p.utcOffset=function(){return-(15*Math.round(this.$d.getTimezoneOffset()/15))},p.diff=function(t,l,u){var h,f=E.p(l),d=b(t),p=6e4*(d.utcOffset()-this.utcOffset()),g=this-d,y=E.m(this,d);return y=((h={})[c]=y/12,h[a]=y,h[s]=y/3,h[o]=(g-p)/6048e5,h[r]=(g-p)/864e5,h[n]=g/36e5,h[i]=g/6e4,h[e]=g/1e3,h)[f]||g,u?y:E.a(y)},p.daysInMonth=function(){return this.endOf(a).$D},p.$locale=function(){return _[this.$L]},p.locale=function(t,e){if(!t)return this.$L;var i=this.clone(),n=m(t,e,!0);return n&&(i.$L=n),i},p.clone=function(){return E.w(this.$d,this)},p.toDate=function(){return new Date(this.valueOf())},p.toJSON=function(){return this.isValid()?this.toISOString():null},p.toISOString=function(){return this.$d.toISOString()},p.toString=function(){return this.$d.toUTCString()},d}(),k=w.prototype;return b.prototype=k,[["$ms",t],["$s",e],["$m",i],["$H",n],["$W",r],["$M",a],["$y",c],["$D",l]].forEach(function(t){k[t[1]]=function(e){return this.$g(e,t[0],t[1])}}),b.extend=function(t,e){return t.$i||(t(e,w,b),t.$i=!0),b},b.locale=m,b.isDayjs=v,b.unix=function(t){return b(1e3*t)},b.en=_[y],b.Ls=_,b.p={},b}()}),duration=createCommonjsModule(function(t,e){var i,n,r,o,a,s,c,l,u,h,f,d,p,g,y,_,v;t.exports=(a=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,u={years:s=31536e6,months:c=2592e6,days:o=864e5,hours:r=36e5,minutes:6e4,seconds:1e3,milliseconds:1,weeks:6048e5},h=function(t){return t instanceof v},f=function(t,e,i){return new v(t,i,e.$l)},d=function(t){return n.p(t)+"s"},p=function(t){return t<0},g=function(t){return p(t)?Math.ceil(t):Math.floor(t)},y=function(t){return Math.abs(t)},_=function(t,e){return t?p(t)?{negative:!0,format:""+y(t)+e}:{negative:!1,format:""+t+e}:{negative:!1,format:""}},v=function(){function t(t,e,i){var n=this;if(this.$d={},this.$l=i,void 0===t&&(this.$ms=0,this.parseFromMilliseconds()),e)return f(t*u[d(e)],this);if("number"==typeof t)return this.$ms=t,this.parseFromMilliseconds(),this;if("object"==typeof t)return Object.keys(t).forEach(function(e){n.$d[d(e)]=t[e]}),this.calMilliseconds(),this;if("string"==typeof t){var r=t.match(l);if(r){var o=r.slice(2).map(function(t){return Number(t)});return this.$d.years=o[0],this.$d.months=o[1],this.$d.weeks=o[2],this.$d.days=o[3],this.$d.hours=o[4],this.$d.minutes=o[5],this.$d.seconds=o[6],this.calMilliseconds(),this}}return this}var e=t.prototype;return e.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(e,i){return e+(t.$d[i]||0)*u[i]},0)},e.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=g(t/s),this.$d.months=g((t%=s)/c),this.$d.days=g((t%=c)/o),this.$d.hours=g((t%=o)/r),this.$d.minutes=g((t%=r)/6e4),this.$d.seconds=g((t%=6e4)/1e3),this.$d.milliseconds=t%=1e3},e.toISOString=function(){var t=_(this.$d.years,"Y"),e=_(this.$d.months,"M"),i=+this.$d.days||0;this.$d.weeks&&(i+=7*this.$d.weeks);var n=_(i,"D"),r=_(this.$d.hours,"H"),o=_(this.$d.minutes,"M"),a=this.$d.seconds||0;this.$d.milliseconds&&(a+=this.$d.milliseconds/1e3);var s=_(a,"S"),c=(t.negative||e.negative||n.negative||r.negative||o.negative||s.negative?"-":"")+"P"+t.format+e.format+n.format+(r.format||o.format||s.format?"T":"")+r.format+o.format+s.format;return"P"===c||"-P"===c?"P0D":c},e.toJSON=function(){return this.toISOString()},e.format=function(t){var e=t||"YYYY-MM-DDTHH:mm:ss",i={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return e.replace(a,function(t,e){return e||String(i[t])})},e.as=function(t){return this.$ms/u[d(t)]},e.get=function(t){var e=this.$ms,i=d(t);return"milliseconds"===i?e%=1e3:e="weeks"===i?g(e/u[i]):this.$d[i],0===e?0:e},e.add=function(t,e,i){var n;return n=e?t*u[d(e)]:h(t)?t.$ms:f(t,this).$ms,f(this.$ms+n*(i?-1:1),this)},e.subtract=function(t,e){return this.add(t,e,!0)},e.locale=function(t){var e=this.clone();return e.$l=t,e},e.clone=function(){return f(this.$ms,this)},e.humanize=function(t){return i().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},e.milliseconds=function(){return this.get("milliseconds")},e.asMilliseconds=function(){return this.as("milliseconds")},e.seconds=function(){return this.get("seconds")},e.asSeconds=function(){return this.as("seconds")},e.minutes=function(){return this.get("minutes")},e.asMinutes=function(){return this.as("minutes")},e.hours=function(){return this.get("hours")},e.asHours=function(){return this.as("hours")},e.days=function(){return this.get("days")},e.asDays=function(){return this.as("days")},e.weeks=function(){return this.get("weeks")},e.asWeeks=function(){return this.as("weeks")},e.months=function(){return this.get("months")},e.asMonths=function(){return this.as("months")},e.years=function(){return this.get("years")},e.asYears=function(){return this.as("years")},t}(),function(t,e,r){i=r,n=r().$utils(),r.duration=function(t,e){return f(t,{$l:r.locale()},e)},r.isDuration=h;var o=e.prototype.add,a=e.prototype.subtract;e.prototype.add=function(t,e){return h(t)&&(t=t.asMilliseconds()),o.bind(this)(t,e)},e.prototype.subtract=function(t,e){return h(t)&&(t=t.asMilliseconds()),a.bind(this)(t,e)}})});dayjs_min.extend(duration);var ignoreList=["__cep_sdk_onboard","__cep_trigger_sdk","_be_active"],moreOP=["and","or","not"],CepRule=function(){function CepRule(){this.support=!0,this.currentPlan=1,this.shouldSendEvent=!1,this.staing=!1,this.test=!1,this.cepReady=!1,this.eventCache=[]}return CepRule.prototype.apply=function(t,e){var i=this;if(this.collect=t,this.config=e,this.config.cep){var n=t.adapters,r=n.fetch,o=n.storage,a=t.Types;this.types=a,this.storage=new o(!1),this.fetch=r,this.configManager=t.configManager,this.url=e.cep_url?""+e.cep_url:t.configManager.getDomain()+"/service/2/cep_settings/",this.reportUrl=t.configManager.getUrl("event"),this.key="__tea_cep_plan_"+e.app_id,this.quotasKey="__tea_cep_plan_quotas_"+e.app_id,this.isWait=!1,this.eventCache=[],this.test=t.configManager.staging,this.collect.on(a.SubmitAfter,function(t){i.matchEvent(t)}),this.init()}},CepRule.prototype.init=function(){var t=this,e=!0,i=0,n=0,r=0,o=!1,a=this.storage.getItem(this.key)||{};if(a&&Object.keys(a).length&&(o=!0,i=a.last_update_time,n=a.fetch_interval,r=a.config_version||0,e=Date.now()-i>1e3*n),e){var s=this.configManager.get();this.fetch(this.url,{header:s.header,user:s.user,local_time:Date.now(),config_version:r},1e4,!1,function(e){e&&0===e.code?(a.fetch_interval=e.fetch_interval,a.data=e.data,a.last_update_time=Date.now(),a.config_version=e.config_version,t.clearQuotas(),t.initState(e.data),t.storage.setItem(t.key,a),e.data.forEach(function(e){t.event("__cep_sdk_onboard",e.plan_id)})):(304===e.code||400===e.code)&&o&&(a.last_update_time=Date.now(),t.storage.setItem(t.key,a),t.initState(a.data))},function(){o?(t.planData=a.data,t.initState(a.data)):t.support=!1})}else a.last_update_time=Date.now(),this.storage.setItem(this.key,a),this.initState(a.data)},CepRule.prototype.initState=function(t){var e=this;t&&t.length&&(this.stateArray=new Map,this.waitArray=new Map,this.planData=t,t.forEach(function(t){var i=new Map;if(t.pattern&&t.pattern.events){var n=1===t.pattern.events.length;t.pattern.events.forEach(function(t){i.set(t.id,{id:t.id,isMatch:!1,event:null,after:t.after||null,connection:t.connection||null,window:t.window||null,matchTime:0,initTime:Date.now(),singleRule:n})}),e.stateArray.set(t.plan_id,{patternState:i,singleRule:n,pattern:{aid:t.aid,biz_id:t.biz_id,end_time:t.end_time,start_time:t.start_time,web_sdk_version:t.web_sdk_version,stage:t.stage},quotas:t.quotas})}}),this.cepReady=!0,this.dealCache(),this.collect.emit(this.types.CepReady))},CepRule.prototype.check=function(t){var e=Date.now();return!(Date.now()>1e3*t.end_time)&&!(e<1e3*t.start_time)&&!(e>1e3*t.end_time)&&(this.staing="testing"===t.staing,!(SDK_VERSION<t.web_sdk_version&&(this.support=!1,1)))},CepRule.prototype.dealCache=function(){var t=this;if(this.eventCache.length){var e=1;this.eventCache.forEach(function(i){t.matchEvent(i),e++}),e===this.eventCache.length&&(this.eventCache=[])}},CepRule.prototype.matchEvent=function(t){if(this.support&&(!this.staing||this.test)&&t&&t.length)try{if(!this.cepReady)return void this.eventCache.push(t);var e=t[0],i=e.header,n=e.user,r=e.events;r.length&&r.reverse();for(var o=0;o<r.length;o++){if(-1!==ignoreList.indexOf(r[o].event))return!1;this.matchRule(i,n,r[o])}}catch(t){return}},CepRule.prototype.matchRule=function(t,e,i){try{for(var n=0;n<this.planData.length;n++){var r=this.planData[n],o=r.plan_id;if(this.check(r)&&this.checkQuotas(o)&&r.pattern&&r.pattern.events){for(var a=r.pattern.events,s=0;s<a.length;s++)if(this.rule(t,e,i,a[s].condition)){var c=this.stateArray.get(o).patternState,l=c.get(a[s].id);if(this.stateArray.get(o).singleRule){this.changeStatus(o,a[s].id,i),this.publish([i],o,a[s].id);break}if(!l.isMatch){l.after&&c.get(l.after).isMatch?this.changeStatus(o,a[s].id,i):l.after||this.changeStatus(o,a[s].id,i);break}}}}this.statusCheck()}catch(t){return}},CepRule.prototype.changeStatus=function(t,e,i){var n=this.stateArray.get(t),r=n.patternState.get(e);r.isMatch=!0,r.event=i,r.matchTime=i.local_time_ms||Date.now(),n.patternState.set(e,r),this.stateArray.set(t,n)},CepRule.prototype.statusCheck=function(){var t,e,i,n;try{for(var r=__values(this.stateArray),o=r.next();!o.done;o=r.next()){var a=__read(o.value,2),s=a[0],c=a[1],l=c.patternState;if(c.isSingle)break;try{for(var u=__values(l),h=u.next();!h.done;h=u.next()){var f=__read(h.value,2),d=f[0],p=f[1];if(p.after&&(!p.after||l.get(p.after).isMatch)){if("NOT_FOLLOWED_BY"===p.connection){p.isMatch?this.reset(s,d):Date.now()-l.get(p.after).matchTime>p.window?this.publish([l.get(p.after).event,p.event],s,d):this.startWait(s,d,p);break}p.isMatch?p.matchTime-l.get(p.after).matchTime<=p.window?this.publish([l.get(p.after).event,p.event],s,d):this.reset(s,d):Date.now()-l.get(p.after).matchTime>p.window?this.reset(s,d):this.startWait(s,d,p);break}}}catch(t){i={error:t}}finally{try{h&&!h.done&&(n=u.return)&&n.call(u)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},CepRule.prototype.startWait=function(t,e,i){var n=this;try{this.waitArray.get(t)||this.waitArray.set(t,new Map);var r=this.waitArray.get(t);if(!r.get(e)){var o=setTimeout(function(){var r,o=n.stateArray.get(t).patternState,a=o.get(e);"NOT_FOLLOWED_BY"===a.connection?!a.isMatch&&o.get(a.after).isMatch||a.matchTime-o.get(a.after).matchTime>i.window?((r=n.waitArray.get(t).get(e)).triggerWait=!0,n.waitArray.set(t,n.waitArray.get(t).set(e,r)),n.publish([o.get(a.after).event],t,e)):n.reset(t,e):"FOLLOWED_BY"===a.connection&&(a.isMatch&&o.get(a.after).isMatch?((r=n.waitArray.get(t).get(e)).triggerWait=!0,n.waitArray.set(t,n.waitArray.get(t).set(e,r)),n.publish([o.get(a.after).event],t,e)):n.reset(t,e))},i.window);r.set(e,{waitFn:o,triggerWait:!1}),this.waitArray.set(t,r)}}catch(t){}},CepRule.prototype.rule=function(t,e,i,n){var r=this;try{var o=i.event,a=i.params;if(a=JSON.parse(a),-1!==moreOP.indexOf(n.op)){if(n.conditions&&n.conditions.length){var s=n.conditions,c=0,l=new Map;l.set(c,{op:n.op,result:void 0,resultList:[],resultKey:[],resultLength:s.length}),function i(n,s){for(var u=0;u<n.length;u++)if(c++,-1!==moreOP.indexOf(n[u].op)&&n[u].hasOwnProperty("conditions"))l.set(c,{op:n[u].op,result:void 0,fatherKey:s,resultList:[],resultKey:[],resultLength:n[u].conditions.length}),i(n[u].conditions,c);else{var h=r.scope(n[u].key),f=h.scope,d=h.key,p=h.key2,g=f?"header"===f?p?JSON.parse(t[p])[d]:t[d]:"user"===f?e[d]:a[d]:o,y=r.calculate(n[u].op,g,n[u].value);l.set(c,{op:n[u].op,result:y,fatherKey:s})}}(s,c);for(var u=l.get(0);void 0===u.result||u.resultList.length<u.resultLength;)l.forEach(function(t,e){if(void 0!==t.result&&void 0!==t.fatherKey){var i=l.get(t.fatherKey);i.resultList.length<i.resultLength&&-1===i.resultKey.indexOf(e)&&(i.resultKey.push(e),i.resultList.push(t.result),l.set(t.fatherKey,i))}}),l.forEach(function(t){t.resultList&&t.resultList.length===t.resultLength&&("and"===t.op&&(t.result=-1===t.resultList.indexOf(!1)),"or"===t.op&&(t.result=-1!==t.resultList.indexOf(!0)))});return l.get(0).result}return!1}var h=this.scope(n.key),f=h.scope,d=h.key,p=h.key2,g=f?"header"===f?p?JSON.parse(t[p])[d]:t[d]:"user"===f?e[d]:a[d]:o;return this.calculate(n.op,g,n.value)}catch(t){return!1}},CepRule.prototype.publish=function(t,e,i){try{var n=this.configManager.get().user,r={biz_id:this.stateArray.get(e).pattern.biz_id,plan_id:e,uid:n.user_id||"",did:n.device_id||"",uuid:n.user_unique_id,events:t,extra:{url:window.location.href}};this.collect.emit("__cep_match",r),(window.opener||window.parent).postMessage({type:"__cep_match",data:r},"*"),this.event("__cep_trigger_sdk",e),this.addQuotas(e),this.reset(e,i)}catch(t){return}},CepRule.prototype.addQuotas=function(t){var e=this.stateArray.get(t).quotas;if(e&&e.length){var i=this.storage.getItem(this.quotasKey)||{};i[t]||(i[t]={value:0,lastTime:Date.now()});var n=i[t].value;0===n&&(i[t].lastTime=Date.now()),i[t].value=n+1,this.storage.setItem(this.quotasKey,i)}},CepRule.prototype.checkQuotas=function(t){var e=this.stateArray.get(t).quotas,i=this.storage.getItem(this.quotasKey)||{};if(i[t]||(i[t]={value:0,lastTime:Date.now()}),e&&e.length){var n=e[0].value;if("per_keyid"!==e[0].type)return!0;var r=this.release(e[0].granularity);return"all"===r?!(i[t].value>=n):Date.now()-i[t].lastTime>=r?(i[t].value=0,i[t].lastTime=Date.now(),this.storage.setItem(this.quotasKey,i),!0):!(i[t].value>=n)}return!0},CepRule.prototype.clearQuotas=function(){this.storage.setItem(this.quotasKey,null)},CepRule.prototype.release=function(t){if("all"===t)return t;var e=dayjs_min.duration(t);return e?e.asMilliseconds():"all"},CepRule.prototype.reset=function(t,e){var i=this.stateArray.get(t);if(i.singleRule){var n=i.patternState.get(e);n.isMatch=!1,n.event=null,n.matchTime=0,n.initTime=Date.now(),i.patternState.set(e,n)}else i.patternState.forEach(function(t){t.isMatch=!1,t.event=null,t.matchTime=0,t.initTime=Date.now()});this.stateArray.set(t,i);var r=this.waitArray.get(t);r&&r.get(e)&&(clearTimeout(r.get(e).waitFn),r.delete(e))},CepRule.prototype.event=function(t,e){try{var i={event:t,params:JSON.stringify({plan_id:e||"",biz_id:this.stateArray.get(e).pattern.biz_id}),local_time_ms:Date.now()},n=this.configManager.get(),r=n.header,o=n.user;r.custom=JSON.stringify(r.custom),this.fetch(this.reportUrl,[{events:[i],user:o,header:r}])}catch(t){return}},CepRule.prototype.scope=function(t){var e="",i="";if(t.indexOf(".")>-1){var n=t.split(".");t=n[1],"header"===(e=n[0])&&"custom"===t&&(t=n[2],i=n[1])}return{scope:e,key:t,key2:i}},CepRule.prototype.calculate=function(op,paramA,paramB){try{if("="===op)return paramA===paramB;if(-1!==["=","<",">",">=","<=","!="].indexOf(op))return eval(""+paramA+op+paramB);if(-1!==["in","contains"].indexOf(op))return -1!==paramB.indexOf(paramA);if(-1!==["is not null","is null"].indexOf(op))return"is null"===op?null==paramA:null!=paramA;if(-1!==["startswith","endswith"].indexOf(op)){if("startswith"===op)return 0===paramA.indexOf(paramB);var start=paramA.length-paramB.length;return paramA.substr(start,paramB.length)===paramB}}catch(e){return!1}},CepRule}(),getLogPluginSpace=function(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null},pluginObject=getLogPluginSpace(),PluginExtend=function(){function t(){}return t.prototype.apply=function(t,e){this._plugin={},this.config=e,this.collect=t,this.channel=e.channel||"cn",this.loadExtend()},t.prototype.loadExtend=function(){var t=this;try{this.collect.remotePlugin.forEach(function(e,i){if("sdk"===e){if(pluginExtendList.hasOwnProperty(i)){var n=pluginExtendList[i].object,r=pluginExtendList[i].src[t.channel]+"?query="+Date.now();t.exist(i,n,r)}}else"object"==typeof e&&(e.src?t.exist(i,e.call,e.src):t.process(i,e.instance,"INSTANCE"))})}catch(t){}},t.prototype.exist=function(t,e,i){var n=this;pluginObject[e]?this.process(t,pluginObject[e]):this.loadPlugin(t,i,function(){n.process(t,pluginObject[e])},function(){})},t.prototype.process=function(t,e,i){try{if(i){var n=new e;n.apply&&n.apply(this.collect,this.config)}else e&&e(this.collect,this.config)}catch(t){}},t.prototype.loadPlugin=function(t,e,i,n){var r=this;try{var o=document.createElement("script");o.src=e,this._plugin[t]||(this._plugin[t]=[]),this._plugin[t].push(i),o.onerror=function(){n(e)},o.onload=function(){r._plugin[t].forEach(function(t){t()})},document.getElementsByTagName("head")[0].appendChild(o)}catch(t){}},t}(),Verify=function(){function t(){this.verifyReady=!1,this.waitTime=5e3,this.cleanStatus=!1}return t.prototype.apply=function(t,e){var i=this;this.collector=t,this.config=e,this.cacheStorgae=new t.adapters.storage(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",function(t){t&&t.length&&i.eventStore(t[0])}),this.checkCache()},t.prototype.checkCache=function(){var t=this;this.verifyCookieKey="__applog_verify_set_"+this.config.app_id,this.cacheStorgae.getCookie(this.verifyCookieKey);var e=this.cacheStorgae.getItem(this.verifyCookieKey);this.sign=e&&e.sign||"",this.origin=e&&e.origin||"*";var i=setTimeout(function(){t.cleanVerify(),clearTimeout(i),t.collector.off("submit-verify")},this.waitTime);window.addEventListener("message",function(e){e&&e.data&&"simulator:verify"===e.data.type&&(clearTimeout(i),t.receMessage(e))},!0)},t.prototype.receMessage=function(t){if(!this.cleanStatus){var e=t.data;this.verifyReady=!0,this.sign=e.sign,this.origin=t.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:e.sign,origin:t.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,e.sign,t.origin)}},t.prototype.eventStore=function(t){this.cleanStatus||(this.verifyReady?this.postVerify(t,this.sign,this.origin):this.eventStorage.push(t))},t.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[]},t.prototype.postVerify=function(t,e,i){try{var n=[];isArray(t)?t.forEach(function(t){n.push(t)}):n.push(t);var r={type:"simulator:verify:event",sign:e,pageUrl:window.location.href,events:n};(window.opener||window.parent).postMessage(r,i)}catch(t){}},t}(),RuotePage=function(){function t(){this.autotrack=!1,this.spa=!1,this.cache={}}return t.prototype.apply=function(t,e){if(e.spa||e.autotrack){var i=t.Types;this.collect=t,this.config=e,this.appid=e.app_id,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),t.emit(i.RouteReady)}},t.prototype.setKey=function(){this.storage=new this.collect.adapters.storage(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:location.href,refer_title:document.title||location.pathname,refer_manual_key:""},this.config.autotrack&&"object"==typeof this.config.autotrack&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},t.prototype.hack=function(){var t=this,e=window.history.pushState;history.pushState=function(i){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];"function"==typeof history.onpushstate&&history.onpushstate({state:i});var o=e.call.apply(e,__spread([history,i],n)),a=t.getPopStateChangeEventData();return t.lastLocation=stringify(location.href,n[1]),t.sendPv(a,"pushState"),o};var i=history.replaceState;history.replaceState=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];"function"==typeof history.onreplacestate&&history.onreplacestate({state:e});var o=i.call.apply(i,__spread([history,e],n)),a=t.getPopStateChangeEventData();return t.lastLocation=stringify(location.href,n[1]),t.sendPv(a),o}},t.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},t.prototype.init=function(){var t=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:t,init:!0})},t.prototype.listener=function(){var t=this,e=null;window.addEventListener("hashchange",function(i){t.lastLocation!==window.location.href&&clearTimeout(e)}),window.addEventListener("popstate",function(i){t.lastLocation!==window.location.href&&(e=setTimeout(function(){t.lastLocation=window.location.href;var e=t.getPopStateChangeEventData();t.sendPv(e)},10))})},t.prototype.getPopStateChangeEventData=function(){var t=this.pageConfig();return t.is_back=0,t},t.prototype.pageConfig=function(){try{var t,e=this.storage.getItem(this.cache_key)||{};t=document.referrer?document.referrer:e&&e.refer_key||"";var i=this.storage.getItem("__tea_cache_first_"+this.appid);return{is_html:1,url:location.href,referrer:t,page_key:location.href,refer_page_key:t,page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:e&&e.refer_manual_key||"",refer_page_title:e&&e.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+(!i||1!=i)}}catch(t){return{}}},t.prototype.sendPv=function(t,e){this.collect.emit("route-change",{config:t,init:!1})},t}();Collector.usePlugin(PluginExtend,"extend"),Collector.usePlugin(Ab,"ab"),Collector.usePlugin(Stay,"stay"),Collector.usePlugin(AutoTrack,"autotrack"),Collector.usePlugin(Verify,"verify"),Collector.usePlugin(Et,"et"),Collector.usePlugin(Profile,"profile"),Collector.usePlugin(CepRule,"cep"),Collector.usePlugin(HeartBeat,"heartbeat"),Collector.usePlugin(Monitor,"monitor"),Collector.usePlugin(RuotePage,"route"),Collector.usePlugin(Tracer,"tracer");var Tea=new Collector("default"),channelMapAppId={cn:7497,va:7997},Manage=function(){function t(t){var e=t.user_id,i=t.device_id,n=t.channel,r=void 0===n?"cn":n,o=t.channel_domain,a=t.user_unique_id,s=t.teaInitPre;if(!Tea.inited){var c={app_id:channelMapAppId[r],channel:r};o&&(c.channel_domain=o),s&&s(Tea),Tea.init(c),Tea.start(),Tea.inited=!0}var l={};l.user_unique_id=a||e,i&&(l.device_id=i),Tea.config(l),this.logOptions=t,this._player=t.player}var e=t.prototype;return e.push=function(t){try{var e=this;t=_objectSpread2({},t);var i=e._player.config.url;e._player.video&&(t.play_current_time=e._player.currentTime),t.cdn_play_url=e.core&&e.core.loader&&e.core.loader.finnalUrl?e.core.loader.finnalUrl:i&&i.startsWith("//")?window.location.protocol+i:i,t.live_stream_session_id=getUrlQuery(t.cdn_play_url,"_session_id"),t.random_session_id=+t.cdn_play_url.includes("rsi=0"),t.play_format=getPlayFormat(t.cdn_play_url),"playing"!==t.event_key&&(t.timestamp=getCurrentTime());var n=getDeviceInfo(),r=n.memory_usage,o=n.network_downlink;return t.cpu_core_number=n.cpu_core_number,t.memory_usage=r,t.network_downlink=o,Promise.resolve(getStorageUsage()).then(function(i){return t.storage_usage=i,Promise.resolve(getBatteryLevel()).then(function(i){t.battery_level=i,t.muted=+e._player.muted,e.send(t)})})}catch(t){return Promise.reject(t)}},e.send=function(t){if(t.event_key){var e,i;(null===(e=(i=this.logOptions).isDisableReport)||void 0===e||!e.call(i,t.event_key,t))&&(this.logOptions.onReport&&this.logOptions.onReport(t.event_key,t),Tea.event(t.event_key,_objectSpread2({},t)))}},t}(),_getDBAsync=function(t,e){try{var i,n=function(t){return r?t:[]},r=!1;if(t===VendorType.Intel&&(i=e.intelPath),t===VendorType.Nvidia&&(i=e.nvidiaPath),t===VendorType.Amd&&(i=e.amdPath),!i)return Promise.resolve([]);var o=_catch(function(){return Promise.resolve(fetch(i).then(function(t){return t.text()})).then(function(e){var i=_text2Arr(e,t);return r=!0,i})},function(){});return Promise.resolve(o&&o.then?o.then(n):n(o))}catch(t){return Promise.reject(t)}},LOCAL_KEY="gpu_score",gpuVendor="",NGOPENGL="OpenGL Engine",UNKNOW="Unknow",VendorType={CpuDeriver:"CpuDeriver",Intel:"Intel",Nvidia:"NVIDIA",Amd:"AMD",Apple:"Apple",Unknow:UNKNOW},INTEL_NVIDIA_PATTERN=/ANGLE\s+\((?:[^,]+,\s+)?([^,/]+)?(?:[^,]*)(?:[,\s]+)(Direct\S+|OpenGL[\d.\s]+)/,AMD_APPLE_APTTENR=/ANGLE\s+\((?:[^,]+,\s+)?([^,]+)?(?:[,\s]+)(Direct\S+|OpenGL[\d.\s]+)/;function getGPUVendor(){if(gpuVendor)return gpuVendor;try{var t,e=document.createElement("canvas").getContext("webgl");e&&(gpuVendor=(t=e.getExtension("WEBGL_debug_renderer_info"))?e.getParameter(t.UNMASKED_RENDERER_WEBGL):"")}catch(t){}return gpuVendor}function getVendorType(t){var e=/(SwiftShader|Intel|NVIDIA|AMD|Radeon|Apple)/.exec(t);return e?"Radeon"===e[0]?VendorType.Amd:"SwiftShader"===e[0]?VendorType.CpuDeriver:e[0]:VendorType.Unknow}function _parseVendorStartWidthAngle(t,e){var i,n,r,o,a=UNKNOW;return t!==VendorType.Intel&&t!==VendorType.Nvidia||(r=INTEL_NVIDIA_PATTERN.exec(e)),t!==VendorType.Amd&&t!==VendorType.Apple||(r=AMD_APPLE_APTTENR.exec(e)),(null===(i=r)||void 0===i?void 0:i[1])&&(null===(n=r)||void 0===n?void 0:n[2])&&(a=r[1].replace(/(AMD|NVIDIA)/,"").trim()),o="Intel"===t?a=a.split(NGOPENGL)[0].trim():a.split(NGOPENGL)[0].trim(),{vendor:t,model:a,backupModel:o}}function parseGpuRendor(t){var e=getVendorType(t);return e===VendorType.Unknow||e===VendorType.CpuDeriver?{vendor:e,model:UNKNOW,backupModel:UNKNOW}:/^ANGLE/.test(t)?_parseVendorStartWidthAngle(e,t):e===VendorType.Intel?{vendor:e,model:t.split(NGOPENGL)[0].trim(),backupModel:t.split(NGOPENGL)[0].trim()}:{vendor:e,model:t.replace(/(AMD|NVIDIA)/,"").trim(),backupModel:t.split(NGOPENGL)[0].replace(/(AMD|NVIDIA)/,"").trim()}}function _text2Arr(t,e){return(e===VendorType.Intel?t.split("\n").map(function(t){return"Intel(R) "+t}):t.split("\n")).map(function(t){return t.split("|")})}function _vendor2Fps(t,e){var i=t.filter(function(t){return t[0]===e.model});i.length||(i=t.filter(function(t){return t[0]===e.backupModel})),i.length||e.vendor!==VendorType.Intel||/^Intel(R)/.test(e.model)||(i=t.filter(function(t){return t[0]==="Intel(R) "+e.model}));var n="-1";if(i.length){var r=i[0][1];n="-1"===r?"0":r}return parseInt(n)}function _fps2score(t){return 0===t?0:-1===t?-1:parseFloat(Math.log2(t).toFixed(2))}var gpu_score,Gpu=function(){function t(){}return t.getScore=function(){var e,i=-1;try{if(i=localStorage.getItem(LOCAL_KEY))return i=Number(i),Promise.resolve(i)}catch(t){}try{if((e=parseGpuRendor(getGPUVendor())).vendor===VendorType.Apple)return Promise.resolve(9)}catch(t){return i}return e?_getDBAsync(e.vendor,t.cfg).then(function(t){return _vendor2Fps(t,e)}).then(_fps2score):i},t}();function setGpuScore(t){void 0===gpu_score?Gpu.getScore().then(function(e){gpu_score=e,t.gpu_score=e;try{localStorage.setItem(LOCAL_KEY,e)}catch(t){}}).catch(function(){gpu_score=-1}):t.gpu_score=gpu_score}Gpu.cfg={intelPath:"https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/db/_int.txt",nvidiaPath:"https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/db/_nvi.txt",amdPath:"https://sf1-cdn-tos.huoshanstatic.com/obj/media-fe/db/_am.txt"};var videoEvts=["play","playing","pause","ended","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","ratechange","volumechange","loadeddata"],_isSr=function(t){var e=window.TTCommon;return e?(_isSr=function(t){if(!t)return 0;try{var i=JSON.parse(e.executeWithElement(t,"getSrCurrentInfo",""))||{};return(3!==(null==i?void 0:i.sr_enable)||0!==(null==i?void 0:i.sr_local_error))&&((null==i?void 0:i.sr_local_error)||!((null==i?void 0:i.proc_avg)>0))?0:1}catch(t){return 0}})(t):(_isSr=function(){},0)},LoggerControl=function(){function t(t){this.options=t,this.logger=new XgLiveLogger(t),this.restart=this.restart.bind(this),this.bindUrlChange()}var e=t.prototype;return e.restart=function(t){this.destroy("string"!=typeof t&&!!t),this.logger=new XgLiveLogger(this.options,!0),this.bindUrlChange(),this.logger.reportStartPlay(),this.logger.handlePlayerComlete()},e.bindUrlChange=function(){this.options&&this.options.player&&!this.options.manual_restart&&this.options.player.on("urlchange",this.restart)},e.setNTP=function(t){this.logger.setNTP(t)},e.updateExt=function(t){this.options.ext=Object.assign(this.options.ext||{},t),this.logger&&this.logger.updateExt(t)},e.destroy=function(t){this.logger.destroy(t),this.logger=null,this.options&&this.options.player&&!this.options.manual_restart&&this.options.player.off("urlchange",this.restart)},t}(),XgLiveLogger=function(){function t(t,e){var i=this;if(this.handleAudioGap=function(t){i.logmanager.push(Object.assign({},i.log.play_audio_gap,{gap:(t||{}).gap,from_evt:"audiotimestampbreaked"}))},!t.player)throw Error("option player is necessary");this.options=Object.assign({},t,getDefaultOptions(t)),this._player=this.options.player,this._url=this._player.config.url,this.project_key=t.project_key||"xigua_live",this.product_line=t.product_line||"live",this.ntpDelta=this.options.ntp?Date.now()-this.options.ntp:0,this.inWaitingStart=0,this.errorNumber=0,this.tempFirstStallTime=0,this.tempDroppedFrameCount=0,this.tempTotalFrameCount=0,this._logmanager=new Manage(this.options),this.isRestart=e,this.init(),this.started=!1,this.destroyed=!1,this.completed=!1,this.firstFrameViewed=!1,this.cacheRtcStats={},this.cachePlaying={demuxCost:0,remuxCost:0,appendCost:0,totalByteSize:0}}_createClass(t,[{key:"videoSize",get:function(){if(!this.player)return{width:0,height:0,play_width:0,play_height:0};var t=this.player.video,e=t.clientWidth,i=t.clientHeight,n=t.videoWidth,r=t.videoHeight;return{width:n,height:r,play_width:e,play_height:i,high_resolution:+(e*pixelRatio<=n||i*pixelRatio<=r),pixelRatio:pixelRatio}}},{key:"player",get:function(){return this._player}},{key:"logmanager",get:function(){return this._logmanager}},{key:"ntpTime",get:function(){return Date.now()-this.ntpDelta}}]);var e=t.prototype;return e.setNTP=function(t){this.options&&(this.options.ntp=t,this.ntpDelta=Date.now()-this.options.ntp)},e.init=function(){this.bindCtx(),this.initLog(),this.initEvt()},e.bindCtx=function(){this.handlePlayerComlete=this.handlePlayerComlete.bind(this),this.handlePlayerPlaying=this.handlePlayerPlaying.bind(this),this.destroyFunc=this.destroyFunc.bind(this),this.handleUserLeave=this.handleUserLeave.bind(this),this.handlePlayerError=this.handlePlayerError.bind(this),this.handlePlayerReady=this.handlePlayerReady.bind(this),this.handlePlayerWaiting=this.handlePlayerWaiting.bind(this),this.handleAVUnsync=this.handleAVUnsync.bind(this),this.handleSEIParsed=this.handleSEIParsed.bind(this),this.handlePlayerPause=this.handlePlayerPause.bind(this),this.handleTTFB=this.handleTTFB.bind(this),this.handleUrlChange=this.handleUrlChange.bind(this),this.handleKeyframe=this.handleKeyframe.bind(this),this.handleSourceOpen=this.handleSourceOpen.bind(this),this.handleBufferAppend=this.handleBufferAppend.bind(this),this.handleDegrade=this.handleDegrade.bind(this),this.handleLoadStart=this.handleLoadStart.bind(this),this.handlePlayerEnded=this.handlePlayerEnded.bind(this),this.handleChaseFrame=this.handleChaseFrame.bind(this),this.handleBlackScreen=this.handleBlackScreen.bind(this)},e.initLog=function(){var t=this,e=this.options,i=e.player,n=void 0!==i.hlsOps;this.commonParams=_objectSpread2({os:sniffer.operation_os},getCommonLog(e)),this.log=Object.assign({},getDefaultLog());var r=this;for(var o in this.log){var a=function(e){Object.defineProperty(t.log[o],e,{get:function(){return null==this["_"+e]?r.commonParams[e]:this["_"+e]},set:function(t){this["_"+e]=t},enumerable:!0})};for(var s in this.commonParams)a(s);n&&Object.defineProperty(this.log[o],"m3u8",{get:function(){if(i&&i.__core__){var t=i.__core__.m3u8Text;return t?t.slice(0,25e4):""}return""},enumerable:!0}),Object.defineProperty(this.log[o],"volume",{get:function(){if(i&&i.video)return i.volume||0},enumerable:!0})}},e.updateExt=function(t){for(var e in this.log)for(var i in t)this.log[e][i]=t[i]},e.reportStartPlay=function(){if(!this.started){this.started=!0,this.log.start_play.start_play_time=this.log.start_play.timestamp=getCurrentTime();var t=this.getFetchLoader();t&&(this.log.first_frame.preload_size=t.totalByteSize),this.logmanager.push(this.log.start_play,!0)}},e.initWindowListener=function(){"pc"===sniffer.device?window.addEventListener("beforeunload",this.destroyFunc):"mobile"===sniffer.device&&(window.addEventListener("beforeunload",this.destroyFunc),window.addEventListener("pagehide",this.destroyFunc))},e.removeWindowListener=function(){"pc"===sniffer.device?window.removeEventListener("beforeunload",this.destroyFunc):"mobile"===sniffer.device&&(window.removeEventListener("beforeunload",this.destroyFunc),window.removeEventListener("pagehide",this.destroyFunc))},e.initEvt=function(){var t=this,e=this.player;videoEvts.forEach(function(e){t["handleVideo"+e+"Evt"]=function(){t["handleVideo"+e]&&t["handleVideo"+e]()},t.bindVideoEvt(e,t["handleVideo"+e+"Evt"])}),this.initWindowListener(),e.once("error",this.handlePlayerError),e.once("complete",this.handlePlayerComlete),e.once("playing",this.handlePlayerPlaying),e.once("timeupdate",this.handlePlayerPlaying),e.once("destroy",this.destroyFunc),e.on("ready",this.handlePlayerReady),e.on("waiting",this.handlePlayerWaiting),e.on("SEI_PARSED",this.handleSEIParsed),e.on("pause",this.handlePlayerPause),e.on("ttfb",this.handleTTFB),e.on("urlchange",this.handleUrlChange),e.once("isKeyframe",this.handleKeyframe),e.once("sourceopen",this.handleSourceOpen),e.once("bufferappend",this.handleBufferAppend),e.on("degrade",this.handleDegrade),e.on("loadstart",this.handleLoadStart),e.on("ended",this.handlePlayerEnded),e.on("chaseframe",this.handleChaseFrame),e.on("detectedblackscreen",this.handleBlackScreen),e.on("audiotimestampbreaked",this.handleAudioGap),this.hiJackPlayerStart()},e.handleBlackScreen=function(){this.logmanager.push(Object.assign(this.log.black_screen))},e.setGpuScore=function(){try{navigator.hardwareConcurrency<=4&&setGpuScore(this.commonParams)}catch(t){}this.setGpuScore=function(){}},e.handleChaseFrame=function(t){this.logmanager.push(Object.assign(this.log.play_chase_frame,t))},e.handlePlayerEnded=function(){if(this.core&&this.core.endedStatus){var t=this.core.endedStatus;this.logmanager.push(Object.assign({},this.log.play_ended,this.core.endedStatus,{endOfStream:+t.endOfStream,mock:+t.mock}))}},e.handleLoadStart=function(){if(this.core=getPlayerCore(this.player),this.core){this.commonParams.live_sdk_version="2",this.logmanager.core=this.core;var t=this.core._context||this.core.context;t&&this.initContextEvt(t)}this.cachePlaying.totalByteSize=0,this.reportStartPlay()},e.handleDegrade=function(t){this.log.degrade.payload=t,this.logmanager.push(this.log.degrade,!0)},e.hiJackPlayerStart=function(){var t=arguments,e=this;this.player._start=this.player.start;var i=this.player;i.start=function(){try{if(i._start)return i._start.apply(i,Array.prototype.slice.call(t,0))}catch(t){}e.destroyed||e.handlePlayerComlete()}},e.handleTTFB=function(t){var e=t||{},i=e.start,n=e.end,r=e.elapsed,o=e.url,a=e.responseUrl;this.log.first_frame.ttfb=r||-1,this.log.first_frame.ttfb_end=n||0,this.log.first_frame.preload_start=i,this.log.playing.ttfb=r||-1,this.log.play_result.ttfb_start_cost=getCurrentTime()-this.log.play_result.start,this.log.first_frame.is_redirect=+(o!==a),this.log.play_result.is_redirect=this.log.first_frame.is_redirect},e.handleUrlChange=function(t){this.logmanager.push(Object.assign(this.log.play_url_change,{url:t,timestamp:getCurrentTime()}))},e.handleKeyframe=function(t){this.log.play_stop.is_firstframe_received=1,this.log.play_stop.firstframe_pts=t},e.handleSourceOpen=function(){this.log.source_opened.timestamp=getCurrentTime(),this.logmanager.push(this.log.source_opened)},e.handleBufferAppend=function(){this.log.source_updateend.timestamp=getCurrentTime(),this.logmanager.push(this.log.source_updateend)},e.handlePlayerPause=function(){this.log.pause.timestamp=getCurrentTime(),this.logmanager.push(this.log.pause,!0)},e.handlePlayerError=function(t){this.setCdnIp(),this.errorNumber=1;var e=t.errorType,i=t.code||t.errorCode;Object.assign(this.log.play_error,_objectSpread2({timestamp:getCurrentTime(),code:i||("parse"===e?31:21),info:t.ex||"",detail:JSON.stringify(t)},this.videoSize)),this.logmanager.push(this.log.play_error,!0),this.destroyed||(0===this.log.first_frame.first_frame_view&&(Object.assign(this.log.first_frame_failed,{code:i||("parse"===e?31:21),msg:t.ex}),void 0!==this.log.first_frame_failed.timestamp&&(this.log.first_frame_failed.timestamp=getCurrentTime()),this.logmanager.push(this.log.first_frame_failed,!0),this.log.play_result.is_threshold||(this.clearPlayResultTimer(),this.log.play_result.reason=t.ex,this.log.play_result.code=this.log.play_error.code,this.logmanager.push(this.log.play_result,!0))),this.options.error_report_stop?this.handleUserLeave():this.updatePlayStopParams())},e.handlePlayerLoadStream=function(t){if("string"==typeof t){var e=this.log.play_loadstream;e.timestamp=getCurrentTime(),e.loadstream_url=t,this.logmanager.push(e),this.log.play_result.load_start_cost=e.timestamp-this.log.play_result.start}},e.handlePlayerLoadedStream=function(){var t=this.log.play_stream_loaded;t.timestamp=getCurrentTime(),this.logmanager.push(t)},e.handleSEIParsed=function(t){var e,i=this.log,n=i.playing,r=i.first_frame,o=i.play_result;if(100===t.code){try{e=new TextDecoder("utf-8").decode(t.content)}catch(i){e=Utf8ArrayToStr(t.content)}e=e.slice(e.indexOf("{"),e.lastIndexOf("}")+1);try{var a=JSON.parse(e),s=a.ts||a.heart_beat&&a.heart_beat.ts;if(Object.assign(r,a.loudness),Object.assign(o,a.loudness),!s)return void(n.sei_string=e);this.core&&this.core.config.seiOnDemand?(n.sei_delay=this.ntpTime-s,r.first_sei_delay=n.sei_delay):(n.sei_network_delay=this.ntpTime-s,n.sei_buffer_delay=this.getPlayerBuffer(),n.sei_delay=n.sei_network_delay+n.sei_buffer_delay,r.sei_network_delay=n.sei_network_delay),n.sei_source=a.source,n.ntp_sync=this.options.ntp?1:0,n.ntp_delta=this.ntp_delta,r.ntp_sync=this.options.ntp?1:0,r.ntp_delta=this.ntp_delta}catch(t){n.sei_string=e}n.sei_string=n.sei_delay?void 0:e}},e.handleMetaDataLoaded=function(t){this.log.play_metadata_loaded.timestamp=getCurrentTime(),this.log.play_metadata_loaded.metadata_type=t;var e=!1;if(this.core){var i,n=this.core._context||this.core.context;n&&("video"===t?i=(n.getInstance("TRACKS")||{}).videoTrack:"audio"===t&&(i=(n.getInstance("TRACKS")||{}).audioTrack),i&&i.meta&&(e=!0,this.log.play_metadata_loaded.meta=i.meta,this.log.play_metadata_loaded.codec=i.meta.codec,"video"===t&&(this.commonParams.codec_type=i.meta.codec,this.log.play_metadata_loaded.codec_support=isCodecSupport(i.meta.codec),this.mark&&this.mark.setPlayer(this.player,(i.meta.codec||"").indexOf("avc")>-1?"h264":"h265"),this.commonParams.fps=i.meta.frameRate&&i.meta.frameRate.fps)))}e||(this.log.play_metadata_loaded.meta=void 0,this.log.play_metadata_loaded.codec=void 0,"video"===t&&(this.commonParams.codec_type="unknown")),this.logmanager.push(this.log.play_metadata_loaded)},e.handleDemuxError=function(t){this.log.play_demux_error.msg=t,this.logmanager.push(this.log.play_demux_error)},e.handleAVUnsync=function(t){Object.assign(this.log.play_av_unsync,t||{}),this.log.play_av_unsync.timestamp=getCurrentTime(),this.logmanager.push(this.log.play_av_unsync,!1)},e.handleDetectLargeGap=function(t,e){this.log.play_stream_discontinue.type=t,this.log.play_stream_discontinue.gap=e,this.logmanager.push(this.log.play_stream_discontinue)},e.initContextEvt=function(t){var e=this;t._emitter.once("LOADER_RESPONSE_HEADERS",function(t,i){try{var n=i.get("X-Server-Ip");if(!e.player)return;void 0!==e.player.hlsOps&&(e.log.play_stop.review_ts_count+=1),n&&(e.commonParams.cdn_ip=n)}catch(t){}}),t._emitter.on("LOADER_START__TO__TS_LOADER",function(t){e.handlePlayerLoadStream(t)}),t._emitter.on("LOADER_START",function(t){e.handlePlayerLoadStream(t)}),t._emitter.on("LOADER_COMPLETE",function(t){e.handlePlayerLoadedStream(t)}),t._emitter.on("LOADER_RETRY",function(){e.log.play_stop.retry_count++}),t._emitter.once("DEMUX_ERROR",function(t,i){i&&(e.log.play_demux_error.msg=i.message,e.handleDemuxError(i.message))}),t._emitter.on("METADATA_PARSED__TO__HLS_LIVE_CONTROLLER",function(t){e.handleMetaDataLoaded(t)}),t._emitter.on("REMUX_METADATA",function(t){e.handleMetaDataLoaded(t)}),t._emitter.on("DETECT_LARGE_GAP",function(t,i){e.handleDetectLargeGap(t,i)}),t._emitter.on("DETECT_AUDIO_GAP",function(t,i){e.logmanager.push(Object.assign({},e.log.play_audio_gap,{gap:t,silent_frame_count:i,from_evt:"DETECT_AUDIO_GAP"}))}),t._emitter.on("DETECT_AUDIO_OVERLAP",function(t){e.logmanager.push(Object.assign({},e.log.play_audio_overlap,{gap:t}))})},e.handlePlayerComlete=function(){var t=this;this.completed||(this.completed=!0,this.core=getPlayerCore(this.player),this.logmanager.core=this.core,this.commonParams.is_wasm&&(this.player.once("lowdecode",function(e){var i=(null==e?void 0:e.detail)||{};Object.assign(t.log.play_low_decode,i),t.log.play_low_decode.decode_fps=i.decodeFps,t.log.play_low_decode.timestamp=getCurrentTime(),t.logmanager.push(t.log.play_low_decode,!0)}),this.player.on("largeavgap",this.handleAVUnsync)),(this.player.config.autoplay||this.player.config.videoInit)&&this.reportStartPlay())},e.getPlayerBuffer=function(){var t=this.player.video.buffered;if(t){var e=Math.max(0,t.length-1);try{var i=Number.parseInt(1e3*(t.end(e)-this.player.video.currentTime));return this.log.playing.audio_buffer_time=this.log.playing.video_buffer_time=i,i}catch(t){return 0}}},e.setCdnIp=function(){if(!this.commonParams.cdn_ip&&this.core){var t=this.core._context||this.core.context;if(!t)return;var e=t.getInstance("FETCH_LOADER")||t.getInstance("TS_LOADER");if(!!e){var i=e.responseHeader;if(i){var n=i.get("X-Server-Ip")||i.get("x-server-ip")||i.get("X-SERVER-IP");n&&(this.commonParams.cdn_ip=n)}}}},e.getFetchLoader=function(){if(this.core){var t=this.core._context||this.core.context;return t?t.getInstance("FETCH_LOADER")||t.getInstance("TS_LOADER"):null}return null},e.getPlayerDownloadSpeed=function(){var t=this.getFetchLoader();if(t)return Number.parseInt(t.currentSpeed)},e.getDownloadSize=function(){var t=this.getFetchLoader();if(t)return t.totalByteSize},e.getPlayerQuality=function(){var t=this.player.video;if(t.getVideoPlaybackQuality){var e=t.getVideoPlaybackQuality();this.log.playing.drop_count=e.droppedVideoFrames-this.tempDroppedFrameCount,this.log.playing.drop_percent=Number.parseFloat(this.log.playing.drop_count/(e.totalVideoFrames-this.tempTotalFrameCount||.01)),this.log.play_stop.drop_percent=Number.parseFloat(e.droppedVideoFrames/e.totalVideoFrames),this.tempDroppedFrameCount=e.droppedVideoFrames,this.tempTotalFrameCount=e.totalVideoFrames}},e.reportPlaying=function(t){try{var e=getCurrentTime();return this.reportPlayingInner(t,e),t||this.setGpuScore(),Promise.resolve()}catch(t){return Promise.reject(t)}},e.reportPlayingInner=function(t,e){if(void 0===e&&(e=getCurrentTime()),this.commonParams.is_wasm)this.commonParams.fps=this.player.video.fps,this.log.playing.render_fps=this.player.video.fps,this.log.playing.decode_fps=this.player.video.decodeFps;else if(this.core){var i=this.core._context||this.core.context;if(i){var n=(i.getInstance("TRACKS")||{}).videoTrack;n&&n.meta&&n.meta.frameRate&&(this.commonParams.fps=n.meta.frameRate.fps,this.log.playing.render_fps=this.commonParams.fps)}if(this.core.transferCost){var r=this.core.transferCost;Object.assign(this.log.playing,{demuxCost:r.demuxCost-this.cachePlaying.demuxCost,remuxCost:r.remuxCost-this.cachePlaying.remuxCost,appendCost:r.appendCost-this.cachePlaying.appendCost}),Object.assign(this.cachePlaying,this.core.transferCost)}}var o=this.getDownloadSize();void 0!==o?(this.log.playing.downloaded_size=o>=this.cachePlaying.totalByteSize?o-this.cachePlaying.totalByteSize:o,this.cachePlaying.totalByteSize=o):this.log.playing.downloaded_size=void 0,this.log.playing.total_download_size=this.log.playing.downloaded_size,this.log.playing.index++;var a,s=this.log.playing.timestamp;this.inWaitingStart&&this.inWaitingStart<getCurrentTime()&&(a=Math.min(this.options.playingInterval||this.log.playing.play_time,getCurrentTime()-Math.max(this.inWaitingStart,s)));try{this.getPlayerQuality()}catch(t){}this.getPlayerBuffer(),this.options.downloadSpeedInterval||(this.log.playing.current_speed=this.getPlayerDownloadSpeed());var c=e-s;c<0&&(c=this.options.playingInterval||1e4);var l=(a>200?a:0)+this.log.playing.stall_time,u=(a>200?1:0)+this.log.playing.stall_count;this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=(a>this.options.aggregationDowngradeStallTime?a:0)+(this.log.playing.aggregation_downgrade_stall||0)),Object.assign(this.log.playing,_objectSpread2({timestamp:e,stop_time:e,time_hour:new Date(e).getHours(),duration:t?0:c/1e3,stall_time_per_100sec:l/c*100,stall_count_per_100sec:1e3*u/c*100,stall_count:u,stall_time:l,play_current_time:this.player.currentTime,first_frame_view:this.log.first_frame.first_frame_view},this.videoSize)),this.log.playing.video_render_stall_time_per_100sec=this.log.playing.stall_time_per_100sec,this.log.playing.video_render_stall_count_per_100sec=this.log.playing.stall_count_per_100sec,this.log.playing.download_speed=this.log.playing.downloaded_size&&this.log.playing.duration?8*this.log.playing.downloaded_size/this.log.playing.duration/1e3:8*this.log.playing.current_speed,this.logmanager.push(Object.assign({},this.log.playing,{play_time:t?0:c,is_super_resolution:_isSr(this.player.video)}),!0),this.log.playing.download_speed_array=[],this.log.playing.stall_time=0,this.log.playing.stall_count=0,this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=0)},e.handlePlayerPlaying=function(){try{var t=this;return t.player&&t.player.video.readyState<3?Promise.resolve():(t.player.off("playing",t.handlePlayerPlaying),t.player.off("timeupdate",t.handlePlayerPlaying),t.reportFirstframe(),t.player.paused?(t.handleVideopause(),Promise.resolve()):Promise.resolve(t.reportPlaying(!0)).then(function(){t.clearPlayingInterval();var e=t.options.playingInterval||1e4;t.intervalId=setInterval(function(){try{var i=function(){if(100>Math.abs(Date.now()-t.log.playing.timestamp-e)||Date.now()-t.log.playing.timestamp>=e){var i=function(){if(t.player.video){var e=function(){if(!t.player.paused)return Promise.resolve(t.reportPlaying()).then(function(){});t.handleVideopause()}();if(e&&e.then)return e.then(function(){})}else t.destroyFunc()}();if(i&&i.then)return i.then(function(){})}}();return Promise.resolve(i&&i.then?i.then(function(){}):void 0)}catch(t){return Promise.reject(t)}},1e3),t.handleVideoplaying(),t.started||t.reportStartPlay(),t.saveBuffered()}))}catch(t){return Promise.reject(t)}},e.handlePlayerReady=function(){var t=this;this.log.start_play.start_play_time=getCurrentTime(),this.player.config.autoplay&&this.reportStartPlay(),this.options.playResultThreshold&&(this.log.play_result.threshold=this.options.playResultThreshold),this.clearPlayResultTimer(),this.log.play_result.start=getCurrentTime(),this.playResultTimer=setTimeout(function(){t.log.play_result.timestamp>=t.log.play_result.start||t.player&&!t.player.paused&&t.player.video&&(t.log.play_result.elapsed=getCurrentTime()-t.log.play_result.start,t.log.play_result.is_shorter=+(t.log.play_result.elapsed<t.log.play_result.threshold),t.log.play_result.is_shorter||(t.log.play_result.is_threshold=1,t.logmanager.push(t.log.play_result,!0)))},this.log.play_result.threshold)},e.handlePlayerWaiting=function(){!this.inWaitingStart&&this.log.first_frame.timestamp&&(this.log.stall.timestamp=this.inWaitingStart=this.log.stall.stall_start=getCurrentTime(),this.log.stall_start.ready_state=this.log.stall.ready_state=this.player.video.readyState,this.log.stall_start.timestamp=getCurrentTime(),this.log.stall_start.stall_start_time=getCurrentTime(),this.log.stall_start.video_buffer_time=this.player.video.readyState,this.log.stall_start.play_current_time=this.player.currentTime,this.log.stall.play_current_time=this.player.currentTime,this.log.stall_start.buffered=this.getBuffered(),this.log.stall.buffered=this.log.stall_start.buffered,this.log.stall.current_speed=this.getPlayerDownloadSpeed(),this.log.stall.start_diff=getCurrentTime()-this.log.first_frame.timestamp,this.log.play_chase_frame.timestamp&&(this.log.stall.chase_diff=getCurrentTime()-this.log.play_chase_frame.timestamp),Object.assign(this.log.stall_start,this.videoSize))},e.handleVideoseeking=function(){this.player&&this.player.video&&this.inWaitingStart&&this.player.video.duration<1/0&&(this.inWaitingStart=0)},e.handleVideoseeked=function(){this.player&&this.player.video&&this.inWaitingStart&&this.player.video.duration<1/0&&(this.inWaitingStart=0,this.log.play_stop.stall_count>0&&this.log.play_stop.stall_count--)},e.handleVideoplay=function(){this.reportStartPlay(),this.removeVideoEvt("play",this.handleVideoplay)},e.handleVideotimeupdate=function(){Math.abs(this.player.currentTime-this.log.stall_start.play_current_time)>.2&&this.stallEnd(),this.saveBuffered()},e.handleVideocanplay=function(){this.setCdnIp(),this.stallEnd(),this.reportFirstframe()},e.handleVideoplaying=function(){this.stallEnd(),this.log.play_stop.is_stream_received=1;var t=getCurrentTime();this.reportStartPlay(),this.log.first_frame.start=t},e.stallEnd=function(){var t=getCurrentTime();if(this.inWaitingStart){var e=t-this.inWaitingStart;e>200&&(this.log.play_stop.stall_count++,this.log.play_stop.stall_time+=t-this.inWaitingStart,this.log.playing.stall_time+=t-Math.max(this.inWaitingStart,this.log.playing.timestamp),this.log.stall.stall_end=t,this.log.stall.timestamp=getCurrentTime(),this.log.playing.stall_count++,Object.assign(this.log.stall,_objectSpread2({},this.videoSize)),this.logmanager.push(this.log.stall,!0)),this.options.aggregationDowngradeStallTime&&e>this.options.aggregationDowngradeStallTime&&(this.log.playing.aggregation_downgrade_stall=(this.log.playing.aggregation_downgrade_stall||0)+(t-Math.max(this.inWaitingStart,this.log.playing.timestamp)))}this.inWaitingStart=0},e.handleVideoloadeddata=function(){this.reportFirstframe()},e.handleVideoratechange=function(){this.log.playing.speed_switch_count++,this.log.playing.speed_switch_info=this.player.video.playbackRate},e.handleVideoended=function(){this.clearPlayingInterval(),Object.assign(this.log.playing,{is_last:1}),this.reportPlayingInner()},e.handleVideoerror=function(){this.errorNumber=1;var t=this.player.video.error;Object.assign(this.log.play_error,_objectSpread2(_objectSpread2({timestamp:getCurrentTime()},this.videoSize),t&&{code:t.code,info:t.message})),this.logmanager.push(this.log.play_error,!0),0!==this.log.first_frame.first_frame_view||this.log.first_frame_failed.code||t&&(this.log.first_frame_failed.code=t.code,this.log.first_frame_failed.msg=video_error[t.code],void 0!==this.log.first_frame_failed.timestamp&&(this.log.first_frame_failed.timestamp=getCurrentTime()),this.logmanager.push(this.log.first_frame_failed,!0),this.log.play_result.is_threshold||(this.log.play_result.reason=video_error[t.code],this.log.play_result.code=t.code,this.clearPlayResultTimer(),this.logmanager.push(this.log.play_result,!0))),this.options.error_report_stop?this.handleUserLeave():this.updatePlayStopParams()},e.handleVideopause=function(){this.stallEnd(),this.clearPlayingInterval(),this.clearPlayResultTimer(),this.reportPlaying(),this.player.off("playing",this.handlePlayerPlaying),this.player.off("timeupdate",this.handlePlayerPlaying),this.player.once("playing",this.handlePlayerPlaying),this.player.once("timeupdate",this.handlePlayerPlaying)},e.destroyFunc=function(t){var e=this;this.destroyed||((!t||t instanceof Event)&&this.handleUserLeave(),this.destroyed=!0,this.removeWindowListener(),videoEvts.forEach(function(t){e.removeVideoEvt(t,e["handleVideo"+t+"Evt"])}),this.player&&(this.player._start&&(this.player.start=this.player._start,delete this.player._start),this.player.off("destroy",this.destroyFunc),this.player.off("complete",this.handlePlayerComlete),this.player.off("playing",this.handlePlayerPlaying),this.player.off("timeupdate",this.handlePlayerPlaying),this.player.off("ready",this.handlePlayerReady),this.player.off("waiting",this.handlePlayerWaiting),this.player.off("largeavgap",this.handleAVUnsync),this.player.off("error",this.handlePlayerError),this.player.off("SEI_PARSED",this.handleSEIParsed),this.player.off("pause",this.handlePlayerPause),this.player.off("ttfb",this.handleTTFB),this.player.off("urlchange",this.handleUrlChange),this.player.off("isKeyframe",this.handleKeyframe),this.player.off("sourceopen",this.handleSourceOpen),this.player.off("bufferappend",this.handleBufferAppend),this.player.off("degrade",this.handleDegrade),this.player.off("loadstart",this.handleLoadStart),this.player.off("ended",this.handlePlayerEnded),this.player.off("chaseframe",this.handleChaseFrame),this.player.off("detectedblackscreen",this.handleBlackScreen),this.player.off("audiotimestampbreaked",this.handleAudioGap),this.clearPlayingInterval(),this.clearPlayResultTimer(),this._player=null))},e.handleUserLeave=function(){!this.destroyed&&this.started&&(this.updatePlayStopParams(),this.reportPlayStop(),this.clearPlayingInterval(),this.removeWindowListener())},e.saveBuffered=function(){try{var t=this.getBuffered();t&&t.length&&(this.log.play_stop.buffered=t)}catch(t){}},e.getBuffered=function(){try{for(var t=[],e=this.player.video,i=0;i<e.buffered.length;i++)t.push([e.buffered.start(i),e.buffered.end(i)]);return t}catch(t){}},e.reportPlayStop=function(){this.log.play_stop.play_current_time=this.player.currentTime||this.log.playing.play_current_time,this.saveBuffered(),this.logmanager.push(this.log.play_stop,!0)},e.reportFirstframe=function(){if(!this.firstFrameViewed){this.firstFrameViewed=!0;var t=getCurrentTime();this.log.play_result.ff_start_cost=t-this.log.play_result.start;var e,i=t-this.log.start_play.start_play_time||t;if(Object.assign(this.log.first_frame,_objectSpread2({first_frame_view:i,timestamp:t,preload_diff:this.log.start_play.start_play_time-this.log.first_frame.preload_start,current_speed:this.getPlayerDownloadSpeed()},this.videoSize)),this.log.playing.first_speed=this.log.first_frame.current_speed,this.log.first_frame.ttfb_end&&(this.log.first_frame.ttdb=t-this.log.first_frame.ttfb_end),this.log.first_frame.buffered=this.getPlayerBuffer(),this.log.first_frame.sei_network_delay&&(this.log.first_frame.sei_buffer_delay=this.log.first_frame.buffered,this.log.first_frame.first_sei_delay=this.log.first_frame.sei_buffer_delay+this.log.first_frame.sei_network_delay),this.core&&this.core.transferCost&&Object.assign(this.log.first_frame,this.core.transferCost),!this.isRestart&&(null===(e=this.player.plugins)||void 0===e?void 0:e.resolutionsel))try{this.log.first_frame.resolutionsel_config=JSON.stringify(this.player.plugins.resolutionsel.config),this.log.first_frame.use_resolution=+!!this.player.plugins.resolutionsel.useResolution}catch(t){}if(this.logmanager.push(this.log.first_frame,!0),this.clearPlayResultTimer(),this.log.play_result.result=1,Object.assign(this.log.play_result,_objectSpread2({},this.videoSize)),this.logmanager.push(this.log.play_result,!0),this.log.play_stop.is_stream_received=1,i>0&&i<=1e4){var n=new Date;cacheFirstframe(60*n.getHours()+n.getMinutes(),i>=1e3)}}},e.updatePlayStopParams=function(){var t=getResourceTiming(this._url),e=getCurrentTime();this.playedTime=e-this.log.start_play.start_play_time;var i=this.log.play_stop;Object.assign(i,_objectSpread2({},0===i.stall_count&&{stall_time:0})),this.inWaitingStart&&e-this.inWaitingStart>200&&(i.stall_time+=e-this.inWaitingStart),this.inWaitingStart=0,Object.assign(i,_objectSpread2({stall_time_per_100sec:i.stall_time/this.playedTime*100,stall_count_per_100sec:1e3*i.stall_count/this.playedTime*100},t)),0===this.log.play_stop.stall_count_per_100sec&&(this.log.play_stop.stall_time_per_100sec=0),this.log.play_stop.stall_time_per_100sec>100||this.log.play_stop.stall_time_per_100sec<0||(this.log.playing.index?(Object.assign(this.log.playing,{is_last:1}),this.reportPlayingInner()):(this.log.play_stop.error_code=this.log.play_error.code,this.log.play_stop.error_info=this.log.play_error.info),Object.assign(i,_objectSpread2({timestamp:e=getCurrentTime(),stop_time:e,duration:this.playedTime/1e3,play_time:this.playedTime},this.videoSize)),0===this.errorNumber&&(i.play_time_on_no_frame=i.stop_time-this.log.start_play.start_play_time))},e.clearPlayingInterval=function(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)},e.clearPlayResultTimer=function(){clearTimeout(this.playResultTimer)},e.destroy=function(t){this.destroyFunc(!t)},e.bindVideoEvt=function(t,e){this.player&&this.player.video.addEventListener(t,e,!1)},e.removeVideoEvt=function(t,e){this.player&&this.player.video&&this.player.video.removeEventListener(t,e,!1)},e.send=function(t,e){this.logmanager.send(t,e)},t}();exports.default=LoggerControl,exports.sniffer=sniffer,Object.defineProperty(exports,"__esModule",{value:!0})})},496691:function(t,e,i){"use strict";i.d(e,{Z:function(){return s}});var n=i(398920),r=i(734123),o="xg-triple-video-hide",a="xg-triple-video",s=function(t){function e(t){var i;return(0,n.PA)(this,e),i=(0,n.$w)(this,e,[t]),(0,n._x)(i,"switchRenderElement",function(t){t?(i._video.style.display="none",i.root.classList.remove(o)):(i.root.classList.add(o),i._video.style.display="block")}),(0,n._x)(i,"cancelRaf",function(){i._rafId&&(window.cancelAnimationFrame(i._rafId),i._rafId=void 0)}),(0,n._x)(i,"initRender",function(){!i._render&&(i.isUseTriple=i.initCanvasSize(),i.isUseTriple&&i.config.enable&&i.config.isSupport?(i.cancelRaf(),i.initWebGL(),i._video.style.display="none"):i._video.style.display="block")}),(0,n._x)(i,"enterpictureinpicture",function(){i.root.classList.add(o)}),(0,n._x)(i,"leavepictureinpicture",function(){i.isUseTriple&&i.config.enable&&i.isSupport&&i.root.classList.remove(o)}),(0,n._x)(i,"emitDegrade",function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"webglcontextlost",e=new Event("degrade");e.message=t.type||t,i.root.classList.add(o),"webglcontextlost"===e.message&&(i.config.isSupport=!1),i._video&&(i._video.style.display="block",i._video.dispatchEvent(e))}),i}return(0,n.XW)(e,t),(0,n.qH)(e,[{key:"enable",set:function(t){if(this.config.enable!==t)this.config.enable=t,this.config.isSupport&&t?(this._render?!this._rafId&&(this._rafId=requestAnimationFrame(this._render)):this.initRender(),this.switchRenderElement(!0)):(this._rafId&&(window.cancelAnimationFrame(this._rafId),this._rafId=0),this.switchRenderElement(!1))}},{key:"afterCreate",value:function(){if(!this._inited)this._inited=!0,this._video=this.player.video,this._video.crossOrigin="anonymous",this.bindVideoEvents(),this._renderCanvas=this.root.querySelector(".".concat(a,"-canvas")),this._renderCanvas.addEventListener("webglcontextlost",this.emitDegrade)}},{key:"onPluginsReady",value:function(){this.player.plugins.rotate&&(this.cacheResizePosition=this.player.resizePosition.bind(this.player),this.player.resizePosition=this.resizePosition.bind(this.player))}},{key:"resizePosition",value:function(){var t=this.videoPos,e=t.rotate,i=t.vy,n=t.vx,o=t.h,a=t.w;if(e<0&&o<0&&a<0)return;var s=this.videoPos._pi;if(!s&&this.video.videoHeight&&(s=this.video.videoWidth/this.video.videoHeight*100),!!s){this.videoPos.pi=s;var c={},l=0,u=0,h=1,f=e<0?0:Math.abs(e/90),d=this.root,p=this.innerContainer,g=d.offsetWidth,y=p?p.offsetHeight:d.offsetHeight,_=y,v=g,m={width:g,height:y};if(f%2==0)h=o>0?100/o:a>0?100/a:1,c.scale=h,l=i>0?(100-o)/2-i:0,c.y=2===f?0-l:l,u=n>0?(100-a)/2-n:0,c.x=2===f?0-u:u,m.width=v,m.height=_;else if(f%2==1){v=y,_=g;var b=y-g;u=-b/2/v*100,c.x=3===f?u+i/2:u-i/2,l=b/2/_*100,c.y=3===f?l+n/2:l-n/2,c.scale=h,m.width=v,m.height=_}var E=this.video,w=this.plugins.triplevideo.root,k=[0,90,180,270].includes(+e);e>=0&&["width","height"].forEach(function(t){E.style[t]="".concat(m[t],"px"),k&&(w.style[t]="".concat(m[t],"px"))}),c.rotate=e<0?0:e;var S=r.Util.getTransformStyle(c,this.video.style.transform||this.video.style.webkitTransform);E.style.transform=S,E.style.webkitTransform=S,k&&(w.style.transform="scale(".concat(h,") translate(").concat(u,"%, 0) rotate(").concat(e,"deg)"))}}},{key:"destroy",value:function(){this.cancelRaf(),this._renderCanvas.removeEventListener("webglcontextlost",this.emitDegrade),this.cacheResizePosition&&(this.player.resizePosition=this.cacheResizePosition),this._video&&(this._video.style.display="block",this._video.removeEventListener("loadeddata",this.initRender),this._video.removeEventListener("enterpictureinpicture",this.enterpictureinpicture),this._video.removeEventListener("leavepictureinpicture",this.leavepictureinpicture))}},{key:"bindVideoEvents",value:function(){this._video.addEventListener("loadeddata",this.initRender),this._video.addEventListener("enterpictureinpicture",this.enterpictureinpicture),this._video.addEventListener("leavepictureinpicture",this.leavepictureinpicture)}},{key:"initCanvasSize",value:function(){if(this._renderCanvas.inited)return!0;if(!this._video.videoWidth||!this._video.videoHeight)return this.emitDegrade("videoWidth or videoHeight is 0"),!1;if(this._video.videoHeight>this._video.videoWidth){var t=Math.ceil(1080/this._video.videoHeight);return this._renderCanvas.width=3*this._video.videoWidth*t,this._renderCanvas.height=this._video.videoHeight*t,this._renderCanvas.inited=!0,!0}return this.emitDegrade("videoHeight <= videoWidth"),!1}},{key:"initWebGL",value:function(){var t=this,e=this._renderCanvas.getContext("webgl")||this._renderCanvas.getContext("experimental-webgl"),i="\n        attribute vec2 aPosition;\n        attribute vec2 aTexCoord;\n        varying vec2 vTexCoord;\n        \n        void main() {\n            gl_Position = vec4(aPosition, 0.0, 1.0);\n            vTexCoord = aTexCoord;\n        }\n    ",n="\n        precision mediump float;\n        varying vec2 vTexCoord;\n        uniform sampler2D uSampler;\n        \n        void main() {\n            gl_FragColor = texture2D(uSampler, vTexCoord);\n        }\n    ",r=this.initShaderProgram(e,i,n),o={program:r,attribLocations:{position:e.getAttribLocation(r,"aPosition"),texCoord:e.getAttribLocation(r,"aTexCoord")},uniformLocations:{sampler:e.getUniformLocation(r,"uSampler")}},a=this.initBuffers(e),s=this.initTexture(e);this._render=function(){t.drawScene(e,o,a,s),t._rafId=requestAnimationFrame(t._render)},this._rafId=requestAnimationFrame(this._render)}},{key:"initShaderProgram",value:function(t,e,i){var n=this.loadShader(t,t.VERTEX_SHADER,e),r=this.loadShader(t,t.FRAGMENT_SHADER,i),o=t.createProgram();return(t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS))?o:(this.emitDegrade("init shader program failed"),null)}},{key:"loadShader",value:function(t,e,i){var n=t.createShader(e);return(t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS))?n:(t.deleteShader(n),this.emitDegrade("load shader failed"),null)}},{key:"initBuffers",value:function(t){var e=[-1,-1,-1/3,-1,-1,1,-1/3,1,-1/3,-1,1/3,-1,-1/3,1,1/3,1,1/3,-1,1,-1,1/3,1,1,1],i=[0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0],n=[0,1,2,1,2,3,4,5,6,5,6,7,8,9,10,9,10,11],r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW);var o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW);var a=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),t.STATIC_DRAW),{position:r,textureCoord:o,indices:a}}},{key:"initTexture",value:function(t){var e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),this.updateTexture(t,e),e}},{key:"drawScene",value:function(t,e,i,n){t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),this.updateTexture(t,n),t.bindBuffer(t.ARRAY_BUFFER,i.position),t.vertexAttribPointer(e.attribLocations.position,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.position),t.bindBuffer(t.ARRAY_BUFFER,i.textureCoord),t.vertexAttribPointer(e.attribLocations.texCoord,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(e.attribLocations.texCoord),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i.indices),t.useProgram(e.program),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,n),t.uniform1i(e.uniformLocations.sampler,0),t.drawElements(t.TRIANGLES,18,t.UNSIGNED_SHORT,0)}},{key:"updateTexture",value:function(t,e){var i;t.bindTexture(t.TEXTURE_2D,e),null!==(i=this._video)&&void 0!==i&&i.videoWidth&&t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._video)}},{key:"render",value:function(){var t=this.config,e=t.enable,i=t.isSupport;return'\n    <div class="'.concat(a," ").concat(e&&i?"":o,'">\n      <canvas class="').concat(a,'-canvas"></canvas>\n    </div>\n    ')}}],[{key:"pluginName",get:function(){return"triplevideo"}},{key:"defaultConfig",get:function(){return{enable:!1,isSupport:e.isSupported()}}},{key:"isSupported",value:function(){if("undefined"==typeof window)return!1;var t=document.createElement("canvas");return!!(t.getContext("webgl")||t.getContext("experimental-webgl"))&&!!window.requestAnimationFrame}}])}(r.Plugin)},713936:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,k(n.key),n)}}function o(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e,i){return(e=k(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function u(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function h(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function f(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return h(t)}function d(t){var e=u();return function(){var i,n=c(t);return i=e?Reflect.construct(n,arguments,c(this).constructor):n.apply(this,arguments),f(this,i)}}function p(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}function g(){return(g="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=p(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}function y(t){return _(t)||v(t)||m(t)||E()}function _(t){if(Array.isArray(t))return b(t)}function v(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function m(t,e){if(t){if("string"==typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(t,e)}}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function E(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function k(t){var e=w(t,"string");return"symbol"==typeof e?e:String(e)}i.d(e,{IP:function(){return c},Lc:function(){return h},PA:function(){return n},U2:function(){return g},WY:function(){return d},XW:function(){return s},_x:function(){return a},qH:function(){return o},u:function(){return y}})},90072:function(t,e,i){"use strict";var n=i(101380),r=i(439837),o=i.n(r),a=i(88648),s=i(336279),c=i(526361),l=function(t){if(!t)return 0;var e=o()(t).valueOf()-Date.now();return e<0?0:e},u=function(t){return{days:Math.floor(t/864e5),hours:Math.floor(t/36e5)%24,minutes:Math.floor(t/6e4)%60,seconds:Math.floor(t/1e3)%60,milliseconds:Math.floor(t)%1e3}},h=function(t){void 0===t&&(t={});var e=t||{},i=e.leftTime,r=e.targetDate,o=e.interval,h=void 0===o?1e3:o,f=e.onEnd,d=(0,a.useMemo)(function(){return(0,c.hj)(i)&&i>0?Date.now()+i:void 0},[i]),p="leftTime"in t?d:r,g=(0,n.CR)((0,a.useState)(function(){return l(p)}),2),y=g[0],_=g[1],v=(0,s.Z)(f);(0,a.useEffect)(function(){if(!p){_(0);return}_(l(p));var t=setInterval(function(){var e,i=l(p);_(i),0===i&&(clearInterval(t),null===(e=v.current)||void 0===e||e.call(v))},h);return function(){return clearInterval(t)}},[p,h]);var m=(0,a.useMemo)(function(){return u(y)},[y]);return[y,m]};e.Z=h},339416:function(t,e,i){var n=i(500024);function r(t,e,i){for(var r=-1,o=t.criteria,a=e.criteria,s=o.length,c=i.length;++r<s;){var l=n(o[r],a[r]);if(l){if(r>=c)return l;return l*("desc"==i[r]?-1:1)}}return t.index-e.index}t.exports=r},779145:function(t,e,i){var n=i(967529),r=i(768341),o=i(868085),a=i(257675),s=i(43715),c=i(652111),l=i(603233),u=i(481611),h=i(667005),f=i(410204),d="[object Map]",p="[object Set]",g=n?n.iterator:void 0;function y(t){if(!t)return[];if(a(t))return s(t)?h(t):r(t);if(g&&t[g])return c(t[g]());var e=o(t);return(e==d?l:e==p?u:f)(t)}t.exports=y},704002:function(t,e){"use strict";e.Z={disabled:!1}},20642:function(t,e,i){"use strict";i.d(e,{Q:function(){return n}});var n=function(t){return t.scrollTop}},701175:function(t,e,i){"use strict";var n=i(584065);function r(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function o(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function a(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}var s=function(){function t(){r(this,t)}return a(t,null,[{key:"_ebsp2rbsp",value:function(t){for(var e=t,i=e.byteLength,n=new Uint8Array(i),r=0,o=0;o<i;o++){if(!(o>=2)||3!==e[o]||0!==e[o-1]||0!==e[o-2])n[r]=e[o],r++}return new Uint8Array(n.buffer,0,r)}},{key:"parseSPS",value:function(e){var i=t._ebsp2rbsp(e),r=new n.Z(i),o=0,a=0,s=0,c=0,l=0,u=0,h=0,f=0,d=0,p=0,g=0,y=0,_=0,v=0,m=0,b=0,E=0,w={};return r.readByte(),r.readByte(),o=r.readBits(4),a=r.readBits(3),s=r.readBits(1),w=t._readProfileTierLevel(r,a),c=r.readUEG(),3===(u=r.readUEG())&&(l=r.readBits(1)),h=r.readUEG(),f=r.readUEG(),1===(_=r.readBits(1))&&(d=r.readUEG(),p=r.readUEG(),g=r.readUEG(),y=r.readUEG()),v=r.readUEG(),m=r.readUEG(),1===_&&(b=(1===u||2===u)&&0===l?2:1,E=1===u&&0===l?2:1,h-=b*p+b*d,f-=E*y+E*g),r.destroy(),r=null,{width:h,height:f,general_profile_space:w.general_profile_space,general_tier_flag:w.general_tier_flag,general_profile_idc:w.general_profile_idc,general_level_idc:w.general_level_idc,chromaFormatIdc:u,bitDepthLumaMinus8:v,bitDepthChromaMinus8:m}}},{key:"_readProfileTierLevel",value:function(t,e){var i=0,n=0,r=0,o=0;i=t.readBits(2)||0,n=t.readBits(1)||0,r=t.readBits(5)||0,t.readBits(16),t.readBits(16),t.readBits(1),t.readBits(1),t.readBits(1),t.readBits(1),t.readBits(16),t.readBits(16),t.readBits(12),o=t.readBits(8)||0;for(var a=[],s=[],c=0;c<e;c++)a[c]=t.readBits(1),s[c]=t.readBits(1);e>0&&t.readBits((8-e)*2);for(var l=0;l<e;l++)0!==a[l]&&(t.readBits(2),t.readBits(1),t.readBits(5),t.readBits(16),t.readBits(16),t.readBits(4),t.readBits(16),t.readBits(16),t.readBits(12)),0!==s[l]&&t.readBits(8);return{general_profile_space:i,general_tier_flag:n,general_profile_idc:r,general_level_idc:o}}},{key:"_skipScalingList",value:function(t,e){for(var i=8,n=8,r=0,o=0;o<e;o++)0!==n&&(n=(i+(r=t.readSEG())+256)%256),i=0===n?i:n}},{key:"getProfileString",value:function(t){switch(t){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(t){return(t/10).toFixed(1)}},{key:"getChromaFormatString",value:function(t){switch(t){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(t){var e={};return t&&t.codec_size?(e.codecWidth=t.codec_size.width,e.codecHeight=t.codec_size.height,e.presentWidth=t.present_size.width,e.presentHeight=t.present_size.height):t.width&&t.height&&(e.codecWidth=t.width,e.codecHeight=t.height,e.presentWidth=t.width,e.presentHeight=t.height),e.profile=t.profile_string,e.level=t.level_string,e.bitDepth=t.bit_depth,e.chromaFormat=t.chroma_format,e}}]),t}();e.Z=s},695596:function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var o=function(){function t(){i(this,t)}return r(t,null,[{key:"decode",value:function(e){for(var i=[],n=e,r=0,o=e.length;r<o;){if(n[r]<128){i.push(String.fromCharCode(n[r])),++r;continue}if(n[r]<192);else if(n[r]<224){if(t._checkContinuation(n,r,1)){var a=(31&n[r])<<6|63&n[r+1];if(a>=128){i.push(String.fromCharCode(65535&a)),r+=2;continue}}}else if(n[r]<240){if(t._checkContinuation(n,r,2)){var s=(15&n[r])<<12|(63&n[r+1])<<6|63&n[r+2];if(s>=2048&&(63488&s)!=55296){i.push(String.fromCharCode(65535&s)),r+=3;continue}}}else if(n[r]<248&&t._checkContinuation(n,r,3)){var c=(7&n[r])<<18|(63&n[r+1])<<12|(63&n[r+2])<<6|63&n[r+3];if(c>65536&&c<1114112){c-=65536,i.push(String.fromCharCode(c>>>10|55296)),i.push(String.fromCharCode(1023&c|56320)),r+=4;continue}}i.push(String.fromCharCode(65533)),++r}return i.join("")}},{key:"_checkContinuation",value:function(t,e,i){var n=t;if(!(e+i<n.length))return!1;for(;i--;)if((192&n[++e])!=128)return!1;return!0}}]),t}();e.Z=o},809553:function(t,e){"use strict";function i(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var o=function(){function t(e){i(this,t),this.length=e||0,this.historyLen=e||0,this.array=[],this.offset=0}return r(t,[{key:"push",value:function(t){this.array.push(t),this.length+=t.byteLength,this.historyLen+=t.byteLength}},{key:"shift",value:function(t){if(this.array.length<1)return new Uint8Array(0);if(void 0===t)return this._shiftBuffer();if(this.offset+t===this.array[0].length){var e=this.array[0].slice(this.offset,this.offset+t);return this.offset=0,this.array.shift(),this.length-=t,e}if(this.offset+t<this.array[0].length){var i=this.array[0].slice(this.offset,this.offset+t);return this.offset+=t,this.length-=t,i}for(var n=new Uint8Array(t),r=0;this.array.length>0&&t>0;){if(this.offset+t<this.array[0].length){var o=this.array[0].slice(this.offset,this.offset+t);n.set(o,r),this.offset+=t,this.length-=t,t=0;break}var a=this.array[0].length-this.offset;n.set(this.array[0].slice(this.offset,this.array[0].length),r),this.array.shift(),this.offset=0,r+=a,this.length-=a,t-=a}return n}},{key:"clear",value:function(){this.array=[],this.length=0,this.offset=0}},{key:"destroy",value:function(){this.clear(),this.historyLen=0}},{key:"_shiftBuffer",value:function(){return this.length-=this.array[0].length,this.offset=0,this.array.shift()}},{key:"toInt",value:function(t,e){for(var i,n=0,r=this.offset+t;r<this.offset+e+t;)r<(null===(i=this.array[0])||void 0===i?void 0:i.length)?n=256*n+this.array[0][r]:this.array[1]&&(n=256*n+this.array[1][r-this.array[0].length]),r++;return n}}]),t}();e.Z=o},53673:function(t,e,i){"use strict";i.d(e,{Z:function(){return m}});var n=i(721032),r=i(879146),o=i.n(r),a=i(829288),s=i(285563);function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function l(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function u(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function h(t,e,i){return e&&u(t.prototype,e),i&&u(t,i),t}function f(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&d(t,e)}function d(t,e){return(d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){var e=_();return function(){var i,n=v(t);return i=e?Reflect.construct(n,arguments,v(this).constructor):n.apply(this,arguments),g(this,i)}}function g(t,e){return e&&("object"===c(e)||"function"==typeof e)?e:y(t)}function y(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var m=function(t){f(i,t);var e=p(i);function i(t){var n,r=t.videoMeta,o=t.audioMeta,a=t.curTime;l(this,i),(n=e.call(this)).TAG="Fmp4Remuxer",n._dtsBase=1e3*a,n._videoMeta=r,n._audioMeta=o,n._audioDtsBase=null,n._videoDtsBase=null,n._isDtsBaseInited=!1,n.isFirstVideo=!0,n.isFirstAudio=!0,n.videoAllDuration=0,n.audioAllDuration=0,n.audioRemuxed=0,n.videoRemuxed=0,n.mp4Durations={keys:[]};var s=/Chrome\/([^.]+)/.exec(navigator.userAgent);return n.forceFirstIDR=s&&50>Number(s[1]),n}return h(i,[{key:"destroy",value:function(){this._dtsBase=-1,this._isDtsBaseInited=!1,this.mp4Durations={keys:[]},this.removeAllListeners()}},{key:"remux",value:function(t,e){this._isDtsBaseInited||this.calcDtsBase(t,e),this.remuxVideo(e),this.remuxAudio(t),n.Z.groupEnd()}},{key:"resetDtsBase",value:function(){this._dtsBase=0}},{key:"seek",value:function(t){n.Z.log(this.TAG,"set dtsBase for seek(),time=",t),this._isDtsBaseInited&&(this._isDtsBaseInited=!1),this._dtsBase=1e3*t,this._audioDtsBase=this._videoDtsBase=null}},{key:"remuxInitSegment",value:function(t,e){n.Z.log(this.TAG,"remuxInitSegment: type=",t,e);var i=new a.Z,r=36===e.streamType?s.Z.ftypHEVC():s.Z.ftyp(),o=s.Z.moov({type:t,meta:e});return i.write(r,o),i}},{key:"calcDtsBase",value:function(t,e){if(!t&&e.samples.length){var i,r=e.samples[0];r.options&&r.options.start&&(i=r.options.start),this._videoDtsBase=r.dts-(i||this._dtsBase),this._isDtsBaseInited=!0;return}if(!!t&&!!t.samples.length||!!e&&!!e.samples.length){var o=null,a=null,s=null;if(t&&t.samples&&t.samples.length){var c=t.samples[0];o=c.dts,c.options&&c.options.start&&(s=c.options.start)}if(e&&e.samples&&e.samples.length){var l=e.samples[0];a=l.dts,l.options&&l.options.start&&(s=l.options.start)}var u=o-a;u<0&&null!==s&&e.samples.forEach(function(t){t.dts-=u,t.pts&&(t.pts-=u)}),this._videoDtsBase=(a||o)-(s||this._dtsBase),this._audioDtsBase=(o||a)-(s||this._dtsBase),this._dtsBase=Math.min(a,o),this._isDtsBaseInited=!0,n.Z.log(this.TAG,"calcDtsBase"),n.Z.log(this.TAG,"video first dts: ".concat(a," , start:").concat(s," , _videoDtsBase:").concat(this._videoDtsBase," , _dtsBase:").concat(this._dtsBase)),n.Z.log(this.TAG,"audio first dts: ".concat(o," , start:").concat(s," , _audioDtsBase:").concat(this._audioDtsBase,", _dtsBase:").concat(this._dtsBase))}}},{key:"remuxVideo",value:function(t){var e=this,r=t||{};if(!!t&&!!t.samples&&!!t.samples.length){var o=r.samples;if(r.meta){for(var c=-1,l=null,u=[],h={samples:[]},f=1e4,d=!0;o.length&&f-- >0;){var p=o.shift(),g=p.isKeyframe,y=p.options;if(!this.isFirstVideo&&y&&y.meta){l=this.remuxInitSegment("video",y.meta),y.meta=null,o.unshift(p),!y.isContinue&&(this._videoDtsBase=0);break}var _=Math.max(0,p.dts-this.videoDtsBase);-1===c&&(c=_);var v=void 0,m=void 0;void 0!==p.pts&&(v=(m=p.pts-this._dtsBase)-_),void 0!==p.cts&&(m=p.cts+_,v=p.cts);var b={buffer:[],size:0},E=0;E=p.duration?p.duration:o.length>=1?o[0].dts-this.videoDtsBase-_:u.length>=1?u[u.length-1].duration:this._videoMeta.refSampleDuration,this.videoAllDuration+=E,n.Z.long&&n.Z.log(this.TAG,"video dts ".concat(_),"pts ".concat(m),"cts: ".concat(v),g,"originDts ".concat(p.originDts),"duration ".concat(E),d),E>=0&&(h.samples.push(b),b.buffer.push(p.data),b.size+=p.data.byteLength,u.push({dts:_,cts:v,pts:m,data:p.data,size:p.data.byteLength,isKeyframe:g,duration:E,flags:{isLeading:0,dependsOn:g||this.forceFirstIDR&&d?2:1,isDependedOn:g?1:0,hasRedundancy:0,isNonSync:g||this.forceFirstIDR&&d?0:1},originDts:_,type:"video"}),d=!1,this.mp4Durations[m]=E,this.mp4Durations.keys.push(m)),g&&this.emit(i.EVENTS.RANDOM_ACCESS_POINT,m)}if(this.mp4Durations.keys.length>1e4){var w=this.mp4Durations;this.mp4Durations={},this.mp4Durations.keys=w.keys.slice(-100),this.mp4Durations.keys.forEach(function(t){e.mp4Durations[t]=w[t]})}u.length&&n.Z.log(this.TAG,"remux to mp4 video:",[c/1e3,u[u.length-1].dts/1e3]);var k=new a.Z;if(u.length&&r.meta){var S=s.Z.moof({id:r.meta.id,time:c,samples:u}),T=s.Z.mdat(h);k.write(S,T),this.segmentRemuxed("video",k,u[u.length-1].pts-u[0].pts)}if(l&&(this.segmentRemuxed("video",l),o.length))return r.samples=o,this.remuxVideo(r);this.isFirstVideo=!1,this.emit(i.EVENTS.TRACK_REMUXED,"video",k),r.samples=[],r.length=0}}}},{key:"remuxAudio",value:function(t){var e=(t||{}).samples,r=-1,o=[],c=null,l={samples:[]};if(!!e&&!!e.length){for(var u=1e4,h=!1;e.length&&u-- >0;){var f=e.shift(),d=f.data,p=f.options;if(!this.isFirstAudio&&p&&p.meta){c=this.remuxInitSegment("audio",p.meta),p.meta=null,e.unshift(f),!p.isContinue&&(this._audioDtsBase=0);break}var g=Math.max(0,f.dts-this.audioDtsBase),y=f.originDts;!h&&(r=g,h=!0);var _=0;_=f.duration?f.duration:this._audioMeta.refSampleDurationFixed?this._audioMeta.refSampleDurationFixed:e.length>=1?e[0].dts-this.audioDtsBase-g:o.length>=1?o[o.length-1].duration:this._audioMeta.refSampleDuration,n.Z.long&&n.Z.log(this.TAG,"audio dts ".concat(g),"pts ".concat(g),"originDts ".concat(y),"duration ".concat(_)),this.audioAllDuration+=_;var v={dts:g,pts:g,cts:0,size:d.byteLength,duration:f.duration?f.duration:_,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,isNonSync:0},isKeyframe:!0,originDts:y,type:"audio"},m={buffer:[],size:0};_>=0&&(m.buffer.push(d),m.size+=d.byteLength,l.samples.push(m),o.push(v))}var b=new a.Z;if(o.length&&t.meta){n.Z.log(this.TAG,"remux to mp4 audio:",[r/1e3,o[o.length-1].dts/1e3]);var E=s.Z.moof({id:t.meta.id,time:r,samples:o}),w=s.Z.mdat(l);b.write(E,w),this.segmentRemuxed("audio",b,o[o.length-1].dts-o[0].dts)}if(c&&(this.segmentRemuxed("audio",c),e.length))return t.samples=e,this.remuxAudio(t);this.isFirstAudio=!1,this.emit(i.EVENTS.TRACK_REMUXED,"audio",b),t.samples=[],t.length=0}}},{key:"segmentRemuxed",value:function(t,e,n){this.emit(i.EVENTS.MEDIA_SEGMENT,t,e,n)}},{key:"videoDtsBase",get:function(){return null!==this._videoDtsBase?this._videoDtsBase:this._dtsBase},set:function(t){this._videoDtsBase=t}},{key:"audioDtsBase",get:function(){return null!==this._audioDtsBase?this._audioDtsBase:this._dtsBase}}],[{key:"EVENTS",get:function(){return{MEDIA_SEGMENT:"MEDIA_SEGMENT",INIT_SEGMENT:"INIT_SEGMENT",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT",TRACK_REMUXED:"TRACK_REMUXED"}}}]),i}(o())},721032:function(t,e){"use strict";function i(t){return a(t)||o(t)||r(t)||n()}function n(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return s(t,e)}}function o(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function a(t){if(Array.isArray(t))return s(t)}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function c(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function u(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),t}var h=function(){function t(){var e=this;c(this,t);try{var n=/xgd=(\d)/.exec(document.cookie);this._status=!!n,this._level=n&&n[1]}catch(t){this._status=!1}["group","groupEnd","log","warn","error","trace"].forEach(function(t){e[t]=function(n,r,o,a,s,c,l,u,h,f){if(e._status){var d,p=n,g=[r,o,a,s,c,l,u,h,f].filter(function(t){return void 0!==t});(d=console)[t].apply(d,["["+p+"]:"].concat(i(g)))}}})}return u(t,[{key:"enable",get:function(){return this._status}},{key:"long",get:function(){return"2"===this._level}}]),t}();e.Z=new h},779148:function(t,e){"use strict";var i={VISIBILITY_CHANGE:"VISIBILITY_CHANGE"},n={SEEK:"SEEK"},r={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_RESPONSE_HEADERS:"LOADER_RESPONSE_HEADERS",LOADER_ERROR:"LOADER_ERROR",LOADER_RETRY:"LOADER_RETRY",LOADER_TTFB:"LOADER_TTFB"},o={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",SEI_PARSED:"SEI_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO",ISKEYFRAME:"ISKEYFRAME"},a={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM",DETECT_CHANGE_STREAM_DISCONTINUE:"DETECT_CHANGE_STREAM_DISCONTINUE",DETECT_AUDIO_GAP:"DETECT_AUDIO_GAP",DETECT_LARGE_GAP:"DETECT_LARGE_GAP",DETECT_AUDIO_OVERLAP:"DETECT_AUDIO_OVERLAP",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT",DETECT_FRAG_ID_DISCONTINUE:"DETECT_FRAG_ID_DISCONTINUE"},s={SOURCE_UPDATE_END:"SOURCE_UPDATE_END",MSE_ERROR:"MSE_ERROR",MSE_WRONG_TRACK_ADD:"MSE_WRONG_TRACK_ADD",MSE_CHANGE_CODEC_ERROR:"MSE_CHANGE_CODEC_ERROR"},c={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},l={START_DECRYPTOO:"START_DECRYPTO",DECRYPTED:"DECRYPTED"},u=Object.assign({},r,o,a,s,c,n,i),h=[],f=[];for(var d in u)u.hasOwnProperty(d)&&h.push(u[d]);for(var p in u)u.hasOwnProperty(p)&&f.push(u[p]);e.Z={ALLEVENTS:u,HLS_EVENTS:c,REMUX_EVENTS:a,DEMUX_EVENTS:o,MSE_EVENTS:s,LOADER_EVENTS:r,FlvAllowedEvents:h,HlsAllowedEvents:f,CRYPTO_EVENTS:l,PLAYER_EVENTS:n,BROWSER_EVENTS:i}},515738:function(t,e){"use strict";var i={VISIBILITY_CHANGE:"VISIBILITY_CHANGE"},n={SEEK:"SEEK"},r={LADER_START:"LOADER_START",LOADER_DATALOADED:"LOADER_DATALOADED",LOADER_COMPLETE:"LOADER_COMPLETE",LOADER_RESPONSE_HEADERS:"LOADER_RESPONSE_HEADERS",LOADER_ERROR:"LOADER_ERROR",LOADER_RETRY:"LOADER_RETRY",LOADER_TTFB:"LOADER_TTFB"},o={DEMUX_START:"DEMUX_START",DEMUX_COMPLETE:"DEMUX_COMPLETE",DEMUX_ERROR:"DEMUX_ERROR",METADATA_PARSED:"METADATA_PARSED",SEI_PARSED:"SEI_PARSED",VIDEO_METADATA_CHANGE:"VIDEO_METADATA_CHANGE",AUDIO_METADATA_CHANGE:"AUDIO_METADATA_CHANGE",MEDIA_INFO:"MEDIA_INFO",ISKEYFRAME:"ISKEYFRAME"},a={REMUX_METADATA:"REMUX_METADATA",REMUX_MEDIA:"REMUX_MEDIA",MEDIA_SEGMENT:"MEDIA_SEGMENT",REMUX_ERROR:"REMUX_ERROR",INIT_SEGMENT:"INIT_SEGMENT",DETECT_CHANGE_STREAM:"DETECT_CHANGE_STREAM",DETECT_CHANGE_STREAM_DISCONTINUE:"DETECT_CHANGE_STREAM_DISCONTINUE",DETECT_AUDIO_GAP:"DETECT_AUDIO_GAP",DETECT_LARGE_GAP:"DETECT_LARGE_GAP",DETECT_AUDIO_OVERLAP:"DETECT_AUDIO_OVERLAP",RANDOM_ACCESS_POINT:"RANDOM_ACCESS_POINT",DETECT_FRAG_ID_DISCONTINUE:"DETECT_FRAG_ID_DISCONTINUE"},s={SOURCE_UPDATE_END:"SOURCE_UPDATE_END",MSE_ERROR:"MSE_ERROR",MSE_WRONG_TRACK_ADD:"MSE_WRONG_TRACK_ADD",MSE_CHANGE_CODEC_ERROR:"MSE_CHANGE_CODEC_ERROR"},c={RETRY_TIME_EXCEEDED:"RETRY_TIME_EXCEEDED"},l={START_DECRYPTOO:"START_DECRYPTO",DECRYPTED:"DECRYPTED"},u=Object.assign({},r,o,a,s,c,n,i),h=[],f=[];for(var d in u)u.hasOwnProperty(d)&&h.push(u[d]);for(var p in u)u.hasOwnProperty(p)&&f.push(u[p]);e.Z={ALLEVENTS:u,HLS_EVENTS:c,REMUX_EVENTS:a,DEMUX_EVENTS:o,MSE_EVENTS:s,LOADER_EVENTS:r,FlvAllowedEvents:h,HlsAllowedEvents:f,CRYPTO_EVENTS:l,PLAYER_EVENTS:n,BROWSER_EVENTS:i}},225629:function(t,e,i){"use strict";function n(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),t}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}i.d(e,{Z:function(){return s}});var s=function(){function t(){n(this,t),a(this,"_sampleQueue",[]),a(this,"_speed",0),a(this,"_recentSpeed",0),a(this,"_timer",0),a(this,"_dit",0),a(this,"_contentLength",0),a(this,"_totalByteSize",0),a(this,"_speedDown",!1)}return o(t,[{key:"recordLoading",value:function(t){var e=t.get("content-length")||0,i=t.get("Accept-Ranges"),n=t.get("Content-Range"),r=!!i||!!n;if(!!e&&!r){this._contentLength=e;var o=Math.floor(e/this._speed*1e3);!(o<50)&&(this._dit=performance.now(),this._startTick(e,o))}}},{key:"recordLoaded",value:function(){this._cleanTimer();var t=performance.now()-this._dit;this._addSample(Math.floor(this._contentLength/t))}},{key:"recordChunk",value:function(t){if(!this._timer){this._dit=performance.now(),this._startTickForStream();return}this._totalByteSize+=t,this._contentLength+=t}},{key:"_startTick",value:function(t,e){var i=this;this._cleanTimer(),this._timer=setInterval(function(){var e=performance.now()-i._dit;i._addSample(Math.floor(t/e))},e)}},{key:"_startTickForStream",value:function(){var t=this;this._timer=setInterval(function(){t._addSample(t._calcSampleSpeed())},1e3)}},{key:"_calcSampleSpeed",value:function(){var t=performance.now()-this._dit,e=Math.floor(this._contentLength/t);return this._contentLength=0,this._dit=performance.now(),e}},{key:"_addSample",value:function(t){this._recentSpeed=1e3*t,this._sampleQueue.length>3&&(this._sampleQueue=[]),this._sampleQueue.push(t),this._calcAvgSpeed(this._sampleQueue)}},{key:"_calcAvgSpeed",value:function(t){var e=t.length,i=t.reduce(function(t,e){return t+=e},0)/e;this._speed=1e3*Math.floor(i)}},{key:"_cleanTimer",value:function(){clearTimeout(this._timer),this._timer=0}},{key:"clean",value:function(){this._cleanTimer()}},{key:"destroy",value:function(){clearTimeout(this._timer)}},{key:"totalByteSize",get:function(){return this._totalByteSize}},{key:"avgSpeed",get:function(){return!this._speed&&this._addSample(this._calcSampleSpeed()),8*this._speed}},{key:"recentSpeed",get:function(){return!this._recentSpeed&&this._addSample(this._calcSampleSpeed()),8*this._recentSpeed}}]),t}()},850643:function(t,e,i){"use strict";i.d(e,{Z:function(){return w}});var n=i(85002),r=i(962190),o=i(553894);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,v(n.key),n)}}function l(t,e,i){return e&&c(t.prototype,e),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}function h(t,e){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function f(t){var e=g();return function(){var i,n=y(t);return i=e?Reflect.construct(n,arguments,y(this).constructor):n.apply(this,arguments),d(this,i)}}function d(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return p(t)}function p(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function g(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function y(t){return(y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _(t,e,i){return(e=v(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function v(t){var e=m(t,"string");return"symbol"===a(e)?e:String(e)}function m(t,e){if("object"!==a(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==a(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var b={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},E=["videoClick","videoDbClick"],w=function(t){u(i,t);var e=f(i);function i(){var t;s(this,i);for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return _(p(t=e.call.apply(e,[this].concat(r))),"onMouseMove",function(e){var i=p(t),n=i.player,r=i.playerConfig;!n.isActive&&(n.focus({autoHide:!r.closeDelayBlur}),r.closeFocusVideoFocus||n.video.focus())}),_(p(t),"onMouseEnter",function(e){var i=p(t),n=i.playerConfig,r=i.player;n.closeFocusVideoFocus||r.video.focus(),n.closeDelayBlur?r.focus({autoHide:!1}):r.focus()}),_(p(t),"onMouseLeave",function(e){var i=t.playerConfig,n=i.closePlayerBlur,r=i.leavePlayerTime,o=i.closeDelayBlur;!n&&!o&&(r?t.player.focus({autoHide:!0,delay:r}):t.player.blur())}),_(p(t),"onVideoClick",function(e){var i=p(t),n=i.player,r=i.playerConfig;if(!e.target||!r.closeVideoClick)(e.target===n.video||e.target===n.innerContainer||e.target===n.video.__canvas)&&(e.preventDefault(),!r.closeVideoStopPropagation&&e.stopPropagation(),t._clickCount++,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),t.clickTimer=setTimeout(function(){if(!!t._clickCount)t._clickCount--,(0,o.rl)(p(t),E[0],function(e,i){t.switchPlayPause(i.e)},{e:e,paused:n.paused}),clearTimeout(t.clickTimer),t.clickTimer=null},300))}),_(p(t),"onVideoDblClick",function(e){var i=p(t),n=i.player;if(!i.playerConfig.closeVideoDblclick&&!!e.target&&(e.target===n.video||e.target===n.video.__canvas)){if(t._clickCount<2){t._clickCount=0;return}t._clickCount=0,t.clickTimer&&(clearTimeout(t.clickTimer),t.clickTimer=null),e.preventDefault(),e.stopPropagation(),(0,o.rl)(p(t),E[1],function(e,i){t.emitUserAction(i.e,"switch_fullscreen",{fullscreen:n.fullscreen}),n.fullscreen?n.exitFullscreen():n.getFullscreen()},{e:e,fullscreen:n.fullscreen})}}),t}return l(i,[{key:"afterCreate",value:function(){var t=this;if(this._clickCount=0,E.map(function(e){t.__hooks[e]=null}),"mobile"!==this.playerConfig.isMobileSimulateMode&&("mobile"!==n.Z.device||!!n.Z.os.isIpad))this.initEvents()}},{key:"initEvents",value:function(){var t=this,e=this.player,i=e.video,n=e.root,r=this.playerConfig.enableContextmenu;i&&i.addEventListener("click",this.onVideoClick,!1),i&&i.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(b).map(function(e){n.addEventListener(e,t[b[e]],!1)}),r&&i&&i.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(t){var e=this.player;this.emitUserAction(t,"switch_play_pause"),e.ended?e.duration!==1/0&&e.duration>0&&e.replay():e.paused?e.play():e.pause()}},{key:"onContextmenu",value:function(t){(t=t||window.event).preventDefault&&t.preventDefault(),t.stopPropagation?t.stopPropagation():(t.returnValue=!1,t.cancelBubble=!0)}},{key:"destroy",value:function(){var t=this,e=this.player,i=e.video,n=e.root;this.clickTimer&&clearTimeout(this.clickTimer),i.removeEventListener("click",this.onVideoClick,!1),i.removeEventListener("dblclick",this.onVideoDblClick,!1),i.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(b).map(function(e){n.removeEventListener(e,t[b[e]],!1)})}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),i}(r.ZP)},106245:function(t,e,i){"use strict";var n=i(767449),r=i(758454),o=i(910730);function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function c(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function l(t,e,i){return e&&c(t.prototype,e),i&&c(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function u(){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=h(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}function h(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=v(t)););return t}function f(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&d(t,e)}function d(t,e){return(d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function p(t){var e=_();return function(){var i,n=v(t);return i=e?Reflect.construct(n,arguments,v(this).constructor):n.apply(this,arguments),g(this,i)}}function g(t,e){if(e&&("object"===a(e)||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return y(t)}function y(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function v(t){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function m(t,e,i){return(e=b(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function b(t){var e=E(t,"string");return"symbol"===a(e)?e:String(e)}function E(t,e){if("object"!==a(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==a(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var w='<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40"><path fill="#fff" d="M18.468 11.639l7.503 4.777-7.503 4.777zM10.965 6.86l7.503 4.778v9.554l-7.503 4.778z"/></svg>',k='<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40"><path fill="#fff" d="M19.173 6.861h5.451v19.11h-5.45V6.86zM8.208 25.971V6.86h5.45v19.11h-5.45z"/></svg>',S=function(t){f(i,t);var e=p(i);function i(){var t;s(this,i);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return m(y(t=e.call.apply(e,[this].concat(r))),"btnClick",function(e){var i=y(t),n=i.player;if(!i.config.disable)return e.preventDefault(),e.stopPropagation(),t.emitUserAction(e,"switch_play_pause"),n.ended?n.replay():n.paused&&!n.isBufferControlPaused?(n.play(),t.animate(!1)):(n.pause(),t.animate(!0)),!1}),t}return l(i,[{key:"afterCreate",value:function(){var t=this;u(v(i.prototype),"afterCreate",this).call(this);var e=this.player;this.initIcons(),this.bind(["touchend","click"],this.btnClick),this.on([n.E7,n.RG,n.NH],function(){t.animate(e.paused)}),this.on(n.SV,function(){t.animate(e.paused)}),this.animate(this.player.paused)}},{key:"registerIcons",value:function(){return{play:{icon:w,class:"xg-icon-play"},pause:{icon:k,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var t=this.icons;this.appendChild(".xgplayer-icon",t.play),this.appendChild(".xgplayer-icon",t.pause)}},{key:"animate",value:function(t){var e=this.i18nKeys,i=this.player;if(!t||!i.isBufferControlPaused)t?(this.setAttr("data-state","pause"),this.changeLangTextKey(this.find(".xg-tips"),e.PLAY_TIPS)):(this.setAttr("data-state","play"),this.changeLangTextKey(this.find(".xg-tips"),e.PAUSE_TIPS))}},{key:"destroy",value:function(){u(v(i.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){return'<xg-icon class="xgplayer-play">\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys.PLAY_TIPS,'">').concat(this.i18n.PLAY_TIPS,"</div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:r.kd.CONTROLS_LEFT,index:0,disable:!1}}}]),i}(o.Z);e.Z=S},232410:function(t,e,i){"use strict";i.d(e,{Z:function(){return S}});var n=i(928673),r=i(758454),o=i(910730),a=i(767449);function s(t){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function l(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,E(n.key),n)}}function u(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function h(){return(h="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,i){var n=f(t,e);if(n){var r=Object.getOwnPropertyDescriptor(n,e);return r.get?r.get.call(arguments.length<3?t:i):r.value}}).apply(this,arguments)}function f(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=m(t)););return t}function d(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}function p(t,e){return(p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function g(t){var e=v();return function(){var i,n=m(t);return i=e?Reflect.construct(n,arguments,m(this).constructor):n.apply(this,arguments),y(this,i)}}function y(t,e){if(e&&("object"===s(e)||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return _(t)}function _(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function v(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function m(t){return(m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function b(t,e,i){return(e=E(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function E(t){var e=w(t,"string");return"symbol"===s(e)?e:String(e)}function w(t,e){if("object"!==s(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!==s(n))return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}var k='<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none"><g clip-path="url(#clip0)" fill="#fff"><path d="M17.5 13.75H6.25A3.75 3.75 0 002.5 17.5v6.25a3.75 3.75 0 003.75 3.75H17.5a3.75 3.75 0 003.75-3.75V17.5a3.75 3.75 0 00-3.75-3.75z"/><path fill-rule="evenodd" clip-rule="evenodd" d="M5.822 6.094a1.247 1.247 0 00.156 1.79l4.509 4.204a1.25 1.25 0 101.705-1.828L9.93 8.152l4.799-.018.039-.001a10 10 0 019.521 13.983 1.25 1.25 0 002.292.998 12.5 12.5 0 00-11.88-17.48l-5.05.019 2.293-2.46a1.25 1.25 0 10-1.829-1.705L5.854 6.06l-.032.036z"/></g><defs><clipPath id="RotateSvg-clip0"><path fill="#fff" d="M0 0h40v40H0z"/></clipPath></defs></svg>',S=function(t){d(i,t);var e=g(i);function i(t){var n;return c(this,i),b(_(n=e.call(this,t)),"onBtnClick",function(t){if(!n.config.disable)t.preventDefault(),t.stopPropagation(),n.emitUserAction(t,"rotate"),n.rotate(n.config.clockwise,n.config.innerRotate,1)}),n.rotateDeg=n.config.rotateDeg||0,n}return u(i,[{key:"afterCreate",value:function(){var t=this;if(!this.config.disable){h(m(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(a.km,function(){t.rotateDeg&&t.config.innerRotate&&n.ZP.setTimeout(t,function(){t.updateRotateDeg(t.rotateDeg,t.config.innerRotate)},100)});var e=this.player.root;this.rootWidth=e.style.width||e.offsetWidth||e.clientWidth,this.rootHeight=e.style.height||e.offsetHeight||e.clientHeight,this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate)}}},{key:"destroy",value:function(){h(m(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"updateRotateDeg",value:function(t,e){!t&&(t=0);var i=this.player,n=this.rootWidth,r=this.rootHeight;if(e){i.videoRotateDeg=t;return}var o=this.player,a=o.root,s=o.innerContainer,c=o.video,l=a.offsetWidth,u=s&&e?s.offsetHeight:a.offsetHeight,h=n,f=r,d=0,p=0;(.75===t||.25===t)&&(h="".concat(u,"px"),f="".concat(l,"px"),d=-(u-l)/2,p=-(l-u)/2);var g="translate(".concat(d,"px,").concat(p,"px) rotate(").concat(t,"turn)"),y={transformOrigin:"center center",transform:g,webKitTransform:g,height:f,width:h},_=e?c:a,v=e?i.getPlugin("poster"):null;Object.keys(y).map(function(t){_.style[t]=y[t],v&&v.root&&(v.root.style[t]=y[t])})}},{key:"rotate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.player;!this.rotateDeg&&(this.rotateDeg=0);var r=t?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*r*i)%1,this.updateRotateDeg(this.rotateDeg,e),n.emit(a.lD,360*this.rotateDeg)}},{key:"registerIcons",value:function(){return{rotate:k}}},{key:"render",value:function(){return'\n    <xg-icon class="xgplayer-rotate">\n      <div class="xgplayer-icon">\n      </div>\n      <div class="xg-tips" lang-key="'.concat(this.i18nKeys.ROTATE_TIPS,'">\n      ').concat(this.i18n.ROTATE_TIPS,"\n      </div>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:r.kd.CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),i}(o.Z)}}]);