"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["91528"],{387595:function(e,l,t){t.d(l,{x:function(){return g}}),t("927234");var n=t("567754"),i=t("147613"),o=t("871212"),r=t("637005"),a=t("150566"),d=t("137425"),s=t("516599"),u=t("520739"),c=t("878389"),v=t("544933"),m=t("282819");let f=(0,c._)((0,u._)({},m.D),{continuingRemindShow:{eventName:"continuing_remind_show",params:{scene:"video",enter_from_on_cellphone:"",previous_page_on_cellphone:"",is_landscape_status_on_cellphone:0,enter_method_on_cellphone:"",item_duration:0,aweme_type:"",item_id:"",from_device_id:"",from_user_id:"",from_app_name:""}}});var p=new v.h(f),h=t("497730");let g=function(e,l){let t=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,i.o)(()=>{if(!e)return;let i=null,u=r.listen(r.EVENT.discoverInsertVideo,e=>{let{aweme_id:t,play_progress:n,from_device_id:r,record_type:a,url_source:u,enter_from_on_cellphone:c,previous_page_on_cellphone:v,is_landscape_status_on_cellphone:m,enter_method_on_cellphone:f,item_duration:g,from_user_id:y,from_app_id:_}=e;(0,d.m_)({awemeId:t,originType:h.F.DiscoverPage}).then(e=>{var d,h,w,I,S,C,x,P,E;if(0===e.statusCode&&e.detail){let C=e.detail;if(null==C?void 0:null===(d=C.chargeInfo)||void 0===d?void 0:d.is_charge_content){p.sendLog("continued_broadcast_receive_sync_message",{scene:"video",stage:"fetch_aweme_fail",stage_detail:"recommend",item_id:t,status_code:null==e?void 0:e.statusCode,log_pb:null==e?void 0:e.logPb,filter_reason:null==e?void 0:null===(w=e.filterDetail)||void 0===w?void 0:w.filterReason,filter_detail:null==e?void 0:null===(I=e.filterDetail)||void 0===I?void 0:I.detailMsg,is_charge_video:!!(null==C?void 0:null===(S=C.chargeInfo)||void 0===S?void 0:S.is_charge_content),from_app_id:_});return}C.continationInfo={playProgress:n,continationVideoAlreadyConsume:!1,fromDeviceId:r,recordType:a,urlSource:u,enterFromOnCellphone:c,previousPageOnCellphone:v,isLandscapeStatusOnCellphone:m,enterMethodOnCellphone:f,itemDuration:g,fromUserId:y},i=setTimeout(()=>{var e;null==l||null===(e=l.current)||void 0===e||e.call(l,C),s.F.info("正在播放手机端的视频")},300),p.sendLog("continuingRemindShow",{scene:"video",enter_from_on_cellphone:c,previous_page_on_cellphone:v,is_landscape_status_on_cellphone:m,enter_method_on_cellphone:f,item_duration:null==C?void 0:null===(h=C.video)||void 0===h?void 0:h.duration,aweme_type:null==C?void 0:C.awemeType,item_id:null==C?void 0:C.awemeId,from_device_id:r,from_user_id:y,from_app_name:o.AppID2AppName[(null!=_?_:"").toString()]});return}"app_continued"===u&&p.sendLog("continued_broadcast_receive_sync_message",{scene:"video",stage:"fetch_aweme_fail",stage_detail:"insert",item_id:t,status_code:null==e?void 0:e.statusCode,log_pb:null==e?void 0:e.logPb,filter_reason:null==e?void 0:null===(C=e.filterDetail)||void 0===C?void 0:C.filterReason,filter_detail:null==e?void 0:null===(x=e.filterDetail)||void 0===x?void 0:x.detailMsg,is_charge_video:!!(null==e?void 0:null===(E=e.detail)||void 0===E?void 0:null===(P=E.chargeInfo)||void 0===P?void 0:P.is_charge_content),from_app_id:_})})});if(t){let{url:e,query:l}=n.parseUrl(location.href),t=l.item_id;if("insert_discover"===l.feed_operation&&"string"==typeof t){var c;r.emit(r.EVENT.discoverInsertVideo,{aweme_id:t,play_progress:Number(null!==(c=(0,a.Rs)("play_progress"))&&void 0!==c?c:0),from_device_id:(0,a.Rs)("from_device_id"),record_type:(0,a.Rs)("record_type"),url_source:(0,a.Rs)("url_source"),enter_from_on_cellphone:(0,a.Rs)("enter_from_on_cellphone"),previous_page_on_cellphone:(0,a.Rs)("previous_page_on_cellphone"),is_landscape_status_on_cellphone:Number((0,a.Rs)("is_landscape_status_on_cellphone")),enter_method_on_cellphone:(0,a.Rs)("enter_method_on_cellphone"),item_duration:Number((0,a.Rs)("item_duration")),from_user_id:(0,a.Rs)("from_user_id"),from_app_id:Number((0,a.Rs)("from_app_id"))});let i=["item_id","feed_operation","play_progress","from_device_id","record_type","url_source","enter_from_on_cellphone","previous_page_on_cellphone","is_landscape_status_on_cellphone","item_duration","from_user_id"];(0,a.U$)(i),i.map(e=>delete l[e]),window.history.replaceState(null,"",n.stringifyUrl({url:e,query:l}))}}return()=>{null==u||u(),i&&clearTimeout(i)}},[e])}},75791:function(e,l,t){t.d(l,{b:function(){return h}}),t(874386);var n=t(88648),i=t(302653),o=t.n(i),r=t(720359),a=t(340290),d=t(811183),s=t(913807),u=t(823685),c=t(375944),v=t(151681),m=t(387595),f=t(419105),p=t(83288);let h=e=>{let{currentNumber:l,setCurrentNumber:t,awemeInfoList:i,setAwemeInfoList:h,modalAwemeInfo:g,abtestData:y,preloadReady:_,preloadAwemeList:w,tagId:I,isActiveTab:S,isCourseTab:C}=e,{awemeFeed:x}=(0,v.j)(),P=(0,n.useRef)(!1),E=(0,n.useRef)(""),b=(0,n.useRef)(!1),[T,L]=(0,n.useState)(!1);(0,n.useEffect)(()=>{let e=null==y?void 0:y.mainHoverPreload;(e.action===u.MainHoverPreloadAction.click||e.action===u.MainHoverPreloadAction.hover)&&1===l&&e.cache===u.MainHoverPreloadCache.on&&f.Z.clearCache(null==g?void 0:g.awemeId)},[l]);let k=(0,r.d)(e=>{var n,o;x.dispatch("modalAwemeInfo",null),E.current=null==e?void 0:e.awemeId;let r=null==i?void 0:i[l],a=(null==r?void 0:r.awemeId)===(null==e?void 0:e.awemeId);h([e]),t(0),a&&"object"==typeof window&&(null===(n=window.player)||void 0===n?void 0:n.seek)&&"number"==typeof(null==e?void 0:null===(o=e.continationInfo)||void 0===o?void 0:o.playProgress)&&window.player.seek(e.continationInfo.playProgress)});(0,m.x)(!0,k);let A=(0,n.useRef)(0),M=(0,n.useRef)({isCourseFeed:C,offset:0,emptyFetchCount:0,ids:{[null==g?void 0:g.awemeId]:1}}),j=(0,n.useCallback)(async()=>{var e,l,t;if(S){let{statusCode:e,awemeList:t=[]}=await (0,a.bJ)({awemeId:E.current,count:(null==y?void 0:null===(l=y.jingxuanModalOpt)||void 0===l?void 0:l.count)||8,filterGids:i.map(e=>null==e?void 0:e.awemeId).join(",")||""});return{statusCode:e,awemeList:t}}if(M.current.isCourseFeed){let{statusCode:e,awemeList:l=[],hasMore:n,offset:i}=await (0,d.F)({tabId:"screen_course_page",offset:M.current.offset,size:6,tagIdList:"[0,0,0]",idList:Object.keys(M.current.ids).join(",")});0===e&&(M.current.offset=i,null==l||null===(t=l.map)||void 0===t||t.call(l,e=>{(null==e?void 0:e.awemeId)&&(M.current.ids[e.awemeId]=1)}));let o=0===e&&0===l.length&&n;if(M.current.emptyFetchCount=o?M.current.emptyFetchCount+1:0,M.current.isCourseFeed=n&&M.current.emptyFetchCount<3,M.current.emptyFetchCount<3)return{statusCode:e,awemeList:l}}let n=E.current;A.current+=1;let o=(null==y?void 0:null===(e=y.jingxuanModalOpt)||void 0===e?void 0:e.count)||8;(null==y?void 0:y.innerSlideSmooth)&&1===A.current&&(o=2);let{statusCode:r,awemeList:u=[]}=await (0,s.fetchHomeModuleFeed)({useV2:1,moduleId:3003101,referType:10,count:o,seoFlag:0,targetGid:n,refreshIndex:A.current,tagId:I,filterGids:(0,p.C0)(I)});return{statusCode:r,awemeList:u}},[i,S,I,y]);(0,n.useEffect)(()=>{h([g]),t(0),E.current=null==g?void 0:g.awemeId;let e=e=>{var l,t;let n=(0,c.Q5)()&&(e.metaKey&&"w"===e.key||e.metaKey&&"q"===e.key);if((null===(l=document.activeElement)||void 0===l?void 0:l.tagName)!=="INPUT"&&!n&&(null==e?void 0:null===(t=e.target)||void 0===t?void 0:t.contentEditable)!=="true")null==e||e.preventDefault()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,n.useEffect)(()=>{var e;(null==y?void 0:null===(e=y.jingxuanModalOpt)||void 0===e?void 0:e.logicOptimize)?(w.length&&_&&h(e=>o()([...e,...w],"awemeId")),_&&L(!0)):w.length&&h(e=>o()([...e,...w],"awemeId"))},[w,T,y,h]),(0,n.useEffect)(()=>{i.length>0&&-1===l&&t(0)},[i]),(0,n.useEffect)(()=>{var e;let t=(null==y?void 0:null===(e=y.jingxuanModalOpt)||void 0===e?void 0:e.logicOptimize)?T:null==b?void 0:b.current;i.length-l<=2&&!P.current&&t&&(async()=>{P.current=!0;for(let e=0;e<3;e++){let{statusCode:e,awemeList:l=[]}=await j();if(0!==l.length){P.current=!1,0===e&&h(e=>o()([...e,...l],"awemeId"));break}}})()},[l,i,j,y]),(0,n.useEffect)(()=>{b.current=_},[_]),(0,n.useEffect)(()=>{g&&(h([g]),t(0),E.current=null==g?void 0:g.awemeId)},[g])}},419105:function(e,l,t){var n=t(134761);let i=new class e{setCache(e,l){let t=Date.now()+this._cacheTime;this._cache[e]={value:l,expireTime:t,loading:!1}}setCacheLaoading(e){let l=Date.now()+this._cacheTime;this._cache[e]={value:[],expireTime:l,loading:!0}}getCache(e){let l=this._cache[e];return l?l.expireTime<Date.now()?(this.clearCache(e),null):l:null}clearCache(e){delete this._cache[e]}clearAllCache(){this._cache={}}setCacheTime(e){this._cacheTime=6e4*e}constructor(e){(0,n._)(this,"_cacheTime",void 0),(0,n._)(this,"_cache",{}),this._cacheTime=e.cacheTime,this._cache={}}}({cacheTime:18e5});l.Z=i},427283:function(e,l,t){t.d(l,{JY:function(){return i},Rg:function(){return n},Xq:function(){return a},_D:function(){return r},mh:function(){return d},z0:function(){return o}});let n=10;var i={All:"all",Course:"course",Game:"game",Acg:"acg",Music:"music",Food:"food",Knowledge:"knowledge",Sports:"sports",Theater:"theater",Film:"film",Vlog:"vlog",Child:"child",Car:"car",Agriculture:"agriculture",Animal:"animal",Travel:"travel",Beauty:"beauty"};let o={0:"all",1e5:"course",300205:"game",300206:"acg",300209:"music",300204:"food",300213:"knowledge",300207:"sports",300214:"theater",300215:"film",300216:"vlog",300217:"child",300218:"car",300219:"agriculture",300220:"animal",300221:"travel",300222:"beauty"},r={course:"100000",game:"300205",acg:"300206",music:"300209",food:"300204",knowledge:"300213",sports:"300207",theater:"300214",film:"300215",vlog:"300216",child:"300217",car:"300218",agriculture:"300219",animal:"300220",travel:"300221",beauty:"300222"},a=["0",r.game,r.acg,r.music,r.food,r.knowledge,r.sports,r.theater,r.film,r.vlog,r.child,r.agriculture,r.animal,r.travel,r.beauty],d=[{label:"全部",key:"0"},{label:"公开课",key:"100000"},{label:"游戏",key:"300205"},{label:"二次元",key:"300206"},{label:"音乐",key:"300209"},{label:"美食",key:"300204"},{label:"知识",key:"300213"},{label:"体育",key:"300207"},{label:"小剧场",key:"300214"},{label:"影视",key:"300215"},{label:"生活vlog",key:"300216"},{label:"亲子",key:"300217"},{label:"汽车",key:"300218"},{label:"三农",key:"300219"},{label:"动物",key:"300220"},{label:"旅行",key:"300221"},{label:"美妆穿搭",key:"300222"}].map(e=>null==e?void 0:e.key)},83288:function(e,l,t){t.d(l,{C0:function(){return g},J9:function(){return h}}),t("110006"),t("826893"),t("250440"),t("779788"),t("874386"),t("675373"),t("429532");var n=t("675162"),i=t("595814"),o=t.n(i),r=t("746864"),a=t("520739"),d=t("496349"),s=t("231755"),u=t("349135");let{COMMON_SEARCH_PARAMS:c}=d||{};async function v(e){let l=await (0,s.v_)("/api/user/cache",(0,a._)({},c),e,{isDataUseJson:!0},"",{current:null},null);return(0,u.RL)(l,e=>{var l;return{statusCode:null!==(l=null==e?void 0:e.status_code)&&void 0!==l?l:-1}})}let m={};function f(e){var l,t,n,i,r,a,d,s,u,c,v,m,f,p,h,g,y,_,w,I,S;let C=o()(e,["authorUserId","awemeControl","awemeId","awemeType","chanFeedVideo","chapterInfo","cooperationInfo","createTime","danmakuControl","desc","douyinPCVideoExtraSEO","douyinPcVideoExtra","download","dyQ","encodedAwemeId","webCardType","fakeHorizontalInfo","feedFlowControllerInfo","fetchExpired","groupId","imageAlbumMusicInfo","imageInfos","imgBitrate","isFriendLimit","isPrivate","logPb","lvideoBrief","mixInfo","packAdDate","poiInfo","refreshIndex","relatedVideo","relatedVideoExtra","requestTime","seoInfo","seriesInfo","stats","status","stroyInfo","suggestWords","tag","textExtra","userCollected","userDigged","varietyVideo","wallpaperTagInfo","webRawData","weeklyRecommend"]);return C.authorInfo={uid:null===(l=e.authorInfo)||void 0===l?void 0:l.uid,secUid:null===(t=e.authorInfo)||void 0===t?void 0:t.secUid,nickname:null===(n=e.authorInfo)||void 0===n?void 0:n.nickname,remarkName:null===(i=e.authorInfo)||void 0===i?void 0:i.remarkName,avatarUri:null===(r=e.authorInfo)||void 0===r?void 0:r.avatarUri,followStatus:null===(a=e.authorInfo)||void 0===a?void 0:a.followStatus,roomData:{},avatarThumb:null===(d=e.authorInfo)||void 0===d?void 0:d.avatarThumb,roleTitle:null===(s=e.authorInfo)||void 0===s?void 0:s.roleTitle,secret:null===(u=e.authorInfo)||void 0===u?void 0:u.secret,roomId:null===(c=e.authorInfo)||void 0===c?void 0:c.roomId,accountCertInfo:{}},C.awemeControl={},C.images=[],C.shareInfo={},C.video={width:null===(v=e.video)||void 0===v?void 0:v.width,height:null===(m=e.video)||void 0===m?void 0:m.height,ratio:null===(f=e.video)||void 0===f?void 0:f.ratio,duration:null===(p=e.video)||void 0===p?void 0:p.duration,playAddr:[],playApi:"",playAddrH265:[],playApiH265:"",bitRateList:[],bitRateAudioList:[],cover:null===(h=e.video)||void 0===h?void 0:h.cover,coverUrlList:null===(g=e.video)||void 0===g?void 0:g.coverUrlList,cover169UrlList:null===(y=e.video)||void 0===y?void 0:y.cover169UrlList,cover169BigUrlList:null===(_=e.video)||void 0===_?void 0:_.cover169BigUrlList,coverUri:null===(w=e.video)||void 0===w?void 0:w.coverUri,originCover:null===(I=e.video)||void 0===I?void 0:I.originCover,rawCover:"",originCoverUrlList:null===(S=e.video)||void 0===S?void 0:S.originCoverUrlList,meta:null,bigThumbs:[],videoModel:null},C}async function p(e){let{tagId:l,res:t,expireS:i,redisMode:o="replace"}=e;try{var a,d;if("undefined"==typeof TextEncoder||(null==t?void 0:t.statusCode)!==0||(null==t?void 0:t.redisVersion)!==void 0||!i||!(null==t?void 0:null===(d=t.awemeList)||void 0===d?void 0:null===(a=d.filter)||void 0===a?void 0:a.call(d,e=>e.awemeType!==r.e.LiveCard)).length)return!1;let e={scene:"jingxuan",tag_id:l,expire:i,data:Object.assign({redisVersion:3,redisMode:o},t)},s=JSON.stringify(e),u=new TextEncoder().encode(s),c=n.default.gzip(u),m=new FormData;m.append("meta",JSON.stringify({type:"json",version:"1.0"})),m.append("data",new Blob([c],{type:"application/gzip"}),"data.gz");let{statusCode:f}=await v(m);return 0===f}catch(e){return!1}}async function h(e){let{tagId:l,originalList:t,expireS:n=0,redisMode:i="replace"}=e;try{var o,a,d,s,u,c,v;let e=t.slice(0,20).filter(e=>e.awemeType!==r.e.LiveCard).slice(0,10);if(e.length<10&&"replace"===i)return!1;let h=null===(o=e.map(e=>e.awemeId))||void 0===o?void 0:o.join(",");if(m[l]===h)return!1;m[l]=h;let g=(null==e?void 0:null===(d=e[0])||void 0===d?void 0:null===(a=d.images)||void 0===a?void 0:a.length)||(null==e?void 0:null===(u=e[0].video)||void 0===u?void 0:null===(s=u.playAddr)||void 0===s?void 0:s.length)!==0||(null==e?void 0:null===(c=e[0].video)||void 0===c?void 0:c.playApi)?e.map(f):e,y={awemeList:g,episodeList:[],hasMore:!0,logId:null===(v=g[0])||void 0===v?void 0:v.logPb,responseFrom:"sort",statusCode:0},_=await p({tagId:l,res:y,expireS:n,redisMode:i});return!_&&delete m[l],_}catch(e){return!1}}function g(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return m[""===e?"0":e]||""}},697189:function(e,l,t){t.d(l,{K:function(){return c}});var n=t(520739),i=t(878389);t(675373);var o=t(563097),r=t(88648),a=t(338426),d=t(207964);let s=(0,a.ZP)(()=>Promise.all([t.e("66135"),t.e("92686"),t.e("79373"),t.e("80303"),t.e("81527"),t.e("24451"),t.e("61653")]).then(t.bind(t,104682)),{ssr:!1}),u=(0,a.ZP)(()=>Promise.all([t.e("66135"),t.e("21692"),t.e("52405"),t.e("65346"),t.e("923"),t.e("92098"),t.e("97607"),t.e("75935"),t.e("47439"),t.e("17275"),t.e("89368"),t.e("75511"),t.e("99763")]).then(t.bind(t,689463)),{ssr:!1}),c=(0,r.forwardRef)((e,l)=>(0,d.useInLiveSearchRefactorAB)()?(0,o.jsx)(s,(0,i._)((0,n._)({},e),{ref:l})):(0,o.jsx)(u,(0,i._)((0,n._)({},e),{ref:l})))},848429:function(e,l,t){t.d(l,{G9:function(){return T},UU:function(){return b}}),t(874386);var n=t(563097),i=t(88648),o=t(713097),r=t.n(o),a=t(130162),d=t(909543),s=t(734123),u=t.n(s),c=t(784492),v=t(79307),m=t(782442),f=t(30321),p=t(616520),h=t(637005),g=t(508828),y=t(392323),_=t(744121),w=t(9352),I=t(67487),S=t(631493),C=t(902496),x=t(424944),P=t(375996);let E=[m.gI.PlayerCardInfo,m.gI.isVideoPlayed,m.gI.IsInModalVideo],b=()=>{let e=(0,i.useRef)(!1),{pathname:l}=(0,d.a)(),t=(0,i.useRef)(l),n=(0,i.useRef)(!1);return(0,f.Nr)(l)?n.current=!0:(n.current?(n.current=!1,e.current=t.current===l):e.current=!1,t.current=l),e},T=e=>{let{children:l,parentRouteClassName:t,checkIsActive:o}=e,{pathname:s}=(0,d.a)(),T=!0;o&&(T=o(s));let L=T&&(0,f.Nr)(s),k=(0,f.Nr)(s)||!T,A=(0,i.useRef)(),M=b(),j=(0,i.useRef)(s),N=(0,i.useRef)(s),R=(0,i.useMemo)(()=>(0,p.oS)(null==j?void 0:j.current)?v.lT.Recommend:(0,p.i8)(null==j?void 0:j.current)?v.lT.Follow:(0,p.z1)(null==j?void 0:j.current)?v.lT.Friend:(0,p.e2)(null==j?void 0:j.current)?v.lT.Modal:(0,p.h$)(null==j?void 0:j.current)?v.lT.User:(0,p.Q5)(null==j?void 0:j.current)?v.lT.AiSearch:void 0,[]);return k&&(N.current=s),(0,i.useLayoutEffect)(()=>{k&&h.emit(h.EVENT.videoPause,{isInChildRoute:!0})},[k]),(0,i.useEffect)(()=>()=>{if(L){let e=h.getPageScope(j.current);h.emit(h.EVENT.exitChildRoute,null,e),"child_route"!==e&&h.emit(h.EVENT.exitChildRoute,null,"child_route")}else h.emit(h.EVENT.enterChildRoute)},[L]),(0,i.useEffect)(()=>{if(k){let e=!1,l=l=>{e=!0};return window.addEventListener("resize",l),()=>{window.removeEventListener("resize",l),e&&setTimeout(()=>{window.dispatchEvent(new Event("resize"))},20)}}},[k]),(0,i.useLayoutEffect)(()=>{if(k){let e=E.map(e=>m.Le.getConfig(e));return m.Le.setConfig(m.gI.SlideStartTime,{slideStartTime:0}),()=>{E.forEach((l,t)=>{m.Le.setConfig(l,e[t])}),m.Le.setConfig(m.gI.SlideStartTime,{slideStartTime:0})}}},[k]),(0,i.useLayoutEffect)(()=>{!M.current&&(0,P.S)()&&(0,g._)()},[]),(0,c.Z)(()=>{let e=window.location.pathname;if(!k)return(!M.current||m.Le.getConfig(m.gI.NeedExitFullScreenAndModal))&&(m.Le.setConfig(m.gI.NeedExitFullScreenAndModal,!1),(0,g._)()),()=>{!(0,f.dH)(location.pathname)&&!(0,f.yk)(location.pathname)&&(0,g._)()};{var l,t,n,i,o;let r=null===(l=m.Le.getConfig(m.gI.IsInModalVideo))||void 0===l?void 0:l.isInModal,a=R&&!r?null===(t=S.s.getLastRegisterPlayerIdByScene)||void 0===t?void 0:t.call(S.s,R):(0,_.OB)();a&&(0,_.wS)(a,!1);let d=null===u()||void 0===u()?void 0:null===(i=u().instManager)||void 0===i?void 0:null===(n=i.find)||void 0===n?void 0:n.call(i,e=>(null==e?void 0:e.playerId)===a);if((0,f.dH)(e)){null==d||null===(o=d.pause)||void 0===o||o.call(d);let e=S.s.getPlayerInfoMap();m.Le.setConfig(m.gI.TempPlayerMap,e),S.s.clearPlayerInfoMap()}return()=>{var l,t,n,i;let o=!1,d=null!==(t=m.Le.getConfig(m.gI.TempPlayerMap))&&void 0!==t?t:null;if(d){if(M.current)null===(i=S.s.setPlayerInfoMap)||void 0===i||i.call(S.s,d);else{let l=new Map;d.forEach((e,t)=>{if(e.scene===v.lT.Modal){var n;null===(n=S.s.unRegister)||void 0===n||n.call(S.s,{id:t})}else l.set(t,e)}),(0,f.dH)(e),null===(n=S.s.setPlayerInfoMap)||void 0===n||n.call(S.s,l)}m.Le.setConfig(m.gI.TempPlayerMap,null)}(0,f.dH)(e)&&!M.current&&r&&(o=!0);let s=R&&(!r||o)?null===(l=S.s.getLastRegisterPlayerIdByScene)||void 0===l?void 0:l.call(S.s,R):(0,_.OB)(),u=o&&s?s:a||s;u&&(0,_.wS)(u,!0);let c=setTimeout(()=>{let e=(0,_.OB)(),l=S.s.getPlayersByScene(R).find(l=>l.playerId===e),t=S.s.getAllPlayer().find(e=>(null==e?void 0:e.playerId)===u);if(t&&!(l&&e!==u)){var n;!(0,f.Nr)(N.current)&&t.once("play",()=>{(0,y.yr)({fromCache:1})}),null==t||null===(n=t.play)||void 0===n||n.call(t)}},500);m.Le.setConfig(m.gI.BackToCacheDelayPlayTimer,c)}}},[k]),(0,i.useEffect)(()=>{if(k)return;let e=A.current,l=e=>h.emit(h.EVENT.routePageScroll,e);return null==e||e.addEventListener("scroll",l),()=>{null==e||e.removeEventListener("scroll",l)}},[k]),(0,i.useEffect)(()=>{L&&h.emit(h.EVENT.childRouteRender)},[L]),(0,i.useEffect)(()=>{!m.Le.getConfig(m.gI.SvgDirectRender)&&m.Le.setConfig(m.gI.SvgDirectRender,!0)},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.O,{active:!k,className:r()({[I.tt]:!k,[w.default.withoutscrollbar]:R===v.lT.User},t,I.ei,w.default.routeContainer),ref:A,children:l}),L&&(0,n.jsx)(C.w,{isActive:L,children:(0,n.jsx)("div",{className:r()(I.WV,I.ei,w.default.routeContainer,w.default.childRoute,{[w.default.enterChildRoute]:!T}),children:(0,n.jsx)(a.Outlet,{})})})]})}},89435:function(e,l,t){t.d(l,{C:function(){return m}});var n=t("520739"),i=t("878389"),o=t("563097"),r=t("77854"),a=t.n(r);t("88648");var d=t("848429"),s=t("147613"),u=t("637005"),c=t("67487");let v=()=>{(0,s.o)(()=>{let e=Array.from(document.querySelectorAll(`.${c.ei}`)).find(e=>e.getBoundingClientRect().height>0)||window;return u.emit(u.EVENT.globalScrollEl,e),u.listen(u.EVENT.sideBarShow,()=>{u.emit(u.EVENT.globalScrollEl,e)})},[])};function m(e,l,t){return function(r){v();let s=(0,o.jsx)(e,(0,n._)({},r));return(0,o.jsx)(d.G9,(0,i._)((0,n._)({checkIsActive:l,parentRouteClassName:t},a()),{children:s}))}}},113255:function(e,l,t){t.d(l,{P:function(){return g}});var n=t("563097"),i=t("88648"),o=t("713097"),r=t.n(o),a=t("782563"),d=t("687297"),s=t("385236"),u=t("473677"),c=t("254897"),v=t("520739"),m=t("878389");let f=(0,i.forwardRef)((e,l)=>(0,n.jsx)("svg",(0,m._)((0,v._)({width:18,height:18,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:l},e),{children:(0,n.jsx)("path",{d:"M17.448 17.448a1.886 1.886 0 0 1-2.668 0L9 11.668l-5.78 5.78A1.886 1.886 0 1 1 .552 14.78L6.332 9 .552 3.22A1.886 1.886 0 1 1 3.22.552L9 6.332l5.78-5.78a1.886 1.886 0 1 1 2.668 2.668L11.668 9l5.78 5.78a1.886 1.886 0 0 1 0 2.668z",fill:"#fff"})}))),p=(0,i.forwardRef)((e,l)=>(0,n.jsx)("svg",(0,m._)((0,v._)({width:24,height:24,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:l},e),{children:(0,n.jsx)("path",{d:"M16 4l-8 8.14L16 20",stroke:"#fff",strokeOpacity:".7",strokeWidth:4,strokeLinecap:"round",strokeLinejoin:"round",shapeRendering:"crispEdges"})})));var h=t("529840");let g=e=>{let{onClick:l,isClientMiniWin:t,isBackSvg:i=!1}=e,o=(0,a.DT)()&&(0,d.y)((0,a.FJ)().awemePcClient,">=","5.4.0"),v=!(i||o);return(0,n.jsxs)("div",{className:r()(h.default.container,"isDark",{[h.default.hide]:t},o&&h.default.clientHomeStyleWrap),onClick:l,children:[(0,n.jsx)("div",{className:h.default.circle}),o&&(0,n.jsx)(c.z,{className:r()(h.default.back),svg:(0,n.jsx)(s.Z,{style:{fontSize:"24px"}})}),i&&!o&&(0,n.jsx)(u.Z,{src:p,className:h.default.back,viewBox:"0 0 24 24"}),v&&(0,n.jsx)(u.Z,{src:f,className:h.default.close,viewBox:"0 0 18 18"})]})}},53289:function(e,l,t){t.r(l),t.d(l,{default:function(){return tH}});var n=t("520739"),i=t("878389"),o=t("368200");t("874386"),t("250440");var r=t("563097"),a=t("88648"),d=t("309931"),s=t("713097"),u=t.n(s),c=t("452894"),v=t("598467"),m=t("35385"),f=t("208987"),p=t("387787"),h=t("782442"),g=t("637005"),y=t("330746"),_=t("879550"),w=t("123869"),I=t("705171");let S=e=>{let{originAwemeInfo:l}=e,[t,n]=(0,a.useState)(""),[i,o]=(0,a.useState)(!1),[r,d]=(0,a.useState)(l);return{slideVideoTab:t,setSlideVideoTab:n,modalAwemeInfo:r,setModalAwemeInfo:d,globalIsSideBarShow:i,setIsSideBarShowFunc:o}};var C=t("877639"),x=t.n(C),P=t("147613"),E=t("506467"),b=t("367366"),T=t("211143"),L=t("507217"),k=t("903868");let A=e=>{let{abtestData:l,closeModal:t,container:n,isClientMiniWin:i=!1,modalEnterFrom:o}=e,{pipWindow:r}=(0,k.Iq)(e=>{let{pipWindow:l}=e;return{pipWindow:l}}),d=(0,a.useRef)(null),s=(0,a.useRef)([]),u=(0,a.useRef)(null),c=(0,a.useRef)(null),v=(0,a.useRef)(0);v.current=(0,y.vU)()?120:0;let m=(0,a.useCallback)((e,l)=>{let t=0,n=e.slice(Math.max(e.length-l,1));for(let e=0;e<n.length;e++)t+=n[e];return Math.ceil(t/l)},[]),f=(0,a.useCallback)(e=>{var l;null==e||null===(l=e.preventDefault)||void 0===l||l.call(e),null==e||e.stopPropagation(),d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{s.current=[]},400);let t=new Date().getTime(),n=e.wheelDelta||-e.deltaY||-e.detail,i=Math.max(-1,Math.min(1,n)),r=void 0!==e.wheelDeltaX||void 0!==e.deltaX,a=Math.abs(e.wheelDeltaX)<Math.abs(e.wheelDelta)||Math.abs(e.deltaX)<Math.abs(e.deltaY)||!r;s.current=[...s.current,v.current+Math.abs(n)];let f=t-u.current;u.current=t,f>400&&1===s.current.length&&(s.current=[,,].fill(s.current[0]),c.current=!1);let p=m(s.current,20),y=p>m(s.current,40);y&&!c.current&&a&&((0,h.Vv)(L.PagingType.scroll),i<0?(g.emit("changeNext",{from:"scroll",triggerFrom:o}),g.emit(g.EVENT.reportPlayNext,{clickFrom:"scroll"})):(g.emit("changePrev",{from:"scroll",triggerFrom:o}),g.emit(g.EVENT.reportPlayPrev,{clickFrom:"scroll"})),c.current=!0),!y&&c.current&&a&&(c.current=!1)},[]);return(0,a.useEffect)(()=>(null==n||n.addEventListener("wheel",f),()=>{null==n||n.removeEventListener("wheel",f)}),[n]),(0,a.useEffect)(()=>{if(r)return null==r||r.addEventListener("wheel",f),()=>{null==r||r.removeEventListener("wheel",f)}},[r,f]),(0,P.o)(()=>{let e=x()(e=>{var l,t,n,o;if(e.nativeEvent||(null==e?void 0:null===(l=e.target)||void 0===l?void 0:l.contentEditable)==="true")return;let r=e;(null===(t=e.data)||void 0===t?void 0:t.type)==="KEY_DOWN"&&(null===(n=e.data)||void 0===n?void 0:n.data)&&(r=null===(o=e.data)||void 0===o?void 0:o.data);let a=i?[E.bf.ArrowUp.keyCode]:[E.bf.ArrowUp.keyCode,E.bf.W.keyCode],d=i?[E.bf.ArrowDown.keyCode]:[E.bf.ArrowDown.keyCode,E.bf.S.keyCode],s=h.Le.getConfig(h.gI.DisableNextPre);!a.includes(r.keyCode)||r.shiftKey||s&&r.keyCode===E.bf.ArrowUp.keyCode?d.includes(r.keyCode)&&!r.shiftKey&&(!s||r.keyCode!==E.bf.ArrowDown.keyCode)&&((0,h.Vv)(L.PagingType.hotkey),g.emit("changeNext",{from:"keyboard"}),g.emit(g.EVENT.reportPlayNext,{clickFrom:"keyboard"})):((0,h.Vv)(L.PagingType.hotkey),g.emit("changePrev",{from:"keyboard"}),g.emit(g.EVENT.reportPlayPrev,{clickFrom:"keyboard"}))},500,{leading:!0,trailing:!1});return document.addEventListener("keydown",e),window.addEventListener("message",e),()=>{document.removeEventListener("keydown",e),window.removeEventListener("message",e)}},[l,i]),(0,a.useEffect)(()=>{let e=e=>{if(e.shiftKey||e.metaKey||e.ctrlKey||(0,b.r)())return;let l=h.Le.getConfig(h.gI.DisableExit);"Escape"===e.code&&!i&&!l&&t({click_method:"esc"}),e.preventDefault()};return T.k.bind("Escape",e),()=>{T.k.remove("Escape",e)}},[t,i]),null},M=e=>{let{currentNumber:l}=e,t=(0,a.useRef)(l),n=(0,a.useRef)(!0);return -1===t.current&&-1!==l&&(t.current=l),t.current!==l&&(n.current=!1),n.current};var j=t("393452");let N=e=>window.location.href.includes(e)||window.location.href.includes("user/self"),R=e=>{let{awemeInfoListRef:l,userInfo:t,currentNumber:n}=e,[i,o]=(0,a.useState)(j.Kw.NotShow);return(0,a.useEffect)(()=>{var e,i,r,a;let d=!1,s=l.current,u=async()=>{var e,l;let i=await (0,j.AH)({userId:null==t?void 0:null===(e=t.info)||void 0===e?void 0:e.uid,itemId:null===(l=s[n])||void 0===l?void 0:l.awemeId});!d&&!i.statusCode&&o(i.status)};return N(null==t?void 0:null===(e=t.info)||void 0===e?void 0:e.secUid)&&s[n]&&(null===(r=s[n])||void 0===r?void 0:null===(i=r.authorInfo)||void 0===i?void 0:i.uid)===(null==t?void 0:null===(a=t.info)||void 0===a?void 0:a.uid)&&u(),()=>{d=!0}},[n,t]),{asrState:i}};var D=t("516599"),F=t("205457"),V=t("301061");t("284961"),t("826893");var W=t("746864"),U=t("697189"),O=t("386531");let B=a.forwardRef((e,l)=>{var t,o;let{item:d,isActive:s,customProps:u,playNextFunc:v,playPrevFunc:m,swiper:f,onLivePlay:p,onLivePause:h,isShowGuide:y,useNewUserSoundGuide:_,modalEnterFrom:w}=e,{userContext:I,abtestData:S}=u,{userInfo:C}=I||{},{isLogin:x}=C||{};(0,a.useEffect)(()=>{if(s&&f)try{let e=(0,g.emitterListen)(f,"changeNext",v),l=(0,g.emitterListen)(f,"changePrev",m);return()=>{try{null==e||e(),null==l||l()}catch(e){}}}catch(e){}},[s,v,m,f]);let P=(0,a.useCallback)(()=>{p(d)},[d]),E=(0,a.useCallback)(()=>{h(d)},[d]),b=(0,a.useMemo)(()=>{var e,l,t,n;if(null==d?void 0:d.flvSrc)return d.flvSrc;let i=null==d?void 0:null===(e=d.cellRoom)||void 0===e?void 0:e.rawdata,o=null==i?void 0:null===(n=i.stream_url)||void 0===n?void 0:null===(t=n.flv_pull_url)||void 0===t?void 0:t[null==i?void 0:null===(l=i.stream_url)||void 0===l?void 0:l.default_resolution];return(null==o?void 0:o.includes("https"))?o:null==o?void 0:o.replace("http","https")},[d]);return(0,r.jsx)(U.K,(0,i._)((0,n._)({ref:l},d),{disableNewPlayer:w===c.a.WaterFall,modalEnterFrom:w,isShow:s,isActive:s,customProps:u,source:{url:d.authorInfo.url,userName:`@ ${d.authorInfo.remarkName||d.authorInfo.nickname}`},gameName:"",scale:3/4,showUserCountInTag:!0,disableLiveCoverBorder:!0,isLogReady:x,userInfo:C,isEnd:2!==d.status,abTestData:S,logParams:(0,n._)({},null!==(o=null==d?void 0:d.logParams)&&void 0!==o?o:{},(null==d?void 0:d.searchLogParams)?{search_params:null==d?void 0:d.searchLogParams}:{},null==u?void 0:null===(t=u.logParams)||void 0===t?void 0:t.live_log_params),onPlay:P,onPause:E,onDestroy:E,enableLiveInfo:!0,isModal:!0,isShowGuide:y,useNewUserSoundGuide:_,flvSrc:b}))}),H=e=>{let{item:l,videoRef:t}=e;return l.awemeType===W.e.LiveCard?(0,r.jsx)(B,(0,i._)((0,n._)({},e),{ref:t})):(0,r.jsx)(O.Z,(0,i._)((0,n._)({},e),{isMultiInstanceScene:!0,ref:t}))};t("675373");var G=t("338426"),K=t("337499"),z=t("542246"),Z=t("113255"),q=t("239910"),Y=t("774765"),$=t("253754");let J=(e,l,t,n,i,o)=>{let[r,d]=(0,a.useState)(!0),[s,u]=(0,a.useState)(!1),{handleHiddenLog:c}=(0,$.s)(),[v,m]=(0,a.useState)((0,b.r)()),f=(0,a.useRef)(null),p=(0,a.useRef)(!1),{run:h}=(0,Y.Z)(()=>{d(!0)},500,[],{trailing:!1,leading:!0}),{run:g}=(0,Y.Z)(async()=>{d(p.current||!1)},3e3),y=()=>{p.current=!0},_=()=>{p.current=!1},[w,I]=(0,a.useState)(null);return(0,P.o)(()=>{if(i&&t){var l,n;let t=null==o?void 0:null===(n=o.current)||void 0===n?void 0:null===(l=n.getPlayerRoot)||void 0===l?void 0:l.call(n);!t&&(null==e?void 0:e.awemeType)!==W.e.LiveCard&&(t=document.querySelector(`#${i} [data-e2e="feed-active-video"] .basePlayerContainer`)),I(null!=t?t:null)}else I(null)},[e,l,i,t,o]),(0,P.o)(()=>{var e,l;if(!!w&&!!t)return w.addEventListener("mousemove",h),w.addEventListener("mousemove",g),null===(e=f.current)||void 0===e||e.addEventListener("mouseenter",y),null===(l=f.current)||void 0===l||l.addEventListener("mouseleave",_),()=>{var e,l;w.removeEventListener("mouseenter",y),w.removeEventListener("mouseleave",_),null===(e=f.current)||void 0===e||e.removeEventListener("mousemove",h),null===(l=f.current)||void 0===l||l.removeEventListener("mousemove",g)}},[w,t,e]),(0,P.o)(()=>{if(!w||!t)return;let e=()=>{m((0,b.r)())};return document.addEventListener("fullscreenchange",e),document.addEventListener("mozfullscreenchange",e),document.addEventListener("webkitfullscreenchange",e),document.addEventListener("msfullscreenchange",e),()=>{document.removeEventListener("fullscreenchange",e),document.removeEventListener("mozfullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("msfullscreenchange",e)}},[t,w]),(0,a.useEffect)(()=>{d(!0),p.current=!1,t&&w&&g()},[t,e,n,v,w]),(0,a.useEffect)(()=>{u(r)},[r]),{isShowExtra:!w||s,extraRef:f,searchBarProps:{onHistoryClick:e=>{let{text:l}=e.currentTarget.dataset;return c(l)},onSearchClick:e=>c(e),onInputKeyDown:(e,l)=>{if("Enter"===(0,E.CS)(e))return c(l)}}}};var Q=t("151681"),X=t("739808");let ee=(0,G.ZP)(()=>Promise.resolve().then(t.bind(t,156795)),{resolveComponent:e=>{let{SearchBar:l}=e;return l},ssr:!1}),el=(0,G.ZP)(()=>Promise.resolve().then(t.bind(t,391298)),{resolveComponent:e=>{let{AiSearchBar:l}=e;return l},ssr:!1}),et=(0,G.ZP)(()=>Promise.resolve().then(t.bind(t,391298)),{resolveComponent:e=>{let{AiSearchBarWithAiMiddlePage:l}=e;return l},ssr:!1}),en=(0,G.ZP)(()=>Promise.resolve().then(t.bind(t,391298)),{resolveComponent:e=>{let{AiSearchBarWithAiInput:l}=e;return l},ssr:!1}),ei=e=>{var l,t,i,o,d;let{isInnerFeed:s,modalInnerFeedCard:c,isClientMiniWin:v,refPlayer:m,onBack:f,onBackWithInnerMode:p,abtestData:y,awemeInfoList:_,currentNumber:w,modalEnterFrom:I,isSelf:S,userInfo:C,logParams:x,searchParams:P,slideVideoTab:b,currentAwemeInfo:T,autoOpenPip:L,containerId:A,fullScreenTarget:M}=e,j=(null==T?void 0:T.awemeType)===W.e.LiveCard,{handleHiddenLog:N}=(0,$.s)(),{supportAiTop1:R}=(0,k.Iq)(e=>{let{supportAiTop1:l}=e;return{supportAiTop1:l}}),D=(0,X.V1)(),{awemeFeed:F}=(0,Q.j)(),{isWebMiniWin:V}=(0,k.Iq)(e=>{let{isWebMiniWin:l}=e;return{isWebMiniWin:l}}),{isShowExtra:U,extraRef:O}=J(T,null==m?void 0:null===(l=m.current)||void 0===l?void 0:l.getPlayer(),!V&&!v,s,A,m),B=(0,a.useMemo)(()=>"waterFall"===I,[I]),[H,G]=(0,a.useState)(!1);(0,a.useEffect)(()=>{var e;G(!!(null!==(e=h.Le.getConfig(h.gI.ImmersiveSwitchStatus))&&void 0!==e&&e))},[w]),(0,a.useEffect)(()=>{let e=g.listen(g.EVENT.ImmersiveSwitch,e=>{let{isOn:l}=e;l!==H&&G(!!l)});return()=>e()},[H]);let Y=F.useValue("cardType",e=>[K.L.Author,K.L.Related,K.L.Mix,K.L.AwemeRelated,K.L.Series].includes(e)),ei=(0,a.useMemo)(()=>L?s||!!c||Y:s||!!c,[L,s,c,Y]),eo=(0,a.useMemo)(()=>{var e;return"general_search"===I?(0,n._)({},x,(null==_?void 0:null===(e=_[w])||void 0===e?void 0:e.logParams)||{}):void 0},[x,I,_,w]),er="general_search"===I?(0,n._)({},x,(null==_?void 0:null===(t=_[w])||void 0===t?void 0:t.logParams)||{}):void 0,ea=(0,a.useCallback)(e=>{let{text:l}=e.currentTarget.dataset;return N(l)},[N]),ed=(0,a.useCallback)((e,l)=>{if("Enter"===(0,E.CS)(e))return N(l)},[N]),es=(0,a.useMemo)(()=>({awemeInfo:_[w],scene:"modal",modalEnterFrom:I}),[_,w,I]);return v||V?null:(0,r.jsxs)("div",{ref:O,className:u()({[z.default.extraTL]:B,[z.default.extraShow]:B&&U}),children:[ei?(0,r.jsx)(q.N,{positionFixed:!0,exitTextProps:{getCurrentTab:()=>{var e,l;return(null==m?void 0:null===(l=m.current)||void 0===l?void 0:null===(e=l.getCurTab)||void 0===e?void 0:e.call(l))||b},modalEnterFrom:I,isSelf:S,uidEquals:(null==_?void 0:null===(o=_[w])||void 0===o?void 0:null===(i=o.authorInfo)||void 0===i?void 0:i.uid)===(null==C?void 0:null===(d=C.info)||void 0===d?void 0:d.uid),awemeInfo:null==_?void 0:_[w]},onHandleReturn:p}):(0,r.jsx)(Z.P,{onClick:f,isClientMiniWin:v}),j||c&&!_[w]?null:(0,r.jsx)("div",{className:u()(z.default.searchCt,"isDark",{[z.default.hidden]:H}),children:(()=>{if((null==y?void 0:y.aiSearchAiInput)&&(null==y?void 0:y.aiSearchInputMiddleNew)&&R&&!D)return(0,r.jsx)(el,{customProps:{isModalVideo:!0,isSmoothInnerFeed:s,searchParams:P,logParams:(null==y?void 0:y.innerSlideSmooth)?eo:er},userInfo:C,abTestData:y,onSearchClick:(null==y?void 0:y.innerSlideSmooth)?N:e=>N(e),onHistoryClick:(null==y?void 0:y.innerSlideSmooth)?ea:e=>{let{text:l}=e.currentTarget.dataset;return N(l)},onInputKeyDown:(null==y?void 0:y.innerSlideSmooth)?ed:(e,l)=>{if("Enter"===(0,E.CS)(e))return N(l)},playerProps:(null==y?void 0:y.innerSlideSmooth)?es:{awemeInfo:_[w],scene:"modal",modalEnterFrom:I},fullScreenTarget:M});if(!(null==y?void 0:y.aiSearchAiInput)&&(null==y?void 0:y.aiSearchInputMiddleNew)&&R&&!D)return(0,r.jsx)(et,{customProps:{isModalVideo:!0,isSmoothInnerFeed:s,searchParams:P,logParams:(null==y?void 0:y.innerSlideSmooth)?eo:er},userInfo:C,abTestData:y,onSearchClick:(null==y?void 0:y.innerSlideSmooth)?N:e=>N(e),onHistoryClick:(null==y?void 0:y.innerSlideSmooth)?ea:e=>{let{text:l}=e.currentTarget.dataset;return N(l)},onInputKeyDown:(null==y?void 0:y.innerSlideSmooth)?ed:(e,l)=>{if("Enter"===(0,E.CS)(e))return N(l)},playerProps:(null==y?void 0:y.innerSlideSmooth)?es:{awemeInfo:_[w],scene:"modal",modalEnterFrom:I}});if((null==y?void 0:y.aiSearchAiInput)&&!(null==y?void 0:y.aiSearchInputMiddleNew)&&R&&!D)return(0,r.jsx)(en,{customProps:{isModalVideo:!0,isSmoothInnerFeed:s,searchParams:P,logParams:(null==y?void 0:y.innerSlideSmooth)?eo:er},userInfo:C,abTestData:y,onSearchClick:(null==y?void 0:y.innerSlideSmooth)?N:e=>N(e),onHistoryClick:(null==y?void 0:y.innerSlideSmooth)?ea:e=>{let{text:l}=e.currentTarget.dataset;return N(l)},onInputKeyDown:(null==y?void 0:y.innerSlideSmooth)?ed:(e,l)=>{if("Enter"===(0,E.CS)(e))return N(l)},playerProps:(null==y?void 0:y.innerSlideSmooth)?es:{awemeInfo:_[w],scene:"modal",modalEnterFrom:I},fullScreenTarget:M});else return(0,r.jsx)(ee,{customProps:{isModalVideo:!0,isSmoothInnerFeed:s,searchParams:P,logParams:(null==y?void 0:y.innerSlideSmooth)?eo:er},userInfo:C,abTestData:y,onSearchClick:(null==y?void 0:y.innerSlideSmooth)?N:e=>N(e),onHistoryClick:(null==y?void 0:y.innerSlideSmooth)?ea:e=>{let{text:l}=e.currentTarget.dataset;return N(l)},onInputKeyDown:(null==y?void 0:y.innerSlideSmooth)?ed:(e,l)=>{if("Enter"===(0,E.CS)(e))return N(l)},playerProps:(null==y?void 0:y.innerSlideSmooth)?es:{awemeInfo:_[w],scene:"modal",modalEnterFrom:I}})})()})]})};t("429532");var eo=t("734123"),er=t("256277"),ea=t("17750"),ed=t("242007"),es=t("79307"),eu=t("35730"),ec=t("491362"),ev=t("28237"),em=t("371260"),ef=t("788418"),ep=t("782563"),eh=t("667557"),eg=t("411080"),ey=t("361558"),e_=t("289089"),ew=t("489862"),eI=t("767449");let eS=e=>{let{player:l,awemeInfo:t,isActive:o,abtestData:r,modalEnterFrom:d}=e,s=c.a.WaterFall===d;(0,a.useEffect)(()=>{let e;if(!l||!o||!s)return;let a=!!(null==r?void 0:r.themeColorOptimize),d=()=>{(l.cumulateTime?l.cumulateTime:0)>15e3&&((0,ed.VY)({info:{[e_.BW.CompletePlayTime]:!0},awemeId:null==t?void 0:t.awemeId,abData:0}),clearInterval(e))},u=()=>{if(a){let e=h.Le.getConfig(h.gI.JxOuterProgress)||{},l=(null==e?void 0:e[null==t?void 0:t.awemeId])||{},o=(null==l?void 0:l.startTime)||0,r=(null==l?void 0:l.duration)||0;h.Le.setConfig(h.gI.JxOuterProgress,(0,i._)((0,n._)({},e),{[null==t?void 0:t.awemeId]:{duration:r,startTime:o,progress:100,isWatchedEnd:!0}}))}if((null==t?void 0:t.awemeType)!==68)(0,ed.VY)({info:{[e_.BW.Finish]:!0},awemeId:null==t?void 0:t.awemeId,abData:0})},c=()=>{var e,o;let r=null!==(e=null==l?void 0:l.currentTime)&&void 0!==e?e:0,a=null!==(o=null==l?void 0:l.duration)&&void 0!==o?o:0,d=h.Le.getConfig(h.gI.JxOuterProgress)||{},s=(null==d?void 0:d[null==t?void 0:t.awemeId])||{},u=!!(null==s?void 0:s.isWatchedEnd),c=a>0?Math.round(r/a*100):0;h.Le.setConfig(h.gI.JxOuterProgress,(0,i._)((0,n._)({},d),{[null==t?void 0:t.awemeId]:{isWatchedEnd:u,startTime:r,progress:u?100:c,duration:a}}))};return l.once(eI.Ku,u),a&&l.on(eI.MH,c),()=>{d(),l.off(eI.Ku,u),e&&clearInterval(e),a&&l.off(eI.MH,c)}},[l,t,o,r])},eC=e=>{let{awemeInfo:l,isActive:t,modalEnterFrom:n}=e;(0,a.useEffect)(()=>{var e;let{discoverPageCurrentVideoId:i,discoverPageVideoVV:o=0}=h.Le.getConfig(h.gI.LandingPageGuideInfo)||{};t&&(e=[c.a.Hot,c.a.WaterFall],e.includes(n))&&i!==l.awemeId&&h.Le.setConfig(h.gI.LandingPageGuideInfo,{discoverPageVideoVV:o+1,discoverPageCurrentVideoId:l.awemeId},!0)},[t,l.awemeId])};var ex=t("81357"),eP=t("702790"),eE=t("720359"),eb=t("77726"),eT=t("317914"),eL=t("702726"),ek=t("658065"),eA=t("860684");let eM=e=>{let{awemeInfo:l,isActive:t,logParams:i={}}=e||{},o=(0,eE.d)(i),r=(0,eA.n)();(0,a.useEffect)(()=>{if(t&&r&&l){let e=()=>{let e=`${eT.w3.modal.modal_first_video_play}_start`,t=`${eT.w3.modal.modal_first_video_play}_end`,i=(0,eb.bE)(e);if((null==i?void 0:i.length)>0){(0,eb.B1)({tag:t});let i=(0,eb.L8)(eT.w3.modal.modal_first_video_play,e,t);i>0&&eL.logInstance.sendLog("webPerfTiming",(0,n._)({enter_from:(0,ek.yW)(),aweme_id:null==l?void 0:l.awemeId,[eT.w3.modal.modal_first_video_play]:i},(null==o?void 0:o.current)||{})),(0,eb.tl)(e),(0,eb.tl)(t),(0,eb.tl)(eT.w3.modal.modal_first_video_play)}};if(r.isPlaying||r.currentTime>0){e();return}return r.on(eo.Events.AUTOPLAY_STARTED,e),r.on(eo.Events.AUTOPLAY_PREVENTED,e),()=>{r.off(eo.Events.AUTOPLAY_STARTED,e),r.off(eo.Events.AUTOPLAY_PREVENTED,e)}}},[l,r,t])},ej=e=>{let{awemeInfo:l,isActive:t,logParams:n={}}=e;return eM({awemeInfo:l,isActive:t,logParams:n}),null};var eN=t("439087"),eR=t("488799"),eD=t("709409"),eF=t("940826"),eV=t("5415"),eW=t("270116"),eU=t("765027"),eO=t("567754"),eB=t("820303"),eH=t("744121"),eG=t("631493");let eK=e=>{let l=(0,eA.n)(),{awemeInfo:t,modalEnterFrom:n,isActive:i}=e;return(0,a.useEffect)(()=>{eG.s.getAllPlayer().filter(e=>eG.s.getPlayerScene(e.playerId)!==es.lT.Modal).forEach(e=>{var l;null===(l=e.pause)||void 0===l||l.call(e),e.config.autoplay=!1,e.autoplay=!1})},[]),(0,a.useEffect)(()=>{var e,t;if((null==l?void 0:l.setConfig)&&(null===(t=l.plugins)||void 0===t?void 0:null===(e=t.keyboard)||void 0===e?void 0:e.keyCodeMap)){let e=l.plugins.keyboard.keyCodeMap;"rightD"in e&&delete e.rightD,"leftA"in e&&delete e.leftA,l.setConfig({keyboard:{keyCodeMap:e}})}},[l]),(0,a.useEffect)(()=>{l&&i&&(0,eH.wS)(l.playerId,!0)},[l,i]),(0,a.useEffect)(()=>{var e,l,t;return sessionStorage.setItem("ModalRefresh","1"),null===(t=document)||void 0===t||null===(l=t.activeElement)||void 0===l||null===(e=l.blur)||void 0===e||e.call(l),()=>{let{url:e,query:l}=eO.parseUrl(location.href);delete l.modal_id,window.history.replaceState(null,"",eO.stringifyUrl({url:e,query:l}))}},[]),(0,a.useEffect)(()=>{if(t&&!(0,ep.DT)()&&"recommendUpdateWindow"!==n&&n!==c.a.FollowAuthorModal&&i){let{url:n,query:i}=eO.parseUrl(location.href);if(!i.modal_id){var e,l;(0,eB.t_)(eu.SessionStorageKeys.BackURl,null===(l=window)||void 0===l?void 0:null===(e=l.location)||void 0===e?void 0:e.pathname)}i.modal_id=null==t?void 0:t.awemeId,window.history.replaceState(null,"",eO.stringifyUrl({url:n,query:i}))}},[t,i,n]),(0,a.useEffect)(()=>{if(""===document.body.style.overflow)return document.body.style.overflow="hidden",()=>{document.body.style.overflow=""}},[]),null};var ez=t("681799"),eZ=t("527816"),eq=t("55426"),eY=t("894416");let e$=e=>{let{isActive:l,startTime:t,awemeInfo:n,isLogin:i=!1,isClientMiniWin:o=!1}=e,r=(0,eA.n)(),d=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if(r&&l&&t>=3&&(0,eh.D)(n)&&i&&!o&&!d.current){let e=()=>{var e,l;null===(l=r.showPrompt)||void 0===l||l.call(r,{text:`上次播放至：${(0,eq.$y)(1e3*t)}`},{mode:"arrow",autoHide:!0,interval:3e3,preventScreenOverflow:!0,style:{left:`${1e3*t/(null==n?void 0:null===(e=n.video)||void 0===e?void 0:e.duration)*100}%`,bottom:"10px",padding:"8px 12px",borderRadius:"12px",backgroundColor:"#33343F",color:"#ffffff",fontSize:"12px",transition:"none",zIndex:"20"}}),d.current=!0};return r.once("play",e),()=>{r.off("play",e)}}if(r&&l&&t>=3&&i&&o){var e;null===(e=r.hidePrompt)||void 0===e||e.call(r)}},[r,l,t,n,i,o]),null},eJ=e=>{let l=(0,eY.N)();return(0,r.jsx)(F.k,{componentName:"WaterLaterContinueTip",Slardar:l,children:(0,r.jsx)(e$,(0,n._)({},e))})};var eQ=t("894995"),eX=t("661639"),e0=t("794117"),e1=t("550339"),e3=t("943695"),e8=t("552167"),e2=t("517864"),e4=t("445482"),e7=t("392334"),e6=t("159223"),e5=t("855340"),e9=t("288038"),le=t("371976"),ll=t("136880"),lt=t("437515"),ln=t("341738"),li=t("477435"),lo=t("85599"),lr=t("40568"),la=t("843029"),ld=t("554281"),ls=t("198702"),lu=t("522376"),lc=t("164619"),lv=t("44944"),lm=t("744785"),lf=t("955462"),lp=t("567590"),lh=t("71575"),lg=t("33723"),ly=t("138139"),l_=t("714835"),lw=t("48559"),lI=t("640393"),lS=t("383639"),lC=t("797367"),lx=t("244773"),lP=t("248333"),lE=t("15303"),lb=t("923693"),lT=t("644860"),lL=t("592162"),lk=t("99840"),lA=t("174554"),lM=t("950081"),lj=t("156053"),lN=t("774314"),lR=t("40970"),lD=t("250286"),lF=t("356650"),lV=t("178872"),lW=t("41667"),lU=t("97598"),lO=t("348447"),lB=t("399083"),lH=t("495765"),lG=t("185026"),lK=t("502100"),lz=t("532048"),lZ=t("492849"),lq=t("326111"),lY=t("893849"),l$=t("312540"),lJ=t("832976");t("340509"),t("368529");var lQ=t("399818"),lX=t("475004"),l0=t("169171"),l1=t("638392"),l3=t("427694"),l8=t("61698"),l2=t("563830"),l4=t("551677"),l7=t("73528"),l6=t("597321");let l5=e=>{let{config:l,isInitPlayer:t}=e,n=(0,eA.n)();return(0,a.useEffect)(()=>{if(t&&n){let e=setTimeout(()=>{var e,t;!(null===(e=n.plugins)||void 0===e?void 0:e.srplugin)&&(null===(t=l.plugins)||void 0===t?void 0:t.includes(l7.o))&&(n.config.srplugin=l.srplugin,n.registerPlugin(l7.o),setTimeout(()=>{n.emit(l6.B.RegisterMissingSrPlugin)}))});return()=>{clearTimeout(e)}}},[n,t]),null},l9=e=>{let l=(0,eY.N)();return(0,r.jsx)(F.k,{componentName:"RegisterMissingPlugin",Slardar:l,children:(0,r.jsx)(l5,(0,n._)({},e))})};var te=t("385976"),tl=t("617297"),tt=t("743317"),tn=t("643728"),ti=t("757135"),to=t("881155"),tr=t("901414"),ta=t("198518"),td=t("794436"),ts=t("877438");let tu=(0,a.memo)((0,a.forwardRef)((e,l)=>{var t,o,d,s,m,g,_,w,I,S,C,x,P,E,b,T,L,A,M,j,N,R;let{isActive:D,isNext:F,isPrev:V,isFirst:U,isLast:O,awemeInfo:B,nextAwemeInfo:H,prevAwemeInfo:G,playNextFunc:K,abtestData:z,deleteCurrentSwiper:Z,toggleComment:q,onAvatarClick:Y,fullScreenTarget:$,logParams:J,videoToast:Q,followHandler:X,playPrevFunc:ee,userInfo:el,dispatch:et,isAuthorCardShow:en,isShowRelatedCard:ei,moreBoxShowList:eI,videoHashtagClassName:eE,videoTags:eb,children:eT,disableAutoPlay:eL,shortCutFiltered:ek,positionBoxClassName:eA,customProps:eM,actionFollow:eO,actionUnFollow:eB,modalEnterFrom:eH,showPlaySwitch:eG=!0,isShowPageFullScreen:eq=!1,isShowCssFullScreenGuide:eY,isInnerFeed:e$,onCooperationAuthorClick:l7,isShowCooperation:l6,sideBarShow:l5,slardarInstance:tu,defaultIsPageFullScreen:tc,avatarTipText:tv,onRelatedClick:tm,onDislike:tf,activityCardDirectOpen:tp,onActivityCardClick:th=()=>{},onShopAnchorClick:tg=()=>{},onShopAnchorMouseEnter:ty=()=>{},onShopAnchorMouseLeave:t_=()=>{},onDouPlusClick:tw,onSodaClick:tI,isShowGuide:tS,notCanMixListen:tC,openSpecificTab:tx,index:tP,isFullScreen:tE,useNewUserSoundGuide:tb,isMultiInstanceScene:tT,isUpperFeed:tL,isRevisitStart:tk,startTime:tA,chapterProps:tM,setContainerPlayer:tj,reuseConfig:tN,recommendTagProps:tR,canShowListenVideo:tD,listenFeedNextAwemeInfo:tF,listenFeedPrevAwemeInfo:tV,hideModalWhenPip:tW,setHideModalByPip:tU,modalClose:tO,aiNoteProps:tB,isShowAdCard:tH,isShowShopSideCard:tG,appendPlayerConfig:tK,LiveSliderCard:tz,disableShortCut:tZ,isAdShortCut:tq,isShowAiCard:tY,sideCardContext:t$}=e,tJ=(0,a.useRef)(null),{isMainland:tQ,isWebMiniWin:tX,pipWindow:t0,isListenVideoMiniWin:t1,fullScreenQuestionVars:{isShowingQuestion:t3}={isShowingQuestion:!1}}=(0,k.Iq)(e=>{let{isMainland:l,isWebMiniWin:t,pipWindow:n,isListenVideoMiniWin:i,fullScreenQuestionVars:o}=e;return{isMainland:l,isWebMiniWin:t,pipWindow:n,isListenVideoMiniWin:i,fullScreenQuestionVars:o}}),{hasChapterBar:t8}=(0,lM.W)(z,B,null===(t=tJ.current)||void 0===t?void 0:t.player),{isClientMiniWin:t2}=(0,a.useContext)(f.C),t4=(0,ep.DT)(),[t7,t6]=(0,a.useState)(null);(null===(o=tJ.current)||void 0===o?void 0:o.player)&&(tJ.current.player.modalEnterFrom=eH,tJ.current.player.disableAutoPlay=eL,tJ.current.player.isShowPageFullScreen=eq);let t5=(0,a.useMemo)(()=>tX||t2||t1,[tX,t2,t1]);(0,a.useEffect)(()=>{if(!tD&&t1){let e=tr.e.getPipWindow({scene:v.d.ListenVideo});e&&e.close()}},[t1]);let{enablePip:t9}=(0,lW.$)({abtestData:z,enterFrom:eH,awemeInfo:B});eC({isActive:D,awemeInfo:B,modalEnterFrom:eH});let{noPaidVideo:ne}=(0,lU.B)({awemeInfo:B});(0,lO.u)({awemeInfo:B,player:null===(d=tJ.current)||void 0===d?void 0:d.player});let nl=(0,eh.D)(B),{isDanmuIcon:nt,hideList:nn,isChapterIcon:ni,chapterMaxWidth:no,isAiNoteIcon:nr}=(0,lB.Cy)({isActive:D,abtestData:z,player:null===(s=tJ.current)||void 0===s?void 0:s.player,hasChapter:t8,hasAiNote:null==tB?void 0:tB.useable,showInnerAutoplay:e$&&!ne,showAutoPlay:!eL&&!ne,showSubtitles:!!(null==B?void 0:B.claInfo),showFakeScreen:(null==B?void 0:B.awemeType)!==W.e.Note,showPlayBackRatio:(null==B?void 0:B.awemeType)!==W.e.Note,showWatchLater:nl,isMiniWin:t5});(0,lH.j)({player:null==tJ?void 0:null===(m=tJ.current)||void 0===m?void 0:m.player,isActive:D,abValue:z}),(0,lG._)({awemeInfo:B,prevAwemeInfo:G,isInnerFeedModel:e$&&D}),(0,lK.V)({awemeInfo:B}),(0,l3.g)({player:null==tJ?void 0:null===(g=tJ.current)||void 0===g?void 0:g.player,awemeInfo:B}),(0,l8.G)({player:null==tJ?void 0:null===(_=tJ.current)||void 0===_?void 0:_.player,awemeInfo:B,scene:"pc_web_mix_aweme",abtestData:z}),(0,a.useImperativeHandle)(l,()=>{var e;return{getPlayer:()=>tJ.current.getPlayer(),player:null===(e=tJ.current)||void 0===e?void 0:e.player,getPlayerRoot:()=>{var e,l;return null===(e=(l=tJ.current).getPlayerRoot)||void 0===e?void 0:e.call(l)}}}),(0,lz.D)({awemeInfo:B,isActive:D});let na=(0,a.useMemo)(()=>{let e={isModal:!0},l=(0,lj.YO)({abtestData:z,awemeInfo:B,isInnerFeed:e$,modalEnterFrom:eH,isModalVideo:!0});Object.assign(e,(0,lA.k)({awemeInfo:B,abtestData:z,enableSr:l}),(0,lQ.QF)({awemeInfo:B,abtestData:z,enableSr:l})),(0,lN.Zf)({config:e,awemeInfo:B,abtestData:z}),(0,lR.LX)({config:e,awemeInfo:B,abtestData:z,isMultiInstanceScene:tT}),(0,lj.nq)({config:e,abtestData:z,enableSr:l}),e.startTime=(0,eD.v)(B.awemeId),e.pip&&!1===[c.a.Im,c.a.Search,c.a.GeneralSearch].includes(eH)&&(e.pip.showIcon=t9),[c.a.GeneralSearch,c.a.Search].includes(eH)&&!e$&&(e.progressDot=(0,eg.x)(null==B?void 0:B.videoAbstract));try{(null==e?void 0:e.mp4encryptplayer)&&(null==tK?void 0:tK.mp4encryptplayer)&&Object.assign(e.mp4encryptplayer,tK.mp4encryptplayer),(null==e?void 0:e.DASHPlugin)&&(null==tK?void 0:tK.DASHPlugin)&&Object.assign(e.DASHPlugin,tK.DASHPlugin)}catch(e){}return e},[B,z,eH,e$,t9,eH,tK]),nd=(0,a.useMemo)(()=>(0,er.Jt)(B),[B]),ns=(0,a.useMemo)(()=>(0,er.gc)(B),[B]),nu=(0,a.useMemo)(()=>{var e;return[...(null==eI?void 0:eI.notInterestingIcon)?[]:[null===(e=ea.getShortcut().dislike)||void 0===e?void 0:e.badgeText],...ek||[]]},[null==eI?void 0:eI.notInterestingIcon,ek]),nc=(0,a.useCallback)(()=>{c.a.WaterFall===eH&&(0,ed.VY)({info:{[e_.BW.Finish]:!0},awemeId:null==B?void 0:B.awemeId,abData:0})},[z,eH]);(0,lZ.O)({player:null===(w=tJ.current)||void 0===w?void 0:w.player,isActive:D,awemeInfo:B,abtestData:z,isWebMiniWin:tX}),(0,lq.w)({player:null===(I=tJ.current)||void 0===I?void 0:I.player,isActive:D,awemeInfo:B,abtestData:z,isInnerFeed:e$}),(0,lY.U)({config:na,isActive:D,awemeInfo:B,player:null===(S=tJ.current)||void 0===S?void 0:S.player}),(0,l$.Q)({player:null===(C=tJ.current)||void 0===C?void 0:C.player,isActive:D,awemeInfo:B,abtestData:z,isSliderVideo:!0,isKeyWorkCancalLike:!0,shortcutExclude:[],isClientMiniWin:t2,pipWindow:t0,isLogin:null==el?void 0:el.isLogin}),eS({player:null===(x=tJ.current)||void 0===x?void 0:x.player,isActive:D,awemeInfo:B,abtestData:z,modalEnterFrom:eH});let nv=(0,a.useRef)(!1),{idlCallBackFlag:nm}=(0,lJ.o)({isActive:F,once:!0}),nf=(0,a.useMemo)(()=>{if(null==z?void 0:z.innerSlideSmooth)return!!nv.current||D||V||F&&nm&&1!==tP;return D||V||F},[D,V,F,nm]);nv.current=nf;let np=(0,p.x)(),{anchorList:nh,hasJingxuanActivity:ng}=(0,tl.e)({abtestData:z,awemeInfo:B}),ny=!ng&&(0,tn.$)({abTestData:z,awemeInfo:B});(0,ta.M)({awemeInfo:B,player:null==tJ?void 0:null===(P=tJ.current)||void 0===P?void 0:P.player,noPaidVideo:ne,isInnerFeed:e$});let{listenVideoDisablePrev:n_,listenVideoDisableNext:nw}=(0,l2.T)({isAuthorCardShow:en,isFirst:U,isLast:O,isShowRelatedCard:ei,canUseListenFeed:eH===c.a.WaterFall,prevAwemeInfo:G,nextAwemeInfo:H,listenFeedNextAwemeInfo:tF,listenFeedPrevAwemeInfo:tV,isInnerFeed:e$,isActive:D}),{scene:nI,reuseId:nS}=null!=tN?tN:{},nC=!(te.YY.checkIsReuseWithId(nI,nS)&&nS===(null==B?void 0:B.awemeId))&&!U&&eH===c.a.WaterFall,nx=(null==z?void 0:z.reuseVideoDiscover)&&nC?eP.Y:ex.f,nP=(0,a.useMemo)(()=>{var e;return(null===(e=window.__QUICK_PLAYER)||void 0===e?void 0:e.playerId)&&window.__QUICK_PLAYER.playerId===(null==t7?void 0:t7.playerId)},[]),nE=eH===c.a.WaterFall?null===(E=h.Le.getConfig(h.gI.JxOuterProgress))||void 0===E?void 0:E[null==B?void 0:B.awemeId]:{},nb=eH===c.a.WaterFall&&!!((null==nE?void 0:nE.isWatchedEnd)||(null==nE?void 0:nE.progress)),nT=(0,a.useMemo)(()=>(0,i._)((0,n._)({},J),{is_theme_progress_bar:nb?"1":"0"}),[J,nb]);return(0,a.useEffect)(()=>{var e,l,t;let n=null===(e=tJ.current)||void 0===e?void 0:e.player;if(n&&(nP||te.YY.checkIsReusePlayer(null==tN?void 0:tN.scene,null==tN?void 0:tN.reuseId,n))){let e=null==n?void 0:null===(t=n.root)||void 0===t?void 0:null===(l=t.closest)||void 0===l?void 0:l.call(t,".basePlayerContainer");e&&eo.Util.addClass(e,"reusePlayer")}},[nP,tN,tJ.current]),(0,ts.O)({abtestData:z,player:null==tJ?void 0:null===(b=tJ.current)||void 0===b?void 0:b.player,scene:es.lT.Modal,awemeInfo:B,isActive:D,refPlayer:tJ}),(0,r.jsxs)(nx,{xgplayerConfig:na,isInitPlayer:nf,style:(0,n._)({height:"100%",width:"100%"},t1?{display:"none"}:{}),className:u()(ew.default.container,"chapterPlayerStyle","modalPlayer","lowPopup",[c.a.GeneralSearch,c.a.Search].includes(eH)?"searchModal":""),ref:tJ,scene:es.lT.Modal,onReady:e=>{t6(e)},slardarInstance:tu,reuseConfig:tN,setContainerPlayer:tj,abtestData:z,children:[(0,r.jsx)(lX.V,{awemeInfo:B,isActive:D,timeout:(0,y.b_)()?4e3:2e3,isFirst:!0}),(0,r.jsx)(ej,{awemeInfo:B,isActive:D,logParams:nT}),(0,r.jsx)(eV.p,{scene:es.lT.Modal,isActive:D}),(0,r.jsx)(eD.t,{awemeInfo:B,player:null===(T=tJ.current)||void 0===T?void 0:T.player,isActive:D}),(0,r.jsxs)(eW.n,{isActive:D,controlHeight:es.fp.MidHigh,position:"right",awemeInfo:B,className:(0,i._)((0,n._)({},eA),{right:u()(null==eA?void 0:eA.right,{fullscreenModal:tE})}),abtestData:z,children:[eG&&!t2&&(0,r.jsx)(eU.I,{playNextFunc:K,playPrevFunc:ee,disablePrev:U&&!(en||ei)||(en||ei)&&!G,disableNext:O&&!(en||ei)||(en||ei)&&!H,className:u()(ew.default.playSwitchContainer,"filter-bg","activity"!==eH||tL?"":ew.default.playSwitchContainerHidden)}),!t2&&((null==z?void 0:z.innerSlideSmooth)?(0,r.jsx)(eF.InteractionNew,{canShowListenVideo:tD,playPrevFunc:ee,playNextFunc:K,listenVideoDisableNext:nw,listenVideoDisablePrev:n_,hideModalWhenPip:tW,setHideModalByPip:tU,modalClose:tO,actionFollow:eO,actionUnFollow:eB,onDouPlusClick:tw,awemeInfo:B,toggleComment:q,loginUserInfo:el,loginDispatch:et,deleteCurrentSwiper:Z,fullScreenTarget:$,onAvatarClick:Y,abtestData:z,videoToast:Q,isActive:D,followHandler:X,reportExtraParams:nT,moreBoxShowList:eI,onRelatedClick:tm,canShowAvatarFollowBtn:!ns,canShowAvatarTip:!ns,showMusicDetail:!(0,er.gc)(B),avatarTipText:tv,onDislike:tf,isShowAiCard:tY,recommendTriggered:null==tR?void 0:tR.recommended,showRecommendToFriend:!!tR,isSearchPlayer:"general_search"===eH,from:[c.a.GeneralSearch,c.a.Search].includes(eH)?"search":void 0}):(0,r.jsx)(eF.Interaction,{canShowListenVideo:tD,playPrevFunc:ee,playNextFunc:K,listenVideoDisableNext:nw,listenVideoDisablePrev:n_,hideModalWhenPip:tW,setHideModalByPip:tU,modalClose:tO,actionFollow:eO,actionUnFollow:eB,onDouPlusClick:tw,awemeInfo:B,toggleComment:q,loginUserInfo:el,loginDispatch:et,deleteCurrentSwiper:Z,fullScreenTarget:$,onAvatarClick:Y,abtestData:z,videoToast:Q,isActive:D,followHandler:X,reportExtraParams:nT,moreBoxShowList:eI,onRelatedClick:tm,canShowAvatarFollowBtn:!ns,canShowAvatarTip:!ns,showMusicDetail:!(0,er.gc)(B),avatarTipText:tv,onDislike:tf,isShowAiCard:tY,recommendTriggered:null==tR?void 0:tR.recommended,showRecommendToFriend:!!tR,isSearchPlayer:"general_search"===eH,from:[c.a.GeneralSearch,c.a.Search].includes(eH)?"search":void 0}))]}),(0,r.jsx)(eK,{awemeInfo:B,isActive:D,modalEnterFrom:eH}),!(0,ey.B)(B)&&(0,r.jsx)(ez._,{awemeInfo:B,isActive:D,controlHeight:es.fp.MidHigh,showImg:!(0,y.G6)(),abtestData:z}),(null==B?void 0:null===(L=B.video)||void 0===L?void 0:L.duration)>18e4&&(0,r.jsx)(eZ.S,{awemeInfo:B,isActive:D,isLogin:null==el?void 0:el.isLogin,startTime:tk?tA:0,isClientMiniWin:t2}),eH===c.a.UserWatchLater&&(0,r.jsx)(eJ,{awemeInfo:B,isActive:D,isLogin:null==el?void 0:el.isLogin,startTime:tA,isClientMiniWin:t2}),t9&&(0,r.jsx)(eN._,{isActive:D,awemeInfo:B,abtestData:z,hideModalWhenPip:tW,setHideModalByPip:tU,modalClose:tO,isReusePlayer:(null==z?void 0:z.reuseVideoDiscover)&&nC,logParams:nT}),(0,r.jsx)(eQ.V,{awemeInfo:B,isActive:D}),(null==B?void 0:null===(A=B.chargeInfo)||void 0===A?void 0:A.is_charge_content)&&(0,r.jsx)(eX.V,{awemeInfo:B,isActive:D,isMiniWin:t5,isShowReplay:!t5}),eL?(0,r.jsx)(e0.r,{}):(0,r.jsxs)(r.Fragment,{children:[e$||ne?null:(0,r.jsx)(e1.kL,{isActive:D,awemeInfo:B,playNextFunc:K,customLocalStorage:[c.a.Search,c.a.GeneralSearch].includes(eH)?eu.LocalStorageKeys.SearchHorizontalAutoPlay:void 0,ablePlayNext:!(O&&!(en||ei)||(en||ei)&&!H),shortcutDisabled:!1,abtestData:z,defaultVal:1}),e$&&!ne?(0,r.jsx)(e3.Ot,{isActive:D,awemeInfo:B,playPrevFunc:ee,playNextFunc:K,ablePlayPrev:!((en||ei)&&!G),ablePlayNext:!((en||ei)&&!H),hide:nn.some(e=>e[0]===lB.p7.InnerAutoPlayer),abtestData:z}):null]}),!ne&&(0,r.jsx)(e8.SD,{isActive:D,awemeInfo:B,abtestData:z,isInnerFeed:e$,hide:nn.some(e=>e[0]===lB.p7.Clear),scene:es.lT.Modal}),(0,r.jsx)(e2.SE,{isActive:D,awemeInfo:B,abtestData:z}),(0,r.jsx)(l9,{isInitPlayer:nf,config:na}),(0,r.jsx)(e4.k,{isActive:D,onVolumeShortCutChange:()=>{var e;(0,lD.t)(null===(e=tJ.current)||void 0===e?void 0:e.player)}}),(0,r.jsx)(e7.g,{isActive:D,abtestData:z,awemeInfo:B,scene:"modal"}),(0,r.jsx)(e6.b,{isActive:D}),!(0,lF.GP)(B)&&((null==z?void 0:z.innerSlideSmooth)?(0,r.jsx)(e5.Z,{awemeInfo:B,userInfo:el,isActive:D,logParams:nT,isFirst:U,isNext:F,isPrev:V}):(0,r.jsx)(e5.Z,{awemeInfo:B,userInfo:el,isActive:D,logParams:nT,isFirst:U,isNext:F,isPrev:V})),(0,r.jsx)(e9.L,{awemeInfo:B,isActive:D,abtestData:z}),(0,r.jsx)(le.E,{isActive:D,awemeInfo:B,abtestData:z,userInfo:el,deleteCurrentSwiper:Z,config:na,isNext:F,currentIndex:tP,reuseConfig:tN,startTime:tk?tA:0}),(0,r.jsx)(ll.h,{isActive:D}),(0,r.jsx)(lt.P,{isActive:D,awemeInfo:B,abtestData:z,userInfo:el,enablePip:t9}),t5?null:(0,r.jsx)(ln.t,{isInnerFeed:e$,isModalVideo:!0,modalEnterFrom:eH,isActive:D,userInfo:el,dispatch:et,abtestData:z,awemeInfo:B,player:null==tJ?void 0:null===(M=tJ.current)||void 0===M?void 0:M.player,isClientMiniWin:t2}),tb?(0,r.jsx)(l1._q,{isActive:D,awemeInfo:B,isShowGuide:tS,abtestData:z}):(0,r.jsx)(li.x,{isActive:D,awemeInfo:B,abtestData:z,isShowGuide:tS,scene:"recommend"}),nl&&eH!==c.a.UserWatchLater&&(0,r.jsx)(lo.vq,{isActive:D,awemeInfo:B,isLogin:null==el?void 0:el.isLogin,loginDispatch:et,toast:Q,logParams:nT,abtest:z}),nd&&(0,r.jsx)(lr.FeedbackAd,{awemeInfo:B,toast:Q,deleteCurrentSwiper:Z,abtestData:z}),(null==B?void 0:B.awemeType)===W.e.Note?(0,r.jsx)(la.PictureMode,{isActive:D,awemeInfo:B,logParams:nT,playNextFunc:K,abTestData:z,ablePlayNext:!(O&&!(en||ei)||(en||ei)&&!H),playPrevFunc:ee,ablePlayPrev:!(U&&!(en||ei)||(en||ei)&&!G),isClientMiniWin:t2,isShowSideBar:l5,onPlayFinish:nc}):null,(0,r.jsx)(ld.q,{isActive:D,abtestData:z,awemeInfo:B,isInnerFeed:e$}),nd&&(0,r.jsx)(ls.K,{awemeInfo:B,isActive:D}),(0,r.jsx)(lu.PlayBackSetting,{disable:nd,isActive:D,awemeInfo:B,logParams:nT,loginBlock:!(null==el?void 0:el.isLogin)&&!tX,loginDispatch:et,speedType:(0,y.G6)()?ec.$.Safari:ec.$.Normal}),eT,!t2||np?(0,r.jsx)(lc.I,{isActive:D,fullScreenTarget:$,loginDispatch:et,abtestData:z,isLogin:!!(null==el?void 0:el.isLogin)}):null,!t5&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(lv.Danmaku,{isActive:D,awemeInfo:B,userInfo:el,loginDispatch:et,danmakuInfo:null==eM?void 0:eM.danmakuInfo,abtestData:z,isDanmuIcon:nt}),(0,r.jsx)(lm.e,{isActive:D,awemeInfo:B,abtestData:z,aiNoteProps:tB,isAiNoteIcon:nr}),t8?(0,r.jsx)(lf.WC,{isActive:D,awemeInfo:B,userInfo:el,loginDispatch:et,abtestData:z,isChapterIcon:ni,chapterProps:tM,logParams:nT,chapterMaxWidth:no}):null,t4&&(0,r.jsx)(l0.zm,{isActive:D,awemeInfo:B,isInnerFeed:e$,abtestData:z}),eq&&(0,r.jsx)(lp.Vw,{awemeInfo:B,isShowGuide:eY,logParams:nT,isActive:D,defaultIsPageFullScreen:tc,modalEnterFrom:eH,abtestData:z}),(0,r.jsxs)(lh.r,{isActive:D,controlHeight:es.fp.MidHigh,position:"bottom",awemeInfo:B,abtestData:z,children:[ny&&!(null==tR?void 0:tR.recommendTagType)&&(0,r.jsx)(tn.n,{scene:"player",awemeInfo:B}),!(0,to.$m)(B)&&(null==tR?void 0:tR.recommendTagType)&&!(null==tR?void 0:tR.isShowVideoInfoSideCard)&&(0,r.jsx)(ti.B,(0,n._)({userInfo:el,awemeInfo:B,player:t7||(null==tJ?void 0:null===(j=tJ.current)||void 0===j?void 0:j.player),abTestData:z},tR)),nh.length>0&&(0,r.jsx)(tt.E,{awemeInfo:B,anchorList:nh,openActivityCard:th,abtestData:z,activityCardDirectOpen:tp}),tQ&&(0,ev.n)(B)&&!(0,em.o4)(B)&&eH!==c.a.RecommendUpdateWindow&&(0,r.jsx)(lg.n,{awemeInfo:B,onClick:tg,isActive:D,onMouseEnter:ty,onMouseLeave:t_}),(0,ef.A)(B)&&(0,r.jsx)(ly.X,{isActive:D,awemeInfo:B,isHide:tH}),(0,em.o4)(B)&&(0,er.Gu)(B)&&(0,r.jsx)(l_.b,{isHide:tG,isActive:D,awemeInfo:B}),(0,em.o4)(B)&&!(0,er.Gu)(B)&&(0,r.jsx)(lV.A,{isActive:D,awemeInfo:B}),(null==z?void 0:z.innerSlideSmooth)?(0,r.jsx)(lw.VideoInfoNew,{isInnerFeed:e$,isActive:D,awemeInfo:B,userInfo:el,scene:es.lT.Modal,isTopicLinkSearchResult:!0,videoHashtagClassName:eE,modalEnterFrom:eH,videoTags:eH===c.a.RecommendUpdateWindow?[]:eb,abTestData:z,isShowCreateTime:!0,onCooperationAuthorClick:l7,isShowCooperation:l6,showSideBar:l5,loginUserInfo:el,loginDispatch:et,fullScreenTarget:$,reportExtraParams:nT,openSpecificTab:tx,onSodaClick:tI,canMixListen:!tC&&eH!==c.a.RecommendUpdateWindow&&!e$,chapterProps:tM,sideCardContext:t$,showExpandButtonInner:(null==z?void 0:z.aiNoteV2)===2}):(0,r.jsx)(lw.VideoInfo,{isInnerFeed:e$,isActive:D,awemeInfo:B,userInfo:el,scene:es.lT.Modal,isTopicLinkSearchResult:!0,videoHashtagClassName:eE,modalEnterFrom:eH,videoTags:eH===c.a.RecommendUpdateWindow?[]:eb,abTestData:z,isShowCreateTime:!0,onCooperationAuthorClick:l7,isShowCooperation:l6,showSideBar:l5,loginUserInfo:el,loginDispatch:et,fullScreenTarget:$,reportExtraParams:nT,openSpecificTab:tx,onSodaClick:tI,canMixListen:!tC&&eH!==c.a.RecommendUpdateWindow&&!e$,chapterProps:tM,sideCardContext:t$,showExpandButtonInner:(null==z?void 0:z.aiNoteV2)===2}),eH===c.a.WaterFall?(0,r.jsx)(lI.H,{isActive:D,isAdAweme:nd,awemeInfo:B,abtestData:z,toast:Q,playNextFunc:K}):null,!!B.videoAbstract&&eH===c.a.GeneralSearch&&!e$&&(0,r.jsx)(lS.y,{awemeInfo:B,isActive:D,showVideoInfo:!0,player:null===(N=tJ.current)||void 0===N?void 0:N.player,logParams:nT,isModal:!0,openSpecificTab:tx})]}),(0,r.jsx)(lC.h,{awemeInfo:B,isActive:D,userInfo:el,abtestData:z}),(0,r.jsx)(lx.MenuList,{isActive:D,awemeInfo:B,abtestData:z,isSliderVideo:!0,isKeyWorkCancalLike:!0,shortcutExclude:(0,er.Gu)(B)&&nd&&tq?[]:["showAdDetail"],shortCutFiltered:nu,showEnterDetail:!(nd&&(0,er.Gu)(B)),showAdMenu:nd&&(0,er.Gu)(B),disableShortCut:tZ||t3,disableAllNativeShortCut:tZ||t3,modalEnterFrom:eH,userInfo:el,showRecommendToFriend:!!tR}),(0,r.jsx)(lP.B,{awemeInfo:B,abtestData:z,isActive:D}),(0,r.jsx)(lE.I,{abtestData:z,isActive:D,awemeInfo:B,logParams:nT,isChapterScene:!0}),(null==nn?void 0:nn.length)>0&&(0,r.jsx)(lb.SettingList,{isActive:D,awemeInfo:B,hideList:nn,player:null==tJ?void 0:null===(R=tJ.current)||void 0===R?void 0:R.player,dispatch:et,abtestData:z,userInfo:el}),(0,r.jsx)(l4.P,{abtestData:z,isActive:D,controlHeight:es.fp.MidHigh})]}),tX&&(0,r.jsx)(eR.U,{awemeInfo:B}),t2&&(0,r.jsxs)(r.Fragment,{children:[D&&(0,r.jsx)(lT.MiniWinMask,{isActive:D,awemeInfo:B,abtestData:z,playPrevFunc:ee,playNextFunc:K,disablePrev:U&&!(en||ei)||(en||ei)&&!G,disableNext:O&&!(en||ei)||(en||ei)&&!H,ablePlayNext:!(O&&!(en||ei)||(en||ei)&&!H),loginUserInfo:el,loginDispatch:et,fullScreenTarget:$,reportExtraParams:nT,recordPreferVideoSwitch:!0}),D&&!np&&(0,r.jsx)(lL.N,{awemeInfo:B})]}),"general_search"===eH&&(0,r.jsx)(lk.l,{awemeInfo:B,from:"modal_player",isActive:D,isUpperFeed:tL}),eH===c.a.Activity&&(0,r.jsx)(td.I,{awemeInfo:B,from:"modal_player",isActive:D,isUpperFeed:tL})]})}));var tc=t("314423");let tv=()=>{let e=(0,a.useRef)({});return{recordLatestAwemeId:(0,a.useCallback)((l,t)=>{l&&t&&!e.current[t]&&(e.current[t]=!0,h.Le.setConfig(h.gI.FeedLatestViewedAweme,{awemeId:t}))},[])}};var tm=t("217281"),tf=t("277926"),tp=t("288470"),th=t("32167"),tg=t("544933");let ty=new tg.h({closePlayer:{eventName:"close_player",params:{enter_from:"",tab_name:"",click_method:""}},clickPreviousVideo:{eventName:"click_previous_video",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",click_from:"click_button",play_material:"video"}},clickNextVideo:{eventName:"click_next_video",params:{author_id:"",group_id:"",log_pb:"",enter_from:"",previous_page:"",click_from:"click_button",play_material:"video"}},modalNextVideoUnready:{eventName:"modal_next_video_unready",params:{error:"",enter_from:"",group_id:"",log_pb:""}},modalNextVideoView:{eventName:"modal_next_video_view",params:{index:0,success:!0,error:"",enter_from:"",group_id:"",log_pb:""}},clickSmallWindowEntrance:{eventName:"click_small_window_entrance",params:{enter_from:"",click_method:"",is_manual:"0",group_id:"",player_display_mode:""}}}),t_=e=>{let{awemeInfo:l,refPlayer:t,hideModalByPipInitial:i=!1,setHideModalByPipInitial:o,modalEnterFrom:r,logParams:d}=e,s=(0,k.Iq)(e=>{let{pipWindow:l}=e;return{pipWindow:l}}),[u,m]=(0,a.useState)(i),f=function(){let{scene:e="auto",awemeId:l}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{scene:"auto"};if(r===c.a.WaterFall&&(ty.sendLog("clickSmallWindowEntrance",(0,n._)({enter_from:(0,th.vM)(),click_method:e,is_manual:"auto"===e?"0":"1",player_display_mode:(0,th.Ok)(),group_id:l},d)),"auto"===e)){var i,o,a;let e=null==t?void 0:null===(i=t.current)||void 0===i?void 0:i.getPlayer(),{pipWindow:l}=s;null==e||null===(a=e.plugins)||void 0===a||null===(o=a.pip)||void 0===o||o.requestPIP(l)}};return(0,a.useEffect)(()=>{i&&u&&(f({scene:"click_preview_icon",awemeId:null==l?void 0:l.awemeId}),null==o||o(!1))},[i,o]),(0,a.useEffect)(()=>()=>{s.pipWindow&&u&&s.pipWindow.close();let e=tr.e.getPipWindow({scene:v.d.ListenVideo});e&&u&&e.close()},[]),{hideModalByPip:u,setHideModalByPip:m}};var tw=t("948375");let tI=e=>{let{logParams:l,awemeInfoList:t,currentNumber:o,modalInnerFeedCard:r,awemeInfoListRef:d,onLivePause:s,modalEnterFrom:u,close:c,isInnerFeed:v}=e,{awemeFeed:m}=(0,Q.j)(),f=(0,a.useMemo)(()=>null==t?void 0:t[o],[t,o]),p=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];v&&!r?(m.dispatch({modalAwemeInfo:null,nextAwemeInfo:null,prevAwemeInfo:null}),ty.sendLog("closePlayer",(0,i._)((0,n._)({},l,e,(null==f?void 0:f.logParams)||{}),{enter_from:m.getValue("feedType")})),t&&c(o)):(c(o),ty.sendLog("closePlayer",(0,n._)({},l,e,(null==f?void 0:f.logParams)||{})))},[c,f,o,l,v]),h=(0,tw.Z)(()=>{m.dispatch("cardType",null),ty.sendLog("closePlayer",(0,i._)((0,n._)({},l,(null==f?void 0:f.logParams)||{}),{enter_from:m.getValue("feedType"),click_method:"button"})),m.dispatch("modalAwemeInfo",null),r&&(null==c||c())}),y=(0,tw.Z)(e=>{var l,t,n;if(null==e||null===(l=e.preventDefault)||void 0===l||l.call(e),null==e||null===(t=e.stopPropagation)||void 0===t||t.call(e),null==s||s(null===(n=d.current)||void 0===n?void 0:n[o]),(null==e?void 0:e.triggerFrom)!=="ai_search"&&(null==e?void 0:e.triggerFrom)!=="ai_extension"&&(null==e?void 0:e.triggerFrom)!=="activity"||u===(null==e?void 0:e.triggerFrom))p({click_method:"button"},!0)});return(0,a.useEffect)(()=>{let e=g.listen(g.EVENT.triggerModalPlayerClose,y),l=g.listen(g.EVENT.triggerModalPlayerCloseForCachePages,y);return()=>{e(),l()}},[y]),{closeModal:p,onBack:y,onBackWithInnerMode:h}},tS=e=>{let{disableSwitch:l,modalEnterFrom:t,recommendGuideVisible:i,handleCloseGuide:o,setCurrentNumber:r,awemeInfoListRef:d,abtestData:s,logParams:u,modalSlideOptimize:c,swiper:v,setIsFirstEnterVideo:m,closeWhenUp:f}=e,p=(0,a.useRef)(()=>{}),g=(0,a.useRef)(()=>{ty.sendLog("modalNextVideoUnready",(0,n._)({error:"正在加载下一个视频"},u)),D.F.info("正在加载下一个视频")}),y=(0,a.useCallback)(e=>{if(l)return;let{from:a="click_button",triggerFrom:f}=e||{};if("ai_search"!==f&&"ai_extension"!==f&&"activity"!==f||t===f)i&&o({scroll:"mouse",keyboard:"keyboard",click_button:"next_video_button"}[a]),"auto"===a&&(0,h.Vv)(L.PagingType.auto),r(e=>{let l=!0,t=e;if(e<d.current.length-1)l=!0,t=e+1;else if("aiNote"===f)l=!1,D.F.info("已经是最后一个视频了"),t=e;else{var i,o;l=!1,(null==s?void 0:s.discoverOptimize)?!!document.querySelector("#toastContainer")||null===(i=g.current)||void 0===i||i.call(g):null===(o=g.current)||void 0===o||o.call(g),t=e}return ty.sendLog("modalNextVideoView",(0,n._)({error:l?"":"正在加载下一个视频",index:e+1,success:l},u)),c&&(null==v||v.slideTo(t)),t}),m(!1)},[l,i,v,c]),_=(0,a.useCallback)(e=>{if(l)return;let{from:n="click_button",triggerFrom:a}=e||{};if("ai_search"!==a&&"ai_extension"!==a&&"activity"!==a||t===a)i&&f&&o({scroll:"mouse",keyboard:"keyboard",click_button:"last_video_button"}[n]),r(e=>{var l;if(e>0)return c&&(null==v||v.slideTo(e-1)),e-1;return null===(l=p.current)||void 0===l||l.call(p),c&&(null==v||v.slideTo(e)),e}),m(!1)},[l,i,f,v,c]);return{refPrevVideoCallBack:p,refNextVideoCallBack:g,playNextFunc:y,playPrevFunc:_}};t("897860"),t("110006");let tC="modal-video-0",tx=()=>{let e=parseInt(tC.match(/\d+$/)[0]);e++,tC=tC.replace(/\d+$/,e)},tP=()=>{let e=parseInt(tC.match(/\d+$/)[0]);e--,tC=tC.replace(/\d+$/,e)},tE=()=>({refDepth:(0,a.useRef)(tC)});var tb=t("616520"),tT=t("468145");let tL=e=>{let{abtestData:l,swiper:t,currentNumber:n,awemeInfoList:i}=e,o=(0,a.useMemo)(()=>{if((0,tb.En)()){var e;return null===(e=(0,tT.P)(l))||void 0===e?void 0:e.preloadCount}let t={};return((null==l?void 0:l.preloadCountApplySideServer)==="both"||isInClient()&&(null==l?void 0:l.preloadCountApplySideServer)==="client"||!isInClient()&&(null==l?void 0:l.preloadCountApplySideServer)==="web")&&(t=null==l?void 0:l.preloadCountServer),Object.assign({},null==l?void 0:l.preloadCount,t)},[l,t]);(0,a.useLayoutEffect)(()=>{(()=>{if(null==o?void 0:o.open){let e=(null==o?void 0:o.count)||3,l=i.slice(n+1).filter(e=>(null==e?void 0:e.awemeType)===W.e.Normal&&!(0,lF.Ni)(e)).slice(0,e);h.Le.setConfig(h.gI.PreloadList,l)}else{let e=i.slice(n+1,n+4).filter(e=>!(0,lF.Ni)(e));h.Le.setConfig(h.gI.PreloadList,e)}})()},[l,n,i])};var tk=t("758590"),tA=t("532765");let tM=e=>{let{refPlayer:l,swiper:t,setAwemeInfoList:n,awemeInfoList:i,scrollRef:o,isInnerFeed:r}=e,d=(0,a.useRef)(""),[s,u]=(0,a.useState)(!1);return(0,tk.g)({swiper:t,setAwemeInfoList:n,awemeInfoList:i,refMixPlayer:l,scrollRef:o,isInnerFeed:r}),(0,tA.Z)({refMixPlayer:l,changeMinWinCb:e=>{e&&(d.current=document.body.style.minWidth),document.body.style.minWidth=e?"auto":d.current,document.body.style.overflow=e?"hidden":"",u(e)}}),{isClientMiniWin:s}},tj=e=>{let{swiper:l,modalSlideOptimize:t,currentNumber:n,setCurrentNumber:i}=e;(0,a.useEffect)(()=>{l&&(t||l.slideTo(n))},[l,n,t]),(0,a.useEffect)(()=>{if(l){let e=null==l?void 0:l.activeIndex,t=t=>{i(null==l?void 0:l.activeIndex),(null==t?void 0:t.from)==="drag"&&g.emit((null==l?void 0:l.activeIndex)-e>0?g.EVENT.reportPlayNext:g.EVENT.reportPlayPrev,{clickFrom:"drag"}),e=null==l?void 0:l.activeIndex};return l.on("slideChange",t),()=>{l.off("slideChange",t)}}},[l])};t("954372"),t("882732"),t("544943");var tN=t("561550");let tR=["search_multi_modal","waterFall","hot",/^channel/,/^music/,"favorite_collection","like","post","record","watch_later"],tD=e=>{var l,t,n,i,o,r,a,d,s,u;let{scene:c,awemeInfoList:v,currentNumber:m,originAwemeInfo:f,modalAwemeInfo:p,isSelf:g}=e,y=null!==(l=v[m])&&void 0!==l?l:f,_=null==y?void 0:y.awemeId,w=h.Le.getConfig(h.gI.ModalStartTime)||{};if(w[_]){let e=w[_];return delete w[_],h.Le.setConfig(h.gI.ModalStartTime,w),{time:e,isRevisitStart:!1}}if(!(tR.findIndex(e=>{var l;return e===c||(null==e?void 0:null===(l=e.test)||void 0===l?void 0:l.call(e,c))})>=0))return{time:void 0,isRevisitStart:!1};let I="watch_later"===c,S=h.Le.getConfig(h.gI.PreviewPlayInfoRecord);if((0,tN.sF)()){let e=new URL(location.href).searchParams;e&&e.get("modal_id")&&(S={awemeId:e.get("modal_id"),recordPlayTime:Number(e.get("start_time"))/1e3})}let C=(null==S?void 0:S.awemeId)===(null==y?void 0:y.awemeId)?null==S?void 0:S.recordPlayTime:void 0,x=(null==y?void 0:y.awemeId)===(null==f?void 0:f.awemeId);if(I&&x&&!C){let{store:e}=null!==(r=h.Le.getConfig(h.gI.WatchLater))&&void 0!==r?r:{},l=(null==e?void 0:null===(t=e[null==y?void 0:y.awemeId])||void 0===t?void 0:t.loop)>0||(null==y?void 0:null===(n=y.playProgress)||void 0===n?void 0:n.watch_times)>0,s=null!==(d=null!==(a=null==e?void 0:null===(i=e[null==y?void 0:y.awemeId])||void 0===i?void 0:i.progress)&&void 0!==a?a:null==y?void 0:null===(o=y.playProgress)||void 0===o?void 0:o.play_progress)&&void 0!==d?d:0;return l||!s?{time:0,isRevisitStart:!1}:{time:Math.floor(s/1e3),isRevisitStart:!1}}if(["favorite_collection","like","record"].includes(c)&&x&&g){if((null==p?void 0:null===(s=p.playProgress)||void 0===s?void 0:s.play_progress)<=0)return{time:0,isRevisitStart:!1};let e=Math.max(Math.floor((null==p?void 0:null===(u=p.playProgress)||void 0===u?void 0:u.play_progress)/1e3)-2,1);return{time:C>=e?C:e,isRevisitStart:!0}}return{time:C,isRevisitStart:!1}};var tF=t("149250"),tV=t("555106"),tW=t("823685");let tU=e=>{let{modalEnterFrom:l,abtestData:t}=e,o=l===c.a.WaterFall||l===c.a.ShareModal&&"discover"===(0,ek.yW)(),r=o&&(t.jxAskAiDefaultOpen===tW.JxAskAiDefaultOpen.V1||t.jxAskAiDefaultOpen===tW.JxAskAiDefaultOpen.V2),d=o&&t.jxAskAiDefaultOpen===tW.JxAskAiDefaultOpen.V1,[s,u]=(0,a.useState)(!1),[v,m]=(0,a.useState)(!1),[f,p]=(0,a.useState)(!1),h=(0,a.useRef)(!1),g=(0,a.useCallback)(e=>{h.current=e},[]),y=(0,a.useCallback)(e=>{u(e),(0,tV.qQ)(eu.LocalStorageKeys.AiCardIsPined,e?"1":"0")},[]);return(0,a.useEffect)(()=>{if(r){let e="1"===(0,tV.$o)(eu.LocalStorageKeys.AiCardIsPined);u(e),m(e)}},[r]),(0,a.useEffect)(()=>{d&&(window.innerWidth>=1200&&p(!0),window.addEventListener("resize",()=>{window.innerWidth<1200&&p(!1)}))},[d]),(0,a.useMemo)(()=>(0,i._)((0,n._)({},r?{globalIsShowAiCard:v,setGlobalIsShowAiCard:m,aiCardIsPined:s,togglePinAiCard:y}:{}),{useJxSlideInheritAndPin:r,useJxDefaultOpen:d,aiCardIsDefaultOpen:f,hasDefaultShowAiCardRef:h,setHasDefaultShowAiCard:g}),[v,m,s,y,r,d,f,g])},{useRecommendGuide:tO}=tc.Z,tB=e=>{var l,t,o,d,s,v;let{appendPlayerConfig:m,preloadReady:C,preloadAwemeList:x=[],userContext:P,abtestData:E,close:b,anyHooks:T,moreBoxShowList:L={notInterestingIcon:!0,unfollow:!0,report:!0,shortcutList:!1,dataAnalysis:!1,deleteSelfPost:!1},logParams:j,defaultCommentShow:N=!1,className:W,insertCommentId:U,disableSwitch:O=!1,disableAutoPlay:B=!1,originAwemeInfo:G,modalId:K,uid:z,useOldModal:Z,danmakuInfo:q,defaultShowSideBar:Y,shortCutFilteredList:$,modalEnterFrom:J="",collectFolderId:X,collectionFolderInfo:ee,isDefaultShowRelatedCard:el,modalInnerFeedCard:et,defaultOpenedCardType:en,defaultOpenedCardExtraProps:eo,defaultForceOpenTab:er,activityCardDirectOpen:ea,bingeInfo:ed,container:es,isSelf:eu,scene:ec,notCanMixListen:ev,searchParams:em,mouseScrollContainer:ef,searchFrom:ep,wrapperClassName:eh,reuseConfig:eg,hideModalWhenPip:ey=!1,hideModalByPipInitial:e_=!1,setHideModalByPipInitial:ew,autoOpenPip:eI=!1,scrollRef:eS}=e,{userInfo:eC}=P,{refDepth:ex}=tE(),eP=(0,a.useRef)(null),eE=(0,a.useRef)(null),eb=(0,a.useRef)(),[eT,eL]=(0,a.useState)(-1),[ek,eA]=(0,a.useState)(!0),[eM,ej]=(0,a.useState)([]),[eN,eR]=(0,a.useState)(null),eD=(0,a.useRef)([]);eD.current=eM;let{awemeFeed:eF}=(0,Q.j)(),eV=eF.useValue("modalAwemeInfo",Boolean),eW=eF.useValue("innerFeedAwemeInfo"),eU=J.includes("search"),{isWebMiniWin:eO,isListenVideoMiniWin:eB}=(0,k.Iq)(e=>{let{isWebMiniWin:l,isListenVideoMiniWin:t}=e;return{isWebMiniWin:l,isListenVideoMiniWin:t}}),[eG,eK]=(0,a.useState)(),[ez,eZ]=(0,a.useState)(!1),eq=(0,p.x)(),[eY,e$]=(0,a.useState)(G),eJ=(null==E?void 0:E.discoverSlideOptimize)&&(null==j?void 0:j.enter_from)==="discover"||(null==E?void 0:E.searchSlideOptimize)&&eU,eQ=tU({modalEnterFrom:J,abtestData:E});(0,a.useEffect)(()=>(h.Le.setConfig(h.gI.IsInModalVideo,{isInModal:!0,modalEnterFrom:J}),h.Le.setConfig(h.gI.VideoPlayMethod,"auto"),g.emit(g.EVENT.videoPause,"ModalVideoContent_enter"),g.emit(g.EVENT.musicPause),g.emit(g.EVENT.searchMusicPause),g.emit(g.EVENT.livePause),h.Le.setConfig(h.gI.isVideoPlayed,null),g.emit(g.EVENT.enterModalVideo,ex.current),tx(),()=>{var e;((null===(e=h.Le.getConfig(h.gI.IsInModalVideo))||void 0===e?void 0:e.modalEnterFrom)||"")===J&&h.Le.setConfig(h.gI.IsInModalVideo,{isInModal:!1}),g.emit(g.EVENT.exitModalVideo,ex.current),tP()}),[]),(0,a.useEffect)(()=>{(0,h.Vv)(void 0)},[K]);let eX="general_search"===J,{recommendGuideChild:e0,useNewUserSoundGuide:e1,recommendGuideVisible:e3,handleCloseGuide:e8}=tO({isCanShow:J!==c.a.Im,enterFrom:"modal_video",modalEnterFrom:J,awemeInfoList:eM,className:I.default.guideCard,disableLottie:(0,y.b_)()||(0,y.Sb)(),isFullscreen:!0,closeWhenUp:eX,isCloseInGuide:!0,swiper:eN}),{playNextFunc:e2,playPrevFunc:e4,refNextVideoCallBack:e7,refPrevVideoCallBack:e6}=tS({disableSwitch:O,modalEnterFrom:J,recommendGuideVisible:e3,handleCloseGuide:e8,setCurrentNumber:eL,awemeInfoListRef:eD,abtestData:E,logParams:j,modalSlideOptimize:eJ,swiper:eN,setIsFirstEnterVideo:eA,closeWhenUp:eX}),e5=(0,a.useCallback)(()=>{var e,l,t,n;eM.length-1===eT&&(eL(eT-1),eJ&&(null==eN||eN.slideTo(eT-1))),ej(e=>{var l;let t=[...e];return t.splice(eT,1),null===(l=eb.current)||void 0===l||l.call(eb,{currentNumber:eT,awemeList:t}),t}),null===(l=eP.current)||void 0===l||null===(e=l.setIsAuthorCardShow)||void 0===e||e.call(l,!1),null===(n=eP.current)||void 0===n||null===(t=n.setIsShowRelatedCard)||void 0===t||t.call(n,!1)},[eT,eM,eN,eJ]);tL({abtestData:E,swiper:eN,currentNumber:eT,awemeInfoList:eM});let{slideVideoTab:e9,setSlideVideoTab:le,modalAwemeInfo:ll,setModalAwemeInfo:lt,globalIsSideBarShow:ln,setIsSideBarShowFunc:li}=S({originAwemeInfo:null!=G?G:eM[0]}),{defaultTab:lo="",isTabFeed:lr,onLivePause:la=()=>null,onLivePlay:ld=()=>null}=(null==T?void 0:T((0,i._)((0,n._)({},e),{delVideoCallBackRef:eb,currentNumber:eT,awemeInfoList:eM,refPrevVideoCallBack:e6,refNextVideoCallBack:e7,curTab:e9,awemeInfo:ll,setCurrentNumber:eL,setAwemeInfoList:ej,setModalAwemeInfo:lt,swiper:eN,preloadReady:C,preloadAwemeList:x,currentAwemeInfo:eY})))||{},{hideModalByPip:ls,setHideModalByPip:lu}=t_({awemeInfo:ll,refPlayer:eP,hideModalByPipInitial:e_,setHideModalByPipInitial:ew,modalEnterFrom:J,logParams:j}),{isClientMiniWin:lc}=tM({swiper:eN,setAwemeInfoList:ej,awemeInfoList:eM,refPlayer:eP,scrollRef:eS,isInnerFeed:eV}),{closeModal:lv,onBack:lm,onBackWithInnerMode:lf}=tI({logParams:j,awemeInfoList:eM,currentNumber:eT,modalInnerFeedCard:et,awemeInfoListRef:eD,onLivePause:la,modalEnterFrom:J,close:b,isInnerFeed:eV});A({abtestData:E,container:ef||es,closeModal:lv,isClientMiniWin:lc,modalEnterFrom:J}),(0,a.useEffect)(()=>{let e=location.pathname,l=(0,eH.OB)();return l&&(0,eH.wS)(l,!1),()=>{l&&e===location.pathname&&(0,eH.wS)(l,!0),_.p.postTask({priority:"background",task:()=>g.emit(g.EVENT.syncInteraction)})}},[]);let{asrState:lp}=R({awemeInfoListRef:eD,userInfo:eC,currentNumber:eT});tj({swiper:eN,modalSlideOptimize:eJ,currentNumber:eT,setCurrentNumber:eL});let lh=M({currentNumber:eT}),{recordLatestAwemeId:lg}=tv(),{isRevisitStart:ly,time:l_}=(0,a.useMemo)(()=>tD({scene:ec,awemeInfoList:eM,currentNumber:eT,originAwemeInfo:G,modalAwemeInfo:ll,isSelf:eu}),[ec,eM,eT,G,ll,eu]),lw=(0,a.useMemo)(()=>{var e,l,t,o,r;return{insertCommentId:ek?U:void 0,userContext:P,abtestData:E,logParams:(0,i._)((0,n._)({},j),{is_modal_first_enter:lh?"1":"0",is_auto_show_ask_ai:(null==eQ?void 0:eQ.aiCardIsPined)||(null==eQ?void 0:eQ.aiCardIsDefaultOpen)?"1":"0"}),showTopicAndMusicCard:!1,showMixCard:!1,showMixCardEntry:!1,showHotCard:!!((null===(e=eM[eT])||void 0===e?void 0:e.hotList)&&(null===(t=eM[eT])||void 0===t?void 0:null===(l=t.hotList)||void 0===l?void 0:l.rank)!==51&&(null===(r=eM[eT])||void 0===r?void 0:null===(o=r.hotList)||void 0===o?void 0:o.type)!==2),tab:"modal",useOldModal:Z,danmakuInfo:q}},[ek,U,P,E,j,eT,Z,q,eQ,lh]),lI=(0,a.useMemo)(()=>{var e;return(0,i._)((0,n._)({},L),{shortcutList:!0,notInterestingIcon:!!lr||L.notInterestingIcon,dataAnalysis:(null==L?void 0:L.dataAnalysis)&&(null==G?void 0:G.authorUserId)===(null===(e=eM[eT])||void 0===e?void 0:e.authorUserId),deleteSelfPost:null==L?void 0:L.deleteSelfPost,asrState:lp})},[L,lr,G,eM,eT,lp]),lS=(0,a.useMemo)(()=>e=>D.F.info(e,void 0,1e3),[]),lC=(0,r.jsx)(H,{appendPlayerConfig:m,activityCardDirectOpen:ea,close:lm,className:"isDark isDeepDark",fullScreenTarget:es,deleteCurrentSwiper:e5,moreBoxShowList:(null==E?void 0:E.innerSlideSmooth)?lI:(0,i._)((0,n._)({},L),{shortcutList:!0,notInterestingIcon:!!lr||L.notInterestingIcon,dataAnalysis:(null==L?void 0:L.dataAnalysis)&&(null==G?void 0:G.authorUserId)===(null===(l=eM[eT])||void 0===l?void 0:l.authorUserId),deleteSelfPost:null==L?void 0:L.deleteSelfPost,asrState:lp}),modalEnterFrom:J,modalInnerFeedCard:et,defaultOpenedCardType:en,defaultOpenedCardExtraProps:eo,swiper:g.commonEvent,videoToast:(null==E?void 0:E.innerSlideSmooth)?lS:e=>D.F.info(e,void 0,1e3),item:eM[eT],playNextFunc:e2,playPrevFunc:e4,defaultCommentShow:N,InnerPlayer:tu,disableAutoPlay:B,relatedDefaultTab:lo,originAwemeInfo:null!=G?G:eM[0],modalId:K,defaultShowSideBar:Y,setModalAwemeInfo:lt,customProps:(null==E?void 0:E.innerSlideSmooth)?lw:{insertCommentId:ek?U:void 0,userContext:P,abtestData:E,logParams:(0,i._)((0,n._)({},j),{is_modal_first_enter:lh?"1":"0",is_auto_show_ask_ai:(null==eQ?void 0:eQ.aiCardIsPined)||(null==eQ?void 0:eQ.aiCardIsDefaultOpen)?"1":"0"}),showTopicAndMusicCard:!1,showMixCard:!1,showMixCardEntry:!1,showHotCard:!!((null===(t=eM[eT])||void 0===t?void 0:t.hotList)&&(null===(d=eM[eT])||void 0===d?void 0:null===(o=d.hotList)||void 0===o?void 0:o.rank)!==51&&(null===(v=eM[eT])||void 0===v?void 0:null===(s=v.hotList)||void 0===s?void 0:s.type)!==2),tab:"modal",useOldModal:Z,danmakuInfo:q},ref:eP,shortCutFilteredList:$,collectFolderId:X,collectionFolderInfo:ee,isDefaultShowRelatedCard:el,defaultForceOpenTab:er,bingeInfo:ed,isClientMiniWin:lc,notCanMixListen:ev,startTime:l_,onLivePause:la,onLivePlay:ld,searchFrom:ep,isShowGuide:e3,useNewUserSoundGuide:e1,isRevisitStart:ly,onAwemeInfoChange:eJ?null:e$,reuseConfig:eg,scrollRef:eS,hideModalWhenPip:ey,setHideModalByPip:lu,modalClose:b}),lx=ec?`dy-modal-video-container-${ec}`:void 0;return(0,r.jsxs)(f.C.Provider,{value:(0,n._)({userId:z,slideVideoTab:e9,setSlideVideoTab:le,setModalAwemeInfo:lt,awemeInfoList:eM,globalIsSideBarShow:ln,setIsSideBarShowFunc:li,isCssFullScreen:!0,isSelf:eu,collectionFolderInfo:ee,isClientMiniWin:lc,globalIsCommentTrayPushGuideShow:eG,setIsCommentTrayPushGuideShowFunc:eK,globalCommentTrayPushGuideType:ez,setCommentTrayPushGuideTypeFunc:eZ},eQ),children:[(0,r.jsxs)("div",{className:u()(eh,{[I.default.pipHide]:ls}),children:[(0,r.jsx)(ei,{containerId:lx,close:b,autoOpenPip:eI,isInnerFeed:eV,modalInnerFeedCard:et,isClientMiniWin:lc,refPlayer:eP,onBack:lm,onBackWithInnerMode:lf,abtestData:E,awemeInfoList:eM,currentNumber:eT,modalEnterFrom:J,isSelf:eu,userInfo:eC,logParams:j,searchParams:em,slideVideoTab:e9,currentAwemeInfo:eV?eW:null==eM?void 0:eM[eT],fullScreenTarget:es}),!lc&&e0,(0,r.jsx)("div",{id:"upperFeedContainer",className:u()(I.default.moreIndex,{[I.default.isClientMiniWin]:lc,searchUpperFeedContainer:eU})}),(0,r.jsx)(F.k,{componentName:"ModalVideoContent",children:(0,r.jsxs)("div",{id:lx,className:u()(I.default.modalVideo,W,"modal-video-container",{[I.default.isLoading]:!eM[eT],[I.default.modalSlider]:"search"===J,[I.default.isWebMiniWin]:eO||eB,isMiniWindow:lc,isMiniWindowOptimize:lc&&eq}),"data-e2e":"modal-video-container",children:[eM[eT]?(0,r.jsx)(tf.ZP,{onSwiper:eR,abTestData:E,cardBetween:0,nextSwiperHeaderHeight:0,upperSpace:0,data:eM,scene:tp.R5.Modal,defaultCssFullScreen:!0,initIndex:eT,useWheelListener:!1,collectionFolderInfo:ee,globalAiCardValue:eQ,children:(0,r.jsx)(tm.o,{"data-e2e":"feed-item",className:u()(I.default.swiperItem),slot:tp.t6.INSIDE,children:e=>{let{slideData:l,activeIndex:t,currentIndex:n}=e;if(!(1>=Math.abs(t-n)))return null;{let e=t===n;return lg(e,null==l?void 0:l.awemeId),(0,a.cloneElement)(lC,{isActive:e,isFirst:0===n,isNext:t+1===n,isPrev:t-1===n,isLast:n===eM.length-1,index:n,isClientMiniWin:lc,item:l,videoRef:e?eP:eE})}}})}):(0,r.jsx)(V.gb,{}),(0,r.jsx)("div",{id:"modal_fullscreen_capture_feedback",children:(0,r.jsx)("div",{id:"modal_fullscreen_capture"})})]})})]}),(0,r.jsx)(w.IsLivingPlugin,{activeIndex:eT,dataList:eM,setDataList:ej,scene:"jingxuan_feed"})]})};var tH=(0,a.memo)(e=>{var l;let{root:t,onSetAttribute:s,metaCtxId:u,isSelfMetaProvider:c=!1,modalEnterFrom:f}=e,{pipWindow:p,isListenVideoMiniWin:h,changeIsListenVideoMiniWin:g}=(0,k.Iq)(e=>{let{pipWindow:l,isListenVideoMiniWin:t,changeIsListenVideoMiniWin:n}=e;return{pipWindow:l,isListenVideoMiniWin:t,changeIsListenVideoMiniWin:n}}),y=(0,a.useRef)(document.createElement("div"));(0,a.useEffect)(()=>{let e=t||document.getElementById("douyin-right-container")||document.body;return null==s||s(y),e.appendChild(y.current),()=>{var e,l;(null===(e=y.current)||void 0===e?void 0:e.parentNode)&&(null===(l=y.current)||void 0===l||l.remove()),y.current=null}},[]),(0,a.useEffect)(()=>{if(h){g(!1);let e=tr.e.getPipWindow({scene:v.d.ListenVideo});e?e.close():tF.T.exit()}},[]),(0,m.w)(()=>{let e=y.current;if(e)return e.classList.add(I.default.routeHide),()=>{e.classList.remove(I.default.routeHide)}},[]);let _=(0,Q.j)(),{awemeFeed:w}=_,S=(0,o._)(_,["awemeFeed"]);return c?d.createPortal((0,r.jsx)(tB,(0,i._)((0,n._)({},e),{close:l=>{var t,n,i;let o=tr.e.getPipWindow({scene:v.d.ListenVideo});o&&o.close(),null==p||null===(t=p.close)||void 0===t||t.call(p),y.current.parentNode&&(null===(i=y.current)||void 0===i||i.remove()),null==e||null===(n=e.close)||void 0===n||n.call(e,l)},container:t||y.current,mouseScrollContainer:y.current})),y.current):d.createPortal((0,r.jsx)(Q.b,{context:(0,i._)((0,n._)({},S),{metaCtxId:null!==(l=null!=u?u:f)&&void 0!==l?l:"modal"}),children:(0,r.jsx)(tB,(0,i._)((0,n._)({},e),{close:l=>{var t,n,i;null==p||null===(t=p.close)||void 0===t||t.call(p),y.current.parentNode&&(null===(i=y.current)||void 0===i||i.remove()),null==e||null===(n=e.close)||void 0===n||n.call(e,l)},container:t||y.current,mouseScrollContainer:y.current}))}),y.current)})},902496:function(e,l,t){t.d(l,{w:function(){return c}});var n=t(563097),i=t(88648),o=t(909543),r=t(870105),a=t(936640),d=t(244885),s=t(30321);let u=()=>{let e=(0,i.useRef)({isRecoveryFromChild:!1}),{pathname:l}=(0,o.a)(),t=(0,i.useRef)(l),n=(0,i.useRef)(!1);return(0,s.Nr)(l)?n.current=!0:(n.current?(n.current=!1,e.current.isRecoveryFromChild=t.current==t.current):e.current.isRecoveryFromChild=!1,t.current=l),e},c=e=>{let{isActive:l,children:t,inherit:o=!0}=e,s=(0,i.useRef)();(0,r.U)();let c=u();!s.current&&(s.current=new a.T(l));let v=(0,i.useMemo)(()=>({isActive:l,routeModel:s.current,ref:c}),[l]);return(0,i.useEffect)(()=>{s.current&&s.current.setActive(l)},[l]),(0,n.jsx)(d.I.Provider,{value:v,children:t})}},424944:function(e,l,t){t.d(l,{O:function(){return r}});var n=t(563097),i=t(88648),o=t(902496);let r=i.forwardRef((e,l)=>{let{active:t,children:r,className:a}=e,d=(0,i.useMemo)(()=>t?{}:{display:"none"},[t]);return(0,n.jsx)(o.w,{isActive:t,children:(0,n.jsx)("div",{className:a,ref:l,style:d,children:r})})})},794436:function(e,l,t){t.d(l,{I:function(){return s}});var n=t(88648),i=t(412679),o=t(746864),r=t(782442),a=t(637005),d=t(860684);let s=e=>{let{awemeInfo:l,from:t,isActive:s,hackFullScreenDom:u=!1,videoAreaClickActive:c=!1,logParams:v,enableInteractionPlugin:m=!0,searchListType:f,isUpperFeed:p=!1,syncInMulti:h=!1}=e,g=(0,d.n)(),y=r.Le.getConfig(r.gI.ActivityModalCurrentActiveProgress);return(0,n.useEffect)(()=>{if(g&&s&&l){r.Le.getConfig(r.gI.ActivityModalEnterFullScreenAfterCreate)&&"modal_player"===t&&(r.Le.setConfig(r.gI.ActivityModalEnterFullScreenAfterCreate,!1),g.getFullscreen());let{awemeId:e}=l,n=()=>{y[0]=e,y[1]=g.currentTime};return g.on("timeupdate",n),()=>{g.off("timeupdate",n),"activity_player"===t&&y[0]===(null==l?void 0:l.awemeId)&&(y[0]="",y[1]=0)}}},[g,l,s]),(0,n.useEffect)(()=>{if(g&&l&&(null==l?void 0:l.awemeType)!==o.e.Note&&(null==l?void 0:l.awemeId)===y[0]){let e=y[1];g.once(i.FP.CANPLAY,()=>{g.seek(e)})}},[g]),(0,n.useEffect)(()=>{if(g&&"activity_player"===t&&s)return a.listen(a.EVENT.activitySyncVideoPlay,()=>{(null==l?void 0:l.awemeType)!==o.e.Note&&((null==l?void 0:l.awemeId)===y[0]&&g.seek(y[1]),r.Le.setConfig(r.gI.IsSearchOuterAsync,!0)),g.play()})},[g,s,l]),null}},794117:function(e,l,t){t.d(l,{r:function(){return o}});var n=t(88648),i=t(860684);let o=e=>{let l=(0,i.n)();return(0,n.useEffect)(()=>{if(l){let e=()=>{l.replay(),l.replayed=!0};return l.on("ended",e),()=>{l.off("ended",e)}}},[l]),null}},99840:function(e,l,t){t.d(l,{l:function(){return g}});var n=t(88648),i=t(412679),o=t(645260),r=t.n(o),a=t(613063),d=t.n(a),s=t(746864),u=t(897880),c=t(993798),v=t(782442),m=t(637005),f=t(33323),p=t(208987),h=t(860684);let g=e=>{let{awemeInfo:l,from:t,isActive:o,hackFullScreenDom:a=!1,videoAreaClickActive:g=!1,logParams:y,enableInteractionPlugin:_=!0,searchListType:w,isUpperFeed:I=!1,syncInMulti:S=!1,livePlayer:C,liveDocId:x}=e,P=(0,h.n)(),E=C||P,{openGeneralSearchModalSlide:b}=(0,n.useContext)(f.j)||{},{docId:T}=(0,n.useContext)(p.C)||{},L=C&&x?x:T,k=v.Le.getConfig(v.gI.SearchModalCurrentActiveProgress);return(0,n.useEffect)(()=>{if(E&&o&&l){v.Le.getConfig(v.gI.SearchModalEnterFullScreenAfterCreate)&&"modal_player"===t&&(v.Le.setConfig(v.gI.SearchModalEnterFullScreenAfterCreate,!1),E.getFullscreen());let{awemeId:e}=l,n=()=>{k[0]=e,k[1]=E.currentTime};return E.on("timeupdate",n),()=>{E.off("timeupdate",n),"search_player"===t&&k[0]===(null==l?void 0:l.awemeId)&&(k[0]="",k[1]=0)}}},[E,l,o]),(0,n.useEffect)(()=>{if(E&&l&&(null==l?void 0:l.awemeType)!==s.e.Note&&(null==l?void 0:l.awemeId)===k[0]){let e=k[1];E.once(i.FP.CANPLAY,()=>{E.seek(e)})}},[E]),(0,n.useEffect)(()=>{if(E&&"search_player"===t&&o)return m.listen(m.EVENT.generalSearchVideoPlay,()=>{(null==l?void 0:l.awemeType)!==s.e.Note&&((null==l?void 0:l.awemeId)===k[0]&&E.seek(k[1]),v.Le.setConfig(v.gI.IsSearchOuterAsync,!0)),E.play()})},[E,o,l]),(0,n.useEffect)(()=>{let e=r()(E,"plugins.fullscreen.root"),l=()=>{var e;null==E||null===(e=E.openGeneralSearchModalSlide)||void 0===e||e.call(E,{from:"fullscreen"})};return E&&o&&"search_player"===t&&a&&(S||w!==u.qs)&&!I&&(d()(E,"plugins.fullscreen.config.disable",!0),null==e||e.addEventListener("click",l)),()=>{d()(E,"plugins.fullscreen.config.disable",!1),null==e||e.removeEventListener("click",l)}},[E,o,a,w,l,I,S]),(0,n.useEffect)(()=>{if(E&&o&&"search_player"===t&&!_&&g){let e=e=>{if(e.target===E.root||e.target===E.video||e.target===E.innerContainer||e.target===E.video.__canvas){var l;null==E||null===(l=E.openGeneralSearchModalSlide)||void 0===l||l.call(E,{from:"pause"}),E.emit(i.FP.USER_ACTION,{action:"click_video_area"});return}};E.config.closeVideoClick=!0;let l=E.root;return l.addEventListener("click",e,!1),()=>{l.removeEventListener("click",e,!1),d()(E,"config.closeVideoClick",!1)}}},[E,o,a,g]),(0,n.useEffect)(()=>{if(E&&"search_player"===t&&o&&!I)return E.openGeneralSearchModalSlide=e=>{let{from:t}=e||{};if("fullscreen"===t&&v.Le.setConfig(v.gI.SearchModalEnterFullScreenAfterCreate,!0),"pause"===t&&!g)return!1;let n=b({docId:L,awemeId:null==l?void 0:l.awemeId,from:t});return n&&(0,c.h)("feed_enter",y),n},()=>{E.openGeneralSearchModalSlide=()=>!1}},[E,l,o,L,b,g,C,I]),(0,n.useEffect)(()=>{if(E&&"search_player"===t){let e=!1,l=m.listen(m.EVENT.pageFullScreen,l=>{let{fullScreen:t}=l;e=t});return()=>{l(),e&&m.emit(m.EVENT.pageFullScreen,{fullScreen:!1,playerId:null==E?void 0:E.playerId,clickMethod:"player_destroy"})}}},[E]),null}},33323:function(e,l,t){t.d(l,{j:function(){return n}});let n=(0,t(88648).createContext)({openGeneralSearchModalSlide:()=>void 0,updateInnerScrollRef:()=>void 0})}}]);