(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["16708"],{597965:function(__unused_webpack_module,exports,__webpack_require__){__webpack_require__(70372),__webpack_require__(429532),__webpack_require__(675373),__webpack_require__(602157),__webpack_require__(874386),__webpack_require__(209955),__webpack_require__(268917),__webpack_require__(882732),__webpack_require__(544943),__webpack_require__(927234),__webpack_require__(179133),__webpack_require__(826893),__webpack_require__(954372),__webpack_require__(284961),__webpack_require__(413806),__webpack_require__(338172),__webpack_require__(315997),__webpack_require__(250440),__webpack_require__(897860),__webpack_require__(110006),__webpack_require__(214478),__webpack_require__(807192),__webpack_require__(99891),__webpack_require__(779788),__webpack_require__(455663),__webpack_require__(242079),__webpack_require__(851912),__webpack_require__(527785),__webpack_require__(950331),!function(t,e){e(exports)}(0,function(exports){"use strict";var _a,__assign=function(){return(__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function __rest$1(t,e){var i={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&0>e.indexOf(o)&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(t);n<o.length;n++)0>e.indexOf(o[n])&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]]);return i}function __awaiter(t,e,i,n){return new(i=i||Promise)(function(o,r){function s(t){try{c(n.next(t))}catch(t){r(t)}}function a(t){try{c(n.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?o(t.value):((e=t.value)instanceof i?e:new i(function(t){t(e)})).then(s,a)}c((n=n.apply(t,e||[])).next())})}function __generator(t,e){var i,n,o,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},s={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){var l=[a,c];if(i)throw TypeError("Generator is already executing.");for(;r=s&&l[s=0]?0:r;)try{if(i=1,n&&(o=2&l[0]?n.return:l[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,l[1])).done)return o;switch(n=0,(l=o?[2&l[0],o.value]:l)[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(o=0<(o=r.trys).length&&o[o.length-1])&&(6===l[0]||2===l[0])){r=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3]))r.label=l[1];else if(6===l[0]&&r.label<o[1])r.label=o[1],o=l;else{if(!(o&&r.label<o[2])){o[2]&&r.ops.pop(),r.trys.pop();continue}r.label=o[2],r.ops.push(l)}}l=e.call(t,r)}catch(t){l=[6,t],n=0}finally{i=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}}function __read$1(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=r.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s}function __spreadArray(t,e,i){if(i||2==arguments.length)for(var n,o=0,r=e.length;o<r;o++)!n&&o in e||((n=n||Array.prototype.slice.call(e,0,o))[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))}var CLOUD_CONFIG_URL={cn:"//imagex-web-settings.volcimagex.net/app/monitor/settings",va:"//imagex-web-settings-va.volcimagex.net/app/monitor/settings",sg:"//imagex-web-settings-sg.volcimagex.net/app/monitor/settings",default:"//imagex-web-settings.volcimagex.net/app/monitor/settings"},DEFAULT_CONFIG$1={reportRateConfig:{reportRate:1,reportRateError:1}},ERROR_MSG={NETWORK_ERR:"NETWORK_ERR",SOURCE_NOT_FOUND:"SOURCE_NOT_FOUND",NETWORK_TIMEOUT:"NETWORK_TIMEOUT",TYPE_ERR_NOT_IMG:"TYPE_ERR_NOT_IMG",MISSING_DECODER:"MISSING_DECODER",ERROR_DECODER:"ERROR_DECODER",ERROR_SYSTEM_INIT:"ERROR_SYSTEM_INIT",ERROR_SYSTEM_OBS:"ERROR_SYSTEM_OBS",ERROR_SYSTEM_SECTION:"ERROR_SYSTEM_SECTION",UNKNOWN:"UNKNOWN"},ERROR_CODE=(_a={},_a[ERROR_MSG.NETWORK_ERR]=1001,_a[ERROR_MSG.SOURCE_NOT_FOUND]=1002,_a[ERROR_MSG.NETWORK_TIMEOUT]=1003,_a[ERROR_MSG.TYPE_ERR_NOT_IMG]=2001,_a[ERROR_MSG.MISSING_DECODER]=3001,_a[ERROR_MSG.ERROR_DECODER]=3002,_a[ERROR_MSG.ERROR_SYSTEM_INIT]=5001,_a[ERROR_MSG.ERROR_SYSTEM_OBS]=5002,_a[ERROR_MSG.ERROR_SYSTEM_SECTION]=5003,_a[ERROR_MSG.UNKNOWN]=6001,_a),LOAD_STATUS={SUCCESS:"success",FAIL:"fail"},IMAGEX_MONITOR_DEBUG_SIGNAL="IMAGEX_MONITOR_DEBUG_SIGNAL",HTTP_STATUS_MAP={504:"Gateway Timeout",503:"Service Unavailable",502:"Bad Gateway",500:"Internal Server Error",451:"Unavailable For Legal Reasons",429:"Too Many Requests",424:"Failed Dependency",412:"Precondition Failed",408:"Request Timeout",406:"Not Acceptable",404:"Not Found",403:"Forbidden",401:"Unauthorized",400:"Bad Request"};function fromEntries(t){for(var e={},i=0;i<t.length;i++)e[t[i][0]]=t[i][1];return e}function entries(t){for(var e=Object.keys(t),i=[],n=0;n<e.length;n++)i.push([e[n],t[e[n]]]);return i}var formatInt=function(t){return t<1?1:Math.round(t)},getReciprocal=function(t){return t?1/t:0};function isObject$1(t){return t&&"object"==typeof t&&!Array.isArray(t)}function mergeConfig(t){for(var e,i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];if(!i.length)return t;var o=i.shift();if(isObject$1(t)&&isObject$1(o))for(var r in o)isObject$1(o[r])?(t[r]||Object.assign(t,((e={})[r]={},e)),mergeConfig(t[r],o[r])):Object.assign(t,((e={})[r]=o[r],e));return mergeConfig.apply(void 0,__spreadArray([t],__read$1(i),!1))}function removeEmptyValFromObj(t){return"object"!=typeof t?t:fromEntries(entries(t).filter(function(t){return(t=__read$1(t,2))[0],null!=(t=t[1])}))}function createLogger(t){try{return localStorage.getItem(IMAGEX_MONITOR_DEBUG_SIGNAL)?function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}:function(){}}catch(t){return function(){}}}function isImgElement(t){return"img"===t.nodeName.toLocaleLowerCase()}function isCanvasElement(t){return"canvas"===t.nodeName.toLocaleLowerCase()}var ReportType,getDataFromEvent=function(t,e){var i,n=t.target||t.srcElement;if(n&&(isImgElement(n)||isCanvasElement(n))&&n.matches(e)){if(isImgElement(n)){if(i=n.currentSrc)return{url:i,el:n}}else if(isCanvasElement(n)&&(i=t.detail.currentSrc))return __assign(__assign({},t.detail),{url:i,el:n})}},mapHttpError=function(t){return{code:t,desc:null!=(t=HTTP_STATUS_MAP[t])?t:"unknown"}},ConfigProvider=function(){function t(t){this.configMap={},this.options=t,this.configMap=mergeConfig({},DEFAULT_CONFIG$1,t.defaultConfig),this.initCloudConfigSchedule()}return t.prototype.initCloudConfigSchedule=function(){var t,e,i=this;null!=(t=this.options.cloudConfig)&&t.channel&&null!=(t=this.options.cloudConfig)&&t.app_id&&(this.url=new URL("".concat(location.protocol).concat(CLOUD_CONFIG_URL[this.options.cloudConfig.channel]||CLOUD_CONFIG_URL.default)),Object.keys(e={aid:this.options.cloudConfig.app_id,os:"web"}).forEach(function(t){return i.url.searchParams.append(t,e[t])}),this.startUpdateSchedule())},t.prototype.startUpdateSchedule=function(){var t;return __awaiter(this,void 0,void 0,function(){var e,i,n=this;return __generator(this,function(o){switch(o.label){case 0:return[4,this.getCloudConfig()];case 1:return(e=o.sent())&&(this.updateConfig("reportRateConfig",e.reportRateConfig),this.updateConfig("fetchInterval",e.fetchInterval),null!=(i=null==(t=this.options.cloudConfig)?void 0:t.callback))&&i(e),setTimeout(function(){return n.startUpdateSchedule()},1e3*e.fetchInterval),[2]}})})},t.prototype.getCloudConfig=function(){var t;return __awaiter(this,void 0,void 0,function(){var e,i,n;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,fetch(this.url.toString())];case 1:return[4,o.sent().json()];case 2:return(n=(n=o.sent()).data)?(e=null==(i=null==(t=n.custom_settings)?void 0:t.allow_log_type)?void 0:i.imagex_load_monitor,i=null==i?void 0:i.imagex_load_monitor_error,n=(null==(t=null==n?void 0:n.general_settings)?void 0:t.fetch_settings_interval)||3600,[2,{reportRateConfig:{reportRate:e,reportRateError:i},fetchInterval:n}]):[2];case 3:return o.sent(),[2];case 4:return[2]}})})},t.initConfigProvider=function(e){return this.instance||(this.instance=new t(e)),this.instance},t.getConfigProvider=function(){if(this.instance)return this.instance;throw Error("[ConfigProvider]: init config provider first")},t.prototype.updateConfig=function(t,e){return this.configMap[t]=e,this.configMap[t]},t.prototype.getConfig=function(t){return this.configMap[t]},t}(),logger=createLogger("MetricFormatter"),MetricFormatter=function(){function t(){}return t.getImageXParam=function(t){try{var e=new URLSearchParams(t.search),i={from:e.get("from"),imagex_flight_id:e.get("imagex_flight_id"),imagex_vid:e.get("imagex_vid"),biz_tag:e.get("biz_tag")};return Object.keys(i).forEach(function(t){return!i[t]&&delete i[t]}),i}catch(t){throw Error("[MetricFormatter]: getImageXParam error")}},t.getProtocol=function(t){var t=String(t),e=location.protocol,i="http",n=/https/.test(t),t=/http/.test(t);return n&&(i="https"),i=!1===n&&!1===t?e.replace(":",""):i},t.formatPerformanceTiming=function(t){try{var e={};return e.timing_time_start=formatInt(t.startTime),e.timing_redirect_start=formatInt(t.redirectStart),e.timing_redirect_end=formatInt(t.redirectEnd),e.timing_fetch_start=formatInt(t.fetchStart),e.timing_dns_start=formatInt(t.domainLookupStart),e.timing_dns_end=formatInt(t.domainLookupEnd),e.timing_connect_start=formatInt(t.connectStart),e.timing_connect_end=formatInt(t.connectEnd),e.timing_secure_connection_start=formatInt(t.secureConnectionStart),e.timing_request_start=formatInt(t.requestStart),e.timing_request_end=formatInt(t.responseStart),e.timing_response_start=formatInt(t.responseStart),e.timing_response_end=formatInt(t.responseEnd),e.timing_network_duration=formatInt(t.duration),e.file_size=formatInt(t.encodedBodySize),e.timing_connect=e.timing_connect_end-e.timing_connect_start,e.timing_dns=e.timing_dns_end-e.timing_dns_start,e.timing_ssl=e.timing_secure_connection_start?e.timing_request_start-e.timing_secure_connection_start:0,e.timing_send=e.timing_request_end-e.timing_request_start,e.timing_wait=e.timing_response_start?e.timing_response_end-e.timing_response_start:e.timing_network_duration,e.timing_receive=0,e.timing_total=e.timing_network_duration,e.timing_isSocketReused=!e.timing_connect,e.data_protocol=this.getProtocol(t.name),e.cache_seek_duration=e.timing_redirect_end-e.timing_redirect_start,e.server_ip="",e.duration=t.duration,logger("performance timing map => ",e),e}catch(t){throw Error("[MetricFormatter]: formatPerformanceTiming error")}},t.formatHeaders=function(t){try{var e=null==t?void 0:t.headers,i=null==t?void 0:t.status,n=(null==e?void 0:e.get("x-response-sinfo"))||"",o=(null==e?void 0:e.get("x-response-cinfo"))||"",r=(null==e?void 0:e.get("x-response-cache"))||"",s=(null==e?void 0:e.get("content-type"))||"",a=Number(null==e?void 0:e.get("content-length"))||0,c="unknown",l=!1,h=s.split(";")[0];return!i||400<=i?c="unknown":h.startsWith("image/")?(c=h.substring(6),l=!0):c=h,{is_img:l,http_status:i,image_type:c,response_sinfo:n,response_cache:r,response_cinfo:o,file_size:a}}catch(t){throw Error("[MetricFormatter]: formatHeaders error")}},t.formatReportRateConfig=function(){try{var t=ConfigProvider.getConfigProvider().getConfig("reportRateConfig");return{report_rate:t.reportRate,report_rate_error:t.reportRateError,report_level:getReciprocal(t.reportRate),report_level_error:getReciprocal(t.reportRateError)}}catch(t){throw Error("[MetricFormatter]: formatReportRateConfig error")}},t.format=function(t){var e=[],i=t.basicInfo,n=t.resourceTiming,o=t.headers,r=n.name,s=new URL(r),a={};try{a=this.getImageXParam(s)}catch(t){e.push(t)}var c={};try{c=this.formatPerformanceTiming(n)}catch(t){e.push(t)}n={};try{n=this.formatHeaders(o)}catch(t){e.push(t)}o={};try{o=this.formatReportRateConfig()}catch(t){e.push(t)}return logger("before process",a,i,c,n,o),(a=__assign(__assign(__assign(__assign(__assign(__assign(__assign({},a),i),c),n),o),t.canvasTimingDetail),{domain:s.host,uri:r,referrer:document.referrer,reffer:document.referrer,image_sdk_version:"0.0.0-feat-viewer-heif-support-20250516072926-v2"})).is_css=t.isCSS,a.load_status=t.status,a.extra=t.extra,a.load_status===LOAD_STATUS.FAIL&&(a.http_status?400<=a.http_status?(c=(i=mapHttpError(a.http_status)).desc,o=i.code,a.err_desc=c,a.err_code=o):a.http_status<400&&(n.is_img?(a.err_desc=ERROR_MSG.MISSING_DECODER,a.err_code=ERROR_CODE[ERROR_MSG.MISSING_DECODER]):n.is_img||(a.err_desc=ERROR_MSG.TYPE_ERR_NOT_IMG,a.err_code=ERROR_CODE[ERROR_MSG.TYPE_ERR_NOT_IMG])):(a.err_desc=ERROR_MSG.UNKNOWN,a.err_code=ERROR_CODE[ERROR_MSG.UNKNOWN])),0<e.length&&logger("errors => ",e),logger("metrics => ",a),a},t}(),EventBroker=(!function(t){t.Error="img_error",t.Monitor="img_monitor",t.System="img_system"}(ReportType=ReportType||{}),function(){function t(t){this.tea=t.tea,this.callback=t.callback,this.logger=createLogger("EventBroker")}return t.initEventBroker=function(e){return this.instance||(this.instance=new t(e)),this.instance},t.getEventBroker=function(){if(this.instance)return this.instance;throw Error("[EventBroker]: init config provider first")},t.prototype.updateReportParams=function(t){this.tea?(t=this.getSafeExtraParams(t),this.tea.config({evtParams:__assign({},t)})):this.logger("Logger have not been initialized")},t.prototype.getSafeExtraParams=function(t){return(t=null!=t?t:{}).app_id,t.line_app_id,t.os_type,__rest$1(t,["app_id","line_app_id","os_type"])},t.prototype.report=function(t){var e;this.logger("will report this event => ",t),this.tea.event(t.type,t.content),null!=(e=this.callback)&&e.call(this,t.type,t.content)},t.prototype.formatInfo=function(t){return MetricFormatter.format(t)},t.prototype.receive=function(t,e){void 0===e&&(e=LOAD_STATUS.SUCCESS);var t=this.formatInfo(t),i=(this.logger("receive ".concat(e," => "),t),ReportType.Monitor);e===LOAD_STATUS.SUCCESS?i=ReportType.Monitor:e===LOAD_STATUS.FAIL&&(i=ReportType.Error),this.report({type:i,content:t})},t}()),MINUTES=6e4,DataCollector=function(){function t(t){this.send=t,this.logger=createLogger("DataCollector"),this.eventCallbackDataMap=new MapWithExpireTime(MINUTES),this.performanceEntryDataMap=new MapWithExpireTime(MINUTES)}return t.prototype.addEventCallbackData=function(t,e){this.logger("addEventCallbackData",t,e);var i=this.performanceEntryDataMap.get(t);i?(this.logger("find entry",i),this.send(i,e.el,e.type,e),this.performanceEntryDataMap.delete(t)):this.eventCallbackDataMap.set(t,e)},t.prototype.addPerformanceEntryData=function(t,e){this.logger("addPerformanceEntryData",t,e);var i=this.eventCallbackDataMap.get(t);i?(this.logger("find data",i),this.send(e,i.el,i.type),this.eventCallbackDataMap.delete(t)):this.performanceEntryDataMap.set(t,e)},t}(),MapWithExpireTime=function(){function t(t){this.expireTime=t,this.map=new Map,this.lastClearTime=Date.now()}return t.prototype.set=function(t,e){return this.clearExpiredData(),this.map.set(t,this.wrapDataWithExpireTime(e)),this},t.prototype.delete=function(t){return this.clearExpiredData(),this.map.delete(t)},t.prototype.get=function(t){if(this.clearExpiredData(),t=this.map.get(t))return this.unwrapData(t)},t.prototype.clearExpiredData=function(){var t=this,e=Date.now();e-this.lastClearTime<MINUTES||(this.lastClearTime=e,this.map.forEach(function(i,n){i.expireTime<e&&t.delete(n)}))},t.prototype.wrapDataWithExpireTime=function(t){return{expireTime:Date.now()+this.expireTime,data:t}},t.prototype.unwrapData=function(t){if(!(t.expireTime<Date.now()))return t.data},t}(),Sampler=function(){function t(){this.configProvider=ConfigProvider.getConfigProvider()}return t.prototype.getSamplingRate=function(){return this.configProvider.getConfig("reportRateConfig")},t.prototype.shouldReport=function(){var t;return Math.random()<=(null!=(t=null==(t=this.getSamplingRate())?void 0:t.reportRate)?t:1)},t.prototype.shouldReportError=function(){var t;return Math.random()<=(null!=(t=null==(t=this.getSamplingRate())?void 0:t.reportRateError)?t:1)},t}(),DEFAULT_CONFIG={selector:"img"},SUPPORT_PERFORMANCE_OBSERVER="undefined"!=typeof PerformanceObserver,IMAGEX_TAGS=["from-imagex-sdk=1","biz_tag=","lk3s=","rk3s="],Producer=function(){function t(t){var e=this;if(this.initPerformanceObserver=function(){SUPPORT_PERFORMANCE_OBSERVER?(e.perfObserver=new PerformanceObserver(function(t){PerformanceObserverEntryList&&t.constructor!==PerformanceObserverEntryList||(t=t.getEntries(),e.logger("entries => ",t),t.forEach(function(t){var i;PerformanceResourceTiming&&t.constructor!==PerformanceResourceTiming||(t=(i=t.toJSON()).initiatorType,e.config.css&&"css"===t?e.send2Broker(i):("img"===t||"fetch"===t&&IMAGEX_TAGS.some(function(t){return i.name.includes(t)}))&&e.dataCollector.addPerformanceEntryData(i.name,i))}))}),e.logger("PerformanceObserver init")):e.logger("current browser does not support PerformanceObserver")},this.errorHandler=this.createHandler(LOAD_STATUS.FAIL),this.loadHandler=this.createHandler(LOAD_STATUS.SUCCESS),this.sampler=new Sampler,this.dataCollector=new DataCollector(this.send2Broker.bind(this)),this.logger=createLogger("Producer"),this.config=Object.assign({},DEFAULT_CONFIG,removeEmptyValFromObj(t)),!t.el)throw Error("[Producer] you should provide el as the element to be observed");if("string"==typeof t.el){var i=document.querySelector(t.el);if(!i)throw Error("[Producer] cannot find the element ".concat(t.el))}else i=t.el;this.el=i,this.include=t.include,this.exclude=t.exclude,this.needIncludeCheck=0<(null!=(i=null==(i=t.include)?void 0:i.length)?i:0),this.needExcludeCheck=0<(null!=(i=null==(i=t.exclude)?void 0:i.length)?i:0),this.customHeadersHandler=t.customHeadersHandler,this.logger("element to be observed => ",this.el),this.initPerformanceObserver()}return t.prototype.start=function(){var t;this.logger(this,"start. Observing => ",this.el),null!=(t=this.perfObserver)&&t.observe({entryTypes:["resource"]}),null!=(t=this.el)&&t.addEventListener("error",this.errorHandler,!0),null!=(t=this.el)&&t.addEventListener("load",this.loadHandler,!0)},t.prototype.stop=function(){var t;this.logger("stop"),null!=(t=this.perfObserver)&&t.disconnect(),null!=(t=this.el)&&t.removeEventListener("error",this.errorHandler,!0),null!=(t=this.el)&&t.removeEventListener("load",this.loadHandler,!0)},t.prototype.createHandler=function(t){var e=this;return function(i){var i=i||window.event;i&&(i=getDataFromEvent(i,e.config.selector))&&i.url&&i.el&&(i.url.startsWith("data:image")||SUPPORT_PERFORMANCE_OBSERVER&&e.dataCollector.addEventCallbackData(i.url,__assign(__assign({},i),{type:t})))}},t.prototype.getHeadersByFetch=function(t,e){return __awaiter(this,void 0,void 0,function(){var i,n,o;return __generator(this,function(r){switch(r.label){case 0:if(!(i=(null==e?void 0:e.currentSrc)||t.name))return this.logger("cannot find uri from the img"),[2];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,fetch(i,{cache:"force-cache"})];case 2:return n=(o=r.sent()).headers,[2,{status:o.status,headers:n}];case 3:return o=r.sent(),this.logger("fetch failed: ",o),[2];case 4:return[2]}})})},t.prototype.getBasicInfo=function(t){var e,i,n,o=t.currentSrc;if(o)return e=t.naturalWidth||0,i=t.naturalHeight||0,e="".concat(e,"*").concat(i),i=formatInt(t.width)||t.style.width||null,n=formatInt(t.height)||t.style.height||null,{duration:0,uri:o,applied_image_size:e,intended_image_size:"".concat(i,"*").concat(n),imagex_type:(null==t?void 0:t.getAttribute("imagex-type"))||"",imagex_version:(null==t?void 0:t.getAttribute("imagex-version"))||"",heif_demotion:(null==t?void 0:t.getAttribute("data-heif-demotion"))||""};this.logger("cannot find uri from the img")},t.prototype.getCanvasBasicInfo=function(t,e){var e=e||{},i=e.naturalWidth,e=e.naturalHeight,n=t.clientWidth,o=t.clientHeight;return{duration:0,applied_image_size:"".concat(i||0,"*").concat(e||0),intended_image_size:"".concat(formatInt(n),"*").concat(formatInt(o)),imagex_type:(null==t?void 0:t.getAttribute("imagex-type"))||"",imagex_version:(null==t?void 0:t.getAttribute("imagex-version"))||""}},t.prototype.send2Broker=function(t,e,i,n){var o;return __awaiter(this,void 0,void 0,function(){var r,s,a,c,l,h,u,p;return __generator(this,function(d){switch(d.label){case 0:return(r=(null==e?void 0:e.currentSrc)||t.name)?this.needExcludeCheck&&this.exclude.some(function(t){return t.test(r)})||this.needIncludeCheck&&!this.include.some(function(t){return t.test(r)})?[2]:(this.logger("send2broker task => ",r,t),e&&isImgElement(e)?s=this.getBasicInfo(e):e&&isCanvasElement(e)&&(s=__assign({uri:r},this.getCanvasBasicInfo(e,n))),c=void 0,e||i?[3,2]:[4,this.getHeadersByFetch(t)]):[2];case 1:c=(u=null==(a=d.sent())?void 0:a.status)&&!(400<=u)?LOAD_STATUS.SUCCESS:LOAD_STATUS.FAIL,d.label=2;case 2:return(l=this.sampler.shouldReport(),h=(null!=i?i:c)===LOAD_STATUS.FAIL&&this.sampler.shouldReportError(),this.logger("shouldReport => ",l,", shouldReportError => ",h),l||h)?e&&i?isImgElement(e)?[4,this.getHeadersByFetch(t,e)]:[3,4]:[3,5]:[2];case 3:return a=d.sent(),[3,5];case 4:isCanvasElement(e)&&(a={status:null==n?void 0:n.fetchStatus,headers:null==n?void 0:n.fetchHeaders}),d.label=5;case 5:return u={},this.customHeadersHandler&&null!=a&&a.headers&&(u=__assign(__assign({},u),null==(o=this.customHeadersHandler)?void 0:o.call(this,a.headers))),p={status:null!=i?i:c,basicInfo:s,headers:a,resourceTiming:t,isCSS:!e,extra:u,canvasTimingDetail:{download_duration:null==n?void 0:n.fetchTime,decode_duration:null==n?void 0:n.decodeTime,render_duration:null==n?void 0:n.renderTime,queue_duration:null==n?void 0:n.queueTime,is_canvas:null==n?void 0:n.isCanvas}},l&&this.config.broker.receive(p),h&&this.config.broker.receive(p,LOAD_STATUS.FAIL),[2]}})})},t}();function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var _assign=function(){return(_assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function __rest(t,e){var i={};for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&0>e.indexOf(o)&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(t);n<o.length;n++)0>e.indexOf(o[n])&&(i[o[n]]=t[o[n]]);return i}function __values(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return{value:(t=t&&i>=t.length?void 0:t)&&t[i++],done:!t}}}}function __read(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,o,r=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=r.next()).done;)s.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(o)throw o.error}}return s}function __spread(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t}var lastEventId,Hook=function(){function t(){this._hooks={},this._cache=[],this._hooksCache={}}return t.prototype.on=function(t,e){t&&e&&"function"==typeof e&&(this._hooks[t]||(this._hooks[t]=[]),this._hooks[t].push(e))},t.prototype.once=function(t,e){var i=this;t&&e&&"function"==typeof e&&this.on(t,function n(o){e(o),i.off(t,n)})},t.prototype.off=function(t,e){t&&this._hooks[t]&&this._hooks[t].length&&(e?-1!==(e=this._hooks[t].indexOf(e))&&this._hooks[t].splice(e,1):this._hooks[t]=[])},t.prototype.emit=function(t,e,i){i?t&&(-1!==this._cache.indexOf(i)?this._emit(t,e):(this._hooksCache.hasOwnProperty(i)||(this._hooksCache[i]={}),this._hooksCache[i].hasOwnProperty(t)||(this._hooksCache[i][t]=[]),this._hooksCache[i][t].push(e))):this._emit(t,e)},t.prototype._emit=function(t,e){t&&this._hooks[t]&&this._hooks[t].length&&__spread(this._hooks[t]).forEach(function(t){try{t(e)}catch(t){}})},t.prototype.set=function(t){t&&-1===this._cache.indexOf(t)&&this._cache.push(t)},t}(),isObject=function(t){return null!=t&&"[object Object]"==Object.prototype.toString.call(t)},isNumber=function(t){return"number"==typeof t&&!isNaN(t)},isString=function(t){return"string"==typeof t},isArray=function(t){return Array.isArray(t)},getIndex=(lastEventId=+Date.now()+Number((""+Math.random()).slice(2,8)),function(){return lastEventId+=1}),decrypto=function(t,e,i){if("string"==typeof t&&"number"==typeof e&&"number"==typeof i){for(var n=[],o=String.fromCharCode((i=i<=25?i:i%25)+97),r=t.split(o),s=0;s<r.length;s++){var a=+parseInt(r[s],i)^e,a=String.fromCharCode(a);n.push(a)}return n.join("")}},decodeUrl=function(t){return decrypto(t,64,25)},beforePageUnload=function(t){navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?window.addEventListener("pagehide",t,!1):window.addEventListener("beforeunload",t,!1)},getIframeUrl=function(){try{return JSON.parse(atob(window.name))||void 0}catch(t){}},loadScript=function(t,e,i){var n=document.createElement("script");n.src=t,n.onerror=function(){i(t)},n.onload=function(){e()},document.getElementsByTagName("head")[0].appendChild(n)},isSupVisChange=function(){var t=0;return["hidden","msHidden","webkitHidden"].forEach(function(e){void 0!==document[e]&&(t=1)}),t},selfAdjust=function(t,e){void 0===t&&(t=function(){}),void 0===e&&(e=1e3);var i=Date.now()+e,n=window.setTimeout(function o(){var r=Date.now()-i;t(),i+=e,n=window.setTimeout(o,Math.max(0,e-r))},e);return function(){window.clearTimeout(n)}},stringify=function(t,e,i){var n;return void 0===i&&(i={}),t===(e=void 0===e?"":e)?e:("/"===(n=(n=t).split("#")[0].split("?")[0])[t.length-1]&&(n=n.substr(0,t.length-1)),n="/"!==e[0]?n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?)(\/[.\w-]+)*\/?$/,"$1"+e):n.replace(/(https?:\/\/[\w-]+(\.[\w-]+){1,}(:[0-9]{1,5})?(\/[.\w-]+)*?)(\/[.\w-]+)?\/?$/,"$1/"+e),0<(t=Object.keys(i).map(function(t){return t+"="+i[t]}).join("&")).length?n+"?"+t:n)},parseURL=function(t){var e=document.createElement("a");return e.href=t,e},parseUrlQuery=function(t){var e={};try{parseURL(t).search.slice(1).split("&").forEach(function(t){var i,n,o=t.split("=");o.length&&(i=o[0],n=o[1]);try{e[i]=decodeURIComponent(void 0===n?"":n)}catch(t){e[i]=n}})}catch(t){}return e},hashCode=function(t){for(var e=0,i=0,n=(t+="").length,o=0;o<n;o++)(0x7fffffffffff<(e=31*e+t.charCodeAt(i++))||e<-140737488355328)&&(e&=0xffffffffffff);return e<0&&(e+=0x7ffffffffffff),e};function createCommonjsModule(t,e){return t(e={exports:{}},e.exports),e.exports}var js_cookie=createCommonjsModule(function(t,e){t.exports=function(){function t(){for(var t=0,e={};t<arguments.length;t++){var i,n=arguments[t];for(i in n)e[i]=n[i]}return e}function e(t){return t.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function i(n){function o(){}function r(e,i,r){if("undefined"!=typeof document){"number"==typeof(r=t({path:"/"},o.defaults,r)).expires&&(r.expires=new Date(+new Date+864e5*r.expires)),r.expires=r.expires?r.expires.toUTCString():"";try{var s=JSON.stringify(i);/^[\{\[]/.test(s)&&(i=s)}catch(t){}i=n.write?n.write(i,e):encodeURIComponent(String(i)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a,c="";for(a in r)r[a]&&(c+="; "+a,!0!==r[a])&&(c+="="+r[a].split(";")[0]);return document.cookie=e+"="+i+c}}function s(t,i){if("undefined"!=typeof document){for(var o={},r=document.cookie?document.cookie.split("; "):[],s=0;s<r.length;s++){var a=r[s].split("="),c=a.slice(1).join("=");i||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=e(a[0]),c=(n.read||n)(c,l)||e(c);if(i)try{c=JSON.parse(c)}catch(t){}if(o[l]=c,t===l)break}catch(t){}}return t?o[t]:o}}return o.set=r,o.get=function(t){return s(t,!1)},o.getJSON=function(t){return s(t,!0)},o.remove=function(e,i){r(e,"",t(i,{expires:-1}))},o.defaults={},o.withConverter=i,o}(function(){})}()}),_getCookie=function(t,e){try{return js_cookie.get(t,{domain:e||document.domain})}catch(t){return""}},_setCookie=function(t,e,i,n){try{var o=n||document.domain,r=+new Date+(i||6048e5);js_cookie.set(t,e,{expires:new Date(r),path:"/",domain:o})}catch(t){}},Memory=function(){function t(){this.cache={}}return t.prototype.setItem=function(t,e){this.cache[t]=e},t.prototype.getItem=function(t){return this.cache[t]},t.prototype.removeItem=function(t){this.cache[t]=void 0},t.prototype.getCookie=function(t,e){return _getCookie(t,e)},t.prototype.setCookie=function(t,e,i,n){_setCookie(t,e,i,n)},t}();function isSupportLS(){try{return localStorage.setItem("_ranger-test-key","hi"),localStorage.getItem("_ranger-test-key"),localStorage.removeItem("_ranger-test-key"),!0}catch(t){return!1}}function isSupportSession(){try{return sessionStorage.setItem("_ranger-test-key","hi"),sessionStorage.getItem("_ranger-test-key"),sessionStorage.removeItem("_ranger-test-key"),!0}catch(t){return!1}}var LOG,Types,DebuggerMesssge$1,local={getItem:function(t){try{var e=localStorage.getItem(t),i=e;try{e&&"string"==typeof e&&(i=JSON.parse(e))}catch(t){}return i||{}}catch(t){}return{}},setItem:function(t,e){try{var i="string"==typeof e?e:JSON.stringify(e);localStorage.setItem(t,i)}catch(t){}},removeItem:function(t){try{localStorage.removeItem(t)}catch(t){}},getCookie:function(t,e){return _getCookie(t,e)},setCookie:function(t,e,i,n){_setCookie(t,e,i,n)},isSupportLS:isSupportLS()},session={getItem:function(t){try{var e=sessionStorage.getItem(t),i=e;try{e&&"string"==typeof e&&(i=JSON.parse(e))}catch(t){}return i||{}}catch(t){}return{}},setItem:function(t,e){try{var i="string"==typeof e?e:JSON.stringify(e);sessionStorage.setItem(t,i)}catch(t){}},removeItem:function(t){try{sessionStorage.removeItem(t)}catch(t){}},getCookie:function(t,e){return _getCookie(t,e)},setCookie:function(t,e,i,n){_setCookie(t,e,i,n)},isSupportSession:isSupportSession()},Storage=function(){function t(t,e){this._storage=e&&"session"===e?session:!t&&local.isSupportLS?local:new Memory}return t.prototype.getItem=function(t){return this._storage.getItem(t)},t.prototype.setItem=function(t,e){this._storage.setItem(t,e)},t.prototype.getCookie=function(t,e){return this._storage.getCookie(t,e)},t.prototype.setCookie=function(t,e,i,n){this._storage.setCookie(t,e,i,n)},t.prototype.removeItem=function(t){this._storage.removeItem(t)},t}(),UTM=function(t,e,i,n){var o=new Storage(!1),r=new Storage(!1,"session"),s=t?"_tea_utm_cache_"+t:"_tea_utm_cache",a=t?"_$utm_from_url_"+t:"_$utm_from_url",c={},l=["tr_shareuser","tr_admaster","tr_param1","tr_param2","tr_param3","tr_param4","$utm_from_url"],h={ad_id:Number(e.ad_id)||void 0,campaign_id:Number(e.campaign_id)||void 0,creative_id:Number(e.creative_id)||void 0,utm_source:e.utm_source,utm_medium:e.utm_medium,utm_campaign:e.utm_campaign,utm_term:e.utm_term,utm_content:e.utm_content,tr_shareuser:e.tr_shareuser,tr_admaster:e.tr_admaster,tr_param1:e.tr_param1,tr_param2:e.tr_param2,tr_param3:e.tr_param3,tr_param4:e.tr_param4};try{var u,p,d=!1;for(u in h)h[u]&&(-1!==l.indexOf(u)?(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data[u]=h[u]):c[u]=h[u],d=!0);d?(r.setItem(a,"1"),o.setCookie(s,JSON.stringify(c),n,i)):(p=o.getCookie(s,i))&&(c=JSON.parse(p)),r.getItem(a)&&(c.hasOwnProperty("tracer_data")||(c.tracer_data={}),c.tracer_data.$utm_from_url=1)}catch(t){return h}return c},Client=function(){function t(t,e,i){this.appid=t,this.domain=e,this.userAgent=window.navigator.userAgent,this.appVersion=window.navigator.appVersion,this.cookie_expire=i}return t.prototype.init=function(){var t=window.navigator.userAgent,e=window.navigator.language,i=document.referrer,n=i?parseURL(i).hostname:"",o=parseUrlQuery(window.location.href),r=/Mobile|htc|mini|Android|iP(ad|od|hone)/.test(this.appVersion)?"wap":"web",o=(this.utm=UTM(this.appid,o,this.domain,this.cookie_expire),this.browser()),s=this.os();return{browser:o.browser,browser_version:o.browser_version,platform:r,os_name:s.os_name,os_version:s.os_version,userAgent:t,screen_width:window.screen&&window.screen.width,screen_height:window.screen&&window.screen.height,device_model:this.getDeviceModel(s.os_name),language:e,referrer:i,referrer_host:n,utm:this.utm,latest_data:this.last(i,n)}},t.prototype.last=function(t,e){var i="",n="",o="",r=location.hostname,s=!1;return t&&e&&r!==e&&(n=e,s=!0,(r=parseUrlQuery(i=t)).keyword)&&(o=r.keyword),{$latest_referrer:i,$latest_referrer_host:n,$latest_search_keyword:o,isLast:s}},t.prototype.browser=function(){var t,e="",i=""+parseFloat(this.appVersion),n=this.userAgent;return -1!==n.indexOf("Edge")||-1!==n.indexOf("Edg")?(e="Microsoft Edge",i=-1!==n.indexOf("Edge")?(t=n.indexOf("Edge"),n.substring(t+5)):(t=n.indexOf("Edg"),n.substring(t+4))):-1!==(t=n.indexOf("MSIE"))?(e="Microsoft Internet Explorer",i=n.substring(t+5)):-1!==(t=n.indexOf("Lark"))?(e="Lark",i=n.substring(t+5,t+11)):-1!==(t=n.indexOf("MetaSr"))?(e="sougoubrowser",i=n.substring(t+7,t+10)):-1!==n.indexOf("MQQBrowser")||-1!==n.indexOf("QQBrowser")?(e="qqbrowser",-1!==n.indexOf("MQQBrowser")?(t=n.indexOf("MQQBrowser"),i=n.substring(t+11,t+15)):-1!==n.indexOf("QQBrowser")&&(t=n.indexOf("QQBrowser"),i=n.substring(t+10,t+17))):-1!==n.indexOf("Chrome")?-1!==(t=n.indexOf("MicroMessenger"))?(e="weixin",i=n.substring(t+15,t+20)):-1!==(t=n.indexOf("360"))?(e="360browser",i=n.substring(n.indexOf("Chrome")+7)):-1!==n.indexOf("baidubrowser")||-1!==n.indexOf("BIDUBrowser")?(-1!==n.indexOf("baidubrowser")?(t=n.indexOf("baidubrowser"),i=n.substring(t+13,t+16)):-1!==n.indexOf("BIDUBrowser")&&(t=n.indexOf("BIDUBrowser"),i=n.substring(t+12,t+15)),e="baidubrowser"):-1!==(t=n.indexOf("xiaomi"))?i=-1!==n.indexOf("openlanguagexiaomi")?(e="openlanguage xiaomi",n.substring(t+7,t+13)):(e="xiaomi",n.substring(t-7,t-1)):-1!==(t=n.indexOf("TTWebView"))?(e="TTWebView",i=n.substring(t+10,t+23)):-1===(t=n.indexOf("Chrome"))&&-1===(t=n.indexOf("Chrome"))||(e="Chrome",i=n.substring(t+7)):-1!==n.indexOf("Safari")?-1!==(t=n.indexOf("QQ"))?(e="qqbrowser",i=n.substring(t+10,t+16)):-1!==(t=n.indexOf("Safari"))&&(e="Safari",i=n.substring(t+7),-1!==(t=n.indexOf("Version")))&&(i=n.substring(t+8)):-1!==(t=n.indexOf("Firefox"))?(e="Firefox",i=n.substring(t+8)):-1!==(t=n.indexOf("MicroMessenger"))?(e="weixin",i=n.substring(t+15,t+20)):-1!==(t=n.indexOf("QQ"))&&(e="qqbrowser",i=n.substring(t+3,t+8)),{browser:e,browser_version:i=-1!==(n=(i=-1!==(n=(i=-1!==(n=i.indexOf(";"))?i.substring(0,n):i).indexOf(" "))?i.substring(0,n):i).indexOf(")"))?i.substring(0,n):i}},t.prototype.os=function(){for(var t,e="",i="",n=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0|Windows NT 10.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Android",r:/Android/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/}],o=0;o<n.length;o++){var r=n[o];if(r.r.test(this.userAgent)){"Mac OS X"===(e=r.s)&&this.isNewIpad()&&(e="iOS");break}}function s(t,e){return(t=t.exec(e))&&t[1]?t[1]:""}function a(t,e){return(t=RegExp("(?:^|[^A-Z0-9-_]|[^A-Z0-9-]_|sprd-)(?:"+t+")","i").exec(e))?t.slice(1)[0]:""}switch(/Windows/.test(e)&&(i=s(/Windows (.*)/,e),e="windows"),e){case"Mac OS X":i=a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent),e="mac";break;case"Android":i=s(/Android ([\.\_\d]+)/,t=this.userAgent)||s(/Android\/([\.\_\d]+)/,t),e="android";break;case"iOS":i=this.isNewIpad()?a("Mac[ +]OS[ +]X(?:[ /](?:Version )?(\\d+(?:[_\\.]\\d+)+))?",this.userAgent):(i=/OS (\d+)_(\d+)_?(\d+)?/.exec(this.appVersion))?i[1]+"."+i[2]+"."+(0|i[3]):"",e="ios"}return{os_name:e,os_version:i}},t.prototype.getDeviceModel=function(t){var e,i,n="";try{"android"===t?navigator.userAgent.split(";").forEach(function(t){-1<t.indexOf("Build/")&&(n=t.slice(0,t.indexOf("Build/")))}):"ios"!==t&&"mac"!==t&&"windows"!==t||(n=this.isNewIpad()?"iPad":(i=(e=navigator.userAgent.replace("Mozilla/5.0 (","")).indexOf(";"),e.slice(0,i)))}catch(t){}return n.trim()},t.prototype.isNewIpad=function(){return void 0!==this.userAgent&&"MacIntel"===navigator.platform&&"number"==typeof navigator.maxTouchPoints&&1<navigator.maxTouchPoints},t}(),LOG={cn:"1fz22z22z1nz21z4mz4bz4bz1kz1az21z4az28z1gz1hz1gz1cz18z1nz1gz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz21z1ez18z1jz1gz49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz1kz18z1jz1gz24z18z49z1kz1az21z4az19z27z22z1cz1mz24z1cz20z21z1cz18z4az1az1mz1k"},AB_DOMAINS={cn:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",va:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az1gz22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k",sg:"1fz22z22z1nz21z4mz4bz4bz22z1mz19z1jz1mz1ez4az22z1mz19z21z1lz21z21z1bz1iz4az1az1mz1k"},LOG_URL=LOG,SDK_VERSION="5.0.31",SDK_USE_TYPE="npm",SDK_TYPE=SDK_USE_TYPE,VISUAL_EDITOR_RANGERS="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-editor-rangers.js",VISUAL_AB_CORE="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-core.js",VISUAL_AB_LOADER="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/visual-ab-loader.js",HOT_PIC_URL="https://lf-cdn-tos.bytescm.com/obj/static/log-sdk/collect/heatmap-core",VISUAL_URL_INSPECTOR="https://lf3-data.volccdn.com/obj/data-static/log-sdk/collect/tester-event-inspector",Types$1=(!function(t){t.Init="init",t.Config="config",t.Start="start",t.Ready="ready",t.TokenComplete="token-complete",t.TokenStorage="token-storage",t.TokenFetch="token-fetch",t.TokenError="token-error",t.ConfigUuid="config-uuid",t.ConfigWebId="config-webid",t.ConfigDomain="config-domain",t.CustomWebId="custom-webid",t.TokenChange="token-change",t.TokenReset="token-reset",t.ConfigTransform="config-transform",t.EnvTransform="env-transform",t.SessionReset="session-reset",t.SessionResetTime="session-reset-time",t.Event="event",t.Events="events",t.EventNow="event-now",t.CleanEvents="clean-events",t.BeconEvent="becon-event",t.SubmitBefore="submit-before",t.SubmitScuess="submit-scuess",t.SubmitAfter="submit-after",t.SubmitError="submit-error",t.SubmitVerify="submit-verify",t.Stay="stay",t.ResetStay="reset-stay",t.StayReady="stay-ready",t.SetStay="set-stay",t.RouteChange="route-change",t.RouteReady="route-ready",t.Ab="ab",t.AbVar="ab-var",t.AbAllVars="ab-all-vars",t.AbConfig="ab-config",t.AbExternalVersion="ab-external-version",t.AbVersionChangeOn="ab-version-change-on",t.AbVersionChangeOff="ab-version-change-off",t.AbOpenLayer="ab-open-layer",t.AbCloseLayer="ab-close-layer",t.AbReady="ab-ready",t.AbComplete="ab-complete",t.Profile="profile",t.ProfileSet="profile-set",t.ProfileSetOnce="profile-set-once",t.ProfileUnset="profile-unset",t.ProfileIncrement="profile-increment",t.ProfileAppend="profile-append",t.ProfileClear="profile-clear",t.Autotrack="autotrack",t.AutotrackReady="autotrack-ready",t.CepReady="cep-ready",t.TracerReady="tracer-ready",t.sessionRecord="session-record",t.SessionRecordStart="session-record-start",t.SessionRecordPause="session-record-pause",t.SessionRecordEnd="session-record-end",t.SessionRecordReport="session-record-report"}(Types=Types||{}),function(t){t.DEBUGGER_MESSAGE="debugger-message",t.DEBUGGER_MESSAGE_SDK="debugger-message-sdk",t.DEBUGGER_MESSAGE_FETCH="debugger-message-fetch",t.DEBUGGER_MESSAGE_FETCH_RESULT="debugger-message-fetch-result",t.DEBUGGER_MESSAGE_EVENT="debugger-message-event",t.DEVTOOL_WEB_READY="devtool-web-ready"}(DebuggerMesssge$1=DebuggerMesssge$1||{}),Types),undef=void 0,date=new Date,timeZoneMin=date.getTimezoneOffset(),timezone=parseInt(""+-timeZoneMin/60,10),tz_offset=60*timeZoneMin,WEBID_URL="/webid",TOB_URL="/tobid",REPORT_URL="/list",COOKIE_EXPIRE=6048e5,ConfigManager=function(){function t(t,e){this.is_first_time=!0,this.configPersist=!1,this.initConfig=e,this.collect=t;var t=new Client(e.app_id,e.cookie_domain||"",e.cookie_expire||COOKIE_EXPIRE).init(),i="__tea_cache_first_"+e.app_id,e=(this.configKey="__tea_cache_config_"+e.app_id,this.sessionStorage=new Storage(!1,"session"),this.localStorage=new Storage(!1,"local"),e.configPersist&&(this.configPersist=!0,this.storage=1===e.configPersist?this.sessionStorage:this.localStorage),this.localStorage.getItem(i));e&&1==e?this.is_first_time=!1:(this.is_first_time=!0,this.localStorage.setItem(i,"1")),this.envInfo={user:{user_unique_id:undef,user_type:undef,user_id:undef,user_is_auth:undef,user_is_login:undef,device_id:undef,web_id:undef,ip_addr_id:undef,user_unique_id_type:undef},header:{app_id:undef,app_name:undef,app_install_id:undef,install_id:undef,app_package:undef,app_channel:undef,app_version:undef,os_name:t.os_name,os_version:t.os_version,device_model:t.device_model,ab_client:undef,traffic_type:undef,client_ip:undef,device_brand:undef,os_api:undef,access:undef,language:t.language,region:undef,app_language:undef,app_region:undef,ab_version:undef,creative_id:t.utm.creative_id,ad_id:t.utm.ad_id,campaign_id:t.utm.campaign_id,log_type:undef,rnd:undef,platform:t.platform,sdk_version:SDK_VERSION,sdk_lib:"js",province:undef,city:undef,timezone:timezone,tz_offset:tz_offset,tz_name:undef,sim_region:undef,carrier:undef,resolution:t.screen_width+"x"+t.screen_height,browser:t.browser,browser_version:t.browser_version,referrer:t.referrer,referrer_host:t.referrer_host,width:t.screen_width,height:t.screen_height,screen_width:t.screen_width,screen_height:t.screen_height,utm_term:t.utm.utm_term,utm_content:t.utm.utm_content,utm_source:t.utm.utm_source,utm_medium:t.utm.utm_medium,utm_campaign:t.utm.utm_campaign,tracer_data:JSON.stringify(t.utm.tracer_data),custom:{},wechat_unionid:undef,wechat_openid:undef}},this.ab_version="",this.evtParams={},this.reportErrorCallback=function(){},this.initDomain()}return t.prototype.initDomain=function(){var t=this.initConfig.channel_domain;t?this.domain=t:(t=this.initConfig.channel,this.domain=decodeUrl(LOG_URL[t]))},t.prototype.setDomain=function(t){this.domain=t},t.prototype.getDomain=function(){return this.domain},t.prototype.setAbVersion=function(t){this.ab_version=t},t.prototype.getAbVersion=function(){return this.ab_version},t.prototype.setAbData=function(t){this.ab_data=t},t.prototype.getAbData=function(){return this.ab_data||{}},t.prototype.getUrl=function(t){var e="";switch(t){case"event":e=this.initConfig.report_url||REPORT_URL;break;case"webid":e=WEBID_URL;break;case"tobid":e=TOB_URL}return t="",this.initConfig.caller&&(t="?sdk_version="+SDK_VERSION+"&sdk_name=web&app_id="+this.initConfig.app_id+"&caller="+this.initConfig.caller),""+this.getDomain()+e+t},t.prototype.set=function(t){var e=this;Object.keys(t).forEach(function(i){var n,o,r;void 0!==t[i]&&null!==t[i]||e.delete(i),"evtParams"===i?e.evtParams=_assign({},e.evtParams||{},t.evtParams||{}):"_staging_flag"===i?e.evtParams=_assign({},e.evtParams||{},{_staging_flag:t._staging_flag}):"reportErrorCallback"===i&&"function"==typeof t[i]?e.reportErrorCallback=t[i]:(r=o="",-1<i.indexOf(".")&&(o=(n=i.split("."))[0],r=n[1]),o?"user"===o||"header"===o?e.envInfo[o][r]=t[i]:e.envInfo.header.custom[r]=t[i]:e.envInfo.user.hasOwnProperty(i)?-1<["user_type","ip_addr_id"].indexOf(i)?e.envInfo.user[i]=t[i]&&Number(t[i]):-1<["user_id","web_id","user_unique_id","user_unique_id_type"].indexOf(i)?e.envInfo.user[i]=t[i]&&String(t[i]):-1<["user_is_auth","user_is_login"].indexOf(i)?e.envInfo.user[i]=!!t[i]:"device_id"===i&&(e.envInfo.user[i]=t[i]):e.envInfo.header.hasOwnProperty(i)?e.envInfo.header[i]=t[i]:e.envInfo.header.custom[i]=t[i])})},t.prototype.get=function(t){try{return t?"evtParams"===t?this.evtParams:"reportErrorCallback"===t?this[t]:this.envInfo.user.hasOwnProperty(t)?this.envInfo.user[t]:this.envInfo.header.hasOwnProperty(t)?this.envInfo.header[t]:JSON.parse(JSON.stringify(this.envInfo[t])):JSON.parse(JSON.stringify(this.envInfo))}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.setStore=function(t){try{var e,i;this.configPersist&&(e=this.storage.getItem(this.configKey)||{})&&Object.keys(t).length&&(i=Object.assign(t,e),this.storage.setItem(this.configKey,i))}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.getStore=function(){try{var t;return this.configPersist&&(t=this.storage.getItem(this.configKey))&&Object.keys(t).length?t:null}catch(t){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),null}},t.prototype.delete=function(t){try{var e;this.configPersist&&(e=this.storage.getItem(this.configKey))&&e.hasOwnProperty(t)&&(delete e[t],this.storage.setItem(this.configKey,e))}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t}(),Logger=function(){function t(t,e){this.isLog=e||!1,this.name=t||""}return t.prototype.info=function(t){this.isLog},t.prototype.warn=function(t){this.isLog},t.prototype.error=function(t){this.isLog},t.prototype.throw=function(t){throw this.error(this.name),Error(t)},t}(),AppBridge=function(){function t(t,e){this.collect=t,this.native=e}var e=t.prototype;return e.bridgeInject=function(){try{return!!this.native&&!!AppLogBridge}catch(t){return!1}},e.bridgeReady=function(){var t=this;return new Promise(function(e,i){try{t.bridgeInject()?AppLogBridge.hasStarted(function(t){t?e(!0):i(!1)}):i(!1)}catch(t){i(!1)}})},e.setNativeAppId=function(t){try{AppLogBridge.setNativeAppId(JSON.stringify(t))}catch(t){}},e.setConfig=function(t){var e=this;try{Object.keys(t).forEach(function(i){"user_unique_id"===i?e.setUserUniqueId(t[i]):t[i]?e.addHeaderInfo(i,t[i]):e.removeHeaderInfo(i)})}catch(t){}},e.setUserUniqueId=function(t){try{AppLogBridge.setUserUniqueId(t)}catch(t){}},e.addHeaderInfo=function(t,e){try{AppLogBridge.addHeaderInfo(t,e)}catch(t){}},e.setHeaderInfo=function(t){try{AppLogBridge.setHeaderInfo(JSON.stringify(t))}catch(t){}},e.removeHeaderInfo=function(t){try{AppLogBridge.removeHeaderInfo(t)}catch(t){}},e.reportPv=function(t){this.onEventV3("predefine_pageview",t)},e.onEventV3=function(t,e){try{AppLogBridge.onEventV3(t,e),this.collect.emit(DebuggerMesssge.DEBUGGER_MESSAGE,{type:DebuggerMesssge.DEBUGGER_MESSAGE_EVENT,info:"bridge埋点上报",time:Date.now(),data:[{events:[{event:t,params:e}]}],code:200,status:"success"})}catch(t){}},e.profileSet=function(t){try{AppLogBridge.profileSet(t)}catch(t){}},e.profileSetOnce=function(t){try{AppLogBridge.profileSetOnce(t)}catch(t){}},e.profileIncrement=function(t){try{AppLogBridge.profileIncrement(t)}catch(t){}},e.profileUnset=function(t){try{AppLogBridge.profileUnset(t)}catch(t){}},e.profileAppend=function(t){try{AppLogBridge.profileAppend(t)}catch(t){}},t}(),ERROR={XHR_ON:500,TIMEOUT:5005};function fetch$1(t,e,i,n,o,r,s,a,c){try{var l=new XMLHttpRequest,h=a||"POST";l.open(h,""+t,!0),l.setRequestHeader("Content-Type","application/json; charset=utf-8"),s&&l.setRequestHeader("X-MCS-AppKey",""+s),n&&(l.withCredentials=!0),l.onload=function(){if(o){var t=null;if(l.responseText){try{t=JSON.parse(l.responseText)}catch(e){t={}}o(t,e)}}},i&&(l.timeout=i,l.ontimeout=function(){r&&r(e,ERROR.TIMEOUT)}),l.onerror=function(){l.abort(),r&&r(e,ERROR.XHR_ON)},c?l.send(e):l.send(JSON.stringify(e))}catch(t){}}var GIF_URL="/gif",ERROR$1={NO_URL:4001,IMG_ON:4e3,IMG_CATCH:4002,BEACON_FALSE:4003},isSupportBeacon=function(){return!(!window.navigator||!window.navigator.sendBeacon)},encodePayload=function(t){var e,i="";for(e in t)t.hasOwnProperty(e)&&void 0!==t[e]&&(i+="&"+e+"="+encodeURIComponent(JSON.stringify(t[e])));return"&"===i[0]?i.slice(1):i},sendByImg=function(t,e,i,n){try{var o=t.match(/\/v\d\//),r=o?o[0]:-1!==t.indexOf("/v1/")?"/v1/":"/v2/",s=t.split(r)[0];s?e.forEach(function(o){var o=encodePayload(o),r=new Image(1,1);r.onload=function(){r=null,i&&i()},r.onerror=function(){r=null,n&&n(t,e,ERROR$1.IMG_ON)},r.src=""+s+GIF_URL+"?"+o}):n(t,e,ERROR$1.NO_URL)}catch(i){n&&n(t,e,ERROR$1.IMG_CATCH,i.message)}},request=function(t,e,i,n,o,r,s,a){var c=window.navigator.userAgent;if(-1===window.navigator.appName.indexOf("Microsoft Internet Explorer")||-1===c.indexOf("MSIE 8.0")&&-1===c.indexOf("MSIE 9.0")){if(s)return isSupportBeacon()?void(window.navigator.sendBeacon(t,JSON.stringify(e))?o():r(t,e,ERROR$1.BEACON_FALSE)):void sendByImg(t,e,o,r)}else sendByImg(t,e,o,r);fetch$1(t,e,i,n,o,r,"","",a)},EventCheck=function(){function t(t,e){this.collector=t,this.config=e,this.eventNameWhiteList=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure"],this.paramsNameWhiteList=["$inactive","$inline","$target_uuid_list","$source_uuid","$is_spider","$source_id","$is_first_time","_staging_flag"],this.regStr=RegExp("^[a-zA-Z0-9][a-z0-9A-Z_.-]{1,255}$")}return t.prototype.checkVerify=function(t){var e,i,n,o=this;return!!(t&&t.length&&(t=t[0])&&(e=t.events,i=t.header,e)&&e.length)&&(n=!0,e.forEach(function(t){o.checkEventName(t.event)||(n=!1,t.checkEvent="事件名不能以 $ or __开头"),o.checkEventParams(t.params)||(n=!1,t.checkParams="属性名不能以 $ or __开头")}),n=!!this.checkEventParams(i)&&n)},t.prototype.checkEventName=function(t){return!!t&&this.calculate(t,"event")},t.prototype.checkEventParams=function(t){var e=t;if("string"==typeof t&&(e=JSON.parse(e)),Object.keys(e).length)for(var i in e)return!(!this.calculate(i,"params")||"string"==typeof e[i]&&1024<e[i].length);return!0},t.prototype.calculate=function(t,e){return -1!==("event"===e?this.eventNameWhiteList:this.paramsNameWhiteList).indexOf(t)||!!this.regStr.test(t)&&!RegExp("^\\$").test(t)&&!RegExp("^__").test(t)},t}(),Event=function(){function t(){this.eventLimit=50,this.enable_ttwebid=!1,this.eventCache=[],this.beconEventCache=[]}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.config=e,this.configManager=t.configManager,this.eventCheck=new EventCheck(t,e),this.cacheStorgae=new Storage(!0),this.localStorage=new Storage(!1),this.maxReport=e.max_report||10,this.reportTime=e.reportTime||30,this.timeout=e.timeout||1e5,this.enable_ttwebid=e.enable_ttwebid,this.reportUrl=this.configManager.getUrl("event"),this.eventKey="__tea_cache_events_"+this.configManager.get("app_id"),this.beconKey="__tea_cache_events_becon_"+this.configManager.get("app_id"),this.abKey="__tea_sdk_ab_version_"+this.configManager.get("app_id"),this.collect.on(Types$1.Ready,function(){i.reportAll(!1)}),this.collect.on(Types$1.ConfigDomain,function(){i.reportUrl=i.configManager.getUrl("event")}),this.collect.on(Types$1.Event,function(t){i.event(t)}),this.collect.on(Types$1.BeconEvent,function(t){i.beconEvent(t)}),this.collect.on(Types$1.CleanEvents,function(){i.reportAll(!1)}),this.linster()},t.prototype.linster=function(){var t=this;window.addEventListener("unload",function(){t.reportAll(!0)},!1),beforePageUnload(function(){t.reportAll(!0)}),document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.reportAll(!0)},!1)},t.prototype.reportAll=function(t){this.report(t),this.reportBecon()},t.prototype.event=function(t){var e=this;try{var i,n=__spread(t,this.cacheStorgae.getItem(this.eventKey)||[]);this.cacheStorgae.setItem(this.eventKey,n),this.reportTimeout&&clearTimeout(this.reportTimeout),n.length>=this.maxReport?this.report(!1):(i=this.reportTime,this.reportTimeout=setTimeout(function(){e.report(!1),e.reportTimeout=null},i))}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.beconEvent=function(t){t=__spread(t,this.cacheStorgae.getItem(this.beconKey)||[]),this.cacheStorgae.setItem(this.beconKey,t),this.collect.destroyInstance||this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},t.prototype.reportBecon=function(){var t;!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(t=this.cacheStorgae.getItem(this.beconKey)||[])&&t.length&&(this.cacheStorgae.removeItem(this.beconKey),this.send(this.split(this.merge(t)),!0))},t.prototype.report=function(t){var e;!this.collect.destroyInstance&&this.collect.tokenManager.getReady()&&this.collect.sdkReady&&(e=this.cacheStorgae.getItem(this.eventKey)||[]).length&&(this.cacheStorgae.removeItem(this.eventKey),this.sliceEvent(e,t))},t.prototype.sliceEvent=function(t,e){if(t.length>this.eventLimit)for(var i=0;i<t.length;i+=this.eventLimit){var n=t.slice(i,i+this.eventLimit),o=this.split(this.merge(n));this.send(o,e)}else o=this.split(this.merge(t)),this.send(o,e)},t.prototype.merge=function(t,e){var i=this,n=this.configManager.get(),o=n.header,r=n.user,s=(o.custom=JSON.stringify(o.custom),this.configManager.get("evtParams")),a=this.configManager.get("user_unique_id_type"),n=t.map(function(t){try{Object.keys(s).length&&!e&&(t.params=_assign({},s,t.params)),a&&(t.params.$user_unique_id_type=a);var n=i.localStorage.getItem(i.abKey);return n&&n.uuid&&n.uuid===r.user_unique_id&&i.configManager.getAbVersion()&&(t.ab_sdk_version=i.configManager.getAbVersion()),t.session_id=i.collect.sessionManager.getSessionId(),t.params=JSON.stringify(t.params),t}catch(e){return i.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),t}}),t=JSON.parse(JSON.stringify({events:n,user:r,header:o})),n=(t.local_time=Math.floor(Date.now()/1e3),t.user_unique_type=this.config.enable_ttwebid?this.config.user_unique_type:void 0,[]);return n.push(t),n},t.prototype.split=function(t){return t.map(function(t){var e=[];return e.push(t),e})},t.prototype.send=function(t,e){var i=this;t.length&&!this.config.disable_track_event&&t.forEach(function(t){try{var n=JSON.parse(JSON.stringify(t)),o=(i.config.filter&&(n=i.config.filter(n)),i.collect.eventFilter&&n&&(n=i.collect.eventFilter(n)),n||t),r=JSON.parse(JSON.stringify(o));i.eventCheck.checkVerify(r),o.length&&(i.collect.emit(Types$1.SubmitBefore,o),i.collect.emit(Types$1.SubmitVerify,o),request(i.reportUrl,o,i.timeout,i.enable_ttwebid,function(t,e){t&&0!==t.e?(i.collect.emit(Types$1.SubmitError,{type:"f_data",eventData:e,errorCode:t.e,response:t}),i.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"埋点上报失败",time:Date.now(),data:r,code:t.e,failType:"数据异常",status:"fail"})):(i.collect.emit(Types$1.SubmitScuess,{eventData:e,res:t}),i.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:r,code:200,status:"success"}))},function(t,e){i.configManager.get("reportErrorCallback")(t,e),i.collect.emit(Types$1.SubmitError,{type:"f_net",eventData:t,errorCode:e}),i.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"埋点上报网络异常",time:Date.now(),data:r,code:e,failType:"网络异常",status:"fail"})},e,!1),i.collect.emit(Types$1.SubmitAfter,o))}catch(t){i.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}})},t}(),b=function t(e){return e?(e^16*Math.random()>>e/4).toString(10):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,t)},localWebId=function(){return b().replace(/-/g,"").slice(0,19)},Token=function(){function t(){this.cacheToken={},this.enableCookie=!1,this.enable_ttwebid=!1,this.enableCustomWebid=!1}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.config=e,this.configManager=this.collect.configManager,this.storage=new Storage(!1),this.tokenKey="__tea_cache_tokens_"+e.app_id,this.enable_ttwebid=e.enable_ttwebid,this.enableCustomWebid=e.enable_custom_webid,this.collect.on(Types$1.ConfigUuid,function(t){i.setUuid(t)}),this.collect.on(Types$1.ConfigWebId,function(t){i.setWebId(t)}),this.enableCookie=e.cross_subdomain,this.expiresTime=e.cookie_expire||6048e5,this.cookieDomain=e.cookie_domain||"",this.checkStorage()},t.prototype.checkStorage=function(){var t,e=this;this.enableCookie?(t=this.storage.getCookie(this.tokenKey,this.cookieDomain),this.cacheToken=t&&"string"==typeof t?JSON.parse(t):{}):this.cacheToken=this.storage.getItem(this.tokenKey)||{},this.tokenType=this.cacheToken&&this.cacheToken._type_?this.cacheToken._type_:"default","custom"!==this.tokenType||this.enableCustomWebid?this.enableCustomWebid?this.collect.on(Types$1.CustomWebId,function(){e.tokenReady=!0,e.collect.emit(Types$1.TokenComplete)}):this.checkEnv()||(this.enable_ttwebid?this.completeTtWid(this.cacheToken):this.check()):this.remoteWebid()},t.prototype.check=function(){this.cacheToken&&this.cacheToken.web_id?this.complete(this.cacheToken):this.config.disable_webid?this.complete({web_id:localWebId(),user_unique_id:this.configManager.get("user_unique_id")||localWebId()}):this.remoteWebid()},t.prototype.checkEnv=function(){var t=window.navigator.userAgent;return(-1!==t.indexOf("miniProgram")||-1!==t.indexOf("MiniProgram"))&&!(!(t=parseUrlQuery(window.location.href))||!t.Web_ID||(this.complete({web_id:""+t.Web_ID,user_unique_id:this.configManager.get("user_unique_id")||""+t.Web_ID}),0))},t.prototype.remoteWebid=function(){var t=this,e=this.configManager.getUrl("webid"),i={app_key:this.config.app_key,app_id:this.config.app_id,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer,user_unique_id:""};this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 发起WEBID请求",logType:"fetch",level:"info",time:Date.now(),data:i}),fetch$1(e,i,3e3,!1,function(e){e&&0===e.e?t.complete({web_id:t.configManager.get("web_id")||e.web_id,user_unique_id:t.configManager.get("user_unique_id")||e.web_id}):t.collect.emit(Types$1.TokenError),t.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"WEBID请求成功",logType:"fetch",level:"info",time:Date.now(),data:e})},function(){t.collect.emit(Types$1.TokenError),t.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"WEBID请求网络异常",logType:"fetch",level:"error",time:Date.now(),data:null})})},t.prototype.complete=function(t){var e=t.web_id,i=t.user_unique_id;t.timestamp=Date.now(),this.collect.configManager.set({web_id:e,user_unique_id:i}),this.setStorage(t),this.tokenReady=!0,this.collect.emit(Types$1.TokenComplete)},t.prototype.completeTtWid=function(t){var e=t.user_unique_id||"",i=this.configManager.get("user_unique_id");(i||e)&&this.configManager.set({user_unique_id:i||e}),this.setStorage(t),this.tokenReady=!0,this.collect.emit(Types$1.TokenComplete)},t.prototype.setUuid=function(t){var e,i;t&&-1===["null","undefined","Null","None"].indexOf(t)?(t=String(t),e=this.configManager.get("user_unique_id"),i=this.cacheToken&&this.cacheToken.user_unique_id,t===e&&t===i||(this.configManager.set({user_unique_id:t}),this.cacheToken||(this.cacheToken={}),this.cacheToken.user_unique_id=t,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken),this.collect.emit(Types$1.TokenChange,"uuid"),this.collect.emit(Types$1.SessionReset))):this.clearUuid()},t.prototype.clearUuid=function(){this.config.enable_ttwebid||this.configManager.get("web_id")&&(this.configManager.set({user_unique_id:this.configManager.get("web_id")}),this.cacheToken&&this.cacheToken.web_id&&(this.cacheToken.user_unique_id=this.cacheToken.web_id,this.cacheToken.timestamp=Date.now(),this.setStorage(this.cacheToken)),this.collect.emit(Types$1.TokenReset))},t.prototype.setWebId=function(t){var e,i;t&&!this.config.enable_ttwebid&&(this.cacheToken&&this.cacheToken.web_id?this.cacheToken.web_id!==t&&(this.cacheToken.user_unique_id=this.cacheToken.web_id===this.cacheToken.user_unique_id?t:this.cacheToken.user_unique_id,this.cacheToken.web_id=t):(this.cacheToken={},this.cacheToken.web_id=t,this.cacheToken.user_unique_id=t),this.cacheToken.timestamp=Date.now(),e=this.configManager.get("web_id"),(i=this.configManager.get("user_unique_id"))&&i!==e||(this.configManager.set({user_unique_id:t}),this.collect.emit(Types$1.TokenChange,"uuid")),e!==t&&(this.configManager.set({web_id:t}),this.collect.emit(Types$1.TokenChange,"webid")),this.setStorage(this.cacheToken))},t.prototype.setStorage=function(t){t._type_=this.enableCustomWebid?"custom":"default",delete t["diss".split("").reverse().join("")],this.enableCookie||this.enable_ttwebid?(this.storage.setCookie(this.tokenKey,t,this.expiresTime,this.cookieDomain),this.enable_ttwebid&&(delete t.web_id,this.storage.setItem(this.tokenKey,t))):this.storage.setItem(this.tokenKey,t),this.cacheToken=t},t.prototype.getReady=function(){return this.tokenReady},t.prototype.getTobId=function(){var t=this,e=this.configManager.getUrl("tobid");return new Promise(function(i){fetch$1(e,{app_id:t.config.app_id,user_unique_id:t.configManager.get("user_unique_id"),web_id:t.configManager.get("web_id"),user_unique_id_type:t.configManager.get("user_unique_id_type")},3e4,t.enable_ttwebid,function(t){t&&0===t.e?i(t.tobid):i("")},function(){i("")})})},t}(),sessionId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})},Session=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.storage=new Storage(!1,"session"),this.sessionKey="__tea_session_id_"+e.app_id,this.expireTime=e.expireTime||18e5,this.disableSession=e.disable_session,this.disableSession||(this.setSessionId(),this.collect.on(Types$1.SessionReset,function(){i.resetSessionId()}),this.collect.on(Types$1.SessionResetTime,function(){i.updateSessionIdTime()}))},t.prototype.updateSessionIdTime=function(){var t,e=this.storage.getItem(this.sessionKey);e&&e.sessionId&&(t=e.timestamp,Date.now()-t>this.expireTime?e={sessionId:sessionId(),timestamp:Date.now()}:e.timestamp=Date.now(),this.storage.setItem(this.sessionKey,e),this.resetExpTime())},t.prototype.setSessionId=function(){var t=this,e=this.storage.getItem(this.sessionKey);e&&e.sessionId?e.timestamp=Date.now():e={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,e),this.sessionExp=setInterval(function(){t.checkEXp()},this.expireTime)},t.prototype.getSessionId=function(){var t=this.storage.getItem(this.sessionKey);return!this.disableSession&&t&&t.sessionId?t.sessionId:""},t.prototype.resetExpTime=function(){var t=this;this.sessionExp&&(clearInterval(this.sessionExp),this.sessionExp=setInterval(function(){t.checkEXp()},this.expireTime))},t.prototype.resetSessionId=function(){var t={sessionId:sessionId(),timestamp:Date.now()};this.storage.setItem(this.sessionKey,t)},t.prototype.checkEXp=function(){var t=this.storage.getItem(this.sessionKey);t&&t.sessionId&&Date.now()-t.timestamp+30>=this.expireTime&&(t={sessionId:sessionId(),timestamp:Date.now()},this.storage.setItem(this.sessionKey,t))},t}(),AutoBase=function(t){var e=t.app_id,i=t.channel,n=t.onTokenReady,t=LOG_URL[i]+"/webid",o=new Storage(!1),r="__tea_cache_tokens_"+e,i=o.getItem(r);i&&i.web_id?n(i.web_id):request(t,{app_key:"",app_id:e,url:location.href,user_agent:window.navigator.userAgent,referer:document.referrer},3e3,!1,function(t){t&&0===t.e?(n(t.web_id),t={web_id:t.web_id,user_unique_id:t.web_id,timestamp:Date.now()},o.setItem(r,t)):n("")},function(){n("")},!0)},Debugger=function(){function t(t,e){this.devToolReady=!1,this.devToolOrigin="*",this.sendAlready=!1,this.collect=t,this.config=e,this.app_id=e.app_id,this.filterEvent=["__bav_page","__bav_beat","__bav_page_statistics","__bav_click","__bav_page_exposure","bav2b_page","bav2b_beat","bav2b_page_statistics","bav2b_click","bav2b_page_exposure","_be_active","predefine_pageview","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append","predefine_page_alive","predefine_page_close","abtest_exposure"],this.load()}return t.prototype.loadScript=function(t){try{var e=document.createElement("script");e.src=t,e.onerror=function(){},e.onload=function(){},document.getElementsByTagName("body")[0].appendChild(e)}catch(t){}},t.prototype.load=function(){try{this.loadBaseInfo(),this.loadHook();var t=parseUrlQuery(window.location.href);t.open_devtool_web&&parseInt(t.app_id)===this.app_id&&(this.addLintener(),this.loadDebuggerModule(),this.loadDevTool())}catch(t){}},t.prototype.loadDevTool=function(){this.loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/devtool/debug-web.js")},t.prototype.loadBaseInfo=function(){var t=this;this.info=[{title:"基本信息",type:1,infoName:{app_id:this.config.app_id,channel:this.config.channel,上报域名:this.collect.configManager.getDomain(),SDK版本:SDK_VERSION,SDK引入方式:SDK_TYPE}},{title:"用户信息",type:2,infoName:{uuid:this.collect.configManager.get("user").user_unique_id||"",web_id:this.collect.configManager.get("user").web_id||"",ssid:"点击获取SSID"}},{title:"公共参数信息",type:2,infoName:{浏览器:this.collect.configManager.get("browser"),浏览器版本:this.collect.configManager.get("browser_version"),平台:this.collect.configManager.get("platform"),设备型号:this.collect.configManager.get("device_model"),操作系统:this.collect.configManager.get("os_name"),操作系统版本:this.collect.configManager.get("os_version"),屏幕分辨率:this.collect.configManager.get("os_version"),来源:this.collect.configManager.get("referrer"),自定义信息:""}},{title:"配置信息",type:3,infoName:{全埋点:!!this.config.autotrack,停留时长:!!this.config.enable_stay_duration}},{title:"A/B配置信息",type:4,infoName:{"A/B实验":!!this.config.enable_ab_test}},{title:"客户端信息",type:3,infoName:{打通开关:!!this.config.Native}}],this.log=[],this.event=[],this.collect.on(Types$1.Ready,function(){t.info[1].infoName.uuid=t.collect.configManager.get("user").user_unique_id,t.info[1].infoName.web_id=t.collect.configManager.get("user").web_id,t.info[2].infoName["自定义信息"]=JSON.stringify(t.collect.configManager.get("custom")),t.config.enable_ab_test&&(t.info[4].infoName["已曝光VID"]=t.collect.configManager.getAbVersion(),t.info[4].infoName["A/B域名"]=t.config.ab_channel_domain||decodeUrl(AB_DOMAINS[t.config.channel]),t.info[4].infoName["全部配置"]=t.collect.configManager.getAbData()),t.config.Native&&(t.info[5].infoName["是否打通"]=!!t.collect.bridgeReport)})},t.prototype.loadHook=function(){var t=this;this.collect.on(DebuggerMesssge$1.DEBUGGER_MESSAGE,function(e){switch(e.type){case DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK:var i={time:e.time,type:e.logType||"sdk",level:e.level,name:e.info,show:!0,levelShow:!0,needDesc:!!e.data};return e.data&&(i.desc={content:JSON.stringify(e.data)}),t.updateLog(i),e.secType&&"AB"===e.secType?(t.info[4].infoName["已曝光VID"]=t.collect.configManager.getAbVersion(),t.info[4].infoName["全部配置"]=t.collect.configManager.getAbData()):"USER"===e.secType&&(t.info[1].infoName.uuid=t.collect.configManager.get("user").user_unique_id,t.info[1].infoName.web_id=t.collect.configManager.get("user").web_id),void t.updateInfo();case DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT:if(e.data&&e.data.length){var i=e.data[0],n=i.events;if(!n.length)return;n.forEach(function(i){i.checkShow=!0,i.searchShow=!0,i.success=e.status,i.type=-1!==t.filterEvent.indexOf(i.event)?"sdk":"cus",i.type=t.collect.bridgeReport?"bridge":i.type,i.info="","fail"===e.status&&(i.info={message:"code: "+e.code+"， msg: "+e.failType})}),t.updateEvent(i)}return}})},t.prototype.addLintener=function(){var t=this;window.addEventListener("message",function(e){if(e&&e.data&&"devtool:web:ready"===e.data.type){if(t.devToolOrigin=e.origin,t.devToolReady=!0,t.sendAlready)return;t.sendData("devtool:web:init",{info:t.info,log:t.log,event:t.event}),t.sendAlready=!0}e&&e.data&&"devtool:web:ssid"===e.data.type&&t.collect.getToken(function(e){t.info[1].infoName.ssid=e.tobid,t.updateInfo()})})},t.prototype.sendData=function(t,e){try{var i={type:t,payload:e};(window.opener||window.parent).postMessage(i,this.devToolOrigin)}catch(t){}},t.prototype.updateInfo=function(){this.devToolReady&&this.sendData("devtool:web:info",this.info)},t.prototype.updateLog=function(t){this.devToolReady?this.sendData("devtool:web:log",t):this.log.push(t)},t.prototype.updateEvent=function(t){this.devToolReady?this.sendData("devtool:web:event",t):this.event.push(t)},t.prototype.loadDebuggerModule=function(){var t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style"),t=(e.appendChild(document.createTextNode("#debugger-applog-web {\n      position: absolute;\n      width: 90px;\n      height: 30px;\n      background: #23c243;\n      border-radius: 6px;\n      color: #fff;\n      font-size: 12px;\n      bottom: 5%;\n      right: 10%;\n      text-align: center;\n      line-height: 30px;\n      cursor: pointer;\n      z-index:100;\n    }")),t.appendChild(e),document.createElement("div")),e=(t.innerHTML='<div id="debugger-applog-web" class="debugger-applog-web">AppLog调试</div>',document.createElement("div"));e.innerHTML='<div id="debugger-container" class="debugger-container"></div>',document.getElementsByTagName("body")[0].appendChild(t),document.getElementsByTagName("body")[0].appendChild(e),document.getElementById("debugger-applog-web").addEventListener("click",function(){(window.opener||window.parent).postMessage({type:"devtool:web:open-draw"},location.origin)})},t}(),sdk_type="base",sdk_type="full",Collector=function(){function t(t){this.disableAutoPageView=!1,this.bridgeReport=!1,this.staging=!1,this.pluginInstances=[],this.sended=!1,this.started=!1,this.destroyInstance=!1,this.sdkReady=!1,this.adapters={},this.name=t,this.hook=new Hook,this.remotePlugin=new Map,this.Types=Types$1,this.adapters.fetch=fetch$1,this.adapters.storage=Storage}return t.usePlugin=function(e,i,n){if(i){for(var o=!1,r=0,s=t.plugins.length;r<s;r++)if(t.plugins[r].name===i){t.plugins[r].plugin=e,t.plugins[r].options=n||{},o=!0;break}o||t.plugins.push({name:i,plugin:e,options:n})}else t.plugins.push({plugin:e})},t.prototype.usePlugin=function(t,e,i){t&&("full"===sdk_type&&this.remotePlugin.get(t)||(e?"string"==typeof e?this.remotePlugin.get(t)||this.remotePlugin.set(t,{src:e,call:i}):this.remotePlugin.get(t)||this.remotePlugin.set(t,{instance:e}):this.remotePlugin.get(t)||this.remotePlugin.set(t,"sdk")))},t.prototype.init=function(e){var i=this;this.inited||e&&isObject(e)&&e.app_id&&isNumber(e.app_id)&&(!e.app_key||isString(e.app_key))&&(e.channel_domain||-1!==["cn","sg","va"].indexOf(e.channel)||(e.channel="cn"),this.logger=new Logger(this.name,e.log),this.appBridge=new AppBridge(this,e.Native),this.bridgeReport=this.appBridge.bridgeInject(),this.configManager=new ConfigManager(this,e),this.debugger=new Debugger(this,e),this.initConfig=e,this.emit(Types$1.Init),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行INIT",data:e,level:"info",time:Date.now()}),e.disable_auto_pv&&(this.disableAutoPageView=!0),this.bridgeReport||(this.configManager.set({app_id:e.app_id}),this.eventManager=new Event,this.tokenManager=new Token,this.sessionManager=new Session,Promise.all([new Promise(function(t){i.once(Types$1.TokenComplete,function(){t(!0)})}),new Promise(function(t){i.once(Types$1.Start,function(){t(!0)})})]).then(function(){try{t.plugins.reduce(function(t,e){var n=e.plugin,e=e.options,e=Object.assign(i.initConfig,e),n=new n;return n.apply(i,e),t.push(n),t},i.pluginInstances)}catch(t){i.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}i.sdkReady=!0,i.emit(Types$1.Ready),i.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 初始化完成",time:Date.now(),level:"info",data:i.configManager.get("user")}),i.logger.info("appid: "+e.app_id+", userInfo:"+JSON.stringify(i.configManager.get("user"))),i.logger.info("appid: "+e.app_id+", sdk is ready, version is "+SDK_VERSION+", you can report now !!!"),e.disable_auto_pv&&(i.disableAutoPageView=!0);try{(e.enable_ab_test||e.autotrack)&&(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(t){i.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}i.pageView(),i.on(Types$1.TokenChange,function(t){"webid"===t&&i.pageView(),i.logger.info("appid: "+e.app_id+" token change, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 设置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),i.on(Types$1.TokenReset,function(){i.logger.info("appid: "+e.app_id+" token reset, new userInfo:"+JSON.stringify(i.configManager.get("user"))),i.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 重置了用户信息",time:Date.now(),secType:"USER",level:"info",data:i.configManager.get("user")})}),i.on(Types$1.RouteChange,function(t){t.init||e.disable_route_report||i.pageView()});try{(window.opener||window.parent).postMessage("[tea-sdk]ready","*")}catch(t){}}),this.tokenManager.apply(this,e),this.eventManager.apply(this,e),this.sessionManager.apply(this,e)),this.inited=!0)},t.prototype.config=function(t){var e,i;this.inited&&t&&isObject(t)&&(this.bridgeReport?this.appBridge.setConfig(t):(t._staging_flag&&1===t._staging_flag&&(this.staging=!0),t.disable_auto_pv&&(this.disableAutoPageView=!0,delete t.disable_auto_pv),e=_assign({},t),this.initConfig&&this.initConfig.configPersist&&((i=this.configManager.getStore())&&(e=Object.assign(i,t)),this.configManager.setStore(t)),e.web_id,e.user_unique_id,i=__rest(e,["web_id","user_unique_id"]),e.hasOwnProperty("web_id")&&this.emit(Types$1.ConfigWebId,e.web_id),e.hasOwnProperty("user_unique_id")&&this.emit(Types$1.ConfigUuid,e.user_unique_id),this.configManager.set(i),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行CONFIG",level:"info",time:Date.now(),data:e})))},t.prototype.setDomain=function(t){this.configManager&&this.configManager.setDomain(t),this.emit(Types$1.ConfigDomain)},t.prototype.getConfig=function(t){return this.configManager.get(t)},t.prototype.send=function(){this.start()},t.prototype.start=function(){this.inited&&!this.sended&&(this.sended=!0,this.emit(Types$1.Start),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行START",level:"info",time:Date.now()}),this.bridgeReport)&&(this.pageView(),this.emit(Types$1.Ready))},t.prototype.event=function(t,e){var i=this;try{var n=[];Array.isArray(t)?t.forEach(function(t){n.push(i.processEvent(t[0],t[1]||{}))}):n.push(this.processEvent(t,e)),this.bridgeReport?n.forEach(function(t){var e=t.event,t=t.params;i.appBridge.onEventV3(e,JSON.stringify(t))}):n.length&&(this.emit(Types$1.Event,n),this.emit(Types$1.SessionResetTime))}catch(t){this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.beconEvent=function(t,e){var i;Array.isArray(t)||((i=[]).push(this.processEvent(t,e||{})),i.length&&(this.emit(Types$1.BeconEvent,i),this.emit(Types$1.SessionResetTime)))},t.prototype.processEvent=function(t,e){void 0===e&&(e={});try{var i=t,n=(/^event\./.test(t)&&(i=t.slice(6)),e),o=void((n="object"!=_typeof(n)?{}:n).profile?delete n.profile:n.event_index=getIndex());return n.local_ms?(o=n.local_ms,delete n.local_ms):o=+new Date,{event:i,params:n,local_time_ms:o,is_bav:this.initConfig&&this.initConfig.autotrack?1:0}}catch(i){return this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:i.message}),{event:t,params:e}}},t.prototype.filterEvent=function(t){this.eventFilter=t},t.prototype.on=function(t,e){this.hook.on(t,e)},t.prototype.once=function(t,e){this.hook.once(t,e)},t.prototype.off=function(t,e){this.hook.off(t,e)},t.prototype.emit=function(t,e,i){this.hook.emit(t,e,i)},t.prototype.set=function(t){this.hook.set(t)},t.prototype.pageView=function(){this.disableAutoPageView||this.predefinePageView()},t.prototype.predefinePageView=function(t){void 0===t&&(t={});var e={title:document.title||location.pathname,url:location.href,url_path:location.pathname,time:Date.now(),referrer:window.document.referrer,$is_first_time:""+this.configManager.is_first_time},e=_assign({},e,t);this.event("predefine_pageview",e)},t.prototype.clearEventCache=function(){this.emit(Types$1.CleanEvents)},t.prototype.setWebIDviaUnionID=function(t){var e;t&&(e=hashCode(t),this.config({web_id:""+e,wechat_unionid:t}),this.emit(Types$1.CustomWebId))},t.prototype.setWebId=function(t){this.config({web_id:""+t})},t.prototype.setWebIDviaOpenID=function(t){var e;t&&(e=hashCode(t),this.config({web_id:""+e,wechat_openid:t}),this.emit(Types$1.CustomWebId))},t.prototype.setNativeAppId=function(t){this.bridgeReport&&this.appBridge.setNativeAppId(t)},t.prototype.resetStayDuration=function(t,e,i){this.emit(Types$1.ResetStay,{url_path:t,title:e,url:i},Types$1.Stay)},t.prototype.resetStayParams=function(t,e,i){this.emit(Types$1.SetStay,{url_path:t=void 0===t?"":t,title:e=void 0===e?"":e,url:i=void 0===i?"":i},Types$1.Stay)},t.prototype.getToken=function(t,e){function i(e){var i;!r&&(r=!0,i=o.configManager.get().user,e&&(i.tobid=e,i["diss".split("").reverse().join("")]=e),t(_assign({},i)))}function n(){o.tokenManager.getTobId().then(function(t){i(t)})}var o=this,r=!1;this.sdkReady?n():(e&&setTimeout(function(){i()},e),this.on(Types$1.Ready,function(){n()}))},t.prototype.profileSet=function(t){this.bridgeReport?this.appBridge.profileSet(JSON.stringify(t)):this.emit(Types$1.ProfileSet,t,Types$1.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSet",level:"info",time:Date.now(),data:t})},t.prototype.profileSetOnce=function(t){this.bridgeReport?this.appBridge.profileSetOnce(JSON.stringify(t)):this.emit(Types$1.ProfileSetOnce,t,Types$1.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileSetOnce",level:"info",time:Date.now(),data:t})},t.prototype.profileIncrement=function(t){this.bridgeReport?this.appBridge.profileIncrement(JSON.stringify(t)):this.emit(Types$1.ProfileIncrement,t,Types$1.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileIncrement",level:"info",time:Date.now(),data:t})},t.prototype.profileUnset=function(t){this.bridgeReport?this.appBridge.profileUnset(t):this.emit(Types$1.ProfileUnset,t,Types$1.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileUnset",level:"info",time:Date.now(),data:t})},t.prototype.profileAppend=function(t){this.bridgeReport?this.appBridge.profileAppend(JSON.stringify(t)):this.emit(Types$1.ProfileAppend,t,Types$1.Profile),this.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行profileAppend",level:"info",time:Date.now(),data:t})},t.prototype.setExternalAbVersion=function(t){this.emit(Types$1.AbExternalVersion,"string"==typeof t&&t?(""+t).trim():null,Types$1.Ab)},t.prototype.getVar=function(t,e,i){this.emit(Types$1.AbVar,{name:t,defaultValue:e,callback:i},Types$1.Ab)},t.prototype.getABconfig=function(t,e){this.emit(Types$1.AbConfig,{params:t,callback:e},Types$1.Ab)},t.prototype.getAbSdkVersion=function(){return this.configManager.getAbVersion()},t.prototype.onAbSdkVersionChange=function(t){var e=this;return this.emit(Types$1.AbVersionChangeOn,t,Types$1.Ab),function(){e.emit(Types$1.AbVersionChangeOff,t,Types$1.Ab)}},t.prototype.offAbSdkVersionChange=function(t){this.emit(Types$1.AbVersionChangeOff,t,Types$1.Ab)},t.prototype.openOverlayer=function(){this.emit(Types$1.AbOpenLayer,"",Types$1.Ab)},t.prototype.closeOverlayer=function(){this.emit(Types$1.AbCloseLayer,"",Types$1.Ab)},t.prototype.getAllVars=function(t){this.emit(Types$1.AbAllVars,t,Types$1.Ab)},t.prototype.sessionRecordStart=function(){this.emit(Types$1.SessionRecordStart,Types$1.sessionRecord)},t.prototype.sessionRecordPause=function(){this.emit(Types$1.SessionRecordPause,Types$1.sessionRecord)},t.prototype.sessionRecordEnd=function(){this.emit(Types$1.SessionRecordEnd,Types$1.sessionRecord)},t.prototype.sessionRecordReport=function(t){this.emit(Types$1.SessionRecordReport,{callback:t},Types$1.sessionRecord)},t.prototype.autoInitializationRangers=function(t){AutoBase(t)},t.prototype.destoryInstace=function(){this.destroyInstance||(this.destroyInstance=!0,this.off(Types$1.TokenComplete))},t.plugins=[],t}(),STYLE_ID="__rangers_ab_style__";function openOverlayer(){var t,e,i;document.getElementById(STYLE_ID)||(t="body { opacity: 0 !important; }",e=document.head||document.getElementsByTagName("head")[0],(i=document.createElement("style")).id=STYLE_ID,i.type="text/css",i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t)),e.appendChild(i))}function closeOverlayer(){var t=document.getElementById(STYLE_ID);t&&t.parentElement.removeChild(t)}var msgQueueMap={},allowdOrigins=[],addAllowdOrigin=function(t){t.length&&t.forEach(function(t){allowdOrigins.push(t)})};function dispatchMsg(t,e,i,n){var o=t&&t.source||window.opener||window.parent,t=t&&t.origin||n||"*";o.postMessage(JSON.stringify({type:e,payload:i}),t)}function receiveMsg(t,e){msgQueueMap[t]=msgQueueMap[t]||[],msgQueueMap[t].push(e)}function processMsg(t){if(allowdOrigins.some(function(t){return"*"===t})||allowdOrigins.some(function(e){return -1<t.origin.indexOf(e)})){var e,i,n=t.data;if("string"==typeof t.data)try{n=JSON.parse(t.data)}catch(t){n=void 0}n&&(e=n.type,i=n.payload,msgQueueMap[e])&&msgQueueMap[e].forEach(function(e){"function"==typeof e&&e(t,i)})}}function init(t,e){t=_assign({},t),delete t.filter,(window.opener||window.parent).postMessage({type:"tea:sdk:info",config:t,version:e},"*"),window.addEventListener("message",processMsg,!1)}var VISUAL_URL="",isLoaded=!1;function loadEditorScript(t){var e=t.event,i=t.editorUrl;t.collectInstance,t.fromSession,isLoaded||(isLoaded=!0,loadScript(i,function(){dispatchMsg(e,"abEditorScriptloadSuccess")},function(){e&&dispatchMsg(e,"abEditorScriptloadError"),isLoaded=!1}))}function readyToLoadEditor(t,e){window.TEAVisualEditor=window.TEAVisualEditor||{},addAllowdOrigin(["*"]);var i,n="",o=(init(e,SDK_VERSION),"");try{var r=window.performance.getEntriesByType("resource");if(r&&r.length&&(r.forEach(function(t){"script"===t.initiatorType&&t.name&&-1!==t.name.indexOf("collect")&&(o=t.name)}),o||document.currentScript&&(o=document.currentScript.src),o)&&(i=o.split("/"))&&i.length){for(var n="https:/",s=2;s<i.length&&s!==i.length-1;s++)n=n+"/"+i[s];n+="/visual-ab-core"}}catch(t){}receiveMsg("tea:openVisualABEditor",function(i){var o,r=i.data;if("string"==typeof i.data)try{r=JSON.parse(i.data)}catch(t){r=void 0}r&&(o=r.lang,r.appId!==e.app_id?dispatchMsg(i,"appIdError"):(VISUAL_URL=(r=r.version)&&n?n+(r?"."+r:".1.0.1")+".js?query="+Date.now():VISUAL_AB_CORE+"?query="+Date.now(),window.TEAVisualEditor.lang=o,window.TEAVisualEditor.__ab_domin=e.channel_domain||"",loadEditorScript({event:i,editorUrl:VISUAL_URL,collectInstance:t})))})}var CallbackType,loadMuiltlink=function(t,e){window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.appId=e.app_id,receiveMsg("tea:openTesterEventInspector",function(e){var i,n,o=e.data;if("string"==typeof e.data)try{o=JSON.parse(e.data)}catch(t){o=void 0}o&&(i=o.referrer,n=o.lang,o=o.appId,window.TEAVisualEditor.__editor_ajax_domain=i||"",window.TEAVisualEditor.__ab_appId=o||"",window.TEAVisualEditor.lang=n||"",loadEditorScript({event:e,editorUrl:VISUAL_URL_INSPECTOR+".js?query="+Date.now(),collectInstance:t}))})},loadVisual=function(t){window.TEAVisualEditor=window.TEAVisualEditor||{},window.TEAVisualEditor.__ab_config=t,loadScript(VISUAL_AB_LOADER+"?query="+Date.now(),function(){},function(){})},STORAGE_EXPRIRE=(!function(t){t[t.Var=0]="Var",t[t.All=1]="All"}(CallbackType=CallbackType||{}),2592e6),API="/service/2/abtest_config/",Ab=function(){function t(){this.fetchStatus="no",this.refreshFetchStatus="complete",this.versions=[],this.extVersions=[],this.mulilinkVersions=[],this.enable_multilink=!1,this.enable_ab_visual=!1,this.editMode=!1,this.callbacks=[],this.data=null,this.changeListener=new Map,this.readyStatus=!1,this.exposureCache=[]}return t.prototype.apply=function(t,e){var i,n,o,r,s,a=this;this.collect=t,this.config=e,this.config.enable_ab_test&&(i=e.enable_multilink,o=e.ab_channel_domain,n=e.enable_ab_visual,o=o||decodeUrl(AB_DOMAINS[e.channel||"cn"]),s=(r=t.adapters).storage,r=r.fetch,this.cacheStorgae=new s(!1),this.fetch=r,this.enable_multilink=i,this.enable_ab_visual=n,this.abKey="__tea_sdk_ab_version_"+e.app_id,this.fetchUrl=""+o+API,this.reportUrl=""+t.configManager.getUrl("event"),this.exposureLimit=e.exposure_limit||20,this.ab_batch_time=e.ab_batch_time||500,s=this.collect.Types,this.types=s,this.collect.on(s.TokenChange,function(t){"uuid"===t&&a.readyStatus&&(a.clearCache(),a.fetchAB())}),this.collect.on(s.AbVar,function(t){var e=t.name,i=t.defaultValue,t=t.callback;a.getVar(e,i,t)}),this.collect.on(s.AbAllVars,function(t){a.getAllVars(t)}),this.collect.on(s.AbConfig,function(t){var e=t.params,t=t.callback;a.getABconfig(e,t)}),this.collect.on(s.AbExternalVersion,function(t){a.setExternalAbVersion(t)}),this.collect.on(s.AbOpenLayer,function(){a.openOverlayer()}),this.collect.on(s.AbCloseLayer,function(){a.closeOverlayer()}),this.collect.on(s.AbVersionChangeOn,function(t){a.changeListener.set(t,t)}),this.collect.on(s.AbVersionChangeOff,function(t){a.changeListener.get(t)&&a.changeListener.delete(t)}),this.loadMode(),(this.enable_ab_visual||this.enable_multilink)&&this.openOverlayer(this.config.multilink_timeout_ms||500),this.checkLocal(),this.ready("ab"),this.readyStatus||(this.fetchAB(),this.readyStatus=!0),this.collect.emit(s.AbReady))},t.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var i=this.collect.hook._hooksCache[t];if(Object.keys(i).length)for(var n in i)!function(t){i[t].length&&i[t].forEach(function(i){e.collect.hook.emit(t,i)})}(n)}},t.prototype.loadMode=function(){var t,e=getIframeUrl(),i="";e&&(t=e.scenario,e=e.href,t?(this.editMode=!0,i=t):e&&(-1!==e.indexOf("datatester")||-1!==e.indexOf("visual-editor"))&&(this.editMode=!0,i="visual-editor")),this.enable_ab_visual&&(readyToLoadEditor(this.collect,this.config),"visual-editor"===i)?this.collect.destoryInstace():this.enable_multilink&&loadMuiltlink(this.collect,this.config)},t.prototype.checkLocal=function(){var t=this.getABCache(),e=t.ab_version,i=t.ab_ext_version,n=t.ab_version_multilink,t=t.data,o=this.checkFromUrl(),o=(o?this.mulilinkVersions.push(o):this.mulilinkVersions=n||[],this.extVersions=i||[],this.versions=e||[],this.data=t,this.versions.concat(this.extVersions));this.enable_multilink&&(o=o.concat(this.mulilinkVersions)),this.configVersions(o.join(","))},t.prototype.checkFromUrl=function(){var t=parseUrlQuery(window.location.href);return t&&t.vid?t.vid:""},t.prototype.updateVersions=function(){var t=this.extVersions.length?this.versions.concat(this.extVersions):this.versions,e=t.concat(this.mulilinkVersions);this.configVersions(e.join(",")),this.updateABCache(),0<this.changeListener.size&&this.changeListener.forEach(function(e){"function"==typeof e&&e(t)})},t.prototype.configVersions=function(t){this.collect.configManager.setAbVersion(t)},t.prototype.getVar=function(t,e,i){if(!t)throw Error("variable must not be empty");if(void 0===e)throw Error("variable no default value");if("function"!=typeof i)throw Error("callback must be a function");e={name:t,defaultValue:e,callback:i,type:CallbackType.Var},"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealVar(e,t):this.callbacks.push(e)},t.prototype.getRealVar=function(t,e){var i,n=t.name,o=t.defaultValue,t=t.callback,r=this.data;r?isObject(r[n])?(i=r[n].vid,"$ab_url"===e?this.mulilinkVersions.includes(i)||this.mulilinkVersions.push(i):this.versions.includes(i)||this.versions.push(i),this.updateVersions(),this.fechEvent(i,e,o),t(r[n].val),this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 曝光了实验"+n,level:"info",time:Date.now(),data:r[n]})):(this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getVar",level:"info",time:Date.now(),data:o}),t(o)):t(o)},t.prototype.getAllVars=function(t){if("function"!=typeof t)throw Error("callback must be a function");t={callback:t,type:CallbackType.All},"complete"===this.fetchStatus&&"complete"===this.refreshFetchStatus?this.getRealAllVars(t):this.callbacks.push(t)},t.prototype.getRealAllVars=function(t){(0,t.callback)(this.data?JSON.parse(JSON.stringify(this.data)):{}),this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"SDK 调用getAllVars",level:"info",time:Date.now(),data:this.data})},t.prototype.fechEvent=function(t,e,i){try{var n,o,r,s,a,c;this.config.disable_track_event||t&&(o=(n=this.collect.configManager.get()).header,r=n.user,(s=this.getABCache())&&s.uuid&&s.uuid!==r.user_unique_id||(a={event:"abtest_exposure",ab_sdk_version:""+t,params:JSON.stringify({app_id:this.config.appId,ab_url:"$ab_url"===e?i:window.location.href}),local_time_ms:Date.now()},o.custom=JSON.stringify(o.custom),c={events:[a],user:r,header:o},"$ab_url"===e&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify([c])):this.reportExposure(c)))}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.reportExposure=function(t){var e=this;this.exposureCache.push(t),this.reportTimeout&&clearTimeout(this.reportTimeout),this.exposureCache.length>=this.exposureLimit?this.report():this.reportTimeout=setTimeout(function(){e.report(),clearTimeout(e.reportTimeout)},this.ab_batch_time)},t.prototype.report=function(){var t=this;this.fetch(this.reportUrl,this.exposureCache,2e4),this.exposureCache.forEach(function(e){t.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:[e],code:200,status:"success"})}),this.exposureCache=[]},t.prototype.setExternalAbVersion=function(t){this.extVersions=[t],this.updateVersions()},t.prototype.getABconfig=function(t,e){var i=Object.keys(t);i&&i.length&&this.collect.configManager.set(t),this.fetchAB(e)},t.prototype.getABCache=function(t){var e={ab_version:[],ab_ext_version:[],ab_version_multilink:[],data:null,timestamp:+new Date,uuid:""},e=this.cacheStorgae.getItem(this.abKey)||e;return Date.now()-e.timestamp>=STORAGE_EXPRIRE?(this.cacheStorgae.removeItem(this.abKey),null):t?e[t]:e},t.prototype.updateABCache=function(){var t=this.getABCache();t.ab_version_multilink=this.mulilinkVersions,t.ab_ext_version=this.extVersions,t.ab_version=this.versions,t.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,t)},t.prototype.setAbCache=function(t){var e=this.getABCache();e.data=this.data,e.uuid=t,e.timestamp=Date.now(),this.cacheStorgae.setItem(this.abKey,e),this.collect.configManager.setAbData(this.data)},t.prototype.clearCache=function(){this.refreshFetchStatus="ing",this.data={},this.extVersions=[],this.mulilinkVersions=[],this.versions=[]},t.prototype.openOverlayer=function(t){var e,i=this;openOverlayer(),t&&(e=setTimeout(function(){i.closeOverlayer(),clearTimeout(e)},t))},t.prototype.closeOverlayer=function(){closeOverlayer()},t.prototype.fetchComplete=function(t,e){var i=this;if(t&&"[object Object]"==Object.prototype.toString.call(t)){this.data=t,this.setAbCache(e);var n,o,r=[],e=(Object.keys(t).forEach(function(e){(e=t[e].vid)&&r.push(e)}),this.versions=this.versions.filter(function(t){return r.includes(t)}),t.$ab_url),s=t.$ab_modification;if(s&&s.val&&this.enable_ab_visual){if(this.collect.destroyInstance)return;this.getVar("$ab_modification",window.location.href,function(){loadVisual(s.val)})}else e&&this.enable_multilink&&(this.mulilinkVersions=this.mulilinkVersions.filter(function(t){return r.includes(t)}),n=e.val,o=e.vid,n)&&o&&this.getVar("$ab_url",n,function(){i.editMode||n!==window.location.href&&setTimeout(function(){var t;i.collect.destroyInstance||(parseURL(t=-1===(t=""+n).indexOf("http")?"https://"+t:t).host!==location.host&&(t=t+"&vid="+o),window.history.replaceState("","",t),window.location.href=t)},100)});this.updateVersions()}this.callbacks.forEach(function(t){return i[t.type===CallbackType.Var?"getRealVar":"getRealAllVars"](t,"")}),this.callbacks=[]},t.prototype.fetchAB=function(t){var e=this,i=window.location.href,n=this.collect.configManager.get(),i={header:_assign({aid:this.config.app_id},n.user||{},n.header||{},{ab_sdk_version:this.collect.configManager.getAbVersion(),ab_url:i})};this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 发起AB实验请求",level:"info",logType:"fetch",time:Date.now(),data:i}),this.fetch(this.fetchUrl,i,this.config.ab_timeout||3e3,!1,function(i){e.fetchStatus="complete",e.refreshFetchStatus="complete";var o=i.data;"success"===i.message?(e.fetchComplete(o,n.user.user_unique_id),t&&t(o)):(e.fetchComplete(null,n.user.user_unique_id),t&&t(null)),e.collect.emit(e.types.AbComplete,o),e.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求成功",level:"info",logType:"fetch",time:Date.now(),data:o})},function(){e.fetchStatus="complete",e.refreshFetchStatus,e.fetchComplete(null,n.user.user_unique_id),t&&t(null),e.collect.emit(e.types.AbComplete,null),e.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,secType:"AB",info:"AB实验请求网络异常",level:"error",logType:"fetch",time:Date.now()})})},t.prototype.filterUrl=function(t){try{var e="",i=(-1!==t.indexOf("&multilink=true")?e="&multilink=true[\0-\xff]*":-1!==t.indexOf("?multilink=true")&&(e="\\?multilink=true[\0-\xff]*"),RegExp(e,"g"));t=t.replace(i,"")}catch(t){}return t},t}(),Et=function(){function t(){}return t.prototype.apply=function(t,e){var i=this,n=t.adapters.fetch;e.event_verify_url&&"string"==typeof e.event_verify_url&&(this.url=e.event_verify_url+"/v1/list_test",this.url&&(e=t.Types,t.on(e.SubmitBefore,function(t){n(i.url,t,3e4)})))},t}(),Alive=function(){function t(t,e){this.maxDuration=432e5,this.aliveDTime=6e4,this.options={aliveName:"predefine_page_alive",params:{}},this.collect=t,this.config=e,this.pageStartTime=Date.now(),this.sessionStartTime=this.pageStartTime,this.timerHandler=null,isObject(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration))}return t.prototype.setParams=function(t,e,i){this.set_path=t,this.set_url=i,this.set_title=e},t.prototype.enable=function(t,e,i){this.url_path=t,this.url=i,this.title=e,this.disableCallback=this.enablePageAlive()},t.prototype.disable=function(){this.disableCallback(),this.pageStartTime=Date.now()},t.prototype.sendEvent=function(t,e){(e=(e=void 0!==e&&e)?this.aliveDTime:Date.now()-this.sessionStartTime)<0||e>this.aliveDTime||Date.now()-this.pageStartTime>this.maxDuration||(this.collect.beconEvent(this.options.aliveName,_assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),duration:e,is_support_visibility_change:isSupVisChange(),startTime:this.sessionStartTime,hidden:document.visibilityState,leave:t},this.options.params)),this.sessionStartTime=Date.now())},t.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.setUpTimer=function(){var t=this;return this.timerHandler&&clearInterval(this.timerHandler),setInterval(function(){Date.now()-t.sessionStartTime>t.aliveDTime&&t.sendEvent(!1,!0)},1e3)},t.prototype.visibilitychange=function(){"hidden"===document.visibilityState?this.timerHandler&&(clearInterval(this.timerHandler),this.sendEvent(!1)):"visible"===document.visibilityState&&(this.sessionStartTime=Date.now(),this.timerHandler=this.setUpTimer())},t.prototype.beforeunload=function(){document.hidden||this.sendEvent(!0)},t.prototype.enablePageAlive=function(){var t=this,e=(this.timerHandler=this.setUpTimer(),this.visibilitychange.bind(this)),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",e),beforePageUnload(i),function(){t.beforeunload(),document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},t}(),Close=function(){function t(t,e){var i=this;this.maxDuration=432e5,this.aliveDTime=6e4,this.options={closeName:"predefine_page_close",params:{}},this.visibilitychange=function(){"hidden"===document.visibilityState?i.activeEndTime=Date.now():"visible"===document.visibilityState&&(i.activeEndTime&&(i.totalTime+=i.activeEndTime-i.activeStartTime,i.activeTimes+=1),i.activeEndTime=void 0,i.activeStartTime=Date.now())},this.beforeunload=function(){if(i.totalTime+=(i.activeEndTime||Date.now())-i.activeStartTime,i.config.autotrack)try{window.sessionStorage.setItem("_tea_cache_duration",JSON.stringify({duration:i.totalTime,page_title:document.title||location.pathname}))}catch(t){}i.sendEventPageClose()},this.collect=t,this.config=e,this.maxDuration=e.maxDuration||864e5,this.pageStartTime=Date.now(),isObject(e.enable_stay_duration)&&(this.options=Object.assign(this.options,e.enable_stay_duration)),this.resetData()}return t.prototype.setParams=function(t,e,i){this.set_path=t,this.set_url=i,this.set_title=e},t.prototype.enable=function(t,e,i){this.url_path=t,this.url=i,this.title=e,this.disableCallback=this.enablePageClose()},t.prototype.disable=function(){this.disableCallback()},t.prototype.resetData=function(){this.activeStartTime=void 0===this.activeStartTime?this.pageStartTime:Date.now(),this.activeEndTime=void 0,this.activeTimes=1,this.totalTime=0},t.prototype.sendEventPageClose=function(){var t=Date.now()-this.pageStartTime;this.totalTime<0||t<0||this.totalTime>=this.maxDuration||(this.collect.beconEvent(this.options.closeName,_assign({url_path:this.getParams("url_path"),title:this.getParams("title"),url:this.getParams("url"),active_times:this.activeTimes,duration:this.totalTime,total_duration:t,is_support_visibility_change:isSupVisChange()},this.options.params)),this.pageStartTime=Date.now(),this.resetData())},t.prototype.getParams=function(t){switch(t){case"url_path":return this.set_path||this.url_path||location.pathname;case"title":return this.set_title||this.title||document.title||location.pathname;case"url":return this.set_url||this.url||location.href}},t.prototype.enablePageClose=function(){var t=this,e=this.visibilitychange.bind(this),i=this.beforeunload.bind(this);return document.addEventListener("visibilitychange",e),beforePageUnload(i),function(){t.beforeunload(),document.removeEventListener("visibilitychange",e),window.removeEventListener("beforeunload",i),window.removeEventListener("pagehide",i)}},t}(),Stay=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;this.collect=t,this.config=e,this.config.enable_stay_duration&&(this.title=document.title||location.pathname,this.url=location.href,this.url_path=location.pathname,this.pageAlive=new Alive(t,e),this.pageClose=new Close(t,e),t=this.collect.Types,this.collect.on(t.ResetStay,function(t){var e=t.url_path,n=t.title,t=t.url;i.resetStayDuration(e,n,t)}),this.collect.on(t.RouteChange,function(t){t.init||e.disable_route_report||i.resetStayDuration()}),this.collect.on(t.SetStay,function(t){var e=t.url_path,n=t.title,t=t.url;i.setStayParmas(e,n,t)}),this.enable(this.url_path,this.title,this.url),this.ready(t.Stay),this.collect.emit(t.StayReady))},t.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var i=this.collect.hook._hooksCache[t];if(Object.keys(i).length)for(var n in i)!function(t){i[t].length&&i[t].forEach(function(i){e.collect.hook.emit(t,i)})}(n)}},t.prototype.enable=function(t,e,i){this.pageAlive.enable(t,e,i),this.pageClose.enable(t,e,i)},t.prototype.disable=function(){this.pageAlive.disable(),this.pageClose.disable()},t.prototype.setStayParmas=function(t,e,i){this.pageAlive.setParams(t=void 0===t?"":t,e=void 0===e?"":e,i=void 0===i?"":i),this.pageClose.setParams(t,e,i),this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayParams",level:"info",time:Date.now(),data:{url_path:t,title:e,url:i}})},t.prototype.reset=function(t,e,i){this.disable(),this.enable(t,e,i)},t.prototype.resetStayDuration=function(t,e,i){this.reset(t,e,i),this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"SDK 执行 resetStayDuration",level:"info",time:Date.now(),data:{url_path:t,title:e,url:i}})},t}(),Profile=function(){function t(){}return t.prototype.apply=function(t,e){var i=this,n=(this.collect=t,this.config=e,this.duration=6e4,this.reportUrl=t.configManager.getDomain()+"/profile/list",t.Types),o=t.adapters.fetch;this.eventCheck=new EventCheck(t,e),this.fetch=o,this.cache={},this.collect.on(n.ProfileSet,function(t){i.setProfile(t)}),this.collect.on(n.ProfileSetOnce,function(t){i.setOnceProfile(t)}),this.collect.on(n.ProfileUnset,function(t){i.unsetProfile(t)}),this.collect.on(n.ProfileIncrement,function(t){i.incrementProfile(t)}),this.collect.on(n.ProfileAppend,function(t){i.appendProfile(t)}),this.collect.on(n.ProfileClear,function(){i.cache={}}),this.ready(n.Profile)},t.prototype.ready=function(t){var e=this;if(this.collect.set(t),this.collect.hook._hooksCache.hasOwnProperty(t)){var i=this.collect.hook._hooksCache[t];if(Object.keys(i).length)for(var n in i)!function(t){i[t].length&&i[t].forEach(function(i){e.collect.hook.emit(t,i)})}(n)}},t.prototype.report=function(t,e){void 0===e&&(e={});try{var i,n;this.config.disable_track_event||((i=[]).push(this.collect.processEvent(t,e)),n=this.collect.eventManager.merge(i),this.fetch(this.reportUrl,n),this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_EVENT,info:"埋点上报成功",time:Date.now(),data:n,code:200,status:"success"}))}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.setProfile=function(t){(t=this.formatParams(t))&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set",_assign({},t,{profile:!0})))},t.prototype.setOnceProfile=function(t){(t=this.formatParams(t,!0))&&Object.keys(t).length&&(this.pushCache(t),this.report("__profile_set_once",_assign({},t,{profile:!0})))},t.prototype.incrementProfile=function(t){t&&this.report("__profile_increment",_assign({},t,{profile:!0}))},t.prototype.unsetProfile=function(t){var e;t&&((e={})[t]="1",this.report("__profile_unset",_assign({},e,{profile:!0})))},t.prototype.appendProfile=function(t){if(t){var e,i={};for(e in t)("string"==typeof t[e]||"Array"===Object.prototype.toString.call(t[e]).slice(8,-1))&&(i[e]=t[e]);Object.keys(i).length&&this.report("__profile_append",_assign({},i,{profile:!0}))}},t.prototype.pushCache=function(t){var e=this;Object.keys(t).forEach(function(i){e.cache[i]={val:e.clone(t[i]),timestamp:Date.now()}})},t.prototype.formatParams=function(t,e){var i=this;void 0===e&&(e=!1);try{if(t&&"[object Object]"===Object.prototype.toString.call(t)){var n,o={};for(n in t)("string"==typeof t[n]||"number"==typeof t[n]||"Array"===Object.prototype.toString.call(t[n]).slice(8,-1))&&(o[n]=t[n]);var r,s=Object.keys(o);if(s.length&&this.eventCheck.checkEventParams(o))return r=Date.now(),s.filter(function(n){var o=i.cache[n];return e?!o:!(o&&i.compare(o.val,t[n])&&r-o.timestamp<i.duration)}).reduce(function(t,e){return t[e]=o[e],t},{})}}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.compare=function(t,e){try{return JSON.stringify(t)===JSON.stringify(e)}catch(t){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),!1}},t.prototype.clone=function(t){try{return JSON.parse(JSON.stringify(t))}catch(e){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),t}},t.prototype.unReady=function(){},t}(),HeartBeat=function(){function t(){var t=this;this.setInterval=function(){t.clearIntervalFunc=selfAdjust(function(){t.isSessionhasEvent&&t.endCurrentSession()},t.sessionInterval)},this.clearInterval=function(){t.clearIntervalFunc&&t.clearIntervalFunc()}}return t.prototype.apply=function(t,e){var i=this;this.collect=t,e.disable_heartbeat||(this.sessionInterval=6e4,this.startTime=0,this.lastTime=0,this.setInterval(),t=this.collect.Types,this.collect.on(t.SessionReset,function(){i.process()}))},t.prototype.endCurrentSession=function(){this.collect.event("_be_active",{start_time:this.startTime,end_time:this.lastTime,url:window.location.href,referrer:window.document.referrer,title:document.title||location.pathname}),this.isSessionhasEvent=!1,this.startTime=0},t.prototype.process=function(){this.isSessionhasEvent||(this.isSessionhasEvent=!0,this.startTime=+new Date);var t=this.lastTime||+new Date;this.lastTime=+new Date,this.lastTime-t>this.sessionInterval&&(this.clearInterval(),this.endCurrentSession(),this.setInterval())},t}(),Monitor$1=function(){function t(){}return t.prototype.apply=function(t,e){var i,n=this;this.collect=t,this.config=e,this.config.channel_domain||(i=t.adapters.fetch,this.fetch=i,e.disable_track_event)||e.disable_sdk_monitor||(this.url=t.configManager.getUrl("event"),i=this.collect.Types,this.collect.on(i.Ready,function(){n.sdkOnload()}),this.collect.on(i.SubmitError,function(t){var e=t.type,i=t.eventData,t=t.errorCode;"f_data"===e&&n.sdkError(i,t)}))},t.prototype.sdkOnload=function(){var t=this;try{var e=this.collect.configManager.get(),i=e.header,n=e.user,o=i.app_id,r=i.app_name,s=i.sdk_version,a=n.web_id,c={events:[{event:"onload",params:JSON.stringify({app_id:o,app_name:r||"",sdk_version:s,sdk_type:SDK_TYPE,sdk_config:this.config,sdk_desc:"TOC"}),local_time_ms:Date.now()}],user:{user_unique_id:a},header:{}};setTimeout(function(){t.fetch(t.url,[c],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(t){}},t.prototype.sdkError=function(t,e){var i=this;try{var n=t[0],o=n.user,r=n.header,s=[],a=(t.forEach(function(t){t.events.forEach(function(t){s.push(t)})}),{events:s.map(function(t){return{event:"on_error",params:JSON.stringify({error_code:e,app_id:r.app_id,app_name:r.app_name||"",error_event:t.event,sdk_version:r.sdk_version,local_time_ms:t.local_time_ms,tea_event_index:Date.now(),params:t.params,header:JSON.stringify(r),user:JSON.stringify(o)}),local_time_ms:Date.now()}}),user:{user_unique_id:o.user_unique_id},header:{}});setTimeout(function(){i.fetch(i.url,[a],3e4,!1,function(){},function(){},"566f58151b0ed37e")},16)}catch(t){}},t}();function isNeedElement(t,e){if(void 0===e&&(e="list"),t){if(e&&"list"===e){if(["LI","TR","DL"].includes(t.nodeName)||t.dataset&&t.dataset.hasOwnProperty("teaIdx")||t.hasAttribute&&t.hasAttribute("data-tea-idx"))return 1}else if(["A","BUTTON"].includes(t.nodeName)||t.dataset&&t.dataset.hasOwnProperty("teaContainer")||t.hasAttribute&&t.hasAttribute("data-tea-container"))return 1}}var isAttrFilter=function(t,e){return!!hasAttributes(t,e)};function getContainer(t){for(var e=t;e&&!isNeedElement(e,"container");){if("HTML"===e.nodeName||"BODY"===e.nodeName)return t;e=e.parentElement}return e||t}function getNodeText(t){var e="";return 3===t.nodeType?e=t.textContent.trim():t.dataset&&t.dataset.hasOwnProperty("teaTitle")||t.hasAttribute("ata-tea-title")?e=t.getAttribute("data-tea-title"):t.hasAttribute("title")?e=t.getAttribute("title"):"INPUT"===t.nodeName&&["button","submit"].includes(t.getAttribute("type"))?e=t.getAttribute("value"):"IMG"===t.nodeName&&t.getAttribute("alt")&&(e=t.getAttribute("alt")),e.slice(0,200)}function getText(t){var t=getContainer(t),e=[];return function t(i){var n=getNodeText(i);if(n&&-1===e.indexOf(n)&&e.push(n),0<i.childNodes.length)for(var o=i.childNodes,r=0;r<o.length;r++)8!==o[r].nodeType&&t(o[r])}(t),e}function getTextSingle(t){var t=getContainer(t),e="";return function t(i){var n=getNodeText(i);if(n&&(e+=n),0<i.childNodes.length)for(var o=i.childNodes,r=0;r<o.length;r++)3===o[r].nodeType&&t(o[r])}(t),e}function ignore(t){for(var e=t;e&&e.parentNode;){if(e.hasAttribute("data-tea-ignore"))return 1;if("HTML"===e.nodeName||"body"===e.nodeName)return;e=e.parentNode}}var hasAttribute=function(t,e){return t.hasAttribute?t.hasAttribute(e):t.attributes?!(!t.attributes[e]||!t.attributes[e].specified):void 0},hasAttributes=function(t,e){if("string"==typeof e)return hasAttribute(t,e);if(isArray(e)){for(var i=!1,n=0;n<e.length;n++)if(hasAttribute(t,e[n])){i=!0;break}return i}},getAttributes=function(t,e){var i={};if("string"==typeof e)hasAttribute(t,e)&&(i.attrs=t.getAttribute(e));else if(isArray(e))for(var n=0;n<e.length;n++)hasAttribute(t,e[n])&&(i[e[n]]=t.getAttribute(e[n]));return i},elementLevel=function(t){return!t.children.length||(t=t.children,![].slice.call(t).some(function(t){return 0<t.children.length}))},isSVG=function(t){if("svg"===t.tagName.toLowerCase())return!0;for(var e=t.parentElement,i=!1;e;)"svg"===e.tagName.toLowerCase()?(e=null,i=!0):e=e.parentElement;return i};function isTrack(t,e){if(1===t.nodeType&&(e.svg||!isSVG(t))&&!["HTML","BODY"].includes(t.tagName.toUpperCase()))return"none"!==t.style.display&&(isNeedElement(t,"container")||elementLevel(t)||e.svg)}var Listener=function(){function t(t,e,i){var n=this;this.clickEvent=function(t){isTrack(t.target,n.options)&&n.eventHandel({eventType:"dom",eventName:"click"},t)},this.changeEvent=function(t){n.eventHandel({eventType:"dom",eventName:"change"},t)},this.submitEvent=function(t){n.eventHandel({eventType:"dom",eventName:"submit"},t)},this.getPageViewEvent=function(t,e){e&&"pushState"===e&&n.eventHandel({eventType:"dom",eventName:"beat"},_assign({beat_type:0},t)),n.eventHandel({eventType:"dom",eventName:"page_view"},t)},this.getPageLoadEvent=function(t){n.eventHandel({eventType:"dom",eventName:"page_statistics"},{lcp:t})},this.config=i.getConfig().eventConfig,this.collect=e,this.options=t,this.beatTime=t.beat,this.statistics=!1}return t.prototype.init=function(t){this.eventHandel=t,t=this.config.mode,this.addListener(t)},t.prototype.addListener=function(t){var e=this;if("proxy-capturing"===t&&(this.config.click&&window.document.addEventListener("click",this.clickEvent,!0),this.config.change&&window.document.addEventListener("change",this.changeEvent,!0),this.config.submit&&window.document.addEventListener("submit",this.submitEvent,!0),this.config.pv&&this.collect.on("route-change",function(t){var i=t.config,t=t.name;e.getPageViewEvent(i,t)}),this.config.beat)){try{"complete"===document.readyState?this.beatEvent(this.beatTime):window.addEventListener("load",function(){e.beatEvent(e.beatTime)});var i=0,n=null,o=(window.addEventListener("scroll",function(){clearTimeout(n),n=setTimeout(o,500),i=document.documentElement.scrollTop||document.body.scrollTop}),function(){(document.documentElement.scrollTop||document.body.scrollTop)==i&&e.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:1})})}catch(t){}try{var r=window.performance&&window.performance.getEntriesByType("paint");r&&r.length?(new PerformanceObserver(function(t){t=(t=(t=t.getEntries())[t.length-1]).renderTime||t.loadTime,e.statistics||(e.getPageLoadEvent(t),e.statistics=!0)}).observe({entryTypes:["largest-contentful-paint"]}),setTimeout(function(){e.statistics||(e.getPageLoadEvent(r[0].startTime||0),e.statistics=!0)},2e3)):this.getPageLoadEvent(0)}catch(t){this.getPageLoadEvent(0)}}},t.prototype.removeListener=function(){window.document.removeEventListener("click",this.clickEvent,!0),window.document.removeEventListener("change",this.changeEvent,!0),window.document.removeEventListener("submit",this.submitEvent,!0)},t.prototype.beatEvent=function(t){var e,i=this;try{this.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:3}),this.beatTime&&(e=setInterval(function(){i.eventHandel({eventType:"dom",eventName:"beat"},{beat_type:2})},t)),beforePageUnload(function(){i.eventHandel({eventType:"dom",eventName:"beat",eventSend:"becon"},{beat_type:0}),i.beatTime&&clearInterval(e)})}catch(t){}},t}(),defaultConfig={eventConfig:{mode:"proxy-capturing",submit:!1,click:!0,change:!1,pv:!0,beat:!0,hashTag:!1,impr:!1},scoutConfig:{mode:"xpath"}},Config=function(){function t(t,e){this.config=t,this.config.eventConfig=Object.assign(this.config.eventConfig,e)}return t.prototype.getConfig=function(){return this.config},t.prototype.setConfig=function(t){return this.config=t},t}();function getPositionData(t){var e,i;if(t)return e=(t=t.getBoundingClientRect()).width,i=t.height,{left:t.left,top:t.top,element_width:e,element_height:i}}function getEventData(t,e){var i=(t=void 0===t?{}:t).clientX,t=t.clientY,n=(e=void 0===e?{}:e).left,e=e.top,t=0<=t-e?t-e:0;return{touch_x:Math.floor(0<=i-n?i-n:0),touch_y:Math.floor(t)}}function getXpath(t){for(var e=[];null!==t.parentElement;)e.push(t),t=t.parentElement;var i=[],n=[];return e.forEach(function(t){var t=getXpathIndex(t),e=t.str,t=t.index;i.unshift(e),n.unshift(t)}),{element_path:"/"+i.join("/"),positions:n}}function getXpathIndex(t){if(null===t)return{str:"",index:0};var e=0,i=t.parentElement;if(i)for(var n=i.children,o=0;o<n.length&&n[o]!==t;o++)n[o].nodeName===t.nodeName&&e++;return{str:[t.nodeName.toLowerCase(),isNeedElement(t,"list")?"[]":""].join(""),index:e}}function getElementData(t,e,i,n){var o={},r=getPositionData(e),t=getEventData(t,r),s=r.element_width,r=r.element_height,a=t.touch_x,t=t.touch_y,c=getXpath(e),l=c.element_path,c=c.positions,h=getText(e),u=window.performance.timing.navigationStart,p=Date.now()-u,c=c.map(function(t){return""+t}),d=null;if(window.TEAVisualEditor&&window.TEAVisualEditor.getOriginXpath&&(d=window.TEAVisualEditor.getOriginXpath({xpath:l,positions:c})),o.element_path=d&&d.xpath||l,o.positions=d&&d.positions||c,n&&!n.text&&(o.texts=h,o.element_title=getTextSingle(e)),o.element_id=e.getAttribute("id")||"",o.element_class_name=e.getAttribute("class")||"",o.element_type=e.nodeType,o.element_width=Math.floor(s),o.element_height=Math.floor(r),o.touch_x=a,o.touch_y=t,o.page_manual_key="",o.elememt_manual_key="",o.since_page_start_ms=p,o.page_start_ms=u,o.page_path=location.pathname,o.page_host=location.host,i.track_attr&&isAttrFilter(e,i.track_attr)){var f,g=getAttributes(e,i.track_attr);for(f in g)o[f]=g[f]}return"A"===(l=getContainer(e)).tagName&&(o.href=l.getAttribute("href")),"IMG"===e.tagName&&(o.src=e.getAttribute("src")),o}var getEventData$1=function(t,e,i,n,o){return _assign({event:t},getElementData(e,i,n,o),{is_html:1,page_key:window.location.href,page_title:document.title})},getExtraEventData=function(t,e){try{if("bav2b_change"===t)return e.hasAttribute("data-tea-track")?{value:e.value}:{}}catch(t){return{}}},EventHandle=function(){function t(t,e){this.ignore={text:!1},this.initConfig=t,this.options=e,this.eventName=e&&"tea"===e.custom?{click:"__bav_click",page:"__bav_page",beat:"__bav_beat",static:"__bav_page_statistics",exposure:"__bav_page_exposure"}:{click:"bav2b_click",page:"bav2b_page",beat:"bav2b_beat",static:"bav2b_page_statistics",exposure:"bav2b_exposure"},e&&!1===e.text&&(this.ignore.text=!0),e&&e.exposure&&e.exposure.eventName&&(this.eventName.exposure=e.exposure.eventName)}return t.prototype.handleEvent=function(t,e){try{if(ignore(t.target))return null;var i="bav2b_click";switch(e){case"click":return i=this.eventName.click,getEventData$1(i,t,t.target,this.options,this.ignore);case"exposure":return i=this.eventName.exposure,getEventData$1(i,t,t.target,this.options,this.ignore);case"change":return _assign({},getEventData$1(i="bav2b_change",t,t.target,this.options),getExtraEventData(i,t.target));case"submit":return getEventData$1(i="bav2b_submit",t,t.target,this.options)}}catch(t){return null}},t.prototype.handleViewEvent=function(t){t.event=this.eventName.page,t.page_title=document.title,t.page_total_width=window.innerWidth,t.page_total_height=window.innerHeight;try{var e,i=window.sessionStorage.getItem("_tea_cache_duration");i&&(e=JSON.parse(i),t.refer_page_duration_ms=e?e.duration:""),t.scroll_width=document.documentElement.scrollLeft?document.documentElement.scrollLeft+window.innerWidth:window.innerWidth,t.scroll_height=document.documentElement.scrollTop?document.documentElement.scrollTop+window.innerHeight:window.innerHeight,t.page_start_ms=window.performance.timing.navigationStart}catch(t){}return t},t.prototype.handleStatisticsEvent=function(t){var e={};e.event=this.eventName.static,e.is_html=1,e.page_key=location.href,e.refer_page_key=document.referrer||"",e.page_title=document.title,e.page_manual_key=this.initConfig.autotrack.page_manual_key||"",e.refer_page_manual_key="";try{var i=t.lcp,n=window.performance.timing,o=n.loadEventEnd-n.navigationStart;e.page_init_cost_ms=parseInt(i||(0<o?o:0)),e.page_start_ms=n.navigationStart}catch(t){}return e},t.prototype.handleBeadtEvent=function(t){t.event=this.eventName.beat,t.page_key=window.location.href,t.is_html=1,t.page_title=document.title,t.page_manual_key=this.initConfig.autotrack.page_manual_key||"";try{t.page_viewport_width=window.innerWidth,t.page_viewport_height=window.innerHeight,t.page_total_width=document.documentElement.scrollWidth,t.page_total_height=document.documentElement.scrollHeight,t.scroll_width=document.documentElement.scrollLeft+window.innerWidth,t.scroll_height=document.documentElement.scrollTop+window.innerHeight,t.since_page_start_ms=Date.now()-window.performance.timing.navigationStart,t.page_start_ms=window.performance.timing.navigationStart}catch(t){}return t},t}(),Request=function(){function t(t){this.collect=t,this.eventNameList=["report_click_event","report_change_event","report_submit_event","report_exposure_event","report_page_view_event","report_page_statistics_event","report_beat_event"]}return t.prototype.send=function(t,e){var t=t.eventSend,i=e.event;delete e.event,t&&"becon"===t?this.collect.beconEvent(i,e):this.collect.event(i,e)},t.prototype.get=function(t,e){fetch(t,e=Object.assign({headers:{"content-type":"application/json"},method:"GET"},e))},t.prototype.post=function(t,e){fetch(t,e=Object.assign({headers:{"content-type":"application/json"},method:"POST"},e))},t}(),COOKIE_KEY="_TEA_VE_OPEN",COOKIE_KEY_HOST="_TEA_VE_APIHOST",COOKIE_LANG="lang",COOKIE_EDIT_VERISON="_VISUAL_EDITOR_V",COOKIE_EDIT_URL="_VISUAL_EDITOR_U";function checkSession(){return"1"===js_cookie.get(COOKIE_KEY)}function checkSessionHost(){var t=js_cookie.get(COOKIE_KEY_HOST);try{t=JSON.parse(t)}catch(t){}return t}function checkEditUrl(){return js_cookie.get(COOKIE_EDIT_URL)}function setSession(){try{var t=window.TEAVisualEditor.lang=window.TEAVisualEditor.lang||js_cookie.get(COOKIE_LANG),e=window.TEAVisualEditor.__editor_ajax_domain=window.TEAVisualEditor.__editor_ajax_domain||js_cookie.get(COOKIE_KEY_HOST),i=window.TEAVisualEditor.__editor_verison=window.TEAVisualEditor.__editor_verison||js_cookie.get(COOKIE_EDIT_VERISON),n=window.TEAVisualEditor.__editor_url=window.TEAVisualEditor.__editor_url||js_cookie.get(COOKIE_EDIT_URL),o=+new Date,r=new Date(18e5+o);js_cookie.set(COOKIE_KEY,"1",{expires:r}),js_cookie.set(COOKIE_KEY_HOST,e,{expires:r}),js_cookie.set(COOKIE_EDIT_URL,n,{expires:r}),js_cookie.set(COOKIE_LANG,t,{expires:r}),js_cookie.set(COOKIE_EDIT_VERISON,i||"",{expires:r})}catch(t){}}var isLoaded$1=!1;function loadEditorScript$1(t){var e=t.event,i=t.editorUrl,n=t.autoTrackInstance;isLoaded$1||(isLoaded$1=!0,loadScript(i,function(){dispatchMsg(e,"editorScriptloadSuccess"),n.destroy()},function(){e&&dispatchMsg(e,"editorScriptloadError"),isLoaded$1=!1}))}function readyToLoadEditor$1(t,e){window.TEAVisualEditor=window.TEAVisualEditor||{};var i="",n=VISUAL_EDITOR_RANGERS+"?query="+Date.now(),o=(window.TEAVisualEditor.appId=e.app_id,e.channel_domain),r="";if(addAllowdOrigin(["*"]),o){var s,a="";try{var c=window.performance.getEntriesByType("resource");if(c&&c.length&&(c.forEach(function(t){"script"===t.initiatorType&&t.name&&-1!==t.name.indexOf("collect")&&(a=t.name)}),a)&&(s=a.split("/"))&&s.length){r="https:/";for(var l=2;l<s.length&&l!==s.length-1;l++)r=r+"/"+s[l];r&&r.indexOf("/5.0")&&(r=r.split("/5.0")[0]||r)}}catch(t){}}if(init(e,SDK_VERSION),checkSession()){var c=checkSessionHost(),h="";c&&(window.TEAVisualEditor.__editor_ajax_domain=c,h=checkEditUrl()),loadEditorScript$1({event:null,editorUrl:h||n,autoTrackInstance:t}),setSession()}else try{receiveMsg("tea:openVisualEditor",function(e){var s,a,c=e.data;if("string"==typeof e.data)try{c=JSON.parse(e.data)}catch(t){c=void 0}c&&(a=c.referrer,s=c.lang,a&&(window.TEAVisualEditor.__editor_ajax_domain=a),i=n,o&&(a=c.version,i=r?r+(a?"/visual-editor-rangers-v"+a:"/visual-editor-rangers-v1.0.0")+".js":n,window.TEAVisualEditor.__editor_verison=a),window.TEAVisualEditor.__editor_url=i,window.TEAVisualEditor.lang=s,loadEditorScript$1({event:e,editorUrl:i,autoTrackInstance:t}),setSession())}),window.TEAVisualEditor.openAutotrackEditor=function(){loadEditorScript$1({event:null,editorUrl:window.TEAVisualEditor.__editor_url,autoTrackInstance:t})}}catch(t){}try{receiveMsg("tea:openHeatMapCore",function(i){var n=i.data.app_id;n&&n!==e.app_id||loadEditorScript$1({event:i,editorUrl:HOT_PIC_URL+".js?query="+Date.now(),autoTrackInstance:t})})}catch(t){}}var State,Observer=function(){function t(t){this._instance=null,this._intersection=t,this.init()}return t.prototype.init=function(){var t=this;this._instance=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&t.attributeChangeObserve(e),"childList"===e.type&&t.modifyNodeObserve(e)})}),this._instance.observe(document.body,{childList:!0,attributes:!0,subtree:!0,attributeOldValue:!1})},t.prototype.attributeChangeObserve=function(t){t.target.hasAttribute("data-exposure")?this.exposureAdd(t,"mutation"):this.exposureRemove(t)},t.prototype.modifyNodeObserve=function(t){var e=this;Array.prototype.forEach.call(t.addedNodes,function(t){1===t.nodeType&&t.hasAttribute("data-exposure")&&e.exposureAdd(t,"intersect"),e.mapChild(t,e.exposureAdd)}),Array.prototype.forEach.call(t.removedNodes,function(t){1===t.nodeType&&t.hasAttribute("data-exposure")&&e.exposureRemove(t),e.mapChild(t,e.exposureRemove)})},t.prototype.mapChild=function(t,e){var i=this;1===t.nodeType&&t.children.length&&Array.prototype.forEach.call(t.children,function(t){1===t.nodeType&&t.hasAttribute("data-exposure")&&e(t),i.mapChild(t,e)})},t.prototype.exposureAdd=function(t,e){this._intersection.exposureAdd(t,e)},t.prototype.exposureRemove=function(t){this._intersection.exposureRemove(t)},t._exposure_observer=null,t}(),Intersection=function(){function t(e,i){this.count=1,this.instance=this.buildObserver(),this.observeMap=t._observer_map,e.autotrack.exposure.ratio?this.Ratio=e.autotrack.exposure.ratio:0===e.autotrack.exposure.ratio?this.Ratio=0:this.Ratio=.5,this.EventHandle=i}return t.prototype.buildObserver=function(){var e=this;if(!t._observer_instance)return t._observer_instance=IntersectionObserver?new IntersectionObserver(function(t){t.forEach(function(t){e.observeMap.get(t.target._observeId)&&e.exposureEvent(t)})},{threshold:[.01,.25,.5,.75,1]}):t._observer_instance},t.prototype.exposureAdd=function(t,e){var i,n,o,r=t,e=(r="mutation"===e?t.target:r)._observeId;e||this.observeMap.has(e)?!1===r.visible&&(i=(e=r.getBoundingClientRect()).top,n=e.left,o=e.right,e=e.bottom,0<=i)&&e<=window.innerHeight&&0<=n&&o<=window.innerWidth&&(r.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},t)):(r._observeId=this.count,r.visible=!1,this.observeMap.set(this.count,r),this.observe(r),this.count++)},t.prototype.exposureRemove=function(t){this.observeMap.has(t._observeId)&&(this.observeMap.delete(t._observeId),this.unobserve(t))},t.prototype.exposureEvent=function(t){t.intersectionRatio>=this.Ratio&&t.isIntersecting?"0"!==t.target.style.opacity&&"hidden"!==t.target.style.visibility&&!0!==t.target.visible&&(t.target.visible=!0,this.EventHandle({eventType:"dom",eventName:"exposure"},t)):t.target.visible=!1},t.prototype.observe=function(t){this.instance.observe(t)},t.prototype.unobserve=function(t){this.instance.unobserve(t)},t._observer_instance=null,t._observer_map=new Map,t}(),Exposure=function(){function t(t,e){t.autotrack&&t.autotrack.exposure&&(this._intersection=new Intersection(t,e),this._observer=new Observer(this._intersection),this.initObserver())}return t.prototype.initObserver=function(){var t=this;Array.prototype.forEach.call(document.querySelectorAll("[data-exposure]"),function(e){t._intersection.exposureAdd(e,"intersect")})},t}(),defaultOpt={hashTag:!1,impr:!1},AutoTrack=function(){function t(){}return t.prototype.apply=function(t,e){this.autoTrackStart=!1,this.collect=t,(this.config=e).autotrack&&(t=t.Types,e.autotrack&&e.autotrack.collect_url&&!e.autotrack.collect_url()||(this.ready(t.Autotrack),this.collect.emit(t.AutotrackReady)))},t.prototype.ready=function(t){this.collect.set(t),t=Object.assign(defaultOpt,t="object"==_typeof(t=this.config.autotrack)?t:{}),this.destroyed=!1,this.options=t,this.Config=new Config(defaultConfig,this.options),this.Exposure=new Exposure(this.config,this.handle.bind(this)),this.Listener=new Listener(t,this.collect,this.Config),this.EventHandle=new EventHandle(this.config,t),this.Request=new Request(this.collect),this.autoTrackStart=!0,this.init(),readyToLoadEditor$1(this,this.config)},t.prototype.init=function(){this.Listener.init(this.handle.bind(this))},t.prototype.handle=function(t,e){"dom"===t.eventType&&this.handleDom(t,e)},t.prototype.handleDom=function(t,e){try{var i,n,o,r,s=t.eventName;"click"===s||"exposure"===s||"change"===s||"submit"===s?null!==(i=this.EventHandle.handleEvent(e,s))&&this.Request.send({eventType:"custom",eventName:"report_"+s+"_event",extra:{methods:"GET"}},i):"page_view"===s||"page_statistics"===s?(n=void 0,n="page_view"===s?this.EventHandle.handleViewEvent(e):this.EventHandle.handleStatisticsEvent(e),this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"}},n)):"beat"===s&&(o=this.EventHandle.handleBeadtEvent(e),r=t.eventSend,this.Request.send({eventType:"custom",eventName:"report_${eventName}_event",extra:{methods:"GET"},eventSend:r},o))}catch(t){}},t.prototype.destroy=function(){this.autoTrackStart&&(this.autoTrackStart=!1,this.Listener.removeListener())},t}(),EventList=(!function(t){t.Net="net",t.FailNet="f_net",t.FailData="f_data"}(State=State||{}),{pv:["predefine_pageview"],sdk:["_be_active","predefine_page_alive","predefine_page_close","__profile_set","__profile_set_once","__profile_increment","__profile_unset","__profile_append"],autotrack:["bav2b_click","bav2b_page","bav2b_beat","bav2b_page_statistics","__bav_click","__bav_page","__bav_beat","__bav_page_statistics"]}),Tracer=function(){function t(){}return t.prototype.apply=function(t,e){var i=this;this.ready=e.app_id&&e.enable_tracer&&!e.disable_track_event,this.ready&&(this.limit={pv:1,sdk:3,autotrack:3,log:3},this.errorCode={f_net:0,f_data:0},this.tracerCache=new Map,this.collect=t,this.appid=e.app_id,this.reportUrl=t.configManager.getUrl("event"),e=this.collect.Types,t=t.adapters.fetch,this.fetch=t,this.collect.on(e.Event,function(){i.addCount("log")}),this.collect.on(e.SubmitError,function(t){var e=t.type,n=t.eventDate,o=t.errorCode,t=t.response;i.addErrorCount(n,e,o,t)}),this.listener(),this.collect.emit(e.TracerReady))},t.prototype.addCount=function(t,e,i){void 0===e&&(e="net"),void 0===i&&(i=1);try{this.tracerCache||(this.tracerCache=new Map);var n,o=void 0;this.tracerCache.has(t)?(n=this.tracerCache.get(t)).has(e)?(o=n.get(e).params.count,o++,n.set(e,this.processTracer(o,t,e))):(o=i,n.set(e,this.processTracer(i,t,e))):(n=new Map,o=i,n.set(e,this.processTracer(i,t,e)),this.tracerCache.set(t,n)),"net"===e&&o>=this.limit[t]&&this.report(!1)}catch(t){}},t.prototype.addErrorCount=function(t,e,i,n){var o,r=this;try{t&&t.length&&(o=t[0].events)&&o.length&&("f_data"===e?(n&&n.hasOwnProperty("sc")?this.addCount("log",e,o.length-n.sc):this.addCount("log",e,o.length),this.errorCode[e]=i):o.forEach(function(t){var n,o="log";for(n in EventList)if(-1!==EventList[n].indexOf(t.event)){o=n;break}r.addCount(o,e,1),r.errorCode[e]=i}))}catch(t){}},t.prototype.report=function(t){var e;this.tracerCache&&(e=[],this.tracerCache.forEach(function(t){t.forEach(function(t){e.push(t)})}),e)&&e.length&&this.sendTracer(e,t)},t.prototype.sendTracer=function(t,e){try{var i=this.collect.eventManager.merge(t);e&&window.navigator.sendBeacon?window.navigator.sendBeacon(this.reportUrl,JSON.stringify(i)):this.fetch(this.reportUrl,i),this.tracerCache=null}catch(t){}},t.prototype.processTracer=function(t,e,i){if(t={count:t,state:i,key:e,params_for_special:"applog_trace",aid:this.appid,platform:"web",_staging_flag:1,sdk_version:SDK_VERSION},"f_net"!==i&&"f_data"!==i||(t.errorCode=this.errorCode[i]),(e=this.collect.processEvent("applog_trace",t))&&e.event)return delete e.is_bav,e},t.prototype.listener=function(){var t=this;document.addEventListener("visibilitychange",function(){"hidden"===document.visibilityState&&t.leavePage()}),beforePageUnload(function(){t.leavePage()})},t.prototype.leavePage=function(){this.report(!0)},t}(),dayjs_min=createCommonjsModule(function(t,e){var i,n,o,r,s,a,c,l,h,u,p,d,f,g,m,_,v,y,b;function E(t,e,i){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(i)+t}function w(t){return t instanceof y}function S(t,e,i){var n;return t?("string"==typeof t?(_[t]&&(n=t),e&&(_[t]=e,n=t)):(_[e=t.name]=t,n=e),!i&&n&&(m=n),n||!i&&m):m}function k(t,e){return w(t)?t.clone():((e="object"==_typeof(e)?e:{}).date=t,e.args=arguments,new y(e))}function D(t){this.$L=S(t.locale,null,!0),this.parse(t)}t.exports=(i="millisecond",n="second",o="minute",r="hour",s="day",a="week",c="month",l="quarter",h="year",u="date",p="Invalid Date",d=/^(\d{4})[-\/]?(\d{1,2})?[-\/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,f=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,t={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_")},g={s:E,z:function(t){var t=-t.utcOffset(),e=Math.abs(t),i=Math.floor(e/60),e=e%60;return(t<=0?"+":"-")+E(i,2,"0")+":"+E(e,2,"0")},m:function t(e,i){var n,o,r;return e.date()<i.date()?-t(i,e):(n=12*(i.year()-e.year())+(i.month()-e.month()),r=i-(o=e.clone().add(n,c))<0,e=e.clone().add(n+(r?-1:1),c),+(-(n+(i-o)/(r?o-e:e-o))||0))},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return({M:c,y:h,w:a,d:s,D:u,h:r,m:o,s:n,ms:i,Q:l})[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},(_={})[m="en"]=t,(v=g).l=S,v.i=w,v.w=function(t,e){return k(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})},(t=D.prototype).parse=function(t){this.$d=function(){var e=t.date,i=t.utc;if(null===e)return new Date(NaN);if(v.u(e))return new Date;if(!(e instanceof Date||"string"!=typeof e||/Z$/i.test(e))){var n,o,r=e.match(d);if(r)return n=r[2]-1||0,o=(r[7]||"0").substring(0,3),i?new Date(Date.UTC(r[1],n,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)):new Date(r[1],n,r[3]||1,r[4]||0,r[5]||0,r[6]||0,o)}return new Date(e)}(),this.$x=t.x||{},this.init()},t.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},t.$utils=function(){return v},t.isValid=function(){return this.$d.toString()!==p},t.isSame=function(t,e){return t=k(t),this.startOf(e)<=t&&t<=this.endOf(e)},t.isAfter=function(t,e){return k(t)<this.startOf(e)},t.isBefore=function(t,e){return this.endOf(e)<k(t)},t.$g=function(t,e,i){return v.u(t)?this[e]:this.set(i,t)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(t,e){function i(t,e){return e=v.w(p.$u?Date.UTC(p.$y,e,t):new Date(p.$y,e,t),p),d?e:e.endOf(s)}function l(t,e){return v.w(p.toDate()[t].apply(p.toDate("s"),(d?[0,0,0,0]:[23,59,59,999]).slice(e)),p)}var p=this,d=!!v.u(e)||e,e=v.p(t),f=this.$W,g=this.$M,m=this.$D,_="set"+(this.$u?"UTC":"");switch(e){case h:return d?i(1,0):i(31,11);case c:return d?i(1,g):i(0,g+1);case a:var y=this.$locale().weekStart||0,y=(f<y?f+7:f)-y;return i(d?m-y:m+(6-y),g);case s:case u:return l(_+"Hours",0);case r:return l(_+"Minutes",1);case o:return l(_+"Seconds",2);case n:return l(_+"Milliseconds",3);default:return this.clone()}},t.endOf=function(t){return this.startOf(t,!1)},t.$set=function(t,e){var t=v.p(t),a="set"+(this.$u?"UTC":""),a=((l={}).day=a+"Date",l[u]=a+"Date",l[c]=a+"Month",l[h]=a+"FullYear",l[r]=a+"Hours",l[o]=a+"Minutes",l[n]=a+"Seconds",l[i]=a+"Milliseconds",l[t]),l=t===s?this.$D+(e-this.$W):e;return t===c||t===h?((e=this.clone().set(u,1)).$d[a](l),e.init(),this.$d=e.set(u,Math.min(this.$D,e.daysInMonth())).$d):a&&this.$d[a](l),this.init(),this},t.set=function(t,e){return this.clone().$set(t,e)},t.get=function(t){return this[v.p(t)]()},t.add=function(t,e){function i(e){var i=k(n);return v.w(i.date(i.date()+Math.round(e*t)),n)}var n=this,e=(t=Number(t),v.p(e));return e===c?this.set(c,this.$M+t):e===h?this.set(h,this.$y+t):e===s?i(1):e===a?i(7):(e=({minute:6e4,hour:36e5,second:1e3})[e]||1,e=this.$d.getTime()+t*e,v.w(e,this))},t.subtract=function(t,e){return this.add(-1*t,e)},t.format=function(t){var e,i,n,o,r,s,a,c,l,h,u=this,d=this.$locale();return this.isValid()?(e=t||"YYYY-MM-DDTHH:mm:ssZ",i=v.z(this),n=this.$H,t=this.$m,o=this.$M,r=d.weekdays,s=d.months,a=function(t,i,n,o){return t&&(t[i]||t(u,e))||n[i].substr(0,o)},c=function(t){return v.s(n%12||12,t,"0")},l=d.meridiem||function(t,e,i){return t=t<12?"AM":"PM",i?t.toLowerCase():t},h={YY:String(this.$y).slice(-2),YYYY:this.$y,M:o+1,MM:v.s(o+1,2,"0"),MMM:a(d.monthsShort,o,s,3),MMMM:a(s,o),D:this.$D,DD:v.s(this.$D,2,"0"),d:String(this.$W),dd:a(d.weekdaysMin,this.$W,r,2),ddd:a(d.weekdaysShort,this.$W,r,3),dddd:r[this.$W],H:String(n),HH:v.s(n,2,"0"),h:c(1),hh:c(2),a:l(n,t,!0),A:l(n,t,!1),m:String(t),mm:v.s(t,2,"0"),s:String(this.$s),ss:v.s(this.$s,2,"0"),SSS:v.s(this.$ms,3,"0"),Z:i},e.replace(f,function(t,e){return e||h[t]||i.replace(":","")})):d.invalidDate||p},t.utcOffset=function(){return-(15*Math.round(this.$d.getTimezoneOffset()/15))},t.diff=function(t,e,i){var e=v.p(e),t=k(t),s=6e4*(t.utcOffset()-this.utcOffset()),u=this-t,t=v.m(this,t),p={};return p[h]=t/12,p[c]=t,p[l]=t/3,p[a]=(u-s)/6048e5,p.day=(u-s)/864e5,p[r]=u/36e5,p[o]=u/6e4,p[n]=u/1e3,t=p[e]||u,i?t:v.a(t)},t.daysInMonth=function(){return this.endOf(c).$D},t.$locale=function(){return _[this.$L]},t.locale=function(t,e){var i;return t?(i=this.clone(),(t=S(t,e,!0))&&(i.$L=t),i):this.$L},t.clone=function(){return v.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},b=(y=D).prototype,k.prototype=b,[["$ms",i],["$s",n],["$m",o],["$H",r],["$W",s],["$M",c],["$y",h],["$D",u]].forEach(function(t){b[t[1]]=function(e){return this.$g(e,t[0],t[1])}}),k.extend=function(t,e){return t.$i||(t(e,y,k),t.$i=!0),k},k.locale=S,k.isDayjs=w,k.unix=function(t){return k(1e3*t)},k.en=_[m],k.Ls=_,k.p={},k)}),duration=createCommonjsModule(function(t,e){var i,n,o,r,s,a,c,l,h,u,p,d,f;function g(t,e,i){var n=this;return(this.$d={},this.$l=i,void 0===t&&(this.$ms=0,this.parseFromMilliseconds()),e)?c(t*s[l(e)],this):("number"==typeof t?(this.$ms=t,this.parseFromMilliseconds()):"object"==_typeof(t)?(Object.keys(t).forEach(function(e){n.$d[l(e)]=t[e]}),this.calMilliseconds()):"string"==typeof t&&(i=t.match(r))&&(e=i.slice(2).map(function(t){return Number(t)}),this.$d.years=e[0],this.$d.months=e[1],this.$d.weeks=e[2],this.$d.days=e[3],this.$d.hours=e[4],this.$d.minutes=e[5],this.$d.seconds=e[6],this.calMilliseconds()),this)}t.exports=(o=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,r=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,s={years:31536e6,months:2592e6,days:864e5,hours:36e5,minutes:6e4,seconds:1e3,milliseconds:1,weeks:6048e5},a=function(t){return t instanceof f},c=function(t,e,i){return new f(t,i,e.$l)},l=function(t){return n.p(t)+"s"},h=function(t){return t<0},u=function(t){return h(t)?Math.ceil(t):Math.floor(t)},p=function(t){return Math.abs(t)},d=function(t,e){return t?h(t)?{negative:!0,format:""+p(t)+e}:{negative:!1,format:""+t+e}:{negative:!1,format:""}},(t=g.prototype).calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(e,i){return e+(t.$d[i]||0)*s[i]},0)},t.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=u(t/31536e6),this.$d.months=u((t%=31536e6)/2592e6),this.$d.days=u((t%=2592e6)/864e5),this.$d.hours=u((t%=864e5)/36e5),this.$d.minutes=u((t%=36e5)/6e4),this.$d.seconds=u((t%=6e4)/1e3),this.$d.milliseconds=t%=1e3},t.toISOString=function(){var t=d(this.$d.years,"Y"),e=d(this.$d.months,"M"),i=+this.$d.days||0,i=(this.$d.weeks&&(i+=7*this.$d.weeks),d(i,"D")),n=d(this.$d.hours,"H"),o=d(this.$d.minutes,"M"),r=this.$d.seconds||0,r=(this.$d.milliseconds&&(r+=this.$d.milliseconds/1e3),d(r,"S")),s=t.negative||e.negative||i.negative||n.negative||o.negative||r.negative,a=n.format||o.format||r.format?"T":"",s=(s?"-":"")+"P"+t.format+e.format+i.format+a+n.format+o.format+r.format;return"P"==s||"-P"==s?"P0D":s},t.toJSON=function(){return this.toISOString()},t.format=function(t){var t=t||"YYYY-MM-DDTHH:mm:ss",e={Y:this.$d.years,YY:n.s(this.$d.years,2,"0"),YYYY:n.s(this.$d.years,4,"0"),M:this.$d.months,MM:n.s(this.$d.months,2,"0"),D:this.$d.days,DD:n.s(this.$d.days,2,"0"),H:this.$d.hours,HH:n.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:n.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:n.s(this.$d.seconds,2,"0"),SSS:n.s(this.$d.milliseconds,3,"0")};return t.replace(o,function(t,i){return i||String(e[t])})},t.as=function(t){return this.$ms/s[l(t)]},t.get=function(t){var e=this.$ms,t=l(t);return"milliseconds"===t?e%=1e3:e="weeks"===t?u(e/s[t]):this.$d[t],0===e?0:e},t.add=function(t,e,i){return e=e?t*s[l(e)]:(a(t)?t:c(t,this)).$ms,c(this.$ms+e*(i?-1:1),this)},t.subtract=function(t,e){return this.add(t,e,!0)},t.locale=function(t){var e=this.clone();return e.$l=t,e},t.clone=function(){return c(this.$ms,this)},t.humanize=function(t){return i().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},t.milliseconds=function(){return this.get("milliseconds")},t.asMilliseconds=function(){return this.as("milliseconds")},t.seconds=function(){return this.get("seconds")},t.asSeconds=function(){return this.as("seconds")},t.minutes=function(){return this.get("minutes")},t.asMinutes=function(){return this.as("minutes")},t.hours=function(){return this.get("hours")},t.asHours=function(){return this.as("hours")},t.days=function(){return this.get("days")},t.asDays=function(){return this.as("days")},t.weeks=function(){return this.get("weeks")},t.asWeeks=function(){return this.as("weeks")},t.months=function(){return this.get("months")},t.asMonths=function(){return this.as("months")},t.years=function(){return this.get("years")},t.asYears=function(){return this.as("years")},f=g,function(t,e,o){n=(i=o)().$utils(),o.duration=function(t,e){var i=o.locale();return c(t,{$l:i},e)},o.isDuration=a;var r=e.prototype.add,s=e.prototype.subtract;e.prototype.add=function(t,e){return a(t)&&(t=t.asMilliseconds()),r.bind(this)(t,e)},e.prototype.subtract=function(t,e){return a(t)&&(t=t.asMilliseconds()),s.bind(this)(t,e)}})}),ignoreList=(dayjs_min.extend(duration),["__cep_sdk_onboard","__cep_trigger_sdk","_be_active"]),moreOP=["and","or","not"],CepRule=function(){function CepRule(){this.support=!0,this.currentPlan=1,this.shouldSendEvent=!1,this.staing=!1,this.test=!1,this.cepReady=!1,this.eventCache=[]}return CepRule.prototype.apply=function(t,e){var i,n,o,r=this;this.collect=t,this.config=e,this.config.cep&&(i=(n=t.adapters).fetch,n=n.storage,o=t.Types,this.types=o,this.storage=new n(!1),this.fetch=i,this.configManager=t.configManager,this.url=e.cep_url?""+e.cep_url:t.configManager.getDomain()+"/service/2/cep_settings/",this.reportUrl=t.configManager.getUrl("event"),this.key="__tea_cep_plan_"+e.app_id,this.quotasKey="__tea_cep_plan_quotas_"+e.app_id,this.isWait=!1,this.eventCache=[],this.test=t.configManager.staging,this.collect.on(o.SubmitAfter,function(t){r.matchEvent(t)}),this.init())},CepRule.prototype.init=function(){var t,e,i=this,n=!0,o=0,r=!1,s=this.storage.getItem(this.key)||{};s&&Object.keys(s).length&&(r=!0,t=s.last_update_time,e=s.fetch_interval,o=s.config_version||0,n=Date.now()-t>1e3*e),n?(e=(t=this.configManager.get()).header,n=t.user,this.fetch(this.url,{header:e,user:n,local_time:Date.now(),config_version:o},1e4,!1,function(t){t&&0===t.code?(s.fetch_interval=t.fetch_interval,s.data=t.data,s.last_update_time=Date.now(),s.config_version=t.config_version,i.clearQuotas(),i.initState(t.data),i.storage.setItem(i.key,s),t.data.forEach(function(t){i.event("__cep_sdk_onboard",t.plan_id)})):(304===t.code||400===t.code)&&r&&(s.last_update_time=Date.now(),i.storage.setItem(i.key,s),i.initState(s.data))},function(){r?(i.planData=s.data,i.initState(s.data)):i.support=!1})):(s.last_update_time=Date.now(),this.storage.setItem(this.key,s),this.initState(s.data))},CepRule.prototype.initState=function(t){var e=this;t&&t.length&&(this.stateArray=new Map,this.waitArray=new Map,(this.planData=t).forEach(function(t){var i,n=new Map;t.pattern&&t.pattern.events&&(i=1===t.pattern.events.length,t.pattern.events.forEach(function(t){n.set(t.id,{id:t.id,isMatch:!1,event:null,after:t.after||null,connection:t.connection||null,window:t.window||null,matchTime:0,initTime:Date.now(),singleRule:i})}),e.stateArray.set(t.plan_id,{patternState:n,singleRule:i,pattern:{aid:t.aid,biz_id:t.biz_id,end_time:t.end_time,start_time:t.start_time,web_sdk_version:t.web_sdk_version,stage:t.stage},quotas:t.quotas}))}),this.cepReady=!0,this.dealCache(),this.collect.emit(this.types.CepReady))},CepRule.prototype.check=function(t){var e=Date.now();return!(Date.now()>1e3*t.end_time)&&!(e<1e3*t.start_time)&&!(e>1e3*t.end_time)&&(this.staing="testing"===t.staing,!(SDK_VERSION<t.web_sdk_version&&(this.support=!1,1)))},CepRule.prototype.dealCache=function(){var t,e=this;this.eventCache.length&&(t=1,this.eventCache.forEach(function(i){e.matchEvent(i),t++}),t===this.eventCache.length)&&(this.eventCache=[])},CepRule.prototype.matchEvent=function(t){if(this.support&&(!this.staing||this.test)&&t&&t.length)try{if(this.cepReady){var e=t[0],i=e.header,n=e.user,o=e.events;o.length&&o.reverse();for(var r=0;r<o.length;r++){var s=o[r].event;if(-1!==ignoreList.indexOf(s))return!1;this.matchRule(i,n,o[r])}}else this.eventCache.push(t)}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},CepRule.prototype.matchRule=function(t,e,i){try{for(var n=0;n<this.planData.length;n++){var o=this.planData[n],r=o.plan_id;if(this.check(o)&&this.checkQuotas(r)&&o.pattern&&o.pattern.events){for(var s=o.pattern.events,a=0;a<s.length;a++)if(this.rule(t,e,i,s[a].condition)){var c=this.stateArray.get(r).patternState,l=c.get(s[a].id);if(this.stateArray.get(r).singleRule){this.changeStatus(r,s[a].id,i),this.publish([i],r,s[a].id);break}if(!l.isMatch){(l.after&&c.get(l.after).isMatch||!l.after)&&this.changeStatus(r,s[a].id,i);break}}}}this.statusCheck()}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},CepRule.prototype.changeStatus=function(t,e,i){var n=this.stateArray.get(t),o=n.patternState.get(e);o.isMatch=!0,o.event=i,o.matchTime=i.local_time_ms||Date.now(),n.patternState.set(e,o),this.stateArray.set(t,n)},CepRule.prototype.statusCheck=function(){var t,e,i,n;try{for(var o=__values(this.stateArray),r=o.next();!r.done;r=o.next()){var s=__read(r.value,2),a=s[0],c=s[1],l=c.patternState;if(c.isSingle)break;try{for(var h=__values(l),u=h.next();!u.done;u=h.next()){var p=__read(u.value,2),d=p[0],f=p[1];if(f.after&&(!f.after||l.get(f.after).isMatch)){if("NOT_FOLLOWED_BY"===f.connection){f.isMatch?this.reset(a,d):Date.now()-l.get(f.after).matchTime>f.window?this.publish([l.get(f.after).event,f.event],a,d):this.startWait(a,d,f);break}f.isMatch?f.matchTime-l.get(f.after).matchTime<=f.window?this.publish([l.get(f.after).event,f.event],a,d):this.reset(a,d):Date.now()-l.get(f.after).matchTime>f.window?this.reset(a,d):this.startWait(a,d,f);break}}}catch(t){i={error:t}}finally{try{u&&!u.done&&(n=h.return)&&n.call(h)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}},CepRule.prototype.startWait=function(t,e,i){var n=this;try{this.waitArray.get(t)||this.waitArray.set(t,new Map);var o,r=this.waitArray.get(t);r.get(e)||(o=setTimeout(function(){var o,r=n.stateArray.get(t).patternState,s=r.get(e);"NOT_FOLLOWED_BY"===s.connection?!s.isMatch&&r.get(s.after).isMatch||s.matchTime-r.get(s.after).matchTime>i.window?((o=n.waitArray.get(t).get(e)).triggerWait=!0,n.waitArray.set(t,n.waitArray.get(t).set(e,o)),n.publish([r.get(s.after).event],t,e)):n.reset(t,e):"FOLLOWED_BY"===s.connection&&(s.isMatch&&r.get(s.after).isMatch?((o=n.waitArray.get(t).get(e)).triggerWait=!0,n.waitArray.set(t,n.waitArray.get(t).set(e,o)),n.publish([r.get(s.after).event],t,e)):n.reset(t,e))},i.window),r.set(e,{waitFn:o,triggerWait:!1}),this.waitArray.set(t,r))}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},CepRule.prototype.rule=function(t,e,i,n){var o=this;try{var r=i.event,s=i.params,s=JSON.parse(s);if(-1!==moreOP.indexOf(n.op)){if(n.conditions&&n.conditions.length){var a=n.conditions,c=0,l=new Map;l.set(c,{op:n.op,result:void 0,resultList:[],resultKey:[],resultLength:a.length}),function i(n,a){for(var h,u,p,d=0;d<n.length;d++)c++,-1!==moreOP.indexOf(n[d].op)&&n[d].hasOwnProperty("conditions")?(l.set(c,{op:n[d].op,result:void 0,fatherKey:a,resultList:[],resultKey:[],resultLength:n[d].conditions.length}),i(n[d].conditions,c)):(p=(u=o.scope(n[d].key)).scope,h=u.key,u=u.key2,u=p?("header"===p?u?JSON.parse(t[u]):t:"user"===p?e:s)[h]:r,p=o.calculate(n[d].op,u,n[d].value),l.set(c,{op:n[d].op,result:p,fatherKey:a}))}(a,c);for(var h=l.get(0);void 0===h.result||h.resultList.length<h.resultLength;)l.forEach(function(t,e){var i;void 0!==t.result&&void 0!==t.fatherKey&&(i=l.get(t.fatherKey)).resultList.length<i.resultLength&&-1===i.resultKey.indexOf(e)&&(i.resultKey.push(e),i.resultList.push(t.result),l.set(t.fatherKey,i))}),l.forEach(function(t){t.resultList&&t.resultList.length===t.resultLength&&("and"===t.op&&(t.result=-1===t.resultList.indexOf(!1)),"or"===t.op)&&(t.result=-1!==t.resultList.indexOf(!0))});return l.get(0).result}return!1}var u=this.scope(n.key),p=u.scope,d=u.key,f=u.key2,g=p?("header"===p?f?JSON.parse(t[f]):t:"user"===p?e:s)[d]:r;return this.calculate(n.op,g,n.value)}catch(t){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),!1}},CepRule.prototype.publish=function(t,e,i){try{var n=this.configManager.get().user,o={biz_id:this.stateArray.get(e).pattern.biz_id,plan_id:e,uid:n.user_id||"",did:n.device_id||"",uuid:n.user_unique_id,events:t,extra:{url:window.location.href}};this.collect.emit("__cep_match",o),(window.opener||window.parent).postMessage({type:"__cep_match",data:o},"*"),this.event("__cep_trigger_sdk",e),this.addQuotas(e),this.reset(e,i)}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},CepRule.prototype.addQuotas=function(t){var e,i=this.stateArray.get(t).quotas;i&&i.length&&((i=this.storage.getItem(this.quotasKey)||{})[t]||(i[t]={value:0,lastTime:Date.now()}),0===(e=i[t].value)&&(i[t].lastTime=Date.now()),i[t].value=e+1,this.storage.setItem(this.quotasKey,i))},CepRule.prototype.checkQuotas=function(t){var e,i,n=this.stateArray.get(t).quotas,o=this.storage.getItem(this.quotasKey)||{};return o[t]||(o[t]={value:0,lastTime:Date.now()}),!(n&&n.length&&(e=n[0].granularity,i=n[0].value,"per_keyid"===n[0].type)&&("all"!==(n=this.release(e))&&Date.now()-o[t].lastTime>=n?(o[t].value=0,o[t].lastTime=Date.now(),this.storage.setItem(this.quotasKey,o),0):o[t].value>=i&&1))},CepRule.prototype.clearQuotas=function(){this.storage.setItem(this.quotasKey,null)},CepRule.prototype.release=function(t){return"all"===t?t:(t=dayjs_min.duration(t))?t.asMilliseconds():"all"},CepRule.prototype.reset=function(t,e){var i=this.stateArray.get(t),n=(i.singleRule?((n=i.patternState.get(e)).isMatch=!1,n.event=null,n.matchTime=0,n.initTime=Date.now(),i.patternState.set(e,n)):i.patternState.forEach(function(t){t.isMatch=!1,t.event=null,t.matchTime=0,t.initTime=Date.now()}),this.stateArray.set(t,i),this.waitArray.get(t));n&&n.get(e)&&(clearTimeout(n.get(e).waitFn),n.delete(e))},CepRule.prototype.event=function(t,e){try{var i={event:t,params:JSON.stringify({plan_id:e||"",biz_id:this.stateArray.get(e).pattern.biz_id}),local_time_ms:Date.now()},n=this.configManager.get(),o=n.header,r=n.user,s=(o.custom=JSON.stringify(o.custom),{events:[i],user:r,header:o});this.fetch(this.reportUrl,[s])}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},CepRule.prototype.scope=function(t){var e,i="",n="";return -1<t.indexOf(".")&&(i=(e=t.split("."))[0],t=e[1],"header"===i)&&"custom"===t&&(t=e[2],n=e[1]),{scope:i,key:t,key2:n}},CepRule.prototype.calculate=function(op,paramA,paramB){try{var start,str;return"="===op?paramA===paramB:-1!==["=","<",">",">=","<=","!="].indexOf(op)?eval(""+paramA+op+paramB):-1!==["in","contains"].indexOf(op)?-1!==paramB.indexOf(paramA):-1!==["is not null","is null"].indexOf(op)?"is null"===op?null==paramA:null!=paramA:-1!==["startswith","endswith"].indexOf(op)?"startswith"===op?0===paramA.indexOf(paramB):(start=paramA.length-paramB.length,str=paramA.substr(start,paramB.length),str===paramB):void 0}catch(e){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:e.message}),!1}},CepRule}(),pluginExtendList={autotrack:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/autotrack.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/autotrack.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/autotrack.js"},object:"LogAutoTrack"},ab:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/ab.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/ab.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/ab.js"},object:"LogAb"},stay:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/stay.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/stay.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/stay.js"},object:"LogStay"},route:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/route.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/route.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/route.js"},object:"LogRoute"},cep:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/cep.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/cep.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/cep.js"},object:"LogCep"},tracer:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/tracer.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/tracer.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/tracer.js"},object:"LogTracer"},visual:{src:{cn:"https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/plugin/visual.js",sg:"https://sf16-scmcdn-sg.ibytedtos.com/obj/static-sg/log-sdk/collect/5.0/plugin/visual.js",va:"https://sf16-scmcdn-va.ibytedtos.com/obj/static-us/log-sdk/collect/5.0/plugin/visual.js"},object:"LogVisual"}},getLogPluginSpace=function(){return"undefined"!=typeof window?(window.LogPluginObject||(window.LogPluginObject={}),window.LogPluginObject):null},pluginObject=getLogPluginSpace(),PluginExtend=function(){function t(){}return t.prototype.apply=function(t,e){this._plugin={},this.config=e,this.collect=t,this.channel=e.channel||"cn",this.loadExtend()},t.prototype.loadExtend=function(){var t=this;try{this.collect.remotePlugin.forEach(function(e,i){var n,o;"sdk"===e?pluginExtendList.hasOwnProperty(i)&&(n=pluginExtendList[i].object,o=""+pluginExtendList[i].src[t.channel],t.exist(i,n,o)):"object"==_typeof(e)&&(e.src?t.exist(i,e.call,e.src):t.process(i,e.instance,"INSTANCE"))})}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.exist=function(t,e,i){var n=this;pluginObject[e]?this.process(t,pluginObject[e]):this.loadPlugin(t,i,function(){n.process(t,pluginObject[e])},function(){})},t.prototype.process=function(t,e,i){try{var n;i?(n=new e).apply&&n.apply(this.collect,this.config):e&&e(this.collect,this.config)}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t.prototype.loadPlugin=function(t,e,i,n){var o=this;try{var r=document.createElement("script");r.src=e,this._plugin[t]||(this._plugin[t]=[]),this._plugin[t].push(i),r.onerror=function(){n(e)},r.onload=function(){o._plugin[t].forEach(function(t){t()})},document.getElementsByTagName("head")[0].appendChild(r)}catch(t){this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message})}},t}(),Verify=function(){function t(){this.verifyReady=!1,this.waitTime=5e3,this.cleanStatus=!1}return t.prototype.apply=function(t,e){var i=this,e=(this.collector=t,this.config=e,t.adapters.storage);this.cacheStorgae=new e(!1,"session"),this.eventStorage=[],this.collector.on("submit-verify",function(t){t&&t.length&&i.eventStore(t[0])}),this.checkCache()},t.prototype.checkCache=function(){var t=this,e=(this.verifyCookieKey="__applog_verify_set_"+this.config.app_id,this.cacheStorgae.getCookie(this.verifyCookieKey),this.cacheStorgae.getItem(this.verifyCookieKey)),i=(this.sign=e&&e.sign||"",this.origin=e&&e.origin||"*",setTimeout(function(){t.cleanVerify(),clearTimeout(i),t.collector.off("submit-verify")},this.waitTime));window.addEventListener("message",function(e){e&&e.data&&"simulator:verify"===e.data.type&&(clearTimeout(i),t.receMessage(e))},!0)},t.prototype.receMessage=function(t){var e;this.cleanStatus||(e=t.data,this.verifyReady=!0,this.sign=e.sign,this.origin=t.origin,this.cacheStorgae.setItem(this.verifyCookieKey,JSON.stringify({sign:e.sign,origin:t.origin})),this.eventStorage.length&&this.postVerify(this.eventStorage,e.sign,t.origin))},t.prototype.eventStore=function(t){this.cleanStatus||(this.verifyReady?this.postVerify(t,this.sign,this.origin):this.eventStorage.push(t))},t.prototype.cleanVerify=function(){this.cleanStatus=!0,this.eventStorage=[]},t.prototype.postVerify=function(t,e,i){try{var n=[],o=(isArray(t)?t.forEach(function(t){n.push(t)}):n.push(t),{type:"simulator:verify:event",sign:e,pageUrl:window.location.href,events:n});(window.opener||window.parent).postMessage(o,i)}catch(t){}},t}(),RuotePage=function(){function t(){this.autotrack=!1,this.spa=!1,this.cache={},this.allowHash=!1}return t.prototype.apply=function(t,e){var i;(e.spa||e.autotrack)&&(i=t.Types,this.collect=t,this.config=e,this.appid=e.app_id,this.allowHash=e.allow_hash,this.fncArray=new Map,this.setKey(),this.setLocation(),this.hack(),this.init(),this.listener(),t.emit(i.RouteReady))},t.prototype.setKey=function(){var t=this.collect.adapters.storage;this.storage=new t(!1),this.cache_key="__tea_cache_refer_"+this.appid,this.cache={refer_key:location.href,refer_title:document.title||location.pathname,refer_manual_key:""},this.config.autotrack&&"object"==_typeof(this.config.autotrack)&&this.config.autotrack.page_manual_key&&(this.cache.refer_manual_key=this.config.autotrack.page_manual_key),this.storage.setItem(this.cache_key,this.cache)},t.prototype.hack=function(){var t=this,e=window.history.pushState,i=(history.pushState=function(i){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];"function"==typeof history.onpushstate&&history.onpushstate({state:i});var r,i=e.call.apply(e,__spread([history,i],n));if(t.lastLocation!==location.href)return r=t.getPopStateChangeEventData(),t.lastLocation=stringify(location.href,n[1]),t.sendPv(r,"pushState"),i},history.replaceState);history.replaceState=function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];"function"==typeof history.onreplacestate&&history.onreplacestate({state:e});var r,e=i.call.apply(i,__spread([history,e],n));if(t.lastLocation!==location.href)return r=t.getPopStateChangeEventData(),t.lastLocation=location.href,t.sendPv(r),e}},t.prototype.setLocation=function(){"undefined"!=typeof window&&(this.lastLocation=window.location.href)},t.prototype.init=function(){var t=this.getPopStateChangeEventData();this.collect.emit("route-change",{config:t,init:!0})},t.prototype.listener=function(){var t=this,e=null;window.addEventListener("hashchange",function(i){var n;t.lastLocation!==window.location.href&&(clearTimeout(e),t.allowHash)&&(t.lastLocation=window.location.href,n=t.getPopStateChangeEventData(),t.sendPv(n))}),window.addEventListener("popstate",function(i){t.lastLocation!==window.location.href&&(e=setTimeout(function(){t.lastLocation=window.location.href;var e=t.getPopStateChangeEventData();t.sendPv(e)},10))})},t.prototype.getPopStateChangeEventData=function(){var t=this.pageConfig();return t.is_back=0,t},t.prototype.pageConfig=function(){try{var t=this.storage.getItem(this.cache_key)||{},e=document.referrer||t&&t.refer_key||"",i=this.storage.getItem("__tea_cache_first_"+this.appid),n=!i||1!=i;return{is_html:1,url:location.href,referrer:e,page_key:location.href,refer_page_key:e,page_title:document.title||location.pathname,page_manual_key:this.config.autotrack&&this.config.autotrack.page_manual_key||"",refer_page_manual_key:t&&t.refer_manual_key||"",refer_page_title:t&&t.refer_title||"",page_path:location.pathname,page_host:location.host,is_first_time:""+n}}catch(t){return this.collect.emit(DebuggerMesssge$1.DEBUGGER_MESSAGE,{type:DebuggerMesssge$1.DEBUGGER_MESSAGE_SDK,info:"发生了异常",level:"error",time:Date.now(),data:t.message}),{}}},t.prototype.sendPv=function(t,e){this.collect.emit("route-change",{config:t,init:!1})},t}(),SessionRecord=function(){function t(){this.recordControl=!1,this.hasRecordStart=!1}return t.prototype.apply=function(t,e){var i,n,o=this;this.collector=t,(this.config=e).recordSession&&(i=(e=t.adapters).storage,e=e.fetch,n=t.Types,this.fetch=e,this.events=[],this.storage=new i(!1),this.sessionStorage=new i(!1,"session"),this.sessionTimeout=18e5,this.dataUrl=[],this.seq_id=1,t.on(n.SessionRecordStart,function(){o.startRecord()}),t.on(n.SessionRecordPause,function(){o.pauseRecord()}),t.on(n.SessionRecordEnd,function(){o.stopRecord()}),t.on(n.SessionRecordReport,function(t){t=t.callback,o.sendRecord(t)}),this.ready("session-record"),this.promission())},t.prototype.ready=function(t){var e=this;if(this.collector.set(t),this.collector.hook._hooksCache.hasOwnProperty(t)){var i=this.collector.hook._hooksCache[t];if(Object.keys(i).length)for(var n in i)!function(t){i[t].length&&i[t].forEach(function(i){e.collector.hook.emit(t,i)})}(n)}},t.prototype.promission=function(){this.loadDom(),this.listener()},t.prototype.loadDom=function(){var t=this;try{loadScript("https://lf3-cdn-tos.bytescm.com/obj/static/log-sdk/collect/5.0/record-rangers.js",function(){t.record=window&&window.rrwebRecord,t.recordControl=!0},function(){})}catch(t){}},t.prototype.startRecord=function(){var t=this;this.recordControl&&this.record?this.stop=this.record({emit:function(e){t.events.push(e),1e6<JSON.stringify(t.events).length&&t.report()},ignoreClass:"tea-ignore",sampling:{scroll:200,mouseInteraction:{MouseUp:!0,MouseDown:!0,Click:!0,ContextMenu:!0,DblClick:!0,Focus:!0,Blur:!0,TouchStart:!0,TouchEnd:!0}}}):this.hasRecordStart=!0},t.prototype.pauseRecord=function(){},t.prototype.stopRecord=function(){this.stop&&this.stop()},t.prototype.resetRecord=function(){this.startRecord()},t.prototype.sendRecord=function(t){this.report(t)},t.prototype.report=function(t){var e=this;try{this.storage.setItem("__tea_record_events_"+this.config.app_id,JSON.stringify(this.events));var i={behaviors:this.events,type:"rrweb",num:this.events.length,seq_id:this.seq_id,url:window.location.href},n=decodeUrl("1fz22z22z1nz21z4mz4bz4bz1bz1mz4az19z27z22z1cz1bz18z1lz1az1cz4az1lz1cz22z4bz18z1nz1gz4bz24z4dz4bz1dz1gz1jz1cz52z1cz26z22z50z4az1hz21z1mz1l");this.fetch(n,i,3e5,!1,function(i){0===i.code&&e.dataUrl.push(i.data.url),t&&(t(e.dataUrl),e.storage.setItem("__tea_record_dataurl_"+e.config.app_id,JSON.stringify(e.dataUrl)),e.dataUrl=[],e.seq_id=1)},function(t){},"","PUT"),this.events=[],this.seq_id++}catch(t){}},t.prototype.listener=function(){},t}(),Tea=(Collector.usePlugin(PluginExtend,"extend"),Collector.usePlugin(Ab,"ab"),Collector.usePlugin(Stay,"stay"),Collector.usePlugin(AutoTrack,"autotrack"),Collector.usePlugin(Verify,"verify"),Collector.usePlugin(Et,"et"),Collector.usePlugin(Profile,"profile"),Collector.usePlugin(CepRule,"cep"),Collector.usePlugin(HeartBeat,"heartbeat"),Collector.usePlugin(Monitor$1,"monitor"),Collector.usePlugin(RuotePage,"route"),Collector.usePlugin(Tracer,"tracer"),Collector.usePlugin(SessionRecord,"record"),new Collector("default")),PRIVATE_APP_ID_MAP={cn:2285,va:7054,sg:7054},initTea=function(t){var e=null!=(e=PRIVATE_APP_ID_MAP[t.region])?e:PRIVATE_APP_ID_MAP.cn;return Tea.init({app_id:e,channel:t.region,disable_auto_pv:!0}),Tea.config({user_unique_id:t.userUniqueId,evtParams:{app_id:e,ab_sdk_version:t.abSdkVersion,department:t.department,line_app_id:t.appId,os_type:"WEB"}}),Tea.start(),Tea},Monitor=function(){function t(t){if("undefined"!=typeof window)try{this.init(t),this.logger=createLogger("Monitor"),this.logger("Image Monitor 0.0.0-feat-viewer-heif-support-20250516072926-v2 initialization completed")}catch(t){throw this.urgentBypassReport({data:ERROR_MSG.ERROR_SYSTEM_INIT,code:ERROR_CODE[ERROR_MSG.ERROR_SYSTEM_INIT]}),t}}return t.prototype.init=function(t){this.options=t,ConfigProvider.initConfigProvider({cloudConfig:this.options.enableCloudConfig?{channel:t.region,app_id:t.appId}:void 0,defaultConfig:{reportRateConfig:{reportRate:null!=(e=null==(e=null==(e=null==t?void 0:t.defaultConfig)?void 0:e.reportRateConfig)?void 0:e.reportRate)?e:1,reportRateError:null!=(e=null==(e=null==(e=null==t?void 0:t.defaultConfig)?void 0:e.reportRateConfig)?void 0:e.reportRateError)?e:1}}}),this.configProvider=ConfigProvider.getConfigProvider(),this.configProvider.updateConfig("monitorConfig",t),this.eventBroker=EventBroker.initEventBroker({tea:initTea({region:t.region,appId:t.appId,userUniqueId:t.userUniqueId||""}),callback:t.callback});var e=this.configProvider.getConfig("monitorConfig");this.producer=new Producer({el:e.el,selector:e.selector,broker:this.eventBroker,include:e.include,exclude:e.exclude,css:e.css,customHeadersHandler:e.customHeadersHandler})},t.prototype.urgentBypassReport=function(t){initTea({region:this.options.region,appId:this.options.appId,userUniqueId:this.options.userUniqueId||""}).event(ReportType.System,t)},t.prototype.start=function(){this.producer.start()},t.prototype.stop=function(){this.producer.stop()},t.prototype.updateReportParams=function(t){this.eventBroker?this.eventBroker.updateReportParams(t):this.logger("EventBroker have not been initialized")},t}();exports.Monitor=Monitor,Object.defineProperty(exports,"__esModule",{value:!0})})}}]);