"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["20844"],{322642:function(e,t,n){n.d(t,{y:function(){return i}});var i={Video:"share_video",Live:"share_live",User:"share_user",Vs:"share_vs",Comment:"share_comment",other:"other"}},596030:function(e,t,n){n.d(t,{q8:function(){return v},Yo:function(){return E},xz:function(){return _},yc:function(){return d},zo:function(){return c}}),n("250440");var i=n("621631"),s=n("23902"),o=n.n(s),r=n("763468"),a=n("676106"),l=n("462402");let{ConversationType:u}=i.m;function d(e){return!!e&&!o()(e.ext)&&(!o()(e.ext["s:pic_for_pic"])||"true"===e.ext["s:pic_for_pic_acked"])}function _(e){if(!e)return!1;let t=(0,r.t$)(e);return!!t&&BigInt(t.quote_message_id)>0}function c(e){if(!e)return!1;let t=(0,r.t$)(e);if(!t)return!1;let{aweType:n}=t;return e.type===a.pp.CHANGE_STORY_PICTURE&&(n===a.c6.LOCATION_CHANGE_REQUEST||n===a.c6.LOCATION_CHANGE_RESPONSE)||!1}function v(e){return!o()(e)&&!o()(e.ext)&&"1"===e.ext[l.S6.SDK_RIP_MEDIA]}function E(e){let t=d(e)||e.isFromMe,n=(0,r.t$)(e).aweType;return!(n===a.c6.LOCATION_CHANGE_REQUEST||n===a.c6.LOCATION_CHANGE_RESPONSE)&&t}a.c6.PICTURE_CHANGE_REQUEST,a.c6.PICTURE_CHANGE_RESPONSE,a.c6.LOCATION_CHANGE_REQUEST,a.c6.LOCATION_CHANGE_RESPONSE},722220:function(e,t,n){n.d(t,{C9:function(){return f},RP:function(){return S},Uo:function(){return I},bf:function(){return p},dy:function(){return g},lk:function(){return m},vW:function(){return E},wq:function(){return h}}),n(927234),n(250440),n(284961),n(826893),n(882732),n(544943),n(874386);var i=n(193533),s=n.n(i),o=n(621631),r=n(88648),a=n(76637),l=n(324630),u=n(492163),d=n(676106),_=n(129965),c=n(866949),v=n(790137).Buffer;function E(e){var t;let{sender:n}=e,i=(0,c.Z)(n),{nickname:s,remark_name:o}=(null===u.Z||void 0===u.Z?void 0:null===(t=u.Z.userInfoFromServerMap)||void 0===t?void 0:t[n])||{};return o||i||s}function h(e){let{referenceInfo:t}=e;if(!t)return"";try{var n;let{hint:e}=t,{refmsg_uid:i}=JSON.parse(e),{nickname:s,remark_name:o}=(null===u.Z||void 0===u.Z?void 0:null===(n=u.Z.userInfoFromServerMap)||void 0===n?void 0:n[i])||{},r=(0,c.Z)(i);return`${o||r||s||""}`}catch(e){return""}}function p(e){let{referenceInfo:t}=e;if(!t)return"";try{let{hint:n,ref_message_type:i}=t,{content:o}=JSON.parse(n),r=s().fromValue(i).toString(),a="";switch(Number(r)){case d.pp.TEXT:a=o;break;case d.pp.CHANGE_STORY_PICTURE:case d.pp.STORY_PICTURE_ONCE_VIEW:case d.pp.STORY_PICTURE:a="[图片]";break;case d.pp.BIG_EMOJI:a="[表情]";break;case d.pp.STORY_VIDEO_ONCE_VIEW:case d.pp.STORY_VIDEO:a="[视频]";break;case d.pp.SHARE_AWEME:case d.pp.REF_MSG:case d.pp.SHARE_PHOTOS:a=o;break;case d.pp.TEXT_ONCE_VIEW:a="仅看一次消息";break;case d.pp.SHARE_COMMENT:case d.pp.BULLET:a=o;break;default:a="暂不支持该回复类型"}return`${h(e)}：${a}`}catch(e){return""}}let I=e=>{let{conversationType:t,conversationId:n,type:i}=e,s=t===o.m.ConversationType.GROUP_CHAT;return{message_type:(0,_.G)(e),conversation_id:n,chat_type:s?"group":"private"}},g=(e,t)=>null==t?void 0:t.slice().reverse().find(t=>{var n;let i=e[t.sender];return null==i?void 0:null===(n=i.im_role_ids)||void 0===n?void 0:n.includes(a.L.AiChatBotRole)}),S=e=>{let t=[d.pp.SYSTEM,d.pp.GROUP_NOTICE_MESSAGE,d.pp.GROUP_GREET_MESSAGE,d.pp.STRANGER_GREET_MESSAGE,d.pp.STORY_VIDEO_ONCE_VIEW,d.pp.STORY_PICTURE_ONCE_VIEW,d.pp.TEXT_ONCE_VIEW];return null==e?void 0:e.slice().reverse().find(e=>{let{isRecalled:n,visible:i,isFromMe:s,type:o}=e||{};return i&&s&&!n&&!t.includes(o)})},f=e=>{let{message:t,onDownloadClick:n,onDownloadShow:i,downloadHref:s,downloadAttr:o,showDownloadRef:a,getCanShow:u}=e,{isFromMe:d,content:_,ext:c}=t;return(0,r.useCallback)(()=>{var e,t;let r="",v=[];if(d){let t,d;if(null==c?void 0:c["s:send_response_check_msg"])try{d=null==(t=JSON.parse(null==c?void 0:c["s:send_response_check_msg"]))?void 0:null===(e=t.status_msg)||void 0===e?void 0:e.msg_content}catch(e){}[7400,8201].includes(null==t?void 0:t.status_code)?(r="为保护你的信息与身份安全，请在完成实名认证后再发送消息，前往「{{1}}」进行实名认证",v=[{key:1,action:4,name:"抖音APP",link:"https://www.douyin.com/downloadpage/app"}]):[8402].includes(null==t?void 0:t.status_code)?(r="发送失败，根据实名制要求，请前往 {{1}} 内完成实名认证",v=[{key:1,action:4,name:"抖音App",link:"https://www.douyin.com/downloadpage/app"}]):[7183].includes(null==t?void 0:t.status_code)?(r="由于多闪与抖音不在本地区运营，私信功能无法使用",v=[]):[7284].includes(null==t?void 0:t.status_code)?(r="由于你的隐私设置，对方无法回复你的私信。你可以在 {{1}} 修改状态",v=[{key:1,action:4,name:"抖音App",link:"https://www.douyin.com/downloadpage/app"}]):a.current||u()?(!a.current&&(i(),(0,l.D0)("im")),a.current=!0,r="及时接收好友消息回复，{{1}}",v=[{key:1,action:1,name:"下载客户端",link:s,onClick:n,isALink:!0,aLinkProps:{download:o}}]):(r=(null==d?void 0:d.tips)||"",v=(null==d?void 0:d.template)||[])}else{let e;if(_)try{e=null===(t=JSON.parse(_))||void 0===t?void 0:t.ext}catch(e){}r=(null==e?void 0:e.new_tips)||"",v=(null==e?void 0:e.new_template)||[],!r&&(null==e?void 0:e.tips)&&(r=(null==e?void 0:e.tips)||"",v=(null==e?void 0:e.template)||[])}return{tips:r,tipsTpl:v}},[t,n,i,s,o,a])()},m=e=>{let t=new Blob([v.from(e.replace(/^data:image\/(png|jpeg|jpg);base64,/,""),"base64")]);return(window.URL||window.webkitURL).createObjectURL(t)}},462402:function(e,t,n){n.d(t,{E9:function(){return l},FO:function(){return d},Nk:function(){return a},S6:function(){return r},hu:function(){return _},r9:function(){return o},sP:function(){return u}});var i=n(129150),s=n(676106);let o={LOVE:{key:"e:love",value:'{"emoji_data":{"icon_url":"https://p6.douyinpic.com/aweme-client-static-resource/single_msg_emoji_love_1588747335.png~tplv-obj.image","me_text":"","text":"❤️"},"type":1}'}},r={RECALL_ROLE:"s:recall_role",RECALL_UID:"s:recall_uid",SDK_TEXT_RECALL_TIMESTAMP:"s:text_recall_timestamp",SDK_RIP_MEDIA:"a:s_rip_media",GROUP_AVATAR:"a:ab_avatar",KEY_DISABLE_REF_MSG:"a:disable_ref_msg",MSG_DISABLE_OPTION:"a:disable_op",KEY_CREATE_GROUP_TYPE:"a:s_group_create_type"},a={KEY_CREATE_GROUP_TYPE:"a:s_group_create_type"},l={[i.Hv.REGULAR_USER]:[i.DK.DELETE_CONVERSATION,i.DK.STICK_ON_TOP,i.DK.REPORT,i.DK.SET_MUTED,i.DK.BLOCK_USER],[i.Hv.REGULAR_GROUP]:[i.DK.DELETE_CONVERSATION,i.DK.STICK_ON_TOP,i.DK.REPORT,i.DK.SET_MUTED,i.DK.QUIT_GROUP],[i.Hv.REGULAR_SELF]:[i.DK.DELETE_CONVERSATION,i.DK.STICK_ON_TOP,i.DK.SET_MUTED],[i.Hv.STARNGER_ITEM]:[i.DK.DELETE_CONVERSATION,i.DK.REPORT,i.DK.BLOCK_USER],[i.Hv.STRANGER_BOX]:[i.DK.DELETE_CONVERSATION],[i.Hv.REGULAR_DAREN_USER]:[i.DK.DELETE_CONVERSATION,i.DK.STICK_ON_TOP,i.DK.ENABLE_PIGEON_SYNC,i.DK.REPORT,i.DK.SET_MUTED,i.DK.BLOCK_USER]},u={[i.DK.INIT_VALUE]:"",[i.DK.DELETE_CONVERSATION]:"删除后将清除本会话的聊天记录",[i.DK.QUIT_GROUP]:"确认退出此群聊?",[i.DK.DISSOLVE_GROUP]:"确认解散此群聊，所有成员将退出群聊，无法接收消息"},d={CONVETSAION_DETAIL_CONENT:"conversaton-detail-content",CONVERSAION_DETAIL_INPUT_CONTENT:"conversaton-detail-input-content"},_={showImNewMeessage:{[s.pp.STORY_VIDEO]:!0},showImNewMeessage2:{[s.pp.CHANGE_STORY_PICTURE]:!0,[s.pp.STORY_PICTURE_ONCE_VIEW]:!0,[s.pp.STORY_VIDEO_ONCE_VIEW]:!0,[s.pp.TEXT_ONCE_VIEW]:!0}}},676106:function(e,t,n){n.d(t,{c6:function(){return o},ds:function(){return r},pp:function(){return s}});let{ConversationType:i}=n(621631).m,s={NONE:-1,SYSTEM:1,ONLY_PICTURE:2,BIG_EMOJI:5,TEXT:7,SHARE_AWEME:8,LOAD_MORE:9,SHARE_PICTURE:12,COMMAND_SHARE:13,UPDATE_TIPS:14,SAY_HELLO:15,COMMENT:16,VOICE:17,SHARE_RANK_LIST:18,SHARE_CHALLENGE:19,SHARRE_POI:20,SHARE_LIVE:21,SHARE_MUSIC:22,SHARE_HARMONY_RANK_LIST:23,SHARE_MINI_APP:24,SHARE_USER:25,SHARE_WEB:26,STORY_PICTURE:27,SHARE_COUPON:28,STORY_VIDEO:30,AT_FRIEND_INTERACT:31,STORY_REPLY:32,COMMON_RED_ENVELOPE:35,VIDEO_RED_ENVELOPE:36,VIDEO_RED_ENVELOPE_NEW_YEAR:38,XPLAN_STICKER_EMOJI:51,XPLAN_HEART_EMOJI:52,SELF_STORY_REPLY:53,GROUP_INVITE_MESSAGE:58,SHARE_WEB_FROM_THIRD_MESSAGE:60,SHARE_GOOD:61,SHARE_GOOD_WINDOW:62,SHARE_POI_RANK:63,SHARE_GOOD_WINDOW_V3:64,ENTERPRISE_CUSTOMIZED_CARD:65,ENTERPRISE_CUSTOMIZED_CARD_WITH_FIXED_HEIGHT:66,ENTERPRISE_PRODUCT_LIST_CARD:67,E_PLATFORM_MESSAGE:70,SHARE_COMPILATION:71,SHARE_STICKER:72,CHAT_CALL:73,RED_PACKET:74,FRIEND_VIDEO_DM_COMMENT:75,SHARE_VS_LIVE:76,SHARE_PHOTOS:77,DIRECT_INVITE:78,GAME_INVITE:79,COUPON_FANS_GROUP:80,SUBSCRIBE_MESSAGE:81,GAME_INVITE_V2:82,REF_MSG:83,LIVE_ADVANCED_NOTICE_MESSAGE:84,URGE_LEAVE_MESSAGE:85,SHARE_PLAYLET:86,SHARE_DSP_MUSIC:87,ONE_CARD:88,ENTER_CHAT_FROM_VIDEO_COMMENT_LINK_MESSAGE:89,FEED_VOIP_SHARE_INVITE_MESSAGE:90,STORY_PICTURE_ONCE_VIEW:91,STORY_VIDEO_ONCE_VIEW:92,ENTERPRISE_CUSTOMER_SERVICE_CARD:93,COUPON_ENTERPRISE:94,CLOUD_GAME_INVITE:96,TEXT_PUSH_GUIDE:97,TEXT_ONCE_VIEW:104,SHARE_COMMENT:105,IM_ENCRYPT_VOICE:109,BULLET:110,CHANGE_STORY_PICTURE:111,CHANGE_STORY_VIDEO:116,ENCRYPT_VOICE:501,SHARE_LOCATION:502,XRTC_CHATROOM_INVITE:507,X_GROUP_HOLDER:1e3,GROUP_NOTICE_MESSAGE:1001,GROUP_GREET_MESSAGE:1002,GROUP_ANNOUNCEMENT_MESSAGE:1004,PUSH_NOTIFICATION_GUIDE_MESSAGE:1005,SYSTEM_COMPAT:1006,DENGER_WARNING_TOP_MESSAGE:1007,GROUP_MASTER_SHARE_TOKEN:1008,DOUBLE_LIKE_GUIDE:1009,STRANGER_GREET_MESSAGE:1010,ACTIVE_FRIEND_GREET_MESSAGE:1011,MUTE_GUIDE_CARD:1012,FEED_LIVE_SHARE_INVITE_MESSAGE:1013,CHAT_CALL_D_ONLY:1017,SHARE_MT_LIVE:1021,ACTION_MESSAGE:2e3,WELCOME_WORDS_CARD:9990,FANS_GROUP_MILE_STONE_CARD:9992,CREATOR_FAN_GROUP_PASSWORD_INVITE:9995,CREATOR_FAN_GROUP_CARD_INVITE_MESSAGE:9996,BIRTHDAY_WISHES_MESSAGE:9997,LIVE_FANS_GROUP_OWNER_INVITE_CARD:9998},o={DEFAULT:0,LIVE:23,AWEME_SYSTEM:100,SYSTEM_USER_ACTIVE_STATUS:101,SYSTEM_CREATE_GROUP_REWARD:102,SYSTEM_GROUP_MEMBER_ONLINE:103,SYSTEM_GROUP_SILENT_NOTICE:106,SYSTEM_GROUP_UN_SILENT_NOTICE:107,SYSTEM_MEMBER_SILENT_NOTICE:108,SYSTEM_MEMBER_UN_SILENT_NOTICE:109,AWEME_COMMENT:200,AWEME_BIG_EMOJI:500,AWEME_EMOJI_SELF:501,AWEME_NET_SEARCH_GIF:502,AWEME_TYPE_GIPHY:503,AWEME_GREET_EMOJI:504,AWEME_LITE_MSG_EMOJI:505,AWEME_LITE_MSG_EMOJI_NEW:506,AWEME_INTERACTIVE_EMOJI:507,AWEME_STORE_EMOJI:508,AWEME_SINGLE_HEYCAN_EMOJI:510,AWEME_TEXT:700,AWEME_SAY_HELLO_TEXT:701,AWEME_TEXT_GREETING:702,TEXT_REF_MSG:703,AWEME_TEXT_POSTSCRIPT:704,AWEME_TEXT_ASK:705,AWEME_TEXT_WELCOME_WORDS:706,AWEME_TEXT_REPORT_WORDS:708,AWEME_PERSONAL_INFO_REQUEST:770,AWEME_PERSONAL_INFO_RESPONSE:771,AWEME_TEXT_UNKNOWN_MSG_TYPE:799,AWEME_CARD:800,PICTURE_CARD:900,RANKING_LIST_WORD:1801,RANKING_LIST_VIDEO:1802,RANKING_LIST_MUSIC:1803,LIVE_KTV:2101,LIVE_VOICE:2102,IM_ENCRYPT_VOICE_AWE_TYPE:10900,RANKING_LIST_HARMONY:2301,MINI_GAME:2401,MINI_APP:2402,MINI_GENERALIZE:2403,ENCRYPT_PICTURE:2700,ENCRYPT_PICTURE_SHARE_FROM_THIRD:2701,ENCRYPT_PICTURE_OUT_CHECK:2702,ENCRYPT_PICTYRE_GIF:2703,WEB_SHARE_FROM_THIRD:6001,WEB_SHARE_FROM_RED_PACKET:2601,GOOD_WINDOW_V3:6400,AWEME_XEMOJI:5101,DIRECT_INVITE_VOICE_CHAT:7801,DIRECT_INVITE_KTV:7802,DIRECT_INVITE_VIDEO_CHAT:7803,DIRECT_INVITE_SHORT_VIDEO:7804,DIRECT_INVITE_FAMILIAR_KTV:7805,DIRECT_INVITE_AUDIENCE:7806,GAME_INVITE_IN_CHAT:7900,GAME_INVITE_IN_GAME:7901,GAME_INVITE_V2:8200,REF_MSG:8300,GROUP_VOTE:8800,COMMODITY_SHARE:8801,FEED_VOIP_SHARE_FOR_AVCALL:9e3,GROUP_NOTICE_MUTE_NOTICE:9994,GROUP_NOTICE_FANS_GROUP_WELCOME_NOTICE:9995,GROUP_NOTICE_ADD:100100,GROUP_NOTICE_COMMAND_ADD:100101,GROUP_NOTICE_QRCODE_ADD:100102,GROUP_NOTICE_SAFETY_WARNING:100103,GROUP_NOTICE_REMOVE:100104,GROUP_NOTICE_EXIT:100105,GROUP_NOTICE_GROUP_NAME_CHANGE:100106,GROUP_NOTICE_FROM_DUO_SHAN:100107,GROUP_NOTICE_APPLY_ADD:100109,GROUP_NOTICE_ADMIN_ADD:100110,GROUP_NOTICE_SEARCH_JOIN_GROUP:100111,GROUP_NOTICE_ACTIVITY_JOIN_GROUP:100112,GROUP_NOTICE_ACTIVITY_JOIN_GROUP_BY_FTF:100113,GROUP_NOTICE_ACTIVITY_JOIN_GROUP_BY_CIRCLE:100114,GROUP_NOTICE_WARNING_TIPS:100120,GROUP_NOTICE_GROUP_NAME_EDIT_TIPS:100121,GROUP_NOTICE_LIVE_FANS_MANAGER:100122,GROUP_NOTICE_LIVE_FANS_ANNOUNCE:100123,GROUO_NOTICE_DISABLE_SHARE:100124,GROUP_NOTICE_OPEN_DISABLES_SHARE:100125,GROUP_GREET_MESSAGE_FROM_SERVER:100200,GROUP_GREET_MESSAGE_FROM_CLIENT:100201,GROUP_OWNER_ACTIVE_GUIDE_EMOJI:100202,GROUP_MEMBER_ONLINE_GREET_EMOJI:100203,GROUP_MESSAGE_FOR_AVCALL:100300,PICTURE_CHANGE_REQUEST:11100,PICTURE_CHANGE_RESPONSE:11101,LOCATION_CHANGE_REQUEST:11102,LOCATION_CHANGE_RESPONSE:11103},r=[s.SHARE_AWEME,s.REF_MSG,s.SHARE_PHOTOS,s.SHARE_COMMENT,s.BULLET]},687381:function(e,t,n){n.d(t,{v:function(){return a}});var i=n(621631),s=n(941987),o=n(945730);let{GROUP_CHAT:r}=i.m.ConversationType;function a(e){var t;let{id:n,type:i,toParticipantUserId:a,lastMessage:l,coreInfo:u={},ext:d}=e||{},_=i===r,{userInfoFromServerMap:c,getPatchUserInfoAsync:v}=(0,o.getImStore)(),{createdAt:E}=l||{},{name:h,icon:p}=u,I=(null==c?void 0:c[a])||{};!I&&v(a);let g=(_?(null==d?void 0:d["a:ab_avatar"])||p:null==I?void 0:null===(t=I.avatar_thumb)||void 0===t?void 0:t.url_list)||"",S=(null==I?void 0:I.remark_name)||(null==I?void 0:I.nickname)||a||"";return{headIcon:g,title:_?h||n:S,timeStr:(0,s.xS)(E)}}},763468:function(e,t,n){n.d(t,{AD:function(){return F},FG:function(){return M},Jo:function(){return R},KI:function(){return k},MZ:function(){return A},NC:function(){return f},V5:function(){return D},Ww:function(){return P},aU:function(){return U},gP:function(){return w},gc:function(){return y},iN:function(){return b},jt:function(){return L},lR:function(){return S},np:function(){return N},s9:function(){return C},t$:function(){return O},ur:function(){return m},zt:function(){return T}});var i=n(520739),s=n(878389);n(268917),n(897860),n(779788),n(250440),n(284961),n(826893),n(413806),n(602157),n(110006);var o=n(621631),r=n(212138),a=n.n(r),l=n(43715),u=n.n(l),d=n(138871),_=n.n(d),c=n(193533),v=n.n(c),E=n(596030),h=n(492163),p=n(676106),I=n(129150);let{ConversationType:g}=o.m;function S(e){let{height:t,id:n,width:i,sticker_type:s,animate_type:o,animate_url:r,id_str:a}=e,l={aweType:p.c6.AWEME_SINGLE_HEYCAN_EMOJI,createdAt:0,display_name:"",height:t,width:i,image_id:a||n,image_type:"gif",is_card:!1,may_show_special_effect:!1,msgHint:"",package_id:0,updateConversationTime:!0,url:{height:0,uri:null==r?void 0:r.uri,url_list:null==r?void 0:r.url_list,width:0}};return{type:p.pp.BIG_EMOJI,content:JSON.stringify(l)}}function f(e){let{height:t,id:n,width:i,display_name:s,animate_url:o,id_str:r}=e,a=BigInt(r),l={aweType:p.c6.AWEME_EMOJI_SELF,createdAt:0,display_name:s||"",height:t,width:i,image_id:a,image_type:"gif",is_card:!1,may_show_special_effect:!1,msgHint:"",package_id:0,updateConversationTime:!0,url:{height:0,uri:null==o?void 0:o.uri,url_list:null==o?void 0:o.url_list,width:0}};return{type:p.pp.BIG_EMOJI,content:_().stringify(l)}}function m(e){let{origin:t,id:n}=e,{width:i,height:s,uri:o,url_list:r}=t||{},a={aweType:p.c6.AWEME_SINGLE_HEYCAN_EMOJI,createdAt:0,display_name:"",height:s,width:i,image_id:n,image_type:"gif",is_card:!1,may_show_special_effect:!1,msgHint:"",package_id:0,updateConversationTime:!0,url:{height:0,uri:o,url_list:r,width:0}};return{type:p.pp.BIG_EMOJI,content:JSON.stringify(a)}}function C(e){let{height:t,id:n,width:i,animate_url:s,display_name:o,resource_type:r,static_url_list:a}=e,l=s;if(5===r){let e=Math.floor(Math.random()*a.length);l=a[e].static_url}let u={aweType:p.c6.AWEME_INTERACTIVE_EMOJI,createdAt:0,display_name:o,height:t,width:i,image_id:n,image_type:"gif",is_card:!1,may_show_special_effect:!1,msgHint:"",package_id:0,updateConversationTime:!0,url:{height:t,uri:l,url_list:[l],width:i}};return{type:p.pp.BIG_EMOJI,content:JSON.stringify(u)}}function T(e){let{height:t,id:n,width:i,animate_url:s,display_name:o}=e,r={aweType:p.c6.AWEME_SINGLE_HEYCAN_EMOJI,createdAt:0,display_name:o,height:t,width:i,image_id:n,image_type:"gif",is_card:!1,may_show_special_effect:!1,msgHint:"",package_id:0,updateConversationTime:!0,url:{height:0,uri:null==s?void 0:s.uri,url_list:null==s?void 0:s.url_list,width:0}};return{type:p.pp.BIG_EMOJI,content:JSON.stringify(r)}}function O(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{content:n}=e,i={};try{i=(t?_():JSON).parse(n)}catch(e){if(n&&Object.keys(n).length>0)return n;i={}}return i}function M(e,t){let n=e,i=t;return(null==e?void 0:e.includes("未成年充值"))&&(n="如遇未成年充值打赏问题，可在 {{1}} 内申请退款",i=[{key:1,action:4,name:"抖音App",link:"https://www.douyin.com/downloadpage/app"}]),{newTips:n,newTemplate:i}}function R(e){let{referenceInfo:t}=e,n={};if(t){let{hint:e}=t;try{let{refmsg_content:t}=JSON.parse(e);t&&(n=JSON.parse(t))}catch(e){n={}}}return n}function A(e,t){switch(t){case p.pp.STORY_PICTURE:return function(e){return{type:e}}(t);case p.pp.STORY_VIDEO:return function(e){return{type:e}}(t);default:return function(e){let{text:t,textExtra:n=[],content:i,type:s,referenceHint:o,referenceMessage:r}=e,l=[];a()(n,e=>{var t;let n=null==e?void 0:null===(t=e.info)||void 0===t?void 0:t.uid;if(n)try{l.push(parseInt(n))}catch(e){}});let u={mention_users:l,aweType:p.c6.AWEME_TEXT,richTextInfos:n};r&&(u.aweType=p.c6.TEXT_REF_MSG),t&&(u.text=t);let d={type:s||p.pp.TEXT,mentionedUsers:l,content:i||JSON.stringify(u)};return r&&(d.referenceHint=JSON.stringify(o),d.referenceMessage=r),d}(e)}}function N(e){var t;let{active_users:n,passive_users:i,locale_resources:s,template:o}=e||{},r=(null==s?void 0:null===(t=s[0])||void 0===t?void 0:t.text)||"",{curUserInfo:l}=h.Z,u=[];a()(n,e=>{let t=(null==e?void 0:e.nickname)||"";(null==l?void 0:l.uid)&&(null==l?void 0:l.uid)===(null==e?void 0:e.uid)&&(t="你"),u.push(t)});let d=[];a()(i,e=>{let t=(null==e?void 0:e.nickname)||"";(null==l?void 0:l.uid)&&(null==l?void 0:l.uid)===(null==e?void 0:e.uid)&&(t="你"),d.push(t)}),r=r.replace("{0}",u.join("、")).replace("{1}",d.join("、"));let _=[];return null==o||o.forEach(e=>{if((null==e?void 0:e.action)===4){var t;if((null==e?void 0:null===(t=e.extra)||void 0===t?void 0:t.is_full_text_match)&&e.key){let t=r.split(e.key);t.map((n,i)=>{_.push({type:"text",text:n}),void 0!==t[i+1]&&_.push({type:"href",text:e.key,href:e.link})})}}}),_.length?_:[{type:"text",text:r}]}function y(e,t){let n="";if(!e)return n;let{type:i,visible:s,isFromMe:o,content:r,sender:a,conversationId:l,conversationType:u,isRecalled:d}=e;if(d)return`${o?"你":""}撤回了一条消息`;let _={};try{_=JSON.parse(r)}catch(e){}switch(i){case p.pp.SYSTEM:n=D(null==_?void 0:_.tips,null==_?void 0:_.template)||"";break;case p.pp.BIG_EMOJI:n=`[${(null==_?void 0:_.display_name)||"表情"}]`;break;case p.pp.TEXT_ONCE_VIEW:n=o?null==_?void 0:_.text:"仅看一次消息";break;case p.pp.TEXT:n=(null==_?void 0:_.text)||"";break;case p.pp.SHARE_AWEME:n="分享[视频]";break;case p.pp.SAY_HELLO:let c=`我是${null==_?void 0:_.nickname}，`||"";n=`嗨～ ${c}聊聊天吧`;break;case p.pp.VOICE:case p.pp.IM_ENCRYPT_VOICE:n="[语音]";break;case p.pp.SHARE_LIVE:n="分享[直播]",(null==_?void 0:_.push_detail)&&(n+=`：${null==_?void 0:_.push_detail}`);break;case p.pp.CHANGE_STORY_PICTURE:if(t){let t=(0,E.xz)(e);n=(0,E.zo)(e)?o?t?"交换了位置":"发送了交换位置":t?"和你交换了位置":"发来位置和你交换":o?t?"回拍交换了图片":"发送了以图换图":t?"回拍交换了图片":"发来图片和你交换"}else n="[图片]";break;case p.pp.STORY_PICTURE_ONCE_VIEW:case p.pp.STORY_PICTURE:n="[图片]";break;case p.pp.STORY_VIDEO_ONCE_VIEW:case p.pp.STORY_VIDEO:n="[视频]";break;case p.pp.XPLAN_STICKER_EMOJI:n=`[${(null==_?void 0:_.display_name)||"表情"}]`;break;case p.pp.SHARE_PHOTOS:n="分享[图集]";break;case p.pp.REF_MSG:n=`${(null==_?void 0:_.shareMsgType)===p.pp.SHARE_PHOTOS?"分享[图集]":"分享[视频]"}`;break;case p.pp.GROUP_NOTICE_MESSAGE:n=N(_).map(e=>e.text).join("");break;case p.pp.GROUP_GREET_MESSAGE:n="和朋友打个招呼吧";break;case p.pp.GROUP_ANNOUNCEMENT_MESSAGE:n=`[群公告]${(null==_?void 0:_.notice_content)||""}`;break;case p.pp.SHARE_USER:n="[分享用户]";break;case p.pp.SHARE_COMMENT:n="分享[评论]";break;case p.pp.BULLET:n=String((null==_?void 0:_.push_detail)||"消息卡片");break;case p.pp.SHARE_LOCATION:n="[地理位置]";break;case p.pp.SHARE_WEB:n=`转发[链接]: ${(null==_?void 0:_.title)||""}`;break;default:n="暂不支持该消息类型"}return n}function L(e){var t;let n="";if(!e)return n;let{type:i,visible:s,isFromMe:o,content:r,sender:a,conversationId:l,isRecalled:u,conversationType:d}=e,{unSendMsgConversationMap:_,userInfoFromSdkMap:c,userInfoFromServerMap:v,abTestData:E}=h.Z,p="",I="";I=y(e);let g=null==c?void 0:null===(t=c[l])||void 0===t?void 0:t[a],S=null==v?void 0:v[a];return(p=(null==S?void 0:S.remark_name)||(null==g?void 0:g.alias)||(null==S?void 0:S.nickname)||"")&&(n+=`${p}:`),I&&(n+=I),n||""}function w(e){try{switch(v().fromValue(e).toNumber()){case p.pp.SHARE_AWEME:return"[分享视频]";case p.pp.SHARE_PHOTOS:return"[分享图集]";default:return""}}catch(e){return""}}function P(e,t){let n;let{type:o,content:r,sender:a}=e,{unSendMsgConversationMap:l,curUserInfo:u,abTestData:d,curConversation:_,userInfoFromSdkMap:c,userInfoFromServerMap:v}=h.Z,{uid:E,sec_uid:g,nickname:S,remark_name:f}=(null==v?void 0:v[a])||{};null==_||_.type;let m=null==u?void 0:u.uid,C={};try{C=JSON.parse(r)}catch(e){}let T={},O="",M=0;switch(o){case p.pp.BIG_EMOJI:T={content:"[表情]",refmsg_content:r};break;case p.pp.TEXT:T={content:C.text,refmsg_content:r};break;case p.pp.TEXT_ONCE_VIEW:T={content:"仅看一次消息",refmsg_content:r};break;case p.pp.SHARE_AWEME:M=1,T={content:`${w(o)}${C.content_title}`,refmsg_content:r};break;case p.pp.CHANGE_STORY_PICTURE:case p.pp.STORY_PICTURE_ONCE_VIEW:case p.pp.STORY_PICTURE:T={content:"[图片]",refmsg_content:r},O=C.itemId;break;case p.pp.STORY_VIDEO_ONCE_VIEW:case p.pp.STORY_VIDEO:T={content:"[视频]",refmsg_content:r},O=C.itemId;break;case p.pp.XPLAN_STICKER_EMOJI:T={content:"[表情]",refmsg_content:r};break;case p.pp.SHARE_PHOTOS:T={content:`${w(o)}${C.content_title}`,refmsg_content:r};break;case p.pp.BULLET:O=C.item_id,T={content:`${C.description||"消息卡片"}`,refmsg_content:r};break;case p.pp.REF_MSG:T={content:C.text,refmsg_content:r};break;default:return!1}return n=m!==E?I.dx.SCENE_TYPE_REPLY_OTHER:I.dx.SCENE_TYPE_REPLY_SELF,(0,s._)((0,i._)({refmsg_uid:E,itemId:O,nickname:f||S,refmsg_sec_uid:g,refmsg_type:o},T),{scene_type:n,version:M})}let b=e=>{let t=Date.now();return t-new Date(e).getTime()<=18e4},U=e=>(!(e>=0)||!(e<=1999))&&(!(e>5e4)||60001===e)&&!0,G=(e,t,n)=>{let i=[];return a()(e,e=>{if(u()(e)){let s=e.split(t),o=s.length,r=[];o>1?(a()(s,(e,t)=>{t===o-1?r.push(e):(r.push(e),r.push(n))}),i=i.concat(r)):i.push(e)}else i.push(e)}),i},k=(e,t)=>{if(!e)return[];if(!(null==t?void 0:t.length))return[e];let n={};a()(t,e=>{n[`{{${null==e?void 0:e.key}}}`]=e});let i=e.match(/{{\d+}}/g),s=[e];return a()(i,e=>{s=G(s,e,n[e])}),s};function D(e,t){let n=String(e);return Array.isArray(t)&&t.forEach(e=>{n=null==n?void 0:n.replace(`{{${null==e?void 0:e.key}}}`,null==e?void 0:e.name)}),n}function F(e,t,n){let i;let{content:s,sender:o}=e;try{i=JSON.parse(s)}catch(e){i={}}let{content_title:r,cover_height:a,cover_url:l,cover_width:u,is_card:d,itemId:_,msgHint:c,push_detail:v,uid:E,secUID:h}=i,g={aweType:p.c6.REF_MSG,scene_type:I.dx.SCENE_TYPE_REPLY_INPUT,content_title:r,cover_height:a,cover_width:u,cover_url:l,is_card:d,itemId:_,msgHint:c,push_detail:v,createdAt:0,text:t,richTextInfos:n,ref_uid:o,uid:E,sec_uid:h};return{type:p.pp.REF_MSG,content:JSON.stringify(g)}}},941987:function(e,t,n){n.d(t,{lD:function(){return u},v1:function(){return d},xS:function(){return l}});var i=n(439837),s=n.n(i),o=n(577603),r=n.n(o);s().extend(r());let a={0:"星期日",1:"星期一",2:"星期二",3:"星期三",4:"星期四",5:"星期五",6:"星期六"};function l(e){if(Date.now()-new Date(e).getTime()<=3e5)return"刚刚";let t=s()(e),n=s()(),i=t.format("HH:mm")||"";return e>n.startOf("day").valueOf()?i:e>n.subtract(1,"day").startOf("day").valueOf()?"昨天":e>=n.subtract(3,"day").startOf("day").valueOf()?a[t.day()]:e>=n.startOf("year").valueOf()?t.format("MM-DD")||"":t.format("YYYY-MM-DD")||""}function u(e){if(Date.now()-new Date(e).getTime()<=3e5)return"刚刚";let t=s()(e),n=s()(),i=t.format("HH:mm")||"";if(e>n.startOf("day").valueOf())return i;if(e>n.subtract(1,"day").startOf("day").valueOf())return`昨天 ${i}`;if(e>=n.subtract(3,"day").startOf("day").valueOf()){let e=t.day();return`${a[e]} ${i}`}return t.format("YYYY-MM-DD HH:mm")||""}function d(e){return!!(Date.now()-new Date(e).getTime()<=3e5)||!1}},975954:function(e,t,n){n.d(t,{J:function(){return h}});var i=n(134761);n(268917),n(675373),n(874386);var s=n(104013),o=n(846311),r=n.n(o),a=n(212138),l=n.n(a),u=n(302653),d=n.n(u),_=n(461634),c=n(763468),v=n(725519),E=n(593231);let h=new class e{get conversationInfoMap(){let e={};return l()(this.converSationListOrigin,t=>{let{id:n}=t;e[n]=t}),e}setCurConversationId(e){this.curConversationId=e}setDlgShow(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.showDlg=e,e&&this.conversationListOpenNum++}setCanShowImPush(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canShowImPush=e}clearAllPushList(){this.msgListToPush=[]}clearOldMsgListToPush(){var e,t;let n=(null===(e=this.msgListToPush)||void 0===e?void 0:e.length)||0;if(!(n<=1))null===(t=this.msgListToPush)||void 0===t||t.splice(0,n-1)}closeMsgPushPop(e){var t,n;if(!(null===(t=this.msgListToPush)||void 0===t?void 0:t.length))return;let i=0;l()(this.msgListToPush,(t,n)=>{(null==t?void 0:t.conversationId)===e&&(i=n)}),null===(n=this.msgListToPush)||void 0===n||n.splice(i,1)}async pushNewMsgInList(e,t){var n,i,s;if(!e||this.showDlg||!this.canShowImPush)return;let{conversationId:o,type:r,createdAt:a}=e;if((0,c.aU)(r)||new Date(a).getTime()+6e4<Date.now())return;await (0,v.Z)(1500);let l=t(o);if(null==l?void 0:null===(n=l.settingInfo)||void 0===n?void 0:n.mute)return;let u=((null===(i=this.msgListToPush)||void 0===i?void 0:i.length)||0)-1,d=null===(s=this.msgListToPush)||void 0===s?void 0:s[u],_=null==d?void 0:d.conversationId;_&&_===o?this.msgListToPush.splice(u,1,e):(this.msgListToPush=this.msgListToPush||[],this.msgListToPush.push(e))}get allFriendInfoList(){let e=[],t=this.allFriendListRealToFix||[],n=this.userInfoFromServerMap||{};return l()(t,t=>{let i=null==n?void 0:n[t];i&&e.push(i)}),d()(e,e=>null==e?void 0:e.uid)}setAllFriendListRealToFix(e){this.allFriendListRealToFix=e}setSecUidUserInfoMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!!e)l()(e,e=>{let{sec_uid:t}=e;t&&"0"!==t&&(this.secUidUserInfoMap[t]=e)})}setUserInfoFromServerMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!!e)l()(e,e=>{let{uid:t}=e;t&&"0"!==t&&(this.uidSecUidMap[t]=e.sec_uid,this.userInfoFromServerMap[t]=e)})}setConverSationList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.converSationListOrigin=e}async getPatchUserInfoAsync(e){var t;let n=null===(t=this.uidSecUidMap)||void 0===t?void 0:t[e];return this.getUserInfoMapAsync([n])}async getUserInfoMapAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(r()(e,async e=>{if(e){let[t,n]=await (0,E.Z)((0,_.RK)(e));n&&(this.setSecUidUserInfoMap([n]),this.setUserInfoFromServerMap([n]))}}))}constructor(){(0,i._)(this,"showDlg",!1),(0,i._)(this,"conversationListOpenNum",0),(0,i._)(this,"msgListToPush",[]),(0,i._)(this,"canShowImPush",!0),(0,i._)(this,"allFriendListRealToFix",[]),(0,i._)(this,"secUidUserInfoMap",{}),(0,i._)(this,"uidSecUidMap",{}),(0,i._)(this,"userInfoFromServerMap",{}),(0,i._)(this,"converSationListOrigin",[]),(0,i._)(this,"curConversationId",void 0),(0,s.makeAutoObservable)(this)}}},492163:function(e,t,n){n.d(t,{Z:function(){return D}});var i=n("134761"),s=n("520739"),o=n("878389");n("268917"),n("874386"),n("250440"),n("981168"),n("675373");var r=n("104013"),a=n("212138"),l=n.n(a),u=n("846311"),d=n.n(u),_=n("461819"),c=n.n(_),v=n("377530"),E=n.n(v),h=n("302653"),p=n.n(h),I=n("621631"),g=n("789145"),S=n("461634"),f=n("237652"),m=n("782442"),C=n("637005"),T=n("129150"),O=n("457815"),M=n("233570"),R=n("725519"),A=n("593231");let N=(e,t)=>(null==e?void 0:e.updatedAt)>(null==t?void 0:t.updatedAt),y=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(null==e?void 0:e.length)||0;if(i<=n)return n;let s=Math.floor((n+i)/2);return N(e[s],t)?n=s+1:i=s,y(e,t,n,i)};var L=n("676106"),w=n("763468"),P=n("416049"),b=n("322642");let{ConversationType:U}=I.m,{GROUP_CHAT:G,ONE_TO_ONE_CHAT:k}=U;var D=new class e{get conversationListFilter(){let e=this.converSationListOrigin||[],t=[];return l()(e,e=>{e&&(e.type!==G||e.type===G&&e.lastMessage)&&t.push(e)}),M.Z.warn("im-dev conversationListFilter",t),t}get stickOnTopCount(){let e=this.conversationListFilter||[],t=0;for(let n of e)if(null==n?void 0:n.isStickOnTop)t++;else break;return t}get converListWithStrangerBox(){var e,t,n;let i=(null===(e=this.conversationListFilter)||void 0===e?void 0:e.slice())||[],s=this.stickOnTopCount||0,o=(null===(t=this.conversationListFilter)||void 0===t?void 0:t.length)||0;if(this.strangerBoxCover){let e=y(i,null===(n=this.strangerBoxCover)||void 0===n?void 0:n.conversation,s,o);null==i||i.splice(e,0,this.strangerBoxCover)}return i}get allUnReadCount(){let e=c()(this.conversationListFilter,e=>{let{isMuted:t,unreadCount:n}=e;return t?0:n||0}),t=m.Le.getConfig(m.gI.UnReadCount)||{},n=t.im||0;return m.Le.setConfig(m.gI.UnReadCount,(0,s._)({},t,{im:e})),n!==e&&C.emit(C.EVENT.updateUnReadCount,!0),e}get allGroupList(){let e=[];return l()(this.conversationListFilter,t=>{let{type:n}=t;n===G&&e.push(t)}),p()(e,e=>null==e?void 0:e.id)}get conversationInfoMap(){let e={};return l()(this.converSationListOrigin,t=>{let{id:n}=t;e[n]=t}),e}get usersInConversationList(){let e=[];return l()(this.converSationListOrigin,t=>{let{id:n,type:i,toParticipantUserId:s}=t;s&&i===k&&e.push({uid:s,conversationId:n})}),p()(e,e=>null==e?void 0:e.uid)}get strongNoticeList(){let e=[];return l()(this.messageList,t=>{var n;let i=(0,w.t$)(t);!(null==t?void 0:t.isFromMe)&&(null==i?void 0:null===(n=i.ext)||void 0===n?void 0:n.strong_tips)&&e.push({contentObj:i,msg:t})}),e}get allFriendInfoList(){let e=[],t=this.allFriendListRealToFix||[],n=this.userInfoFromServerMap||{};return l()(t,t=>{let i=null==n?void 0:n[t];i&&e.push(i)}),p()(e,e=>null==e?void 0:e.uid)}setAllFriendListRealToFix(e){this.allFriendListRealToFix=e}get videoMsgList(){let e=[];return l()(this.messageList,t=>{let{type:n,clientId:i,isRecalled:s}=t||{};if(!s&&(null===L.ds||void 0===L.ds?void 0:L.ds.includes(n))){let{itemId:n,item_id:s}=(0,w.t$)(t)||{},o=null!=n?n:s;o&&e.push({awemeId:o,msgClientId:i})}}),e}setTheme(e){this.theme=e}setCurUserInfo(e){this.curUserInfo=e}setIsLogin(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isLogin=e}setDlgShow(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.showDlg=e,e&&this.conversationListOpenNum++}setAbTestData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.abTestData=e}setShareCollapse(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],{handleCollapse:t=()=>{},handleExpand:n=()=>{}}=this.shareStatusHandler;this.isShareCollapse=e,e?null==t||t():null==n||n()}setCurShareType(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.y.Video;this.shareType=e}setCurAwemeInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.awemeInfo=e}setCurShareUserInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.shareUserInfo=e}setCurShareCommentInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.shareCommentInfo=e}setCurShareLiveInfo(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.shareLiveInfo=e}setShareeListHeight(e){this.shareeListHeight=e}setShareStatusHandler(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{handleCollapse:()=>{},handleExpand:()=>{}};this.shareStatusHandler=e}setShareMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.shareMap=e}resetData(){}setAudioMd5(e){this.audioMd5=e}setConverSationList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=p()(e,e=>null==e?void 0:e.id),n=0,i=t.length;for(let e=0;e<i;e++){let i=t[e];if(!(null==i?void 0:i.isStickOnTop)){n=e;break}}let s=[];n>0&&(s=t.splice(0,n)).sort((e,t)=>{var n,i;let s=(null==e?void 0:null===(n=e.lastMessage)||void 0===n?void 0:n.createdAt)||0;return((null==t?void 0:null===(i=t.lastMessage)||void 0===i?void 0:i.createdAt)||0)-s}),this.converSationListOrigin=s.concat(t)}setCurConverSation(){var e,t,n;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(null===(e=this.curConversation)||void 0===e?void 0:e.id)!==(null==i?void 0:i.id)&&((null===(t=this.curConversation)||void 0===t?void 0:t.id)&&O.ImSdk.clearConversationMessage({conversationIds:[null===(n=this.curConversation)||void 0===n?void 0:n.id]}),this.removeMessageCacheIfNeed()),this.curConversation=i,this.curConversationId=null==i?void 0:i.id,this.serverIdMessageMap={},this.setIsStrangerConversation((null==i?void 0:i.isStrangerConversation)||!1)}setEnterConversation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T.eY.CHAT_NOTIFY;this.enterConversation=e}setCurMessageList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.serverIdMessageMap=(0,s._)({},this.serverIdMessageMap),this.messageList=p()(e,e=>{let{serverId:t,clientId:n}=e||{};return t&&(this.serverIdMessageMap[t]=e),n})}setConversationPullUp(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.conversationPullUpPriority=(0,o._)((0,s._)({},this.conversationPullUpPriority),{[null==e?void 0:e.shortId]:Date.now()})}setStrangerConverListObj(e){this.strangerConverListObj=e}setConversationMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.conversationMap||{};null==e||e.forEach(e=>{let{id:n}=e;t[n]=e}),this.conversationMap=t}setIsInStrangerConversationList(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isInStrangerConversationList=e}setIsStrangerConversation(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.isStrangerConversation=e}setStrangerBoxCover(e){let t=e?{conversation:e,converCellType:T.tQ.STRANGER}:null;this.strangerBoxCover=t}setStrangerMessageUnreadCount(e){this.strangerMessageUnreadCount=e}setCurGroupUserIdList(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.curGroupUserIdList=E()(e)}setConversationUserids(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n?this.conversationUserids[e]=E()(t):this.conversationUserids[e]=E()([...this.conversationUserids[e]||[],...t])}setUserInfoFromSdkMap(e,t,n){if(!this.userInfoFromSdkMap&&(this.userInfoFromSdkMap={}),!this.userInfoFromSdkMap[e]&&(this.userInfoFromSdkMap[e]={}),!this.userInfoFromSdkMap[e][t])this.userInfoFromSdkMap[e][t]=n,this.uidSecUidMap[t]=n.sec_uid}setSecUidUserInfoMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!!e)l()(e,e=>{let{sec_uid:t}=e;t&&"0"!==t&&(this.secUidUserInfoMap[t]=e)})}setUserInfoFromServerMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!!e)l()(e,e=>{let{uid:t}=e;t&&"0"!==t&&(this.uidSecUidMap[t]=e.sec_uid,this.userInfoFromServerMap[t]=e)})}setUserInfoForShareMap(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(!!e)this.userInfoForShareMap=this.userInfoForShareMap||{},l()(e,e=>{let{uid:t}=e;t&&"0"!==t&&(this.userInfoForShareMap[t]=e)})}setUserInfoBlockStatus(e){var t;let n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(null===(t=this.userInfoFromServerMap)||void 0===t?void 0:t[e])&&(this.userInfoFromServerMap[e].is_block=n)}setReplayMessageServerId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.replayMessageServerId=e}setClientTrayGuidClientId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;this.clientTrayGuidInfo={clientId:e,type:t}}setUnSendMsgConversation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!!e)t?this.unSendMsgConversationMap[e]=t:delete this.unSendMsgConversationMap[e]}setMultiUnSendMsgConversation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];e.forEach(e=>{let{conversationId:t,text:n,textExtra:i,replyMsgServerId:s}=e;t&&(this.unSendMsgConversationMap[t]={text:n,textExtra:i,replyMsgServerId:s})})}clearOldMsgListToPush(){var e,t;let n=(null===(e=this.msgListToPush)||void 0===e?void 0:e.length)||0;if(!(n<=1))null===(t=this.msgListToPush)||void 0===t||t.splice(0,n-1)}clearAllPushList(){this.msgListToPush=[]}closeMsgPushPop(e){var t,n;if(!(null===(t=this.msgListToPush)||void 0===t?void 0:t.length))return;let i=0;l()(this.msgListToPush,(t,n)=>{(null==t?void 0:t.conversationId)===e&&(i=n)}),null===(n=this.msgListToPush)||void 0===n||n.splice(i,1)}setHasJoinGroup(e){this.hasJoinGroupObj=e}setCanShowImPush(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.canShowImPush=e}setUserFollowStatusMap(e,t){if(!!e)this.userFollowStatusMap[e]=t}async getUserInfoMapAsync(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Promise.all(d()(e,async e=>{if(e){let[t,n]=await (0,A.Z)((0,S.RK)(e));n&&(this.setSecUidUserInfoMap([n]),this.setUserInfoFromServerMap([n]))}}))}async getPatchUserInfoAsync(e){var t;let n=null===(t=this.uidSecUidMap)||void 0===t?void 0:t[e];return this.getUserInfoMapAsync([n])}async getShareUserListAsync(){}async getEmojiMaps(){if(!(Object.keys(this.emojiMap).length>0)){let[e,t]=await (0,A.Z)((0,g.zk)());if(!e)0===t.statusCode&&(this.emojiMap=t.data)}}async getEmojiList(){if(this.emojiList.length>0)return this.emojiList;{await (0,A.Z)(this.getEmojiMaps());let e=[];return Object.values(this.emojiMap).forEach(t=>{1!==t.hide&&e.push(t)}),this.emojiList=e,e}}async getEmojiGifListAsync(){var e,t;if(null===(e=this.emojiGifList)||void 0===e?void 0:e.length)return this.emojiGifList;let[n,i]=await (0,A.Z)((0,f.xD)({}));return n?[]:(this.emojiGifList=(null==i?void 0:null===(t=i.emoticon_data)||void 0===t?void 0:t.stickers)||[],this.emojiGifList)}async getInteractiveEmojiListAsync(){var e;if(null===(e=this.interactiveEmojiList)||void 0===e?void 0:e.length)return this.interactiveEmojiList;let{statusCode:t,stickerList:n}=await (0,g.YX)();return 0!==t?[]:(this.interactiveEmojiList=n,this.interactiveEmojiList)}async getCustomEmojiListAsync(){var e,t,n,i,s;let o=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.customEmojiIsCompleted||this.customEmojiIsLoading||!o&&(null===(e=this.customEmojiList)||void 0===e?void 0:e.length))return this.customEmojiList;this.customEmojiIsLoading=!0;try{let e=await (0,g.Ol)(this.customEmojiCursor,20);if(0!==e.status_code)return this.customEmojiIsLoading=!1,this.customEmojiList;let r=(null===(n=e.custom_sticker_page_list)||void 0===n?void 0:null===(t=n.resources)||void 0===t?void 0:t[0].stickers)||[];o?this.customEmojiList=[...this.customEmojiList,...r]:this.customEmojiList=r,this.customEmojiCursor=(null===(i=e.custom_sticker_page_list)||void 0===i?void 0:i.next_cursor)||0,this.customEmojiIsCompleted=(null===(s=e.custom_sticker_page_list)||void 0===s?void 0:s.is_completed)||!1}catch(e){}finally{this.customEmojiIsLoading=!1}return this.customEmojiList}async getRecentEmojiAsync(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((null===(e=this.recentEmojiList)||void 0===e?void 0:e.length)&&!t)return this.recentEmojiList;let n=await (0,g.iT)(!1);return 0!==n.status_code?this.recentEmojiList=[]:(this.recentEmojiList=n.sticker_list,this.recentEmojiList)}async getRecentGifAsync(){var e;let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((null===(e=this.recentGifList)||void 0===e?void 0:e.length)&&!t)return this.recentGifList;let n=await (0,g.iT)(!0);return 0!==n.status_code?this.recentGifList=[]:(this.recentGifList=n.sticker_list,this.recentGifList)}async getShowSugEmoji(){let{enable_rec_emoticon:e,status_code:t}=await (0,g.nb)();0===t&&(this.showSugEmoji=!!e)}async setFollowUserAsync(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return(0,S.P_)(e,t)}async setUserBlockAsync(e,t,n,i){return(0,S.Ox)(e,t,n,i)}async pushNewMsgInList(e,t){var n,i,s;if(!e||!this.isLogin||this.showDlg||!this.canShowImPush)return;let{conversationId:o,type:r,createdAt:a}=e;if((0,w.aU)(r)||new Date(a).getTime()+6e4<Date.now())return;let{conversationInfoMap:l}=this,u=null==l?void 0:l[o];if(!u&&(await (0,R.Z)(1500),u=t(o)),null==u?void 0:null===(n=u.settingInfo)||void 0===n?void 0:n.mute)return;let d=((null===(i=this.msgListToPush)||void 0===i?void 0:i.length)||0)-1,_=null===(s=this.msgListToPush)||void 0===s?void 0:s[d],c=null==_?void 0:_.conversationId;c&&c===o?this.msgListToPush.splice(d,1,e):(this.msgListToPush=this.msgListToPush||[],this.msgListToPush.push(e))}setDownloadInfo(e){this.downloadInfo=e}setMessageVoiceText(e,t){this.messageVoiceTextMap[e]=t}constructor(){var e=this;(0,i._)(this,"theme",T.rS.light),(0,i._)(this,"curUserInfo",{}),(0,i._)(this,"abTestData",{}),(0,i._)(this,"isLogin",!1),(0,i._)(this,"showDlg",!1),(0,i._)(this,"isShareCollapse",!0),(0,i._)(this,"audioMd5",""),(0,i._)(this,"converSationListOrigin",[]),(0,i._)(this,"conversationPullUpPriority",{}),(0,i._)(this,"conversationMap",{}),(0,i._)(this,"isInStrangerConversationList",!1),(0,i._)(this,"curConversationId",void 0),(0,i._)(this,"curConversation",null),(0,i._)(this,"strangerBoxCover",null),(0,i._)(this,"enterConversation",T.eY.CHAT_NOTIFY),(0,i._)(this,"messageList",[]),(0,i._)(this,"messageDataCache",{}),(0,i._)(this,"curMsgOptPopId",""),(0,i._)(this,"curGroupUserIdList",[]),(0,i._)(this,"conversationUserids",{}),(0,i._)(this,"uidSecUidMap",{}),(0,i._)(this,"userInfoFromSdkMap",{}),(0,i._)(this,"secUidUserInfoMap",{}),(0,i._)(this,"userInfoFromServerMap",{}),(0,i._)(this,"unSendMsgConversationMap",{}),(0,i._)(this,"serverIdMessageMap",{}),(0,i._)(this,"emojiMap",{}),(0,i._)(this,"emojiList",[]),(0,i._)(this,"emojiGifList",[]),(0,i._)(this,"customEmojiList",[]),(0,i._)(this,"customEmojiCursor",0),(0,i._)(this,"customEmojiIsCompleted",!1),(0,i._)(this,"customEmojiIsLoading",!1),(0,i._)(this,"recentEmojiList",[]),(0,i._)(this,"recentGifList",[]),(0,i._)(this,"showSugEmoji",!0),(0,i._)(this,"interactiveEmojiList",[]),(0,i._)(this,"allFriendListRealToFix",[]),(0,i._)(this,"userInfoForShareMap",{}),(0,i._)(this,"msgListToPush",[]),(0,i._)(this,"awemeInfo",{}),(0,i._)(this,"shareType",b.y.Video),(0,i._)(this,"shareUserInfo",{}),(0,i._)(this,"shareCommentInfo",{}),(0,i._)(this,"shareLiveInfo",{}),(0,i._)(this,"shareeListHeight",0),(0,i._)(this,"shareMap",{}),(0,i._)(this,"replayMessageServerId",null),(0,i._)(this,"clientTrayGuidInfo",null),(0,i._)(this,"strangerMessageUnreadCount",0),(0,i._)(this,"isStrangerConversation",!1),(0,i._)(this,"shareStatusHandler",{handleCollapse:()=>{},handleExpand:()=>{}}),(0,i._)(this,"hasJoinGroupObj",{conversation:[],cursor:"0",hasMore:!0,loading:!1}),(0,i._)(this,"strangerConverListObj",{conversation:[],cursor:"0",hasMore:!0,loading:!1,unreadCount:0}),(0,i._)(this,"canShowImPush",!0),(0,i._)(this,"userFollowStatusMap",{}),(0,i._)(this,"selectChatUserShortId",""),(0,i._)(this,"isOpenMessageList",!0),(0,i._)(this,"maskIsTestGroupClickConversionListItem",!1),(0,i._)(this,"maskConversaionAnimationEnd",!1),(0,i._)(this,"maskIsExitConversation",!1),(0,i._)(this,"changeConversationItemStatus",!1),(0,i._)(this,"saveStrageConversaionInfo",{list:[],index:-1}),(0,i._)(this,"isShowGetConversaionListLoading",!0),(0,i._)(this,"isShowGetStrangeConversationListLoading",!0),(0,i._)(this,"isReportOpen",!1),(0,i._)(this,"selectedMessage",new Set),(0,i._)(this,"downloadInfo",{showDownload:!1}),(0,i._)(this,"conversationListOpenNum",0),(0,i._)(this,"messageVoiceTextMap",{}),(0,i._)(this,"isSdkInitFinish",!1),(0,i._)(this,"setCurMsgOptPopId",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e.curMsgOptPopId=t}),(0,i._)(this,"clearClientTrayGuidClientId",()=>{this.clientTrayGuidInfo=null}),(0,i._)(this,"setSelectChatUserShortId",function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";e.selectChatUserShortId=t}),(0,i._)(this,"setIsOpenMessageList",e=>{(0,P.G)("click_fold_im",{is_fold:Number(!e)}),this.isOpenMessageList=e}),(0,i._)(this,"setMaskIsTestGroupClickConversionListItem",e=>{this.maskIsTestGroupClickConversionListItem=e}),(0,i._)(this,"setMaskConversaionAnimationEnd",function(){let t=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e.maskConversaionAnimationEnd=!!t}),(0,i._)(this,"setMaskIsExitConversation",()=>{this.maskIsExitConversation=!0}),(0,i._)(this,"setChangeConversationItemStatus",e=>{this.changeConversationItemStatus=e}),(0,i._)(this,"setSaveStrageConversaionInfo",e=>{this.saveStrageConversaionInfo=(0,s._)({},this.saveStrageConversaionInfo,e)}),(0,i._)(this,"setIsShowGetConversaionListLoading",e=>{this.isShowGetConversaionListLoading=e}),(0,i._)(this,"setIsShowGetStrangeConversationListLoading",e=>{this.isShowGetStrangeConversationListLoading=e}),(0,i._)(this,"updateSelectedMessage",(e,t)=>{t?this.selectedMessage.add(e):this.selectedMessage.delete(e)}),(0,i._)(this,"getMessageDataCache",e=>{var t,n,i,s;let{conversationShortId:o,messageId:r,key:a}=e;if(!(null===(n=this.abTestData)||void 0===n?void 0:null===(t=n.imPerformanceOptimization)||void 0===t?void 0:t.virtual_message_list))return null;let l=null===(s=this.messageDataCache[o])||void 0===s?void 0:null===(i=s[r])||void 0===i?void 0:i[a];return null==l?void 0:l.data}),(0,i._)(this,"setMessageDataCache",async e=>{var t,n;let{conversationShortId:i,messageId:s,key:o,data:r}=e;if(!!(null===(n=this.abTestData)||void 0===n?void 0:null===(t=n.imPerformanceOptimization)||void 0===t?void 0:t.virtual_message_list))this.messageDataCache[i]=this.messageDataCache[i]||{timeStamp:Date.now()},this.messageDataCache[i][s]=this.messageDataCache[i][s]||{},this.messageDataCache[i][s][o]={data:r}}),(0,i._)(this,"removeMessageCacheIfNeed",()=>{Object.keys(this.messageDataCache).forEach(e=>{let t=this.messageDataCache[e];if(!!t)Date.now()-t.timeStamp>12e5&&delete this.messageDataCache[e]})}),(0,r.makeAutoObservable)(this,{theme:r.observable,curUserInfo:r.observable,abTestData:r.observable.shallow,isLogin:r.observable,showDlg:r.observable,isShareCollapse:r.observable,audioMd5:r.observable,converSationListOrigin:r.observable,conversationPullUpPriority:r.observable,curConversationId:r.observable,curConversation:r.observable,enterConversation:r.observable,messageList:r.observable,curMsgOptPopId:r.observable,curGroupUserIdList:r.observable,conversationUserids:r.observable,uidSecUidMap:r.observable,userInfoFromSdkMap:r.observable,userInfoFromServerMap:r.observable,userInfoForShareMap:r.observable,secUidUserInfoMap:r.observable,unSendMsgConversationMap:r.observable,serverIdMessageMap:r.observable,emojiMap:r.observable,emojiList:r.observable,emojiGifList:r.observable,allFriendListRealToFix:r.observable,msgListToPush:r.observable,awemeInfo:r.observable,shareMap:r.observable,replayMessageServerId:r.observable,shareStatusHandler:r.observable,hasJoinGroupObj:r.observable,isInStrangerConversationList:r.observable,strangerBoxCover:r.observable,strangerMessageUnreadCount:r.observable,conversationMap:r.observable,strangerConverListObj:r.observable,isStrangerConversation:r.observable,canShowImPush:r.observable,userFollowStatusMap:r.observable,selectChatUserShortId:r.observable,isOpenMessageList:r.observable,maskIsTestGroupClickConversionListItem:r.observable,maskConversaionAnimationEnd:r.observable,maskIsExitConversation:r.observable,changeConversationItemStatus:r.observable,saveStrageConversaionInfo:r.observable,isShowGetConversaionListLoading:r.observable,isReportOpen:r.observable,selectedMessage:r.observable,isSdkInitFinish:r.observable,messageDataCache:r.observable.ref,conversationListFilter:r.computed,allUnReadCount:r.computed,allGroupList:r.computed,conversationInfoMap:r.computed,allFriendInfoList:r.computed,usersInConversationList:r.computed,strongNoticeList:r.computed,converListWithStrangerBox:r.computed,stickOnTopCount:r.computed,videoMsgList:r.computed,setIsLogin:r.action,setDlgShow:r.action,setShareCollapse:r.action,setCurShareType:r.action,setCurAwemeInfo:r.action,setCurShareUserInfo:r.action,setCurShareCommentInfo:r.action,setCurShareLiveInfo:r.action,setShareeListHeight:r.action,setShareMap:r.action,setShareStatusHandler:r.action,resetData:r.action,setAudioMd5:r.action,setConverSationList:r.action,setCurConverSation:r.action,setCurMessageList:r.action,setConversationPullUp:r.action,setCurMsgOptPopId:r.action,setCurGroupUserIdList:r.action,setConversationUserids:r.action,setUserInfoFromSdkMap:r.action,setSecUidUserInfoMap:r.action,setUserInfoFromServerMap:r.action,setUserInfoForShareMap:r.action,setUnSendMsgConversation:r.action,clearOldMsgListToPush:r.action,closeMsgPushPop:r.action,setUserInfoBlockStatus:r.action,setReplayMessageServerId:r.action,setClientTrayGuidClientId:r.action,clearClientTrayGuidClientId:r.action,setHasJoinGroup:r.action,setIsInStrangerConversationList:r.action,setStrangerBoxCover:r.action,setStrangerMessageUnreadCount:r.action,setConversationMap:r.action,setStrangerConverListObj:r.action,setIsStrangerConversation:r.action,setCanShowImPush:r.action,setUserFollowStatusMap:r.action,setSelectChatUserShortId:r.action,setIsOpenMessageList:r.action,setMaskIsTestGroupClickConversionListItem:r.action,setMaskConversaionAnimationEnd:r.action,setMaskIsExitConversation:r.action,setChangeConversationItemStatus:r.action,setSaveStrageConversaionInfo:r.action,setIsShowGetConversaionListLoading:r.action,setDownloadInfo:r.action,getUserInfoMapAsync:r.action,getShareUserListAsync:r.action,getEmojiGifListAsync:r.action,pushNewMsgInList:r.action})}}},945730:function(e,t,n){let i;n.r(t),n.d(t,{getImStore:function(){return a}});var s=n(684207),o=n(492163),r=n(975954);let a=()=>{if(!i)try{i=s.O.getIsSaasPopup()?r.J:o.Z}catch(e){throw i=void 0,e}return i}},21480:function(e,t,n){n.d(t,{Z:function(){return s}});var i=n(134761);n(675373);class s{constructor(){(0,i._)(this,"promise",void 0),(0,i._)(this,"resolve",void 0),(0,i._)(this,"reject",void 0),this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}},593231:function(e,t,n){n.d(t,{F:function(){return i}}),n(209955);let i=e=>{let t="function"==typeof e?e():e;return(null==t?void 0:t.then)?t.then(e=>[null,e]).catch(e=>[e||Error("err"),void 0]):[Error("not promise or function"),void 0]};t.Z=i},974144:function(e,t,n){n.d(t,{B:function(){return i}});function i(e){var t,n;return(null==e?void 0:null===(n=e.coreInfo)||void 0===n?void 0:null===(t=n.ext)||void 0===t?void 0:t["a:s_group_type"])==="1021"}},866949:function(e,t,n){var i=n(492163);t.Z=e=>{var t;let{curConversation:n,userInfoFromSdkMap:s}=i.Z,{id:o}=n||{},{alias:r}=(null==s?void 0:null===(t=s[o])||void 0===t?void 0:t[e])||{};return r}},524621:function(e,t,n){n.d(t,{p:function(){return a}}),n(874386);var i=n(461634),s=n(593231),o=n(492163),r=n(129150);let a=async e=>{if(!e)return r.$u.FollowRelationUnknown;let{uidSecUidMap:t,userFollowStatusMap:n}=o.Z;if((null==n?void 0:n[e])||(null==n?void 0:n[e])===0)return null==n?void 0:n[e];let a=(null==t?void 0:t[e])||"";if(a){let[t,n]=await (0,s.Z)((0,i.RK)(a));if(t)return r.$u.FollowRelationUnknown;if(n){var l,u;let t=null!==(u=null==n?void 0:n.follow_status)&&void 0!==u?u:r.$u.FollowRelationUnknown;return null===(l=o.Z.setUserFollowStatusMap)||void 0===l||l.call(o.Z,e,t),t}}return r.$u.FollowRelationUnknown}},213309:function(e,t,n){n.d(t,{$0:function(){return l},T4:function(){return d},gD:function(){return a},n6:function(){return u}});var i=n(621631),s=n(722220),o=n(129150),r=n(462402);let a=e=>{var t,n;let i=null==e?void 0:null===(n=e.coreInfo)||void 0===n?void 0:null===(t=n.ext)||void 0===t?void 0:t[r.Nk.KEY_CREATE_GROUP_TYPE];return!!i&&("5"===i||"2"===i)},l=e=>{let{ext:t,sender:n,isFromMe:a,conversationType:l}=e,u=Number(t[r.S6.RECALL_ROLE]),d=t[r.S6.RECALL_UID];if(d&&l===i.m.ConversationType.GROUP_CHAT&&n!==d&&u!==o.GB.MEMBER)return u===o.GB.OWNER?{text:"群主撤回一条消息"}:{text:"群管理员撤回一条消息"};return a?{text:"你撤回了一条消息",reEdit:!0}:{text:`${(0,s.vW)(e)}撤回一条消息`}},u=e=>{var t;return"1"===String(null==e?void 0:null===(t=e.ext)||void 0===t?void 0:t["a:s_banned"])},d=e=>{let t=i.m.ConversationType.GROUP_CHAT;return(null==e?void 0:e.type)===t}},263005:function(e,t,n){n.d(t,{Z:function(){return v}});var i=n("782563"),s=n("134761"),o=n("567754"),r=n("572076");let a="https://www.douyin.com";var l=n("21480"),u=n("416049"),d=class e{constructor(){(0,s._)(this,"waitToInitDeferred",void 0),(0,s._)(this,"messageHandler",e=>{var t,n;(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.type)==="onFirstScreen"&&this.waitToInitDeferred.resolve(),(null==e?void 0:null===(n=e.data)||void 0===n?void 0:n.type)==="pang"&&this.waitToInitDeferred.resolve()}),(0,s._)(this,"listenerMessageFromTargetWindow",()=>{r.on("postMessage",(e,t)=>{this.messageHandler(t)})}),(0,s._)(this,"sendMessageToTargetWindow",(e,t)=>{r.invoke("postMessage",{toPageName:"im-page",type:e,params:t})}),(0,s._)(this,"openImNewPage",async e=>{var t;let{data:n}=await r.invoke("getMultitaskingWindowCount"),i=`${a}/chat?${o.stringify({isPopup:1,multi_window_open_from:"auto_open",multi_window_order:String(n)})}`,s=await r.invoke("createMultitaskingWindow",{url:i,useSmallMode:!1,useExtendTop:!0,useReuse:!0,useToMain:!0,useReload:!1,windowSize:{width:960,height:656,minWidth:670}});(null==s?void 0:null===(t=s.data)||void 0===t?void 0:t.useReuse)?(this.waitToInitDeferred=this.waitToInitDeferred||new l.Z,this.waitToInitDeferred.resolve()):this.waitToInitDeferred=new l.Z,this.openOrCreateConversation(e),(0,u.G)("open_im_new_page",{enter_from:e.enterFrom,launch_from:"aweme_desktop"})}),(0,s._)(this,"openOrCreateConversation",async e=>{if(!!e)await this.waitToInitDeferred.promise,this.sendMessageToTargetWindow("OpenConversationIfCreate",e)}),this.listenerMessageFromTargetWindow()}},_=n("516599"),c=class e{constructor(){(0,s._)(this,"targetWindow",void 0),(0,s._)(this,"waitToInitDeferred",void 0),(0,s._)(this,"isTargetWindowOkForWeb",()=>{if(this.targetWindow&&!1===this.targetWindow.closed)try{if(this.targetWindow.origin===a)return!0}catch(e){}return!1}),(0,s._)(this,"messageHandler",e=>{var t;if(e.origin===a)(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.type)==="onFirstScreen"&&this.waitToInitDeferred.resolve()}),(0,s._)(this,"sendMessageToTargetWindow",(e,t)=>{this.targetWindow.postMessage({type:e,params:t},a)}),(0,s._)(this,"openImNewPage",e=>{let t=`${a}/chat?${o.stringify({isPopup:1})}`;if(this.waitToInitDeferred=new l.Z,this.isTargetWindowOkForWeb()){this.waitToInitDeferred.resolve(),this.openOrCreateConversation(e),this.targetWindow.focus();return}window.removeEventListener("message",this.messageHandler),this.targetWindow=window.open(t),this.targetWindow?(window.addEventListener("message",this.messageHandler),this.openOrCreateConversation(e)):_.F.info("页面打开失败，请重试"),(0,u.G)("open_im_new_page",{enter_from:e.enterFrom,launch_from:"aweme_web"})}),(0,s._)(this,"openOrCreateConversation",async e=>{if(!!e)await this.waitToInitDeferred.promise,this.sendMessageToTargetWindow("OpenConversationIfCreate",e)})}},v=(0,i.DT)()?new d:new c},296447:function(e,t,n){n.d(t,{B:function(){return r}});var i=n(782563),s=n(687297),o=n(642793),r={NotOpen:0,0:"NotOpen",OpenOnConversationClick:1,1:"OpenOnConversationClick",OpenOnConversationDetailClick:2,2:"OpenOnConversationDetailClick"};t.Z=e=>{var t,n,r;if(!e)return 0;if((0,i.DT)()){if(!(0,o.T)())return 0;let e=null!==(r=(0,i.FJ)().awemePcClient)&&void 0!==r?r:"";if((0,s.y)(e,"<","6.4.0"))return 0}return(null===(t=e.pc_im_new_window)||void 0===t?void 0:t.open_type)==="conversation_click"?1:(null===(n=e.pc_im_new_window)||void 0===n?void 0:n.open_type)==="conversation_detail_click"?2:0}},732218:function(e,t,n){var i=n(296447),s=n(492163);t.Z=()=>(0,i.Z)(s.Z.abTestData)===i.B.OpenOnConversationClick},457815:function(e,t,n){let i;n.r(t),n.d(t,{ImSdk:function(){return ek},IM_EVENT_NAMES:function(){return eb}});var s,o=n("134761"),r=n("520739"),a=n("878389"),l=n("245580");n("874386"),n("268917"),n("950331"),n("927234"),n("250440"),n("675373"),n("954372"),n("826893"),n("214478"),n("807192"),n("99891"),n("779788"),n("602157");var u=n("621631"),d=n("811092"),_=n("855537"),c=n("473614"),v=n("651889"),E=n("355132"),h=n("445534"),p=n("261582"),I=n("9"),g=n("650317"),S=n("380855"),f=n("176147"),m=n("173489"),C=n("277928"),T=n("835649"),O=n("128231"),M=n.n(O),R=n("212138"),A=n.n(R),N=n("193533"),y=n.n(N),L=n("831202"),w=n("555106"),P=n("44905"),b=n("637005"),U=n("782563"),G=n("572076"),k=n("782442"),D=n("770989"),F=n("76637"),H=n("905611"),Z=n("35730"),V=n("408609"),W=n("33626"),x=n("725896");let Y={disableInitPull:!1,appId:6383,userId:"",deviceId:"",boe:!0,debug:!0,apiUrl:"http://imapi-boe.douyin.com",frontierUrl:"ws://frontier-boe.douyin.com/ws/v2",token:"",authType:u.m.AuthType.SESSION_AUTH,devicePlatform:"douyin_pc",appKey:"e1bd35ec9db7b8d846de66ed140b1ad9",service:5,fpId:9,withCredentials:!0,maxMessageCount:0,inboxType:0,timeout:3e4,acceptIncorrectInboxType:!0,biz:"douyin_web",disablePullIntervalWhenWsIsOnline:!1,triggerPullWhenReceiveEmptyContent:!0};var B=n("190638"),j=n("763468");class J extends B.f{async process(e){var t;let n=null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.type;return(0,j.aU)(n)?(e.needContinue=!1,e.data=null,e):e}}var K=n("84105"),$=n("358354");class X extends K.v{install(){}async sendPacket(e){return this.fillTtWidParam(e),e}fillTtWidParam(e){let t={};try{let e=(0,$.F)({});t.deviceId="0",t.session_did="0",t.webid=e.webid,t.fp=e.fp}catch(e){}e.device_id="0",e.headers=(0,r._)({},e.headers,t)}}var z=n("516599"),q=n("462402"),Q=n("676106"),ee=n("129150"),et=n("524621"),en=n("593231"),ei=n("725519"),es=n("492163"),eo=n("416049"),er=n("958829"),ea=n("129965");let{ConversationType:el}=u.m,{GROUP_CHAT:eu,ONE_TO_ONE_CHAT:ed}=el;var e_=async e=>{let{conversationType:t,isFromMe:n,conversationId:i}=e,{curConversation:s}=es.Z,{toParticipantUserId:o=""}=s||{},r=t===eu?ee.eD.GROUP:ee.eD.PRIVATE,a=n?ee.IM.ISME:ee.IM.NOISME,l={chat_type:r,is_self:a,message_type:(0,ea.G)(e),conversation_id:i};if(t===ed&&o){let e=await (0,et.p)(o);l.personal_relation=String(e)}return l},ec=n("91907"),ev=n("562017");n("990921");var eE=new WeakMap;class eh{add(){let e;return(0,ec._)(this,eE).push(new Promise(t=>{e=t})),e}run(e){return Promise.all((0,ec._)(this,eE)).then(t=>{null==e||e(t)})}constructor(){(0,ev._)(this,eE,{writable:!0,value:[]})}}var ep=n("233570"),eI=n("687381");let eg=()=>{let{host:e}=location;return/live.douyin.com/.test(e)};var eS=n("295847"),ef=n("355469"),em=n("461634"),eC=n("266861"),eT=n("263005"),eO=n("732218"),eM=n("21480"),eR=n("974144");let eA=/(https?:\/\/[A-Z0-9+&@#\/%?=~_|!:,.;]+)/i,eN=/http[s]?:\/\/live\.douyin\.com\/[\w\d]+/gi,{ConversationType:ey}=u.m,{GROUP_CHAT:eL,ONE_TO_ONE_CHAT:ew}=ey,eP=new x.Z;var eb={IM_SEND_MSG:"IM_SEND_MSG",IM_DELETE_CONVERSATION:"IM_DELETE_CONVERSATION",IM_VIDEO_MSG_RECALLED:"IM_VIDEO_MSG_RECALLED",IM_SEND_MSG_TIME_OUT:"IM_SEND_MSG_TIME_OUT"};let eU={disableInitPull:!1,appId:6383,appKey:"e1bd35ec9db7b8d846de66ed140b1ad9",userId:"",deviceId:"",service:5,debug:!1,apiUrl:"https://imapi.douyin.com",frontierUrl:"wss://frontier-im.douyin.com/ws/v2",authType:u.m.AuthType.SESSION_AUTH,token:"",fpId:9,withCredentials:!0,inboxType:1,devicePlatform:"douyin_pc",timeout:3e4,acceptIncorrectInboxType:!0,sharkAppName:"douyin_pc",maxMessageCount:0,sharkPriorityRegion:"cn",biz:"douyin_web",monitor:[...L.oe.getSlardarInstance()?[new d.a(L.oe.getSlardarInstance())]:[],new _.Cu({event(e,t){var n,i;null===(n=(i=window).collectEvent)||void 0===n||n.call(i,e,t)}},{metricsToReport:[..._.Dp,(0,_.af)(c.U.BizSdkInit+c.U.SuccessSuffix)]})],ppe:null!==(s=(0,w.$o)(Z.LocalStorageKeys.ImOptionPPE))&&void 0!==s?s:void 0,webSocketLevel:(0,w.$o)(Z.LocalStorageKeys.ImOptionDisableWS)?v._.Disable:v._.PushOnly,useBadgeCountForUnread:!0,unreadCountReport:!0,disablePullIntervalWhenWsIsOnline:!1,triggerPullWhenReceiveEmptyContent:!0},eG=[E.D,h.l,p.v,X,I.b,g.n,S.x];class ek{static tryStart(e,t,n){var s;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};ep.Z.warn("登录用户信息",t);let{uid:a}=t||{},{bytedIMInstance:l}=ek;es.Z.setIsLogin(e);let u=null===(s=(0,P.Es)())||void 0===s?void 0:s.user_unique_id;return e?!l&&(eS.Z.mark("imsdk_try_start"),i=a,ek.init((0,r._)({userId:a,deviceId:u||a,pullInterval:n.pullInterval},o),!0===V.uZ)):l&&ek.destroy(),ek.bytedIMInstance}static init(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t?(0,r._)({},Y,e):(0,r._)({},eU,e);ep.Z.warn("IM 初始化参数",n),!eg()&&(n.authType=u.m.AuthType.PASSPORT_CERT_AUTH,n.securityScene="web_protect",n.securityCertType="cookie",eG.push(f.f)),e.storage&&eG.push(m.C),ek.idToken=ef.ZP.instance({aid:6383});let i=new C.A(n,eG);return ek.bytedIMInstance=i,i.resolve(T.Uk.MessageManager).processors.unshift(new J(i.ctx)),eS.Z.mark("imsdk_init_start"),i.init().then(()=>{(0,em.v5)({}).then(e=>{(0,eC.C)(e)}),ek.getStrangerConversationPreview(),ek.getAllUserConversation(!0),eS.Z.mark("imsdk_init_end"),eS.Z.measure("imsdk_init_start","imsdk_init_end")}),ep.Z.warn("IM 实例",i),ek.listenEvents(),ek.bytedIMInstanceDeferred.resolve(i),b.emit(b.EVENT.IMInstanceReady),i}static destroy(){var e;ek.imEvents(),null===(e=ek.bytedIMInstance)||void 0===e||e.dispose(),ek.bytedIMInstance=null}static onEvent(e,t){return eP.on(e,t)}static emitEvent(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];eP.emit(e,...n)}static offEvent(e,t){eP.off(e,t)}static clearConversationMessage(e){var t,n;null===(n=ek.bytedIMInstance)||void 0===n||null===(t=n.clearConversationMessages)||void 0===t||t.call(n,{conversationIds:e,limitMessage:1e3})}static checkAndReportReadIndexGreater(e){for(let t of e){let e=t.readIndex,n=t.lastMessageIndex;if(e&&(null==n?void 0:n.greaterThan(0))&&e.sub(n).greaterThanOrEqual(1e4)){let{shortId:i}=t;if(ek.reportedReadIndexGreater.has(i))continue;(0,eo.G)("imsdk_debug_read_index_greater",{conversation_type:t.type,index_distance:e.sub(n).toNumber(),conversation_id:t.id,conversation_short_id:i,conversation_read_index:e.toString(),message_index_in_conversation:n.toString(),user_id:t.ctx.option.userId,debug_version:"2"}),ek.reportedReadIndexGreater.add(i)}}}static updateIsStrangerConver(){var e;let{id:t}=(null===es.Z||void 0===es.Z?void 0:es.Z.curConversation)||{},n=null===es.Z||void 0===es.Z?void 0:null===(e=es.Z.conversationMap)||void 0===e?void 0:e[t],i=null==n?void 0:n.isStrangerConversation;es.Z.setIsStrangerConversation(i)}static setCurConversation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;if((0,eO.Z)()&&e)return eT.Z.openImNewPage({conversationId:e.id,isStrangeConversation:null==e?void 0:e.isStrangerConversation,enterFrom:t||"setCurConversation"}),!0;if(es.Z.setCurConverSation(e),e){let{isStrangerConversation:e=!1}=es.Z;e?ek.strangerMessageUpsert():ek.messageUpsert(),eS.Z.mark("im_conversation_change")}else es.Z.setCurMessageList([]);return!1}static listenEvents(){let{bytedIMInstance:e}=ek;if(!e)return;let t=null==e?void 0:e.event;eS.Z.mark("imsdk_listen_events_start");let n=t.subscribe(v.c5.ConversationChange,()=>{ek.conversationChange(),ek.unreadCountReport()}),i=t.subscribe(v.c5.MessageUpsert,e=>{if(e){let{type:t}=e;if(t===Q.pp.GROUP_NOTICE_MESSAGE){let{curConversation:e}=es.Z;e&&ek.getMoreParticipants({conversation:e})}}ek.messageUpsert()}),s=t.subscribe(v.c5.ReceiveNewMessage,e=>{ep.Z.log("ReceiveNewMessage",e),es.Z.pushNewMsgInList(e,e=>ek.getConversationById(e)),this.syncToTray()}),o=t.subscribe(v.c5.MessageRecall,e=>{ep.Z.log("MessageRecall",e);let{curConversation:t}=es.Z,{conversationId:n,type:i}=e;(null==t?void 0:t.id)===n&&(null===Q.ds||void 0===Q.ds?void 0:Q.ds.includes(i))&&ek.emitEvent("IM_VIDEO_MSG_RECALLED",e)}),r=t.subscribe(v.c5.InitFinish,()=>{var t,n;ek.checkClientPush(),es.Z.isSdkInitFinish=!0,eS.Z.mark("imsdk_listen_events_end"),(0,eo.G)("im_sdk_init_time",{duration:eS.Z.measure("imsdk_listen_events_start","imsdk_listen_events_end"),conversation_number:null==e?void 0:null===(n=e.getConversationList)||void 0===n?void 0:null===(t=n.call(e))||void 0===t?void 0:t.length})});ek.imEvents=()=>{t.unsubscribe(v.c5.MessageUpsert,i),t.unsubscribe(v.c5.ConversationChange,n),t.unsubscribe(v.c5.ReceiveNewMessage,s),t.unsubscribe(v.c5.InitFinish,r),t.unsubscribe(v.c5.MessageRecall,o)}}static syncToTray(){if(!!(0,U.DT)())G.invoke("isTopWebview").then(e=>{var t;if(!!e.data)D.a.setImConvUnreadData({message:((null===(t=es.Z.conversationListFilter)||void 0===t?void 0:t.slice())||[]).map(e=>{var t;if(!e.unreadCount||e.isMuted||!e.lastMessage)return null;let n=(0,eI.v)(e);return{conversation_name:n.title,unread_count:e.unreadCount,conversation_id:e.shortId,last_message_time:e.lastMessage.createdAt?Number(e.lastMessage.createdAt):0,last_message_id:e.lastMessage.serverId,avatar_url:null!==(t=Array.isArray(n.headIcon)?n.headIcon[0]:n.headIcon)&&void 0!==t?t:"",type:e.type,open_url:`sslocal://chat/center?conv_short_id=${e.shortId}&conversation_id=${e.id}`,is_stick_on_top:e.isStickOnTop}}).filter(e=>!!e)})})}static setConversationSettingInfo(e,t){let{bytedIMInstance:n}=ek;null==n||n.setConversationSettingInfo((0,r._)({conversation:e},t))}static async handleDeleteConversation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>{};ek.emitEvent("IM_DELETE_CONVERSATION",e),t&&await (0,ei.Z)(t),null==n||n()}static deleteConversation(e){if(!e)return;let{bytedIMInstance:t}=ek;null==t||t.deleteConversation({conversation:e}),null===es.Z||void 0===es.Z||es.Z.setCurConverSation()}static async deleteStrangerConversation(e,t){if(!e)return;let{bytedIMInstance:n}=ek,[i,s]=await (0,en.F)(null==n?void 0:n.deleteStrangerConversation({conversation:e}));if(!i)null==t||t(),null===es.Z||void 0===es.Z||es.Z.setCurConverSation()}static deleteAllStrangerConversation(){let{bytedIMInstance:e}=ek;null==e||e.deleteAllStrangerConversation(),null===es.Z||void 0===es.Z||es.Z.setCurConverSation(),null===es.Z||void 0===es.Z||es.Z.setIsInStrangerConversationList(!1)}static async getConversationWithUid(e){if(!e)return;let t=await ek.bytedIMInstanceDeferred.promise;if(!t)return;let n=t.getConversationList(),i={};A()(n,e=>{let{id:t,type:n,toParticipantUserId:s}=e;n===ew&&s&&(i[s]=e)});let s=null==i?void 0:i[e];if(!s){var o;let[n,i]=await (0,en.F)(t.createConversation({type:ew,participants:e,inboxType:0}));if(n)return;let{statusCode:r,body:a}=i,l=null==a?void 0:null===(o=a.conversation)||void 0===o?void 0:o.conversation_id;0===r&&l&&(s=t.getConversation({conversationId:l}))}return s}static async getAllUserConversation(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{hasJoinGroupObj:t}=es.Z,n=t;if(n.loading)return;if(e){let e={conversation:[],cursor:"0",hasMore:!0,loading:!1};es.Z.setHasJoinGroup(e),n=e}es.Z.setHasJoinGroup((0,a._)((0,r._)({},n),{loading:!0}));let{cursor:i,hasMore:s}=n;if(s){var o;let{bytedIMInstance:e}=ek,[t,s]=await (0,en.F)(null==e?void 0:e.getUserConversationList({type:eL,inboxType:0,limit:10,sortType:1,cursor:i}));if(ep.Z.log("getAllUserConversation",t,s),t){es.Z.setHasJoinGroup((0,a._)((0,r._)({},n),{loading:!1}));return}let{conversation:l,cursor:u,hasMore:d}=s||{},_=null===(o=n.conversation)||void 0===o?void 0:o.concat(l);es.Z.setHasJoinGroup({conversation:_,cursor:y().fromValue(u).toString(),hasMore:d,loading:!1})}}static createMsg(e,t){let n=null===es.Z||void 0===es.Z?void 0:es.Z.curConversation;return(0,l._)(ek,ek,eZ).call(ek,n,e,t)}static async sendMessage(e,t){let{bytedIMInstance:n}=ek,i=null===es.Z||void 0===es.Z?void 0:es.Z.curConversation;if(!n||!i)return;let[s,o]=await (0,en.F)((0,l._)(ek,ek,eZ).call(ek,i,e)),r=!1;return setTimeout(()=>{!r&&ek.emitEvent("IM_SEND_MSG_TIME_OUT",{message:o})},450),(0,l._)(this,ek,eH).call(ek,o,t).then(()=>(r=!0,o))}static resendMessage(e,t){return(0,l._)(this,ek,eH).call(ek,e,t)}static getConversationById(e){var t,n,i,s;let{bytedIMInstance:o}=ek,r=null;try{r=null===(t=o.getConversationList({filter:t=>t.id===e||t.shortId===e}))||void 0===t?void 0:t[0]}catch(t){L.oe.captureException("IM",t,{conversationId:e,userId:null==o?void 0:null===(n=o.option)||void 0===n?void 0:n.userId,conversationCount:String(null===(i=null!==(s=o.getConversationList())&&void 0!==s?s:[])||void 0===i?void 0:i.length)})}return r}static async getConversationByIdWithOnline(e){let t=this.getConversationById(e.conversationId);if(t)return t;if(!t){let{bytedIMInstance:t}=ek;return await t.getConversationOnline(e)}}static async fetchConversation(e){let{bytedIMInstance:t}=ek;if(t){let[n,i]=await (0,en.F)(t.fetchConversation(e));return i}}static async sendUserMsg(e,t,n){let i=null==e?void 0:e.length;if(!i)return;let{bytedIMInstance:s}=ek,o=s.getConversationList(),u={};A()(o,e=>{let{id:t,type:n,toParticipantUserId:i}=e;n===ew&&i&&(u[i]=e)});let d=new eh,_=new eh;for(let o=0;o<i;o++){let i=e[o],v=null==u?void 0:u[i];if(!v&&i){var c;let[e,t]=await (0,en.F)(s.createConversation({type:ew,participants:i,inboxType:0}));if(e)continue;let{statusCode:n,body:o}=t,r=null==o?void 0:null===(c=o.conversation)||void 0===c?void 0:c.conversation_id;0===n&&r&&(v=s.getConversation({conversationId:r}))}if(v){let[e,i]=await (0,en.F)((0,l._)(ek,ek,eZ).call(ek,v,t));if(!i)continue;let s=d.add(),o=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s(t)},u=_.add(),c=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u(t)};await (0,l._)(this,ek,eH).call(ek,i,(0,a._)((0,r._)({},n),{beforeSend:o,afterSend:c}))}}d.run(null==n?void 0:n.beforeSend),_.run(null==n?void 0:n.afterSend)}static async sendGroupMsg(e,t,n){let i=null==e?void 0:e.length;if(!i)return;let s=null===es.Z||void 0===es.Z?void 0:es.Z.conversationInfoMap,o=new eh,u=new eh,{bytedIMInstance:d}=ek;for(let _=0;_<i;_++){let i=e[_],c=null==s?void 0:s[i];if(!c){let e={conversationId:i,shortId:i,type:eL},[t,n]=await (0,en.F)(d.getConversationOnline(e));!t&&n&&(c=n)}if(c){let[e,i]=await (0,en.F)((0,l._)(ek,ek,eZ).call(ek,c,t));if(i){let e=o.add(),t=function(){for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];e(n)},s=u.add(),d=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s(t)};await (0,l._)(this,ek,eH).call(ek,i,(0,a._)((0,r._)({},n),{beforeSend:t,afterSend:d}))}}}o.run(null==n?void 0:n.beforeSend),u.run(null==n?void 0:n.afterSend)}static async getIdConverMap(e){let{bytedIMInstance:t}=ek,n=t.getConversationList(),i={},s={};A()(n,e=>{let{id:t,type:n,toParticipantUserId:o}=e;n===ew&&o?i[o]=e:n===eL&&(s[t]=e)});let o=e.length;for(let n=0;n<o;n++){let{uid:s,type:o}=e[n];if(o===ew&&s&&!i[s]){var r;let[e,n]=await (0,en.F)(t.createConversation({type:ew,participants:s,inboxType:0}));if(e)continue;let{statusCode:o,body:a}=n,l=null==a?void 0:null===(r=a.conversation)||void 0===r?void 0:r.conversation_id;0===o&&l&&(i[s]=t.getConversation({conversationId:l}))}}return{converPrevOne2OneMap:i,converPrevGroupMap:s}}static async sendUserAndGroupMsg(e,t,n){let i=null==e?void 0:e.length;if(!i)return;let[s,o]=await (0,en.F)(ek.getIdConverMap(e));if(s)return;let{converPrevOne2OneMap:u,converPrevGroupMap:d}=o,_=new eh,c=new eh;for(let s=0;s<i;s++){let{uid:i,type:o}=e[s],v=o===ew?u[i]:d[i];if(v){let[e,i]=await (0,en.F)((0,l._)(ek,ek,eZ).call(ek,v,t));if(!i)continue;let s=_.add(),o=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];s(t)},u=c.add(),d=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];u(t)};await (0,l._)(this,ek,eH).call(ek,i,(0,a._)((0,r._)({},n),{beforeSend:o,afterSend:d}))}}_.run(null==n?void 0:n.beforeSend),c.run(null==n?void 0:n.afterSend)}static async recallMessage(e){let{bytedIMInstance:t}=ek;return null==t?void 0:t.recallMessage({message:e})}static deleteMessage(e){let{bytedIMInstance:t}=ek;return null==t?void 0:t.deleteMessage({message:e})}static async setLikeMsg(e,t,n){let i=await e_(e);return i.action=n?"cancel":"like",(0,eo.G)("like_message",i),(0,l._)(this,ek,eV).call(ek,e,(0,r._)((0,a._)((0,r._)({},q.r9.LOVE),{operation:u.m.OPERATION_TYPE.ADD_PROPERTY_ITEM}),t))}static async setMsgFlightStatus(e,t){return(0,l._)(this,ek,eV).call(ek,e,{key:"flightStatus",value:t,operation:u.m.OPERATION_TYPE.ADD_PROPERTY_ITEM})}static getMoreMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50,n=Promise.resolve({messages:[],hasMore:null,cursor:0});if(!e)return n;let{bytedIMInstance:i}=ek,s=e.getMessageList(),o=null==s?void 0:s[0],r=i.getMessagesByConversation({conversation:e,cursor:o,limit:t}).then(e=>(ek.messageUpsert(),e));return o?r:n}static getConversationParticipants(e){let{bytedIMInstance:t}=ek,n=t.getConversationParticipants({conversation:e});return(0,l._)(this,ek,eW).call(ek,null==e?void 0:e.id,n,!0),n}static getMoreParticipants(e){let{bytedIMInstance:t}=ek;return Promise.all([t.getConversationParticipantsAsync((0,r._)({},e)),t.getConversationBots({conversation:e.conversation}).catch(e=>null)]).then(t=>{var n;let[i,s]=t,o=[...i,...s];return(0,l._)(this,ek,eW).call(ek,null===(n=e.conversation)||void 0===n?void 0:n.id,o,!0),o}).catch(()=>[])}static async leaveConversation(e){let{bytedIMInstance:t}=ek;await t.leaveConversation({conversation:e}),await t.deleteConversation({conversation:e}),null===es.Z||void 0===es.Z||es.Z.setCurConverSation()}static async dissolveConversation(e){let{bytedIMInstance:t}=ek;await t.dissolveConversation({conversation:e}),await t.deleteConversation({conversation:e}),null===es.Z||void 0===es.Z||es.Z.setCurConverSation()}static getAllUserFromServer(){let e=(0,l._)(this,ek,ex).call(ek);return es.Z.getUserInfoMapAsync(e)}static getAllStrangerFromServer(){let e=(0,l._)(this,ek,eY).call(ek);return es.Z.getUserInfoMapAsync(e)}static getStrangerFromServerWithConver(e){let{userInfoFromServerMap:t,curUserInfo:n}=es.Z,i=null==n?void 0:n.uid,{id:s="",firstPageParticipant:o=[],participants:r}=e||{},a=null==t?void 0:t[s],u=r||(null==o?void 0:o.participants)||[];if((0,l._)(this,ek,eW).call(ek,s,u,!0),!a){let e=[];u.forEach(t=>{let{userId:n,secUid:s,user_id:o,sec_uid:r}=t;(n||y().fromValue(o).toString())!==i&&e.push(s||r)}),es.Z.getUserInfoMapAsync(e)}}static async markConversationRead(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{indexInConversation:i="",conversationId:s}=e||{},{bytedIMInstance:o}=ek,r=null;try{r=o.getConversation({conversationId:s})}catch(e){return}if(!!r){if(n)return r.settingInfo._readIndex=y().ZERO,o.markConversationRead({conversation:r});if(i&&r){if(t)o.markStrangerConversationRead({conversation:r});else{var a,l;(null==r?void 0:null===(l=r.lastMessageIndex)||void 0===l?void 0:null===(a=l.eq)||void 0===a?void 0:a.call(l,i))?o.markConversationRead({conversation:r,force:!0}):o.markConversationRead({conversation:r,readIndex:i})}}}}static async markAllStrangerConversationRead(){let{bytedIMInstance:e}=ek;return e.markAllStrangerConversationRead()}static async getMessgeByServerId(e){let{conversation:t,serverMessageId:n}=e,{bytedIMInstance:i}=ek;return i.getMessageByServerId({conversation:t,serverMessageId:n})}static checkClientPush(){let{conversationId:e,userId:t,enterMethod:n}=k.Le.getConfig(k.gI.IMStatusStore)||{};e&&b.emit(b.EVENT.openImConversation,{conversationId:e,enterMethod:n||ee.eY.CLIENT_PUSH}),t&&b.emit(b.EVENT.sendImUserMsg,{uid:t,enterMethod:n||ee.eY.CLIENT_PUSH}),e||t||!n||b.emit(b.EVENT.openImConversation,{enterMethod:n||ee.eY.CLIENT_PUSH})}static async isFromGroupOwner(e){if(!e)return!1;let{bytedIMInstance:t}=ek,{conversationId:n,sender:i}=e;if(!i)return!1;let s=t.getConversation({conversationId:n});if(!s)return!1;let{type:o,coreInfo:r}=s;return o===eL&&(null==r?void 0:r.owner)===i}static async getMoreVideoInMsg(){let{curConversation:e}=es.Z;(null===es.Z||void 0===es.Z?void 0:es.Z.curMsgOptPopId)&&es.Z.setCurMsgOptPopId();let t=[],n=[];if(e){let[i,s]=await (0,en.F)(ek.getMoreMessage(e));if(i)return{hasMore:!0,awemeIds:t,videoMsgList:n};let{hasMore:o=!0,messages:r=[]}=s||{};return A()(r,e=>{let{type:i,isRecalled:s,clientId:o}=e;if(!s&&(null===Q.ds||void 0===Q.ds?void 0:Q.ds.includes(i))){let{itemId:i,item_id:s}=(0,j.t$)(e)||{},r=null!=i?i:s;r&&(t.push(r),n.push({awemeId:r,msgClientId:o}))}}),{hasMore:o,awemeIds:t,videoMsgList:n}}return{hasMore:!0,awemeIds:t,videoMsgList:n}}static upsertConversationSettingExtInfo(e,t){if(!e)return;let{bytedIMInstance:n}=ek;null==n||n.upsertConversationSettingExtInfo((0,r._)({conversation:e},t))}static async addParticipants(e){let{bytedIMInstance:t}=ek;return await t.addParticipants(e)}}async function eD(e,t,n){var i,s,o;let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",{conversationId:a,conversationType:l,referenceInfo:u,mentionedUsers:d,type:_}=t,{isOpenMessageList:c}=es.Z;if(!e)return;let{toParticipantUserId:v}=e,E=l===ew?await (0,et.p)(v):ee.$u.FollowRelationUnknown;if(u){let e={conversation_id:a,chat_type:ea.n[l],message_type:n};l===ew&&(e.personal_relation=String(E)),(0,eo.G)("quote_message",e)}d&&d.length>0&&d.forEach(e=>{var t;let n=es.Z.userInfoFromServerMap[e];(0,eo.G)("send_at_message",{conversation_id:a,at_user_id:e,at_type:(null==n?void 0:null===(t=n.im_role_ids)||void 0===t?void 0:t.includes(F.L.AiChatBotRole))?"ai_role":"user",at_ai_name:null==n?void 0:n.nickname})});let h={conversation_id:a,chat_type:ea.n[l],to_user_id:v||"",message_type:n,real_message_type:_,enter_method:er.Q[r],online_status:null===(i=W.m.statusStore[es.Z.uidSecUidMap[v]])||void 0===i?void 0:i.lastActiveLogValue};h.is_fold=Number(!c),l===ew&&(h.personal_relation=String(E),(null===(o=es.Z.userInfoFromServerMap[v])||void 0===o?void 0:null===(s=o.im_role_ids)||void 0===s?void 0:s.includes(F.L.AiChatBotRole))&&(h.chat_type="ai_role")),(0,eo.G)("send_message",h),(0,eo.G)("soraka_sli_report",{scene:"pc-im-send-message",status:"begin",context:h});let{text:p=""}=(0,j.t$)(t);if(eA.test(p)){let e=eN.test(p);(0,eo.G)("send_link",{enter_from:er.Q[r],chat_type:ea.n[l],conversation_id:a,to_user_id:v||"",link_type:e?"live_share_link":"other"})}}function eF(e,t,n,i){var s,o,a,l,u;let d,_=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},{conversationId:v,conversationType:E,type:h,serverId:p,mentionedUsers:I}=t;if(!e||!i){(0,eo.G)("soraka_sli_report",{scene:"pc-im-send-message",status:"fail",context:{conversation_id:v,message_type:n,real_message_type:h,messgae_id:p||"",enter_method:er.Q[_],error_message:"fe: thisConver or res is null"}});return}let{toParticipantUserId:g}=e,{statusCode:S,success:f,checkCode:m}=i;I&&I.length>0&&I.forEach(e=>{var t;let n=es.Z.userInfoFromServerMap[e];(0,eo.G)("send_at_message_response",{conversation_id:v,at_user_id:e,at_type:(null==n?void 0:null===(t=n.im_role_ids)||void 0===t?void 0:t.includes(F.L.AiChatBotRole))?"ai_role":"user",at_ai_name:null==n?void 0:n.nickname})});let C=E===ew&&(null===(o=es.Z.userInfoFromServerMap[g])||void 0===o?void 0:null===(s=o.im_role_ids)||void 0===s?void 0:s.includes(F.L.AiChatBotRole));try{d=JSON.parse((null==i?void 0:null===(u=i.body)||void 0===u?void 0:u.check_message)||"{}")}catch(e){}let T=(0,r._)({conversation_id:v,chat_type:C?"ai_role":ea.n[E],to_user_id:g||"",message_type:n,real_message_type:h,send_status:f?"success":"failure",status_code:`${S}`,check_code:(null==m?void 0:m.toString())||"",messgae_id:p||"",enter_method:er.Q[_],check_message_status_code:(null==d?void 0:d.status_code)||"",error_tips:(null==d?void 0:null===(l=d.status_msg)||void 0===l?void 0:null===(a=l.msg_content)||void 0===a?void 0:a.tips)||""},c);(0,eo.G)("send_message_response",T),(0,eo.G)("soraka_sli_report",{scene:"pc-im-send-message",status:f?"success":"fail",context:T})}async function eH(e,t){let{beforeSend:n=()=>{},afterSend:i=()=>{},enter_method:s="",retrying:o=!1}=t;if(e){var r,a,u,d,_,c,E,h,p,I;let{conversationId:t}=e,{bytedIMInstance:g}=ek,S=g.getConversation({conversationId:t}),f=(0,ea.G)(e);(0,l._)(ek,ek,eD).call(ek,S,e,f,s),null==n||n(e),ek.idToken=ef.ZP.instance({aid:6383});let[m,C]=await (0,en.F)(ek.idToken.getIdentitySecurityToken({scene:"web_im"},o));if((null==m?void 0:null===(r=m.data)||void 0===r?void 0:r.is_zti_timeout_error)===1){e.flightStatus=v.b3.Failed,z.F.info("系统繁忙，修改时间后可以正常使用私信功能");let n={conversation_id:t,send_status:"failure",enter_method:er.Q[s],error_code:null==m?void 0:null===(E=m.data)||void 0===E?void 0:E.error_code,is_network_error:null==m?void 0:null===(h=m.data)||void 0===h?void 0:h.is_network_error,is_zti_timeout_error:1};(0,eo.G)("send_message_response",n);return}let{identity_security_param:T,real_device_id:O}=C||{};g.updateSendMessageHeaders({identity_security_token:T||"",identity_security_device_id:O||"",identity_security_aid:"6383"});let M=await g.sendMessage({message:e});if(o)return M;if((null==M?void 0:null===(a=M.body)||void 0===a?void 0:a.status)===3)try{let t=JSON.parse((null==M?void 0:M.checkMsg)||"{}");if(null==t?void 0:t.decision_conf){z.F.info("行为存在异常，需要完成二次验证");try{await (0,H.dI)({request:()=>null},{headers:{"x-vc-bdturing-parameters":btoa(t.decision_conf)},config:{url:""}},{uid:null===(p=es.Z.curUserInfo)||void 0===p?void 0:p.uid}),M=await ek.resendMessage(e,{enter_method:s,retrying:!0})}catch(e){}}(null==t?void 0:t.status_code)===7914&&(null===(I=JSON.parse((null==t?void 0:t.extra)||"null"))||void 0===I?void 0:I.identity_token_check_status)==="fail"&&(M=await ek.resendMessage(e,{enter_method:s,retrying:!0}))}catch(e){}ek.emitEvent("IM_SEND_MSG",{message:e,res:M});let R={tokenRes:`${!!(null==C?void 0:C.identity_security_param)},${!!(null==C?void 0:C.real_device_id)}`,identitySecurityTokenError:m?JSON.stringify({error_code:null==m?void 0:null===(u=m.data)||void 0===u?void 0:u.error_code,is_network_error:null==m?void 0:null===(d=m.data)||void 0===d?void 0:d.is_network_error,is_zti_timeout_error:null==m?void 0:null===(_=m.data)||void 0===_?void 0:_.is_zti_timeout_error,message:null==m?void 0:null===(c=m.data)||void 0===c?void 0:c.description}):""};return(0,l._)(this,ek,eF).call(ek,S,e,f,M,s,R),null==i||i({conversation:S,message:e,res:M}),M}}function eZ(e,t,n){let{bytedIMInstance:i}=ek,s=(0,j.MZ)(t,n);return null==i?void 0:i.createMessage((0,r._)({conversation:e},s))}function eV(e,t){let{bytedIMInstance:n}=ek;return null==n?void 0:n.modifyMessageProperty({message:e,modifyContent:[t]})}function eW(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{curUserInfo:i}=es.Z,s=null==i?void 0:i.uid,o=[];A()(t,t=>{let{userId:n,role:i,secUid:r,user_id:a,sec_uid:l,alias:u=""}=t,d=n||y().fromValue(a).toString();d!==s&&o.push(d),d&&es.Z.setUserInfoFromSdkMap(e,d,{alias:u,uid:d,role:i,sec_uid:r||l})}),es.Z.setConversationUserids(e,o,n)}function ex(){let{converSationListOrigin:e,uidSecUidMap:t,userInfoFromSdkMap:n,userInfoFromServerMap:i}=es.Z;A()(e,e=>{let{id:t,type:i,toParticipantUserId:s,firstPageParticipant:o,participants:r}=e;null==n||n[t],(0,l._)(this,ek,eW).call(ek,t,r||(null==o?void 0:o.participants),!1)});let s=[];return A()(t,(e,t)=>{let n=i[t];e&&!n&&s.push(e)}),s}function eY(){let{strangerConverListObj:e,uidSecUidMap:t,userInfoFromSdkMap:n,userInfoFromServerMap:i}=es.Z,s=(null==e?void 0:e.conversation)||[],o=[];return A()(s,e=>{let{id:t="",firstPageParticipant:i=[],participants:s}=e;null==n||n[t],(0,l._)(this,ek,eW).call(ek,t,s||(null==i?void 0:i.participants),!0)}),A()(t,(e,t)=>{let n=i[t];e&&!n&&o.push(e)}),o}(0,o._)(ek,"bytedIMInstance",null),(0,o._)(ek,"bytedIMInstanceDeferred",new eM.Z),(0,o._)(ek,"idToken",null),(0,o._)(ek,"imEvents",()=>{}),(0,o._)(ek,"conversationChange",M()(()=>{var e,t;let n=null!==(t=null===(e=ek.bytedIMInstance)||void 0===e?void 0:e.getConversationList({filter:e=>{var t,n,s,o,r;return(null===(r=e.firstPageParticipant)||void 0===r?void 0:null===(o=r.participants)||void 0===o?void 0:null===(s=o.map)||void 0===s?void 0:null===(n=s.call(o,e=>{var t,n;return null==e?void 0:null===(n=e.user_id)||void 0===n?void 0:null===(t=n.toString)||void 0===t?void 0:t.call(n)}))||void 0===n?void 0:null===(t=n.includes)||void 0===t?void 0:t.call(n,i))&&!(null==e?void 0:e.isStrangerConversation)&&!(0,eR.B)(e)}}))&&void 0!==t?t:[];return es.Z.setConverSationList(n),es.Z.setConversationMap(n),ek.checkAndReportReadIndexGreater(n),Promise.all([ek.getAllUserFromServer(),ek.getStrangerConversationPreview()]).then(()=>{ek.syncToTray()}),ek.updateIsStrangerConver(),n},200)),(0,o._)(ek,"reportedReadIndexGreater",new Set),(0,o._)(ek,"messageUpsert",M()(()=>{var e;let t=null===es.Z||void 0===es.Z?void 0:es.Z.curConversation,n=null!==(e=null==t?void 0:t.getMessageList())&&void 0!==e?e:[];es.Z.setCurMessageList(n)},200)),(0,o._)(ek,"strangerMessageUpsert",M()(async()=>{var e;let t=null===es.Z||void 0===es.Z?void 0:es.Z.curConversation;null===(e=ek.bytedIMInstance)||void 0===e||e.getStrangerConversationMessage({conversation:t}).then(e=>{es.Z.setCurMessageList(null!=e?e:[])}).catch(e=>{})},200)),(0,o._)(ek,"getStrangerConversationList",async function(){var e,t,n;let i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],{strangerConverListObj:s,setIsShowGetStrangeConversationListLoading:o,abTestData:l,setIsShowGetConversaionListLoading:u}=es.Z;o(!0);let d=!!(null==l?void 0:null===(e=l.imPerformanceOptimization)||void 0===e?void 0:e.im_entrance_display);!d&&u(!0);let _=s;if(null==_?void 0:_.loading)return;es.Z.setStrangerConverListObj((0,a._)((0,r._)({},_),{loading:!0})),i&&(_={conversation:[],cursor:"0",hasMore:!0,loading:!1,unreadCount:0});let{cursor:c="0",hasMore:v=!0}=_;if(!v){es.Z.setStrangerConverListObj((0,a._)((0,r._)({},_),{loading:!1}));return}let[E,h]=await (0,en.F)(null===(t=ek.bytedIMInstance)||void 0===t?void 0:t.getStrangerConversationList({limit:10,cursor:c}));E&&es.Z.setStrangerConverListObj((0,a._)((0,r._)({},_),{loading:!1}));let{conversation:p,cursor:I,hasMore:g,unreadCount:S}=h||{},f=(null==_?void 0:null===(n=_.conversation)||void 0===n?void 0:n.concat(p))||[];es.Z.setStrangerConverListObj({conversation:f,cursor:y().fromValue(I).toString(),hasMore:g,unreadCount:S,loading:!1}),o(!1),!d&&u(!1),es.Z.setConversationMap(f),ek.getAllStrangerFromServer(),ek.updateIsStrangerConver()}),(0,o._)(ek,"getStrangerConversationPreview",M()(()=>{var e;return null===(e=ek.bytedIMInstance)||void 0===e?void 0:e.getStrangerPreview({}).then(e=>{if(ep.Z.log("new-preview",e),e){let{conversation:t={},unreadCount:n=0}=e;ek.getStrangerFromServerWithConver(t),es.Z.setStrangerMessageUnreadCount(n),es.Z.setStrangerBoxCover(t)}else es.Z.setStrangerBoxCover(null),es.Z.setStrangerMessageUnreadCount(0)})},200)),(0,o._)(ek,"unreadCountReport",M()(()=>{let{bytedIMInstance:e}=ek;null==e||e.unreadCountReport()},200))},326823:function(e,t,n){n.d(t,{a:function(){return r}});var i=n(20534),s=n(21480),o=n(684207);let r=async()=>(0,i.Z)()?(window.imContextDeferred=window.imContextDeferred||new s.Z,window.imContextDeferred.promise):o.O.getIsSaasPopup()?(window.imSaasPopupContextDeferred=window.imSaasPopupContextDeferred||new s.Z,window.imSaasPopupContextDeferred.promise):void 0;t.Z=r},20534:function(e,t){t.Z=()=>"/chat"===window.location.pathname},725519:function(e,t,n){n(675373);t.Z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new Promise(t=>{setTimeout(()=>{t(!0)},e||0)})}},416049:function(e,t,n){n.d(t,{G:function(){return r}});var i=n(520739),s=n(958829),o=n(16583);let r=(e,t)=>{try{s.i.sendLog(e,(0,i._)({page_host:o.OZ,enter_from:(0,o.yW)(),previous_page:(0,o.Os)()},t||{}))}catch(e){}}},129965:function(e,t,n){n.d(t,{G:function(){return d},n:function(){return _}});var i=n(621631),s=n(676106),o=n(763468),r=n(457815);let{ConversationType:a}=i.m,{GROUP_CHAT:l,ONE_TO_ONE_CHAT:u}=a,d=e=>{let{type:t,ext:n}=e,i=(0,o.t$)(e),a=null==i?void 0:i.type,l="";switch(t){case s.pp.TEXT:l="text";break;case s.pp.SHARE_WEB:0!==(null==i?void 0:i.aweType)&&(l=(null==i?void 0:i.msgTrack)||"");break;case s.pp.SHARE_WEB_FROM_THIRD_MESSAGE:l="share_from_third";break;case s.pp.XPLAN_STICKER_EMOJI:l=a===s.c6.AWEME_XEMOJI?"xmoji":"emoji";break;case s.pp.BIG_EMOJI:l=a===s.c6.AWEME_EMOJI_SELF?"emoji":a===s.c6.AWEME_NET_SEARCH_GIF?"giphy":a===s.c6.AWEME_GREET_EMOJI?"emoji":a===s.c6.AWEME_LITE_MSG_EMOJI?"lite_emoji":a===s.c6.AWEME_LITE_MSG_EMOJI_NEW?"lite_emoji":a===s.c6.AWEME_INTERACTIVE_EMOJI?"lite_emoji":"emoji";break;case s.pp.ONE_CARD:a===s.c6.GROUP_VOTE&&(l="poll");break;case s.pp.VOICE:case s.pp.ENCRYPT_VOICE:case s.pp.IM_ENCRYPT_VOICE:l="audio";break;case s.pp.ONLY_PICTURE:case s.pp.STORY_PICTURE:l="pic";break;case s.pp.STORY_VIDEO:l="video";break;case s.pp.SHARE_AWEME:l="share_video";break;case s.pp.SHARE_PHOTOS:l="share_photos";break;case s.pp.SHARE_COMPILATION:l="share";break;case s.pp.SHARE_USER:case s.pp.SHARE_MUSIC:case s.pp.SHARE_CHALLENGE:case s.pp.SHARE_STICKER:l="page";break;case s.pp.RED_PACKET:l="redpacket";break;case s.pp.SHARE_MINI_APP:l="mini_app";break;case s.pp.REF_MSG:l="ref_message";break;case s.pp.FRIEND_VIDEO_DM_COMMENT:l="friend_video_card";break;case s.pp.GROUP_INVITE_MESSAGE:let u=null==n?void 0:n["a:group_invite"];if("1"==`${u}`)l="group_card";else{let e=null==i?void 0:i.aweme_invite_card;l=(null==e?void 0:e.card_type)===1?"group_card":"unknown"}break;case s.pp.COMMAND_SHARE:l="token_video_card";break;case s.pp.SHARE_LIVE:l=a===s.c6.LIVE_KTV?"familiar_invitation_ktv":a===s.c6.LIVE_VOICE?"familiar_invitation_chatting_room":"live_card";break;case s.pp.FEED_LIVE_SHARE_INVITE_MESSAGE:l="co_play_invitation";break;case s.pp.DIRECT_INVITE:l="invite";break;case s.pp.GAME_INVITE:case s.pp.GAME_INVITE_V2:l="chat_game";break;case s.pp.CLOUD_GAME_INVITE:l="cloud_game_card";break;case s.pp.COUPON_ENTERPRISE:case s.pp.COUPON_FANS_GROUP:l="fansgroup_coupon";break;case s.pp.CHAT_CALL:l="chat_call";break;case s.pp.SHARE_PICTURE:l="share_picture";break;case s.pp.AT_FRIEND_INTERACT:l="publish_at";break;case s.pp.URGE_LEAVE_MESSAGE:l=r.ImSdk.isFromGroupOwner(e)?"reply_to_update":"ask_for_update";break;case s.pp.SHARE_LOCATION:l="location";break;case s.pp.STORY_PICTURE_ONCE_VIEW:l="only_once_pic";break;case s.pp.STORY_VIDEO_ONCE_VIEW:l="only_once_video";break;case s.pp.SHARE_COMMENT:l="share_comment";break;case s.pp.BULLET:l="bullet";break;default:l="unknown"}return l},_={[l]:"group",[u]:"private"}},999283:function(e,t,n){var i=n(134761);n(874386),n(209955),n(779788);var s=n(621631),o=n(651889),r=n(637005),a=n(457815),l=n(21480),u=n(326823),d=n(20534),_=n(684207),c=n(593231),v=n(945730);let E=s.m.ConversationType;t.Z=new class e{constructor(){(0,i._)(this,"newImContext",null),(0,i._)(this,"imSdkInstanceReadyDeferred",new l.Z),(0,i._)(this,"sendMessage",async e=>{await this.imSdkInstanceReadyDeferred.promise;let{uid:t,conversationId:n,messageInfo:i}=e;if(!!(t||n)&&!!i)if((0,d.Z)()||_.O.getIsSaasPopup()){var s;let o=t?{participantId:t}:{conversationShortId:n},[,r]=await (0,c.Z)(this.getConversationByIdWithOnlineAsync(o));if(!r)throw Error(`conversation为空 getConversationParams:${JSON.stringify(o)}`);(await (null===(s=this.newImContext)||void 0===s?void 0:s.imSdkService.sendMessageManager.createMessageBuilder({messageType:e.messageInfo.type,enterFrom:"douyin_web_share"}).conversation(r).content(null==i?void 0:i.content).callback({onSendBefore:t=>{var n;let{message:i}=t;null===(n=e.options)||void 0===n||n.beforeSend([[i]])},onSendFinished:t=>{var n;null===(n=e.options)||void 0===n||n.afterSend([[t]])}}).buildMessage())).send()}else e.conversationType===E.ONE_TO_ONE_CHAT?a.ImSdk.sendUserMsg([t],e.messageInfo,e.options):a.ImSdk.sendGroupMsg([n],e.messageInfo,e.options)}),(0,i._)(this,"doRequestUserInfoBySecUid",async e=>{if(await this.imSdkInstanceReadyDeferred.promise,(0,d.Z)()||_.O.getIsSaasPopup()){var t;null===(t=this.newImContext)||void 0===t||t.store.usersInfoStore.doRequestUsersInfoIfNeeded({secUids:[e]}),(0,v.getImStore)().getUserInfoMapAsync([e])}else(0,v.getImStore)().getUserInfoMapAsync([e])}),(0,i._)(this,"getUserInfoBySecUid",e=>{if((0,d.Z)()||_.O.getIsSaasPopup()){var t;return this.doRequestUserInfoBySecUid(e),null===(t=this.newImContext)||void 0===t?void 0:t.store.usersInfoStore.getUserBySecUid(e)}{let t=(0,v.getImStore)().secUidUserInfoMap[e];return!t&&this.doRequestUserInfoBySecUid(e),t}}),(0,i._)(this,"getConversationByIdWithOnlineAsync",async e=>{var t;let{participantId:n,conversationShortId:i}=e;if(await this.imSdkInstanceReadyDeferred.promise,!((0,d.Z)()||_.O.getIsSaasPopup()))return a.ImSdk.fetchConversation({shortId:i,participantId:n,inboxType:0});return null===(t=this.newImContext)||void 0===t?void 0:t.imSdkService.conversationManager.getConversationByUidOrShortIdIfOnline({conversationShortId:i,participantId:n})}),(0,i._)(this,"getConversationByShortId",e=>{var t;if(this.imSdkInstanceReadyDeferred.promise.then(()=>{if((0,d.Z)()||_.O.getIsSaasPopup()){var t;let n=null===(t=this.newImContext)||void 0===t?void 0:t.imSdkService.imSdkManager.getImSdkInstance();null==n||n.fetchConversation({shortId:e,inboxType:0})}else a.ImSdk.fetchConversation({shortId:e,inboxType:0})}),!((0,d.Z)()||_.O.getIsSaasPopup()))return(0,v.getImStore)().conversationInfoMap[e];return null===(t=this.newImContext)||void 0===t?void 0:t.store.conversationStore.conversationMap.get(e)}),(0,i._)(this,"openConversation",async e=>{let{uid:t,conversationId:n,conversationType:i,enterMethod:s}=e;if(await this.imSdkInstanceReadyDeferred.promise,(0,d.Z)()){var o;let[,e]=await (0,c.Z)(this.getConversationByIdWithOnlineAsync({participantId:t,conversationShortId:n}));if(!e)return;null===(o=this.newImContext)||void 0===o||o.uiApiManager.openConversationIfCreate({conversationId:e.id})}else i===E.ONE_TO_ONE_CHAT?r.emit(r.EVENT.sendImUserMsg,{uid:t,enterMethod:s}):r.emit(r.EVENT.openImConversation,{conversationId:n,enterMethod:s})}),(0,d.Z)()||_.O.getIsSaasPopup()?(0,u.Z)().then(e=>{this.newImContext=e,this.imSdkInstanceReadyDeferred.resolve()}):r.listen(r.EVENT.IMInstanceReady,()=>{var e,t;null===(t=a.ImSdk.bytedIMInstance)||void 0===t||null===(e=t.event)||void 0===e||e.subscribe(o.c5.InitFinish,()=>{this.imSdkInstanceReadyDeferred.resolve()})})}}},266861:function(e,t,n){n.d(t,{Z:function(){return A},C:function(){return R}});var i=n("520739");n("874386");var s=n("302653"),o=n.n(s),r=n("621631"),a=n("677350"),l=n("461634"),u=n("878389");n("268917");var d=n("212138"),_=n.n(d);let{ConversationType:c}=r.m,{GROUP_CHAT:v,ONE_TO_ONE_CHAT:E}=c,h=e=>e>=0?e:1/0,p=(e,t,n,i)=>{if(!e)return[];let s=0,o=[];for(let r=0;r<e.length;r++)if(s<t){let t=n(e[r]);if(!t||i.has(t))continue;i.add(t),o.push(e[r]),s++}else break;return o},I={enable:!0,recent_share_count:-1,sort_info_count:-1,signle_follow_count:-1,double_follow_count:-1};var g=e=>{var t;let{sorted_info:n,remove_share_panel_info:s=[],mix_recent_share_users:o=[],followings:r=[]}=e||{},{signle_follow_count:a,double_follow_count:l,recent_share_count:d,sort_info_count:c}=I,g=new Set,S=[],f=[],m=[],C=r;_()(s,e=>{let t=e.conv_id||e.sec_uid;g.add(t)});let T=h(d),O=h(c),M=p(o,T,e=>e.sec_uid||e.conv_id,g).map(e=>(0,u._)((0,i._)({},e),{conv_type:e.sec_uid?E:v})),R=p(n,O,e=>e.sec_uid||e.conv_short_id_str||e.conv_id,g).map(e=>(0,u._)((0,i._)({},e),{conv_id:String(e.conv_short_id_str||e.conv_id||""),conv_type:e.sec_uid?E:v}));for(let e=0;e<(null==C?void 0:C.length);e++){let t=C[e],n=(null==t?void 0:t.sec_uid)||t.uid||(null==t?void 0:t.conv_id);if("0"!==t.uid&&g.has(n))continue;let i=h(l),s=h(a);if(f.length<i&&(null==t?void 0:t.follow_status)===2?f.push(t):S.length<s&&(null==t?void 0:t.follow_status)===1?S.push(t):(null==t?void 0:t.follow_status)===0&&m.push(t),f.length>=i&&S.length>=s)break}let A=(null==C?void 0:null===(t=C.map)||void 0===t?void 0:t.call(C,e=>e.uid))||[];return{shareConversationInfoList:[...M,...R],followList:C=[...f,...S,...m],followUidList:A}},S=n("999283"),f=n("213309"),m=n("945730"),C=n("974144");let{ConversationType:T}=r.m,{GROUP_CHAT:O,ONE_TO_ONE_CHAT:M}=T,R=e=>{let{shareConversationInfoList:t,followList:n,followUidList:s}=g(e);(0,m.getImStore)().setAllFriendListRealToFix(s);let r=[...t,...n].map(e=>{let{conv_type:t,conv_id:n,sec_uid:s}=e;if(t===O){let e=S.Z.getConversationByShortId(n);if((0,f.n6)(e)||!(null==e?void 0:e.isMember)||(0,C.B)(e))return null;let{coreInfo:t={},id:i="",ext:s}=e,{name:o,icon:r}=t;return{type:O,nickname:o,avatar_thumb:{url_list:[].concat((null==s?void 0:s["a:ab_avatar"])||r||"")},hasShared:!1,conversationShortId:i,uid:i,isRoundAvatar:!!(null==s?void 0:s["a:ab_avatar"])}}{let e=S.Z.getUserInfoBySecUid(s);return!e||e.is_block?null:(0,i._)({type:M,isRoundAvatar:!1},e)}}).filter(e=>e);return o()(r,e=>null==e?void 0:e.uid)};var A=()=>{let{data:e,error:t,loading:n}=(0,a.ZP)(()=>(0,l.v5)({}),{auto:!0,cacheKey:"share-list-relation-request",refreshDeps:[]});return t?{data:[],loading:n}:{data:R(e),loading:n}}},71104:function(e,t,n){n.d(t,{h:function(){return g},n:function(){return I}});var i=n(91907),s=n(562017),o=n(260211),r=n(134761);n(990921),n(874386),n(675373),n(268917),n(209955);var a=n(866674),l=n.n(a),u=n(877639),d=n.n(u),_=n(918294),c=n.n(_),v=n(212138),E=n.n(v),h=new WeakMap,p=new WeakMap;class I{add(e){return new Promise((t,n)=>{this.runList.push({param:e,resolve:t,reject:n}),(0,i._)(this,h).call(this)})}constructor({max:e,timeWait:t,runOperation:n}){(0,r._)(this,"max",0),(0,r._)(this,"runList",[]),(0,r._)(this,"runOperation",e=>{}),(0,s._)(this,h,{writable:!0,value:()=>{(0,i._)(this,p).call(this)}}),(0,s._)(this,p,{writable:!0,value:()=>{let e=this.runList;this.runList=[];let t=(null==e?void 0:e.length)||0,{max:n}=this;if(n<=0||t<=n){this.runOperation(e);return}for(let i=0;i<t;i+=n){let t=c()(e,i,i+n);if(null==t?void 0:t.length)this.runOperation(t);else break}}}),this.max=e||0;if(!n)throw Error("MultiRun runOperation 执行函数必须设置");if(!l()(n))throw Error("MultiRun runOperation 执行函数必须为函数形式");this.runOperation=n,(0,o._)(this,h,d()(()=>{(0,i._)(this,p).call(this)},t||300,{leading:!1,trailing:!0}))}}let g=(e,t)=>{E()(e,e=>{var n;null==e||null===(n=e.reject)||void 0===n||n.call(e,t||"error")})}},237652:function(e,t,n){n.d(t,{AB:function(){return R},n5:function(){return M},q:function(){return T},xD:function(){return C}});var i=n(520739),s=n(878389);n(675373),n(268917);var o=n(496349),r=n(738363),a=n(231755),l=n(71104),u=n(212138),d=n.n(u),_=n(377530),c=n.n(_),v=n(138871),E=n.n(v),h=n(812307),p=n(497730),I=n(871212);let{COMMON_SEARCH_PARAMS:g,DISABLE_SECRET_VIDEO_PARAMS:S,CHANNEL_PC_WEB:f}=o||{},{ERROR_CODE:m}=r||{};async function C(e){let{cursor:t=0,count:n=50,groupId:o="1"}=e;return arguments.length>1&&void 0!==arguments[1]&&arguments[1],await (0,a.U2)("/aweme/v1/web/im/resources/emoticon/trending",(0,s._)((0,i._)({},g),{cursor:t,count:n,groupId:o}))}async function T(e){let{itemIds:t,from:n,requestSource:s=I.AWEME_PC_RESOURCE_TYPE,originType:o=p.F.General}=e;return(0,h.Ex)("/aweme/v1/web/multi/aweme/detail/",n),await (0,a.v_)("/aweme/v1/web/multi/aweme/detail/",(0,i._)({},g),{aweme_ids:`[${t.join(",")}]`,request_source:s,origin_type:o})}(0,h.m)("/aweme/v1/web/multi/aweme/detail/",500);let O=new l.n({max:40,timeWait:300,runOperation:e=>{let t=[];d()(e,e=>{let{param:n}=e;n&&t.push(n)}),T({itemIds:c()(t),from:"multiRunGetAwemeInfo",originType:p.F.Chat,requestSource:I.AWEME_IM_RESOURCE_TYPE}).then(t=>{if((null==t?void 0:t.status_code)===0){let n=(null==t?void 0:t.aweme_details)||[],i=(null==t?void 0:t.filter_list)||[],s={};d()(n,(e,t)=>{let{aweme_id:n,external_video_type:i}=e;if(n){let t=n;i&&(t+=`:${i}`),s[t]=e}});let o={};d()(i,(e,t)=>{let{aweme_id:n,external_video_type:i}=e;if(n){let t=n;i&&(t+=`:${i}`),o[t]=e}}),d()(e,e=>{let{param:t,reject:n,resolve:i}=e;i({aweme_details:s[t]?[s[t]]:null,filter_list:o[t]?[o[t]]:null})})}else(0,l.h)(e,"")}).catch(t=>{(0,l.h)(e,t)})}});async function M(e){return O.add(e)}async function R(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return await (0,a.v_)("/aweme/v1/web/im_communication/msg_read_switch/",(0,i._)({},g),E().stringify((0,s._)((0,i._)({},g),{source:"msg_tab",is_retry:t,msg_ids:e})),{headers:{"Content-Type":"application/json"},isDataUseJson:!0,transformResponse:[function(e){return E().parse(e)}]})}},461634:function(e,t,n){let i;n.d(t,{NE:function(){return R},Ol:function(){return C},Ox:function(){return A},P_:function(){return T},RK:function(){return m},bF:function(){return M},et:function(){return N},v5:function(){return O}});var s=n(520739),o=n(878389);n(779788),n(675373),n(268917);var r=n(496349),a=n(738363),l=n(421442),u=n(231755),d=n(71104),_=n(212138),c=n.n(_),v=n(377530),E=n.n(v);let{COMMON_SEARCH_PARAMS:h,DISABLE_SECRET_VIDEO_PARAMS:p,CHANNEL_PC_WEB:I}=r||{},{ERROR_CODE:g}=a||{};async function S(e){let{sec_user_ids:t}=e;return(arguments.length>1&&void 0!==arguments[1]&&arguments[1],t&&0!==t.length)?await (0,u.v_)("/aweme/v1/web/im/user/info/",(0,s._)({},h),{sec_user_ids:JSON.stringify(t)}):{statusCode:g.ERROR_INVALID_PARAM}}l.HOME_DOMAIN;let f=new d.n({max:40,timeWait:100,runOperation:e=>{let t=[];c()(e,e=>{let{param:n}=e;t.push(n)}),S({sec_user_ids:E()(t)}).then(t=>{let n=null==t?void 0:t.data;if((null==t?void 0:t.status_code)===0&&(null==n?void 0:n.length)){let t={};c()(n,(e,n)=>{let i=null==e?void 0:e.sec_uid;i&&(t[i]=e)}),c()(e,e=>{var n,i;let s=null==e?void 0:e.param;s&&t[s]?null==e||null===(n=e.resolve)||void 0===n||n.call(e,t[s]):null==e||null===(i=e.reject)||void 0===i||i.call(e,"error")})}else(0,d.h)(e,"")}).catch(t=>{(0,d.h)(e,t)})}});async function m(e){return f.add(e)}var C={follow:1,1:"follow",unfollow:0,0:"unfollow"};async function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return await (0,u.v_)("/aweme/v1/web/commit/follow/user/",(0,s._)({},h),{user_id:e,type:t})}async function O(e){let{count:t=50,max_time:n=Date.now(),min_time:r=0,with_fstatus:a=1,source:l="coldup"}=e;arguments.length>1&&void 0!==arguments[1]&&arguments[1];let d=i||r,_=await (0,u.U2)("/aweme/v1/web/im/spotlight/relation/",(0,o._)((0,s._)({},h),{count:t,source:l,max_time:n,min_time:d,need_remove_share_panel:!0,need_sorted_info:!0,with_fstatus:a}));return i=null==_?void 0:_.min_time,_}var M={block:1,1:"block",unblock:0,0:"unblock"},R={block:0,0:"block",allowOtherSee:1,1:"allowOtherSee",unSeeOther:2,2:"unSeeOther"};async function A(e,t,n,i){return await (0,u.v_)("/aweme/v1/web/user/block/",(0,s._)({},h),{user_id:e,sec_user_id:t,block_type:n,source:i})}async function N(e){return await (0,u.U2)("/aweme/v1/web/user/profile/other/",(0,o._)((0,s._)({},h),{source:I,sec_user_id:e}),{},void 0)}},413367:function(){},47069:function(){},687841:function(){},89855:function(){}}]);