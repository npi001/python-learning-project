"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["58579"],{579900:function(e,t,r){r.r(t),r.d(t,{PRELOAD_TYPES:function(){return a.dJ},PreloaderManager:function(){return ee},PRELOAD_EVENTS:function(){return a.KR},PreloaderBase:function(){return et},CACHE_TYPES:function(){return a.Rr}});var n,a=r("327408");function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function o(e,t,r,n,a,i,o){try{var u=e[i](o),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function u(e){return function(){var t=this,r=arguments;return new Promise(function(n,a){var i=e.apply(t,r);function u(e){o(i,n,a,u,s,"next",e)}function s(e){o(i,n,a,u,s,"throw",e)}u(void 0)})}}function s(e,t,r){return t=v(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,p()?Reflect.construct(t,r||[],v(e).constructor):t.apply(e,r))}function c(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,P(n.key),n)}}function f(e,t,r){return t&&l(e.prototype,t),r&&l(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=I(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}function h(e,t,r){return(t=P(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}function p(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(p=function(){return!!e})()}function g(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?g(Object(r),!0).forEach(function(t){h(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function m(e,t){if(null==e)return{};var r,n,a=function(e,t){if(null==e)return{};var r={};for(var n in e)if(({}).hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],-1===t.indexOf(r)&&({}).propertyIsEnumerable.call(e,r)&&(a[r]=e[r])}return a}function b(){b=function(){return t};var e,t={},r=Object.prototype,n=r.hasOwnProperty,a=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,r){return e[t]=r}}function l(t,r,n,i){var o=Object.create((r&&r.prototype instanceof p?r:p).prototype);return a(o,"_invoke",{value:function(t,r,n){var a=d;return function(i,o){if(a===h)throw Error("Generator is already running");if(a===v){if("throw"===i)throw o;return{value:e,done:!0}}for(n.method=i,n.arg=o;;){var u=n.delegate;if(u){var s=function t(r,n){var a=n.method,i=r.iterator[a];if(i===e)return n.delegate=null,"throw"===a&&r.iterator.return&&(n.method="return",n.arg=e,t(r,n),"throw"===n.method)||"return"!==a&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+a+"' method")),y;var o=f(i,r.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var u=o.arg;return u?u.done?(n[r.resultName]=u.value,n.next=r.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,y):u:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,y)}(u,n);if(s){if(s===y)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=h;var c=f(t,r,n);if("normal"===c.type){if(a=n.done?v:"suspendedYield",c.arg===y)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a=v,n.method="throw",n.arg=c.arg)}}}(t,n,new T(i||[]))}),o}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}t.wrap=l;var d="suspendedStart",h="executing",v="completed",y={};function p(){}function g(){}function _(){}var m={};c(m,o,function(){return this});var k=Object.getPrototypeOf,P=k&&k(k(S([])));P&&P!==r&&n.call(P,o)&&(m=P);var w=_.prototype=p.prototype=Object.create(m);function I(e){["next","throw","return"].forEach(function(t){c(e,t,function(e){return this._invoke(t,e)})})}function x(e,t){var r;a(this,"_invoke",{value:function(a,i){function o(){return new t(function(r,o){!function r(a,i,o,u){var s=f(e[a],e,i);if("throw"!==s.type){var c=s.arg,l=c.value;return l&&"object"==typeof l&&n.call(l,"__await")?t.resolve(l.__await).then(function(e){r("next",e,o,u)},function(e){r("throw",e,o,u)}):t.resolve(l).then(function(e){c.value=e,o(c)},function(e){return r("throw",e,o,u)})}u(s.arg)}(a,i,r,o)})}return r=r?r.then(o,o):o()}})}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function S(t){if(t||""===t){var r=t[o];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var a=-1,i=function r(){for(;++a<t.length;)if(n.call(t,a))return r.value=t[a],r.done=!1,r;return r.value=e,r.done=!0,r};return i.next=i}}throw TypeError(typeof t+" is not iterable")}return g.prototype=_,a(w,"constructor",{value:_,configurable:!0}),a(_,"constructor",{value:g,configurable:!0}),g.displayName=c(_,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,_):(e.__proto__=_,c(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},t.awrap=function(e){return{__await:e}},I(x.prototype),c(x.prototype,u,function(){return this}),t.AsyncIterator=x,t.async=function(e,r,n,a,i){void 0===i&&(i=Promise);var o=new x(l(e,r,n,a),i);return t.isGeneratorFunction(r)?o:o.next().then(function(e){return e.done?e.value:o.next()})},I(w),c(w,s,"Generator"),c(w,o,function(){return this}),c(w,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},t.values=S,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(L),!t)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function a(n,a){return u.type="throw",u.arg=t,r.next=n,a&&(r.method="next",r.arg=e),!!a}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],u=o.completion;if("root"===o.tryLoc)return a("end");if(o.tryLoc<=this.prev){var s=n.call(o,"catchLoc"),c=n.call(o,"finallyLoc");if(s&&c){if(this.prev<o.catchLoc)return a(o.catchLoc,!0);if(this.prev<o.finallyLoc)return a(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return a(o.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return a(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),L(r),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var a=n.arg;L(r)}return a}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:S(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),y}},t}function k(e,t){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function P(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){if(e){if("string"==typeof e)return i(e,t);var r=({}).toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}r("110617"),r("675373"),r("819117");var x=r("879146"),C=r.n(x);r("836654"),r("691842"),r("981168"),r("499953"),r("429532"),r("98601"),r("742611");var L=r("44216");r("910795"),r("743465"),r("891555"),r("304095"),r("826893"),r("250440"),r("413806");var T=r("262416");r("511141"),r("47513"),r("914613"),r("874386"),r("927234");var S=function(){try{if("undefined"!=typeof indexedDB)return indexedDB}catch(e){}}();function O(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function E(e){return"string"!=typeof e&&(e=String(e)),e}var K={},D="readonly",j="readwrite";function A(e){var t=K[e.name],r={};r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t}),t.deferredOperations.push(r),t.dbReady?t.dbReady=t.dbReady.then(function(){return r.promise}):t.dbReady=r.promise}function M(e,t){return new Promise(function(r,n){if(K[e.name]=K[e.name]||q(),e.db){if(!t)return r(e.db);A(e),e.db.close()}var a=[e.name];t&&a.push(e.version);var i=null==S?void 0:S.open.apply(S,a);t&&(i.onupgradeneeded=function(t){var r=i.result;try{r.createObjectStore(e.storeName)}catch(e){if("ConstraintError"===e.name);else throw e}}),i.onerror=function(e){e.preventDefault(),n(i.error)},i.onsuccess=function(){r(i.result),!function(e){var t=K[e.name].deferredOperations.pop();if(t)t.resolve(),t.promise}(e)}})}function R(e){return M(e,!1)}function B(e){return M(e,!0)}function N(e,t){if(!e.db)return!0;var r=!e.db.objectStoreNames.contains(e.storeName),n=e.version<e.db.version,a=e.version>e.db.version;if(n&&(e.version,e.version=e.db.version),a||r){if(r){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function U(e,t,r,n){void 0===n&&(n=1);try{var a=e.db.transaction(e.storeName,t);r(null,a)}catch(a){if(n>0&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return Promise.resolve().then(function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),M(e,!0)}).then(function(){return(function(e){A(e);for(var t=K[e.name],r=t.forages,n=0;n<r.length;n++){var a=r[n];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,M(e,!1).then(function(t){if(e.db=t,N(e))return M(e,!0);return t}).then(function(n){e.db=t.db=n;for(var a=0;a<r.length;a++)r[a]._dbInfo.db=n}).catch(function(t){throw!function(e,t){var r=K[e.name].deferredOperations.pop();if(r)r.reject(t),r.promise}(e,t),t})})(e).then(function(){U(e,t,r,n-1)})}).catch(r);r(a)}}function q(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}var V=f(function e(){c(this,e)},[{key:"ready",value:function(){return this._ready}},{key:"_initStorage",value:function(e){var t=this;t._defaultConfig=e;var r={db:null,name:"",version:""};if(e)for(var n in e)r[n]=e[n];var a=K[r.name];!a&&(a=q(),K[r.name]=a),a.forages.push(t),!t._initReady&&(t._initReady=t.ready,t._ready=t._fullyReady);var i=[];function o(){return Promise.resolve()}for(var u=0;u<a.forages.length;u++){var s=a.forages[u];s!==t&&i.push(s._initReady().catch(o))}var c=a.forages.slice(0);return t._ready=Promise.all(i).then(function(){return r.db=a.db,M(r,!1)}).then(function(e){if(r.db=e,N(r,t._defaultConfig.version))return M(r,!0);return e}).then(function(e){r.db=a.db=e,t._dbInfo=r;for(var n=0;n<c.length;n++){var i=c[n];i!==t&&(i._dbInfo.db=r.db,i._dbInfo.version=r.version)}}),t._ready}},{key:"probeSupport",get:function(){return function(){try{if(!(null!=S&&S.open))return!1;var e=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}()}},{key:"getItem",value:function(e,t){var r=this;e=E(e);var n=new Promise(function(t,n){r.ready().then(function(){U(r._dbInfo,D,function(a,i){if(a)return n(a);try{var o=i.objectStore(r._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;void 0===e&&(e=null),t(e)},o.onerror=function(){n(o.error)}}catch(e){n(e)}})}).catch(n)});return O(n,t),n}},{key:"setItem",value:function(e,t,r){var n=this;e=E(e);var a=new Promise(function(r,a){n.ready().then(function(){return n._dbInfo,t}).then(function(t){U(n._dbInfo,j,function(i,o){if(i)return a(i);try{var u=o.objectStore(n._dbInfo.storeName);null===t&&(t=void 0);var s=u.put(t,e);o.oncomplete=function(){void 0===t&&(t=null),r(t)},o.onabort=o.onerror=function(){var e=s.error?s.error:s.transaction.error;a(e)}}catch(e){a(e)}})}).catch(a)});return O(a,r),a}},{key:"removeItem",value:function(e,t){var r=this;e=E(e);var n=new Promise(function(t,n){r.ready().then(function(){U(r._dbInfo,j,function(a,i){if(a)return n(a);try{var o=i.objectStore(r._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){n(o.error)},i.onabort=function(){var e=o.error?o.error:o.transaction.error;n(e)}}catch(e){n(e)}})}).catch(n)});return O(n,t),n}},{key:"clear",value:function(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){U(t._dbInfo,j,function(n,a){if(n)return r(n);try{var i=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=i.error?i.error:i.transaction.error;r(e)}}catch(e){r(e)}})}).catch(r)});return O(r,e),r}},{key:"length",value:function(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){U(t._dbInfo,D,function(n,a){if(n)return r(n);try{var i=a.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){r(i.error)}}catch(e){r(e)}})}).catch(r)});return O(r,e),r}},{key:"all",value:function(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){U(t._dbInfo,D,function(n,a){if(n)return r(n);try{var i=a.objectStore(t._dbInfo.storeName).openCursor(),o=[];i.onsuccess=function(){var t=i.result;if(!t){e(o);return}o.push({key:t.key,value:t.value}),t.continue()},i.onerror=function(){r(i.error)}}catch(e){r(e)}})}).catch(r)});return O(r,e),r}},{key:"_fullyReady",value:function(e){var t,r,n,a=this,i=a._initReady().then(function(){var e=K[a._dbInfo.name];if(null!=e&&e.dbReady)return e.dbReady});return t=i,r=e,n=e,"function"==typeof r&&t.then(r),"function"==typeof n&&t.catch(n),i}},{key:"getItemSync",value:function(){throw Error("NotSupported")}}]),F=f(function e(){c(this,e)},[{key:"_initStorage",value:function(e){var t=e.name,r=e.storeName,n="".concat(t,"_").concat(r);return this.key=n,(!window[n]||"object"!==w(window[n]))&&(window[n]={}),this.store=window[n],Promise.resolve()}},{key:"getItem",value:function(e,t){var r=this.store[e];return void 0===r&&(r=null),this._internalPromise(t,r)}},{key:"getItemSync",value:function(e,t){var r=this.store[e];return void 0===r&&(r=null),t&&t(r),r}},{key:"setItem",value:function(e,t,r){return this.store[e]=t,this._internalPromise(r)}},{key:"removeItem",value:function(e,t){return delete this.store[e],this._internalPromise(t)}},{key:"clear",value:function(e){return this.store={},window[this.key]={},this._internalPromise(e)}},{key:"length",value:function(e){var t=Object.keys(this.store).length;return this._internalPromise(e,t)}},{key:"_internalPromise",value:function(e,t){var r=t?Promise.resolve(t):Promise.resolve();return O(r,e),r}},{key:"all",value:function(e){for(var t=[],r=Object.keys(this.store),n=0;n<r.length;n++){var a=r[n];t.push({key:a,value:this.store[a]})}return this._internalPromise(e,t)}},{key:"probeSupport",value:function(){return!0}}]),Y={description:"",name:"__PRE_CACHE__",storeName:"keyvaluepairs",version:1},z="__PRE_CACHE__KEYS";var G=f(function e(t,r){c(this,e),this._allCachedKeyMap={},this._memory=0,this._cnt=0;var n=r===a.Rr.MEMORY?F:V;this._cacheType=r,this._driver=new n,this._driver._initStorage(Y).catch(function(){}),this._hasIdbForbidden=!1,this._maxCache=!t||t<=0?200:t,this.setMaxCache(this._maxCache),this._allCachedKeys={},this._allCachedTimeKeys={},this.getCachedKeysFromLocal(),this._readyPromise=new T.XK,this.init()},[{key:"supportSync",value:function(){return this._cacheType===a.Rr.MEMORY}},{key:"getCachedKeysFromLocal",value:function(){var e=T.Xb.getItem(z);if(e){for(var t=e.split("|"),r=0;r<t.length;r++){var n=t[r],a=this._getCacheKeyInfos(n),i=a.time,o=a.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=i}}}},{key:"_getCacheKeyInfos",value:function(e){var t,r=e.split("$");return 2===r.length&&(t=r[0],e=r[1]),{time:t,cachedKey:e}}},{key:"writeCachedKeysToLocal",value:function(e){var t=[];this._allCachedKeys={},this._allCachedTimeKeys={};for(var r=0;r<e.length;r++){var n=e[r].key,a=this._getCacheKeyInfos(n),i=a.time,o=a.cachedKey;this._allCachedKeys[o]=1,this._allCachedTimeKeys[o]=i,t.push(n)}var u=t.join("|");T.Xb.setItem(z,u)}},{key:"init",value:function(){var e=this;this._driver.setItem("test","test").then(function(){}).catch(function(){e._hasIdbForbidden=!0}).finally(function(){e._driver.removeItem("test").catch(function(){}),e._hasIdbForbidden&&(e._driver=new F,e._driver._initStorage(Y)),e._getAll(),e._readyPromise.resolve()})}},{key:"_getAll",value:function(){var e=this;this._memory=0,this._cnt=0,this._driver.all().then(function(t){e._cachedLength=t.length;var r=t.length-e._maxCache,n=t;if(r>0){var a=t.slice(0,r);n=t.slice(r);for(var i=0;i<a.length;i++)e.removeItem(a[i].key).then(function(){})}e._cnt=n.length;for(var o=0;o<n.length;o++){var u=n[o];if("object"===w(u.value)){Object.values(u.value).forEach(function(t){e._memory+=(null==t?void 0:t.memory)||0});var s=e._getCacheKeyInfos(u.key).cachedKey;e._allCachedKeyMap[s]=Object.keys(u.value)}}e.writeCachedKeysToLocal(n)}).catch(function(){})}},{key:"getAllCachedDataKeys",value:function(){var e=[];return Object.values(this._allCachedKeyMap).forEach(function(t){var r;e.push.apply(e,function(e){if(Array.isArray(e))return i(e)}(r=t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||I(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())}),e}},{key:"getItem",value:(n=u(b().mark(function e(t,r,n){var a,i,o,u;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((a=this.hasItem(t))&&n&&(a=(null==(i=this._allCachedKeyMap[t])?void 0:i.includes(n))||!1),a){e.next=4;break}return e.abrupt("return",Promise.resolve(!1));case 4:return o=this._getTimeKey(t).timeKey,e.next=7,this._driver.getItem(o,r);case 7:if(u=e.sent,!n){e.next=10;break}return e.abrupt("return",u[n]);case 10:return e.abrupt("return",u);case 11:case"end":return e.stop()}},e,this)})),function(e,t,r){return n.apply(this,arguments)})},{key:"getItemSync",value:function(e,t,r){var n=this.hasItem(e);if(n&&r){var a=this._allCachedKeyMap[e];n=(null==a?void 0:a.includes(r))||!1}if(!n)return!1;var i=this._getTimeKey(e).timeKey,o=this._driver.getItemSync(i,t);return o&&r?o[r]:o}},{key:"setItem",value:function(e,t,r){var n=this;this._getTimeKey(e).timeKey&&this.removeItem(e);var a=new Date().getTime();this._allCachedKeys[e]=1,this._allCachedTimeKeys[e]=a;var i=this._genTimeKey(e,a);return r=r?function(){n._getAll(),r()}:function(){n._getAll()},this._driver.setItem(i,t,r)}},{key:"_getTimeKey",value:function(e){var t=this._allCachedTimeKeys[e],r=e;return t&&(r=this._genTimeKey(e,t)),{timeKey:r,time:t}}},{key:"_genTimeKey",value:function(e,t){return"".concat(t).concat("$").concat(e)}},{key:"removeItem",value:function(e,t){var r=this._getTimeKey(e).timeKey,n=this._driver.removeItem(r,t);return delete this._allCachedKeys[e],delete this._allCachedTimeKeys[e],delete this._allCachedKeyMap[e],n}},{key:"hasItem",value:function(e){return!!this._allCachedKeys[e]}},{key:"clear",value:function(e){return this._driver.clear(e)}},{key:"length",value:function(e){return this._driver.length(e)}},{key:"setMaxCache",value:function(e){"number"==typeof e&&e>0&&(this._maxCache=e)}},{key:"getMemoryInfo",value:function(){return{memory:this._memory,cnt:this._cnt}}}]);r("206642"),r("271692"),r("296702"),r("828514"),r("187562"),r("166613"),r("801402"),r("862956"),r("703327"),r("573545"),r("170399"),r("544805"),r("463724"),r("279651");var X=["vid","loadType","size","speed","cacheKey","vtype","duration","bitrate"],H=0,$=f(function e(t){var r=this;c(this,e),this._preload_bandwith_map=new Map,this._usepreload_info=new Map,this._pcdn_info_map=new Map,this._updateRealTimeSpeed=function(e){H=e.speed,r.emit(L.kW,e)},this._manager=t},[{key:"setPreloadBandwidth",value:function(e,t){this._preload_bandwith_map.set(e,t)}},{key:"getPreloadBandwidth",value:function(e){return this._preload_bandwith_map.get(e)}},{key:"_updateLoadInfo",value:function(e,t,r){var n=this._pcdn_info_map.get(e);n||(n={}),!n[t]&&(n[t]={},n[t].loadLen=0),n[t].loadLen=n[t].loadLen+r,this._pcdn_info_map.set(e,n)}},{key:"getLoadInfoAndDelete",value:function(e){var t=this._pcdn_info_map.get(e);return this._pcdn_info_map.delete(e),t}},{key:"getPreloadUnuseInfo",value:function(){var e={},t,r=d(this._preload_bandwith_map);try{for(r.s();!(t=r.n()).done;){var n,a,i=(n=t.value,a=2,function(e){if(Array.isArray(e))return e}(n)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,a,i,o,u=[],s=!0,c=!1;try{if(i=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(u.push(n.value),u.length!==t);s=!0);}catch(e){c=!0,a=e}finally{try{if(!s&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(c)throw a}}return u}}(n,2)||I(n,a)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=i[0],u=i[1];if(this._usepreload_info.get(o))this._preload_bandwith_map.delete(o);else{var s=o.split("#"),c=s.length>0?s[0]:o;e[c]?(e[c].bw+=u.bw||0,e[c].pbw+=u.pbw||0):e[c]={vid:c,bw:u.bw||0,pbw:u.pbw||0,bitrate:u.bitrate||0,duration:u.duration||0}}}}catch(e){r.e(e)}finally{r.f()}return Object.values(e)}},{key:"bwEventEmit",value:function(e){var t=e.vid,r=e.loadType,n=e.size,a=e.speed,i=e.cacheKey,o=e.vtype,u=e.duration,s=e.bitrate,c=m(e,X),l=this.getPreloadBandwidth(i)||{bw:0,pbw:0,vid:t,duration:u,bitrate:s};r&&r!==L._R.CDN?(l.pbw=l.pbw+n,this.emit("prf_data_size",_({vid:t,task_type:2,pcdn_size:n,pcdn_speed:a,vtype:o,bitrate:s,duration:u},c))):(l.bw=l.bw+n,this.emit("prf_data_size",_({vid:t,task_type:2,cdn_size:n,cdn_speed:a,vtype:o,duration:u,bitrate:s},c))),this.setPreloadBandwidth(i,l),this._updateRealTimeSpeed({speed:a,type:r||L._R.CDN}),this._updateLoadInfo(i,r,n)}},{key:"setUsePreloadInfo",value:function(e,t){this._usepreload_info.set(e,t)}},{key:"realTimeSpeed",get:function(){return H}},{key:"emit",value:function(e,t){var r;null===(r=this._manager)||void 0===r||r.emit(e,t)}},{key:"destroy",value:function(){this._preload_bandwith_map=new Map,this._usepreload_info=new Map,this._pcdn_info_map=new Map,this._manager=null}}]);function J(e,t){var r=[0,0];if(e)for(var n=0,a=e.length;n<a&&(r[0]=e.start(n),r[1]=e.end(n),!(r[0]<=t)||!(t<=r[1]));n++);return r[0]-t<=0&&t-r[1]<=0?r:[0,0]}function W(e,t,r){for(var n=0;n<e.length;n++)if(r===e[n][t])return n;return -1}var Q=["vid","loadType","size","speed","cacheKey","vtype","duration","bitrate"],Z=!1,ee=function(e){var t,r,n,i,o,l;function v(){var e;return c(this,v),(e=s(this,v))._loaders={},e._loaderInsts={},e._taskIntervalId=0,e._currentPreloadInst=null,e._preloadDataList=[],e._player=null,e._stepwise=!1,e._playingVids=[],e._isOpen=!0,e._userDefinition=null,e._startDefinition=null,e.onPreloadNext=u(b().mark(function t(){var r,n,i,o,u,s,c,l,f,d,h,v,y,p;return b().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=(i=e)._preloadDataList,u=i._config,!(!e._isOpen||e._currentPreloadInst||e._preloadDataList.length<1)){t.next=3;break}return t.abrupt("return",!1);case 3:if(c=null==(s=e.findPreloadItem(o,!1))?void 0:s.data,!(!s||!(null!=c&&c.payload))){t.next=7;break}return t.abrupt("return",!1);case 7:if(l=null,l=e.selectBeforeStart(c),e._filterMixPayload(c,l),e.setStartDefinition(null===(r=l)||void 0===r?void 0:r.definition),e.log("log","selectBeforeStart",null===(n=l)||void 0===n?void 0:n.vtype,l),f=e._getPreloaderKey(l||c)){t.next=17;break}return e.log("warn","need to set vtype, no preloader",c),u.autoPreload&&e.emit(a.KR.PRELOAD_NEXT),t.abrupt("return",!1);case 17:if(d=e._getLoaderInst(f)){t.next=23;break}if(h=e._getLoader(f)){t.next=22;break}return t.abrupt("return",!1);case 22:d=new h(e,e._config);case 23:return e._currentPreloadInst=d,e._currentPreloadInst.setData(c),e._emitEvtByStart(c),t.prev=26,e.log("log","loaderInst.start",f,e.getStartDefinition(),c),t.next=30,d.start(c,e.getStartDefinition());case 30:(v=t.sent)&&v.remove&&(y=o.indexOf(s))>-1&&o.splice(y,1),t.next=37;break;case 34:t.prev=34,t.t0=t.catch(26),e.log("error","preload data error!",t.t0);case 37:return t.prev=37,null===(p=e._currentPreloadInst)||void 0===p||p.setData(null),e._currentPreloadInst=null,e._config.autoPreload&&e.emit(a.KR.PRELOAD_NEXT),t.finish(37);case 42:return t.abrupt("return",!0);case 43:case"end":return t.stop()}},t,null,[[26,34,37,42]])})),e._stats=new $(e),e}return y(v,e),f(v,[{key:"VTYPES",get:function(){return L.l0}},{key:"player",get:function(){return this._player}},{key:"stepwise",get:function(){return this._stepwise}},{key:"realTimeSpeed",get:function(){return this._stats.realTimeSpeed}},{key:"currentPreloadInst",get:function(){return this._currentPreloadInst}},{key:"cacheInst",get:function(){return this._cacheInst}},{key:"preloadDataList",get:function(){return this._preloadDataList}},{key:"log",value:function(e){for(var t,r=arguments.length,n=Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];Z&&(t=console)[e].apply(t,["[PreloaderManager]"].concat(n))}},{key:"register",value:function(e){try{if("undefined"==typeof window){this.log("preloader in ssr");return}var t=v.getDefaultConfig();this._config=Object.assign({},t,e.config),this._options=e;var r=this._config,n=r.preloadMaxCacheCount,i=r.preloadCacheType;this._stepwise=!!this._config.stepwise,this._cacheInst=new G(n,i),this._selector=e.BitrateSelector,this.on(a.KR.PRELOAD_NEXT,this.onPreloadNext);for(var o=e.loaders,u=0;u<o.length;u++)this.registerLoader(o[u].vtype,o[u])}catch(e){this.log("register error",e)}}},{key:"registerLoader",value:function(e,t){e&&(this._loaders[e]&&this.log("warn","vtype:".concat(e," Preloader already exist")),this._loaders[e]=t,this._loaderInsts[e]=new t(this,this._config))}},{key:"_checkIfCanPreload",value:function(){if(null===this._currentPreloadInst&&this._preloadDataList.length>0){var e=this.findPreloadItem(this._preloadDataList),t=null==e?void 0:e.data;if(this._wipPreloadTask=e,e&&null!=t&&t.payload){if(!this._getPreloaderKey(t))return this.log("warn","need to set vtype"),this.stopCheckTask(),!1;var r=this._config.checkIfCanPreload;if(r&&"function"==typeof r)return r(t);if(this._config.autoCheckPreload)return this._autoCheckPreload(t,e);else this.stopCheckTask()}}return!1}},{key:"_autoCheckPreload",value:function(e,t){var r,n=null==t||null===(r=t.data)||void 0===r?void 0:r.force;if("always"===n)return!0;if(!this._player)return"no-player"===n||(this.log("warn","need set video"),!1);return function(e,t,r){if(!e)return!1;var n=J(e.buffered,e.currentTime),a=t.startPreloadControl,i=t.startPreloadMinBuffer,o=t.startPreloadMinPosTime,u=t.minBufferLength;if(a){var s=Math.max(n[1]-e.currentTime,0);if("number"==typeof i&&s>i){if("number"==typeof o&&e.currentTime>o||e.currentTime>e.duration/2)return null==r||r("log","[checkIfStartPreload] hit buffer",s,"startPreloadMinBuffer",i),!0}else if(e.currentTime+i+1>e.duration&&e.currentTime+s>e.duration-1)return null==r||r("log","[checkIfStartPreload] hit end"),!0}else{var c="number"==typeof u&&e.duration>u+5?u:e.duration/2,l=Math.min(e.currentTime+u,e.duration),f=n[1]-l;if(e.currentTime>c&&f>-1)return null==r||r("log","[checkIfStartPreload] hit minPos",c,"minCacheTime",l),!0}return!1}(this._player,this._config,this.log)}},{key:"_getPreloaderKey",value:function(e){return e.vtype?e.vtype.toUpperCase():""}},{key:"_sort",value:function(e){e.sort(function(e,t){return void 0===e.order&&void 0===t.order||"number"==typeof e.order&&"number"==typeof t.order&&e.order<t.order?-1:1})}},{key:"_addPlayingVid",value:function(e,t){var r=this._playingVids,n=W(this._playingVids,"playerId",e);n>-1?r[n].vid=t:r.push({vid:t,playerId:e})}},{key:"selectBeforeStart",value:function(e){var t=e.targetDefinition,r=e.defaultDefinition;if(t)return _({},t);var n=this.getUserSelectDefinition(),a=this.selectBitrate(null==e?void 0:e.payload,r,n),i=(null==a?void 0:a.vtype)||e.vtype,o=_(_({},a),{},{vtype:i});return e.targetDefinition=o,this.log("log","selectBeforeStart",null==e?void 0:e.vid,i,null==a?void 0:a.definition,null==e?void 0:e.payload,a),o}},{key:"selectBitrate",value:function(e,t,r){if(e.length<1)return null;var n,a,i,o=null;if(this._selector)o=this._selector.getSuitableBitrate(e,r),this.log("log","BitRateAdapter result",null===(n=o)||void 0===n?void 0:n.vtype,null===(a=o)||void 0===a?void 0:a.definition,null===(i=o)||void 0===i?void 0:i.bitrate);else{for(var u=-1,s=-1,c=0;c<e.length;c++){var l=e[c];r&&l.definition===r?u=c:t&&l.definition===t&&(s=c)}o=e[u>=0?u:s>=0?s:0]}return _({},o)}},{key:"startCheckTask",value:function(){var e=this,t=this._preloadDataList,r=this._currentPreloadInst,n=this._config.autoCheck;if(this._taskIntervalId&&(clearTimeout(this._taskIntervalId),this._taskIntervalId=0),null!=r&&r.taskInProgress&&function(e,t,r){var n=t.endPreloadControl,a=t.endPreloadMinBuffer,i=t.startPreloadMinBuffer;if(!e)return!1;if(n){if("number"==typeof i&&e.currentTime+i>=e.duration)return!1;var o=Math.max(J(e.buffered,e.currentTime)[1]-e.currentTime,0);if(o<=a)return null==r||r("log","[checkIfCancelPreload] hit buffer:",o,"endPreloadMinBuffer:",a,"video:","".concat(e.currentTime,"/").concat(e.duration)),!0}return!1}(this._player,this._config,this.log)){this.cancelPreloadingTask();return}if(0!==t.length)this._checkIfCanPreload()&&this.onPreloadNext(),this._taskIntervalId=setTimeout(function(){e.startCheckTask()},n.interval)}},{key:"cancelPreloadingTask",value:function(){var e,t=this._preloadDataList,r=this._wipPreloadTask,n=this._config.endPreloadTaskStrategy;this.cancel(),r&&(this.stepwise?"number"==typeof(null===(e=r.data)||void 0===e?void 0:e.stepIdx)&&r.data.stepIdx>-1&&r.data.stepIdx--:0!==n&&t.unshift(r),this._emitEvtByCancel(r.data),this._wipPreloadTask=void 0)}},{key:"stopCheckTask",value:function(){this._taskIntervalId&&(clearTimeout(this._taskIntervalId),this._taskIntervalId=-1)}},{key:"getPreloadMetaByVid",value:function(e,t){for(var r=this.getAllCachedDataKeys(),n=[],a="",i=0;i<r.length;i++){var o=r[i],u=v.parseKey(o);if(u.vid!==e)continue;if(a=u.vtype,null==t||!t.vtype||t.vtype===a)n.push(o)}if(0===n.length)return null;var s=this._getLoaderInst(a);return s?s.parseKey(n):null}},{key:"preloadNext",value:function(){this.onPreloadNext()}},{key:"_filterMixPayload",value:function(e,t){var r=t.vtype;if(r&&Array.isArray(e.payload)){var n=e.vtype===r;e.vtype=r,e.payload=e.payload.filter(function(e){return e.vtype===r||n})}}},{key:"_emitEvtByStart",value:function(e){var t=this._player;if(e&&t)try{this.emit(a.KR.PRELOAD_START,this._getEventPayload(e,t))}catch(e){this.log("warn","preload emit start error",null==e?void 0:e.stack)}}},{key:"_emitEvtByCancel",value:function(e){var t=this._player;if(e&&t)try{this.emit(a.KR.PRELOAD_CANCEL,this._getEventPayload(e,t))}catch(e){this.log("warn","preload emit cancel error",null==e?void 0:e.stack)}}},{key:"_getEventPayload",value:function(e,t){var r=t.config.vid,n=this._config,a=n.minBufferLength,i=n.startPreloadControl,o=n.startPreloadMinBuffer,u=n.startPreloadMinPosTime,s=n.endPreloadMinBuffer,c=n.endPreloadControl,l=J(t.video.buffered,t.currentTime),f=l[1]?l[1]-t.currentTime:0;return{vid:r,pid:e.vid,buffer:l,bufferHead:f,currentTime:t.currentTime,minBufferLength:a,startPreloadControl:i,startPreloadMinBuffer:o,startPreloadMinPosTime:u,endPreloadControl:c,endPreloadMinBuffer:s}}},{key:"addPreloadList",value:(t=u(b().mark(function e(t){var r,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._sort(t),r=d(t),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=10;break}return a=n.value,e.next=8,this._addData(a);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:this._checkAutoTask();case 19:case"end":return e.stop()}},e,this,[[2,12,15,18]])})),function(e){return t.apply(this,arguments)})},{key:"addPlayingId",value:function(e,t){for(var r=this._preloadDataList,n=-1,a=0;a<r.length;a++)if(e===r[a].data.vid){n=a;break}if(n>-1){var i=r.splice(n,1);this.log("log","cancelPreloadByVid remove from list",i.length>0&&i[0].data.vid)}var o=this._currentPreloadInst,u=o?o.getData():null;this.log("log","_currentPreloadInst",u),u&&u.vid===e&&this.cancel(),t&&this._addPlayingVid(t,e)}},{key:"removePlayingId",value:function(e){var t=this._playingVids,r=W(t,"playerId",e);if(r>-1){var n=t.splice(r,1);this.log("log","removePlayingId",n.length>0&&n[0].playerId)}}},{key:"addPreload",value:(r=u(b().mark(function e(t){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._addData(t);case 2:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this._sort(this._preloadDataList),this._checkAutoTask();case 7:case"end":return e.stop()}},e,this)})),function(e){return r.apply(this,arguments)})},{key:"_addData",value:(n=u(b().mark(function e(t){var r,n,a,i,o,u,s,c,l,f=this;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.data.vtype){e.next=3;break}return this.log("warn","vtype is null, can\xb7t select loader"),e.abrupt("return",!1);case 3:if(r=t.data,n=this._getLoader(r.vtype)){e.next=8;break}return this.log("warn","the loader for ".concat(r.vtype," not registered")),e.abrupt("return",!1);case 8:if(!((i=W(a=this._playingVids,"vid",t.data.vid))>=0)){e.next=14;break}return o=a[i],this.log("log","vid:".concat(o.vid," is already instantiated and loaded, playerId is ").concat(o.playerId)),e.abrupt("return");case 14:return u=this._getUniqueKey(t),e.next=17,this.getItem(t.data,!0);case 17:if(!(s=e.sent)||!n.isUniqueCache(s)){e.next=22;break}return this.log("log","".concat(u," already exist in cache")),e.abrupt("return",!1);case 22:if(!this._currentPreloadInst||!(c=this._currentPreloadInst.getData())||this._getUniqueKey({data:c,order:0})!==u){e.next=29;break}return this.log("log","currentKey repeat"),e.abrupt("return");case 29:if(l=this._preloadDataList.filter(function(e){return f._getUniqueKey(e)===u}),this.log("log","addedItems",u,l),0!==l.length){e.next=35;break}return this._stepwise&&void 0===t.data.steps&&(t.data.steps=[0]),this._preloadDataList.push(t),e.abrupt("return",!0);case 35:return this.log("log","".concat(u," already exist in preloadList")),e.abrupt("return",!1);case 37:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"_getUniqueKey",value:function(e){return e.data.vtype?v.generateUniqueCacheKey(e.data):e.data.vid}},{key:"_checkAutoTask",value:function(){var e=this,t=this._config,r=t.autoCheck,n=t.autoPreload;Promise.resolve().then(function(){n&&e.emit(a.KR.PRELOAD_NEXT),null!=r&&r.enable&&!e._taskIntervalId&&e.startCheckTask()})}},{key:"setItem",value:function(e,t,r,n){var a=v.generateUniqueCacheKey(e);if(!r){var i=this._getLoader(e.vtype);if(!i)return this.log("warn","no ".concat(e.vtype," preloader, register")),Promise.resolve(!1);t=h({},i.generateUniqueKey(e),t)}return this._cacheInst.setItem(a,t,n)}},{key:"getItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=v.generateUniqueCacheKey(e),a=this._getLoader(e.vtype);if(!a)return this.log("warn","no ".concat(e.vtype," preloader, register")),Promise.resolve(!1);var i=t?"":a.generateUniqueKey(e);return this._cacheInst.getItem(n,r,i)}},{key:"getItemSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=v.generateUniqueCacheKey(e),a=this._getLoader(e.vtype);if(!a)return this.log("warn","no ".concat(e.vtype," preloader, register")),!1;var i=t?"":a.generateUniqueKey(e);return this._cacheInst.getItemSync(n,r,i)}},{key:"supportSync",value:function(){return this._cacheInst.supportSync()}},{key:"removeItem",value:function(e,t){var r=v.generateUniqueCacheKey(e);return this._cacheInst.removeItem(r,t)}},{key:"getPreLoadData",value:(i=u(b().mark(function e(t){var r,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.vtype,!(n=this._getLoaderInst(r))){e.next=7;break}return e.next=5,n.getPreLoadData(t);case 5:return a=e.sent,e.abrupt("return",a);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e,this)})),function(e){return i.apply(this,arguments)})},{key:"getPreLoadDataSync",value:function(e){var t=e.vtype,r=this._getLoaderInst(t);return r?r.getPreLoadDataSync(e):null}},{key:"removeAll",value:function(){var e=this;this.getAllCachedDataKeys().forEach(function(t){var r=e.getPreloadMetaByVid(t.split("#")[0]);r&&e.removeItem(r,null)})}},{key:"removeAllPreloadTask",value:function(){this.cancel(),this._preloadDataList=[],this._playingVids=[]}},{key:"disable",value:function(){this._isOpen=!1,this.stopCheckTask()}},{key:"enable",value:function(){this._isOpen=!0,this._config.autoCheck.enable&&!this._taskIntervalId&&this._preloadDataList.length>0&&this.startCheckTask()}},{key:"setUserSelectDefinition",value:function(e){this._userDefinition=e}},{key:"getUserSelectDefinition",value:function(){return this._userDefinition||null}},{key:"getStartDefinition",value:function(){return this._startDefinition}},{key:"setStartDefinition",value:function(e){this._startDefinition=e}},{key:"destroy",value:(o=u(b().mark(function e(){var t,r,n,a;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._stats.destroy(),t=Object.keys(this._loaderInsts),r=0;case 3:if(!(r<t.length)){e.next=12;break}if(n=t[r],!(a=this._getLoaderInst(n))){e.next=9;break}return e.next=9,a.destroy();case 9:r++,e.next=3;break;case 12:this.removeAllListeners(),this._loaderInsts={},this._loaders={},this._playingVids=[],this.detachPlayer();case 17:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"cancel",value:(l=u(b().mark(function e(){var t;return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._currentPreloadInst){e.next=4;break}return e.next=3,this._currentPreloadInst.cancel();case 3:null===(t=this._currentPreloadInst)||void 0===t||t.setData(null);case 4:this._currentPreloadInst=null;case 5:case"end":return e.stop()}},e,this)})),function(){return l.apply(this,arguments)})},{key:"removeByPlayInst",value:function(e,t){for(var r=this._preloadDataList.length-1;r>-1;r--){var n=this._preloadDataList[r];if(n.data.vid===e&&n.playerId===t){this._preloadDataList.splice(r,1);break}}}},{key:"getAllCachedDataKeys",value:function(){var e;return(null===(e=this._cacheInst)||void 0===e?void 0:e.getAllCachedDataKeys())||[]}},{key:"getDataUniqueKey",value:function(e){var t=this._getLoader(e.vtype);return!!t&&t.generateUniqueKey(e)}},{key:"hasItemSameVid",value:function(e){var t=this._getLoader(e.vtype),r=this._getLoaderInst(e.vtype);if(t&&r){var n=t.generateUniqueKey(e);return r.hasItemSameVid(n)}return!1}},{key:"_getLoader",value:function(e){e=e||"";var t=this._loaders[e]||this._loaders[e.toLocaleLowerCase()];return t?t:(this.log("warn","no ".concat(e," preloader, register")),null)}},{key:"_getLoaderInst",value:function(e){e=e||"";var t=this._loaderInsts[e]||this._loaderInsts[e.toLocaleLowerCase()];return t?t:(this.log("warn","no ".concat(e," preloader, register")),null)}},{key:"getPreloadMemoryInfo",value:function(){return this._cacheInst.getMemoryInfo()}},{key:"attachPlayer",value:function(e){this._player=e}},{key:"detachPlayer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;(!e||this._player===e)&&(this._player=null)}},{key:"setPreloadBandwidth",value:function(e,t){this._stats.setPreloadBandwidth(e,t)}},{key:"getPreloadBandwidth",value:function(e){return this._stats.getPreloadBandwidth(e)}},{key:"getLoadInfoAndDelete",value:function(e){return this._stats.getLoadInfoAndDelete(e)}},{key:"getPreloadUnuseInfo",value:function(){return this._stats.getPreloadUnuseInfo()}},{key:"setUsePreloadInfo",value:function(e,t){this._stats.setUsePreloadInfo(e,t)}},{key:"bwEventEmit",value:function(e){var t=e.vid,r=e.loadType,n=e.size,a=e.speed,i=e.cacheKey,o=e.vtype,u=e.duration,s=e.bitrate,c=m(e,Q);this._stats.bwEventEmit(_({vid:t,loadType:r,size:n,speed:a,cacheKey:i,vtype:o,duration:u,bitrate:s},c))}},{key:"findPreloadItem",value:function(e){var t,r=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(this._stepwise){var n=e.reduce(function(e,t){return void 0===t.data.stepIdx||"number"==typeof t.data.stepIdx&&"number"==typeof e.data.stepIdx&&t.data.stepIdx<e.data.stepIdx?t:e}),a=e.filter(function(e){return e.data.stepIdx===n.data.stepIdx});if(a.length>1&&this._sort(a),t=a[0],!r){if("number"!=typeof t.data.stepIdx&&(t.data.stepIdx=-1),t.data.stepIdx++,Array.isArray(t.data.steps)&&t.data.stepIdx>=t.data.steps.length-1){var i=e.indexOf(t);e.splice(i,1)}t.data.stepIdx===1/0&&(t=void 0)}}else t=r?e[0]:e.shift();return t}},{key:"updateConfig",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?this._config=Object.assign({},v.getDefaultConfig(),e):Object.assign(this._config,e);var r=this._config.autoCheck;r&&!r.enable&&this.stopCheckTask(),r&&r.enable&&this.startCheckTask()}},{key:"preProcessUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this._config,n=r.preProcessUrl,a=r.preProcessUrlOptions;return"function"==typeof n?n(e,Object.assign({},a,t)):{url:e}}}],[{key:"getDefaultConfig",value:function(){return{autoPreload:!1,autoCheck:{enable:!1,interval:1e3},preloadMaxCacheCount:5,preloadCacheType:a.Rr.MEMORY,autoCheckPreload:!0,startPreloadControl:!1,startPreloadMinBuffer:5,startPreloadMinPosTime:5,minBufferLength:5,endPreloadControl:!1,endPreloadTaskStrategy:0}}},{key:"generateUniqueCacheKey",value:function(e){var t=e.vid,r=e.codecType,n=e.vtype;return"".concat(t,"#").concat(r,"#").concat(n.toUpperCase())}},{key:"parseKey",value:function(e){if(!e)throw Error("key ".concat(e," is empty"));var t=e.split("#");if(t.length<6)throw Error("key ".concat(e," is not right format"));var r=t[0],n=t[1],a=t[2],i=t[3],o=t[4];return{vid:r,mediaType:n,codecType:a,vtype:i,definition:o,bitrate:parseInt("".concat(t[5]||0),10)||0}}},{key:"debugger",set:function(e){Z=!!e}}])}(C()),et=function(e){var t,r,n,a;function i(e,t){var r;return c(this,i),(r=s(this,i))._data=null,r.preloadManager=e,r._config=t,r.promisePolyfill(),r}return y(i,e),f(i,[{key:"taskInProgress",get:function(){return!1}},{key:"stepwise",get:function(){return this.preloadManager.stepwise}},{key:"getRequestOption",value:function(e){var t=this._config,r=t.getRequestOptionsCallback,n=t.reqOptions,a={};return e?a=e.reqOptions?e.reqOptions:"function"==typeof r?r(e):n||{}:a}},{key:"getUserSelectDefinition",value:function(){return this.preloadManager.getUserSelectDefinition()}},{key:"selectBitrate",value:function(e,t,r){return this.preloadManager.selectBitrate(e,t,r)}},{key:"promisePolyfill",value:function(){!Promise.prototype.finally&&(Promise.prototype.finally=({finally:function(e){var t=function(t){return Promise.resolve(e()).then(t)};return this.then(function(e){return t(function(){return e})},function(e){return t(function(){return Promise.reject(e)})})}}).finally)}},{key:"getData",value:function(){return this._data}},{key:"setData",value:function(e){this._data=e}},{key:"start",value:(t=u(b().mark(function e(t,r){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("start need implement, return Promise");case 1:case"end":return e.stop()}},e)})),function(e,r){return t.apply(this,arguments)})},{key:"cancel",value:(r=u(b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("cancel need implement, cancel current preload request");case 1:case"end":return e.stop()}},e)})),function(){return r.apply(this,arguments)})},{key:"getPreLoadData",value:(n=u(b().mark(function e(t){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw Error("getPreLoadData not implement");case 1:case"end":return e.stop()}},e)})),function(e){return n.apply(this,arguments)})},{key:"getPreLoadDataSync",value:function(e){return null}},{key:"hasItemSameVid",value:function(e){return!0}},{key:"destroy",value:(a=u(b().mark(function e(){return b().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}},e)})),function(){return a.apply(this,arguments)})},{key:"parseKey",value:function(e){return ee.parseKey(e[0])}}],[{key:"generateUniqueKey",value:function(e){throw Error("generateUniqueCacheKey  need implement, return string")}},{key:"vtype",get:function(){throw Error("need vtype")}},{key:"isUniqueCache",value:function(e){return!0}}])}(C())}}]);