/*! For license information please see 12563.0baaada8.js.LICENSE.txt */
(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["12563"],{985493:function(e,t,i){"use strict";i.d(t,{Z_:function(){return r},d8:function(){return n}});var n=function(e,t,i,n){void 0===i&&(i="/"),document.cookie="".concat(e,"=").concat(t,";path=").concat(i,";domain=").concat(n||window.location.hostname)},r=function(){try{var e="",t=document.location.hostname,i=t.split(".");if(/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(t)||"localhost"===t){var n=document.location.hostname,r=/^.*?\b\.\b/;return n.replace(r,"")}var o=[];for(o.unshift(i.pop());o.length<2;)o.unshift(i.pop()),e=o.join(".");return e||document.location.hostname}catch(e){return document.location.hostname}}},839954:function(e,t,i){"use strict";i.d(t,{AU:function(){return v},Di:function(){return l},bD:function(){return a},lk:function(){return u}});var n=i(213257),r=i(885774),o=function(e,t,i){if(i||2==arguments.length)for(var n,r=0,o=t.length;r<o;r++)(n||!(r in t))&&(!n&&(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},s=n.sha256.hmac;function a(e,t){return s(e,t)}function l(e,t,i,n){return void 0===n&&(n=32),c(d(e,t),i,n)}function d(e,t){var i=32;return(!e||0===e.length)&&(e=new Uint8Array(i)),a(e,t)}function c(e,t,i){void 0===i&&(i=32);for(var n=new Uint8Array,s="",l=0;n.length<i;){l++;var d=Uint8Array.from(o(o(o([],Array.from(Uint8Array.from((0,r.GZ)(s))),!0),Array.from(t),!0),[l],!1));s=a((0,r.GZ)(e),d),n=Uint8Array.from(o(o([],Array.from(n),!0),Array.from(Uint8Array.from((0,r.GZ)(s))),!0))}return Uint8Array.from(n.slice(0,i))}var u=function(e,t,i){return"aid=".concat(e,"&path=").concat(t,"&ts=").concat(i)},v=function(e,t){return(void 0===t&&(t=location.hostname),0===e.indexOf("/passport")||-1===t.indexOf("sso"))?e:"/passport/sso".concat(e)}},515518:function(e,t,i){"use strict";i.d(t,{c:function(){return v}});var n=i("442664"),r=i("428775"),o=i.n(r),s=i("684941"),a=i("340699"),l=i("177948"),d=function(){return(d=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=function e(e,t){var i=e.host,n=e.isBoe,r=void 0!==n&&n,c=e.axiosConfig,u=o().create(d(d({},c),{baseURL:i||window&&"".concat(r?"http":"https","://").concat(window.location.hostname),adapter:(0,a.Z)(e),withCredentials:!0,transformRequest:[function(e){var t=e;if("string"==typeof e)try{t=JSON.parse(e)}catch(e){}return t}]}));return u.interceptors.response.use(function(t){return(0,s.e)(t,e)},void 0),u.interceptors.request.use((0,l.w)(t)),u},u=i("971699"),v=function(){return function e(e){var t=e.autoTrace,i=void 0===t||t,r=e.traceInstance||new l.f({autoTrace:i}),o=(null==e?void 0:e.fetch)?c(e,r):(0,n.Z)(e,r);return o.trace=r,o.interceptors.request.use((0,u.m)(e)),o}}()},103356:function(e,t,i){"use strict";i.d(t,{nC:function(){return v},e4:function(){return u},bb:function(){return h},IK:function(){return f}});var n=i("885774"),r="4.2.3",o=function(){return(o=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var r in t=arguments[i],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},s=function(e,t,i,n){function r(e){return e instanceof i?e:new i(function(t){t(e)})}return new(i||(i=Promise))(function(i,o){function s(e){try{l(n.next(e))}catch(e){o(e)}}function a(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):r(e.value).then(s,a)}l((n=n.apply(e,t||[])).next())})},a=function(e,t){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(e){return function(t){return l([e,t])}}function l(o){if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,n&&(r=2&o[0]?n.return:o[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,o[1])).done)return r;switch(n=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{i=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},l=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&0>t.indexOf(n)&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)0>t.indexOf(n[r])&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]]);return i},d=function(e,t,i){if(i||2==arguments.length)for(var n,r=0,o=t.length;r<o;r++)(n||!(r in t))&&(!n&&(n=Array.prototype.slice.call(t,0,r)),n[r]=t[r]);return e.concat(n||Array.prototype.slice.call(t))},c={web:{respHandler:function(e){return(null==e?void 0:e.message)==="success"},successCallBack:function(e){return null==e?void 0:e.data},failCallBack:function(e){return null==e?void 0:e.data}},sso:{respHandler:function(e){return(null==e?void 0:e.error_code)===0||(null==e?void 0:e.message)==="success"},successCallBack:function(e){return(null==e?void 0:e.message)==="success"?e.data:e},failCallBack:function(e){return e}},app:{},auth:{respHandler:function(e){return(null==e?void 0:e.status_code)===0},successCallBack:function(e){return e.data},failCallBack:function(e){return e}}},u=function(e,t){var i,r,s,a,l,u,v,h,f=c[e.config.params.account_sdk_source],g=(null==f?void 0:f.respHandler)||function(e){return(null==e?void 0:e.message)==="success"},p=(null==f?void 0:f.successCallBack)||function(e){return null==e?void 0:e.data},m=(null==f?void 0:f.failCallBack)||function(e){return null==e?void 0:e.data},y=(null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.url)||"",x=(null===(r=null==e?void 0:e.headers)||void 0===r?void 0:r["x-tt-logid"])||"",I=(null==e?void 0:e.data)||{},_=(null==t?void 0:t.printLog)||!1,b=null===(s=null==e?void 0:e.config)||void 0===s?void 0:s.startTime;if("string"==typeof I)try{I=JSON.parse(I)}catch(e){}return g(I)?(_&&(0,n.Jz)("call ".concat(y," result >>>>"),{"%cSUCCESS":p(I),"%cLogid":x}),Promise.resolve(o(o({},p(I)||{}),{log_id:x,rawData:e,respHeader:null==e?void 0:e.headers,middlewareHandlerLog:d(d([],(null===(a=null==e?void 0:e.config)||void 0===a?void 0:a.middlewareHandlerLog)||[],!0),[{name:"request",time:Date.now()-b,endTime:Date.now(),startTime:b,errorCode:0,logid:x}],!1)}))):(_&&(0,n.Jz)("call ".concat(y," result >>>>"),{"%cERROR":m(I),"%cLogid":x}),Promise.reject(o(o({},m(I)||{}),{log_id:x,originConfig:o(o({},null==e?void 0:e.config),{middlewareHandlerLog:d(d([],(null===(l=null==e?void 0:e.config)||void 0===l?void 0:l.middlewareHandlerLog)||[],!0),[{name:"request",time:Date.now()-b,endTime:Date.now(),startTime:b,errorCode:(null===(u=null==I?void 0:I.data)||void 0===u?void 0:u.error_code)||(null==I?void 0:I.error_code)||"-998",logid:x}],!1)}),middlewareHandlerLog:d(d([],(null===(v=null==e?void 0:e.config)||void 0===v?void 0:v.middlewareHandlerLog)||[],!0),[{name:"request",time:Date.now()-b,endTime:Date.now(),startTime:b,errorCode:(null===(h=null==I?void 0:I.data)||void 0===h?void 0:h.error_code)||(null==I?void 0:I.error_code)||"-998",logid:x}],!1),rawData:e,respHeader:null==e?void 0:e.headers})))},v=function(e,t){var i,r,s,a,l,c,u,v=(null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.url)||"",h=(null===(s=null===(r=null==e?void 0:e.response)||void 0===r?void 0:r.headers)||void 0===s?void 0:s["x-tt-logid"])||"unknown",f=(null==t?void 0:t.printLog)||!1,g=null===(a=null==e?void 0:e.config)||void 0===a?void 0:a.startTime;return f&&(0,n.Jz)("call ".concat(v," result >>>>"),{"%cERROR":"HTTP ERROR","%cLogid":h}),Promise.reject({error_code:e.code,description:e.message,is_network_error:!0,log_id:h,originConfig:o(o({},null==e?void 0:e.config),{middlewareHandlerLog:d(d([],(null===(l=null==e?void 0:e.config)||void 0===l?void 0:l.middlewareHandlerLog)||[],!0),[{name:"request",time:Date.now()-g,endTime:Date.now(),startTime:g,errorCode:e.code||"-999",logid:h}],!1)}),middlewareHandlerLog:d(d([],(null===(c=null==e?void 0:e.config)||void 0===c?void 0:c.middlewareHandlerLog)||[],!0),[{name:"request",time:Date.now()-g,endTime:Date.now(),startTime:g,errorCode:e.code||"-999",logid:h}],!1),rawData:e,respHeader:null===(u=null==e?void 0:e.response)||void 0===u?void 0:u.headers})},h=function(e,t){return s(void 0,void 0,void 0,function(){var i,r,s,d,c,u,v,h,f,g,p,m,y,x,I,_;return a(this,function(a){return(i=(null==t?void 0:t.printLog)||!1,r=(null==t?void 0:t.appKey)||"",s=null==e?void 0:e.url,d=(null==e?void 0:e.method)||"get",c=(null==e?void 0:e.data)||{},u=(null==e?void 0:e.params)||{},v=Object.assign({"Content-Type":"application/x-www-form-urlencoded",Accept:"application/json, text/javascript"},{"x-tt-passport-csrf-token":(0,n.ej)("passport_csrf_token")||(0,n.ej)("passport_csrf_token_default")||""},e.headers||{}),e.headers=v,i&&(0,n.Jz)("".concat(d," ").concat(s," >>>>"),{"%cdata >>>>":c,"%cparams >>>>":u}),(null===(I=e.params)||void 0===I?void 0:I.isResend)||(null===(_=e.params)||void 0===_?void 0:_.auto_retry_req))?(f=(h=e.params).isResend,g=l(h,["isResend"]),[2,o(o({},e),{params:g,startTime:Date.now()})]):(p={},Object.keys(c).filter(function(e){return void 0!==c[e]}).forEach(function(e){p[e]=c[e]}),["post","POST"].includes(d)&&(m=o({},(null==e?void 0:e.params)||{}),y=(0,n.uF)(m,p,r),e.params=o(o({},m),y),(0,n.hp)(c)?e.data=c:e.data=(0,n.IC)(p)),["get","GET"].includes(d)&&(x=o(o({},p),e.params),y=(0,n.uF)(x,{},r),e.params=o(o({},x),y)),[2,o(o({},e),{startTime:Date.now()})])})})},f=function(e,t){return s(void 0,void 0,void 0,function(){var i,n,s,l,d,c,u,v,h;return a(this,function(a){switch(a.label){case 0:if(i=(null==e?void 0:e.params)||{},n=t.aid,l=void 0===(s=t.language)?"zh":s,c=void 0===(d=t.generalParams)?{}:d,u=t.getGeneralParams,v={},!u)return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),[4,u()];case 2:return v=a.sent(),[3,4];case 3:return h=a.sent(),[3,4];case 4:return e.params=o(o(o({passport_jssdk_version:r,passport_jssdk_type:"lite",is_from_ttaccountsdk:1,aid:n,language:l},i),c),v),[2,Promise.resolve(e)]}})})}},557418:function(e,t,i){"use strict";i.d(t,{G:function(){return a}});var n=i(651889),r=i(592242),o=i(473614),s=i(835649);class a extends Error{constructor(e){var t,i,l,d;super(`${e&&e.logid?`[${e.logid}] `:""}${e&&e.msg?'message: "'+e.msg+'"':""}${e&&e.innerError?`, inner error: "${e.innerError}"`:""}`),this.ctx=e.ctx,Object.assign(this,e),Object.setPrototypeOf(this,a.prototype),(null===(t=this.innerError)||void 0===t?void 0:t.logid)&&(this.logid=this.innerError.logid);try{"string"==typeof(null===(i=this.innerError)||void 0===i?void 0:i.stack)&&(this.stack=this.innerError.stack+"\n"+(null===(l=this.stack)||void 0===l?void 0:l.split("\n").slice(2).join("\n")))}catch(e){r.Y.ctxWarn(this.ctx,`concat trace fail=${e}, current stack=${this.stack}, inner stack=${null===(d=this.innerError)||void 0===d?void 0:d.stack}`)}if(!this.ctx)return;!e.ignoreEvent&&this.resolve(s.Uk.EventBus).emit(n.c5.Error,e.sender,this),this.resolve(s.Uk.Monitor).emitError(this),this.resolve(s.Uk.Monitor).emitCounter(o.U.BizSdkError,1,{type:e.type?`${e.type}:${n.NI[e.type]}`:"unknown"})}getContext(){return this.ctx}resolve(e){return this.ctx.resolve(e)}}},473614:function(e,t,i){"use strict";i.d(t,{U:function(){return n},u:function(){return s}});var n,r=i(651889),o=i(835649);!function(e){e.CreateConversation="create.conv",e.SendMessage="send.msg",e.ReceiveMessage="receive.msg",e.WsConnect="ws.connect",e.NetworkRequest="network.request",e.FrontierOpen="frontier.open",e.FrontierClose="frontier.close",e.FrontierError="frontier.error",e.FrontierReceive="frontier.receive",e.FrontierLive="frontier.live",e.WebSocketConnectFirst="ws.connect.first",e.WebSocketConnectAfterClose="ws.connect.afterclose",e.WebSocketConnectNoHeartbeat="ws.connect.noheartbeat",e.BizApiInvoke="api.invoke",e.MessageAck="message.ack",e.SuccessSuffix=".success",e.ErrorSuffix=".error",e.BizSdkInit="init",e.BizRefreshToken="refresh.token",e.BizSdkError="error",e.GetMessagesByConversation="message.get.byconversation",e.GetMessagesByTicker="message.get.ticker"}(n||(n={}));class s extends o.mA{static get avgDelta(){return 0===this.putDeltaTimes?0:this.totalDelta/this.putDeltaTimes}static putTimeDelta(e,t,i,n){if(void 0===i||void 0===n)return;let r=(t-e-(i-n))/2+e,o=n-r;s.putDeltaTimes++,s.totalDelta+=o}get avgDelta(){return s.avgDelta}static performanceNow(){return"object"==typeof performance&&"function"==typeof performance.now&&"number"==typeof performance.timeOrigin?performance.now()+performance.timeOrigin:Date.now()}invoke(e,...t){if(void 0===this.ctx.option.monitor)return!1;let i=this.ctx.option.monitor;!Array.isArray(i)&&(i=[i]),i.forEach(i=>{let n=i[e];return"function"==typeof n&&setTimeout(()=>{n.apply(i,t)},0)})}fillKv(e){let t=Object.assign(Object.assign(Object.assign({},e),this.ctx.option.monitorTagKv),{sdk_version:r.HF.sdkVersion,sdk_type:this.ctx.option.sdkType||"im-web-sdk",build_number:r.HF.buildNumber,app_id:this.ctx.option.appId.toString(),user_id:this.ctx.option.userId});return this.ctx.option.versionCode&&(t.version_code=this.ctx.option.versionCode),t}emitMetrics(e,t={},i={}){let n=`imsdk.${e}`;this.invoke("emitMetrics",n,t,this.fillKv(i))}emitCounter(e,t=1,i={}){if(0===t)return;let n=`imsdk.${e}`;this.invoke("emitMetrics",n,{count:t},this.fillKv(i))}emitDuration(e,t,i={}){let n=s.performanceNow()-t,r=`imsdk.${e}`;return this.invoke("emitMetrics",r,{duration:n},this.fillKv(i)),n}emitLatencyDuration(e,t,i={}){let n=this.ctx.option.timeCalibration?this.avgDelta:0,r=s.performanceNow()+n-t;if(!(r<0))this.invoke("emitMetrics",e,{duration:r},this.fillKv(i))}emitError(e){this.invoke("emitError",e,this.fillKv({}))}emitNetwork(e,t,i={}){this.invoke("emitNetwork",e,t,this.fillKv(i))}emitEvent(e,t,i){this.invoke("emitEvent",e,t,i)}emitLog(e,...t){this.invoke("emitLog",e,t[0])}emitTracker(e,t){this.invoke("emitTracker",e,this.fillKv(t))}}s.putDeltaTimes=0,s.totalDelta=0},832141:function(e,t,i){"use strict";i.d(t,{_:function(){return s}});var n=i(193533),r=i(592242),o=i(835649);class s extends o.mA{constructor(e,t){var i,r;super(e.ctx),this.version=n.ZERO,this.parent=e,void 0!==t&&(this.desc=t.desc,this.ext=t.ext,this.icon=t.icon,this.name=t.name,this.notice=t.notice,this.owner=null!==(r=null===(i=t.owner)||void 0===i?void 0:i.toString())&&void 0!==r?r:"",this.version=t.info_version,this.secOwner=t.sec_owner,this.inboxType=t.inbox_type),void 0===this.inboxType&&(this.inboxType=this.resolve(o.Uk.InboxType).getDefaultInboxWithoutCheck())}get conversationId(){return this.parent.id}get ext(){return!this.innerExt&&(this.innerExt={}),this.innerExt}set ext(e){this.innerExt=null!=e?e:{}}mergeCore(e){return e.version.lt(this.version)?(r.Y.ctxDebug(this.ctx,"core info version local > online, local: ",this.version.toString(),"new: ",e.version.toString()),this):e.conversationId!==this.conversationId?(r.Y.ctxDebug(this.ctx,"core info conversation not match, local:",this.conversationId.toString(),"new: ",e.conversationId.toString()),this):(this.version=e.version,this.name=e.name,this.desc=e.desc,this.icon=e.icon,this.notice=e.notice,this.owner=e.owner,this.secOwner=e.owner,this.innerExt=Object.assign(Object.assign({},this.innerExt),e.innerExt),this.inboxType=e.inboxType,this)}}},504025:function(e,t,i){"use strict";i.d(t,{z:function(){return s}});var n=i(621631),r=i(124125),o=i(792243);class s{static fromOp(e,t){var i;let n=new s;return n.conversationId=e.conversationId,n.messageId=e.clientId,n.key=t.key,n.userId=e.ctx.option.userId,n.secUid=e.ctx.option.secUid,n.createTime=new Date(Date.now()),n.idempotentId=t.idempotentId,n.value=null!==(i=t.value)&&void 0!==i?i:"",n.version=e.version,n.status=o.R.Sending,n}static mergeOperationToCurrent(e,t){var i;let o=(0,r.vM)(t,e=>e.key);for(let t of Object.keys(o))for(let r of o[t]){!e.property[t]&&(e.property[t]=[]);let o=null===(i=e.property[t])||void 0===i?void 0:i.findIndex(e=>e.idempotentId===r.idempotentId);switch(r.operation){case n.m.OPERATION_TYPE.ADD_PROPERTY_ITEM:-1===o&&e.property[t].push(s.fromOp(e,r));break;case n.m.OPERATION_TYPE.REMOVE_PROPERTY_ITEM:-1!==o&&e.property[t].splice(o,1),0===e.property[t].length&&delete e.property[t];break;case n.m.OPERATION_TYPE.SET_PROPERTY:e.property[t]=[s.fromOp(e,r)];break;case n.m.OPERATION_TYPE.DEL_PROPERTY:delete e.property[t]}}}}},419707:function(e,t,i){"use strict";i.d(t,{Q:function(){return l}});var n=i(193533),r=i(651889),o=i(621631),s=i(835649),a=i(124125);class l extends s.mA{constructor(){super(...arguments),this.minIndex=n.ZERO,this._readIndex=n.ZERO,this._readOrder=n.ZERO}get isServerBlocked(){return(0,a.vP)(this.ext,r.v9.RelationIsMutedServer)}get readIndex(){return this._readIndex}set readIndex(e){e&&e.gt(this._readIndex)&&(this._readIndex=e)}get readOrder(){return this._readOrder}set readOrder(e){e&&e.gt(this._readOrder)&&(this._readOrder=e)}get isSelf(){return this.userId===this.ctx.option.userId}get ext(){return!this.innerExt&&(this.innerExt={}),this.innerExt}set ext(e){this.innerExt=e}static featLocalParticipant(e,t){var i,n,r,o,s,a,l,d;return e.userId!==t.userId?e:(e.secUid=null!==(i=t.secUid)&&void 0!==i?i:e.secUid,e.role=null!==(n=t.role)&&void 0!==n?n:e.role,e.alias=null!==(r=t.alias)&&void 0!==r?r:e.alias,e.sortOrder=null!==(o=t.sortOrder)&&void 0!==o?o:e.sortOrder,e.blocked=null!==(s=t.blocked)&&void 0!==s?s:e.blocked,e.leftBlockTime=null!==(a=t.leftBlockTime)&&void 0!==a?a:e.leftBlockTime,e.readIndex=null!==(l=t.readIndex)&&void 0!==l?l:e.readIndex,e.readOrder=null!==(d=t.readOrder)&&void 0!==d?d:e.readOrder,e.ext=Object.assign(e.ext,t.ext),e)}static fromServerParticipant(e,t,i,n){var s,a,d,c,u;let v=new l(e);return v.userId=t.user_id.toString(),v.secUid=t.sec_uid,v.role=null!==(s=t.role)&&void 0!==s?s:void 0,v.alias=null!==(a=t.alias)&&void 0!==a?a:void 0,v.sortOrder=null!==(d=t.sort_order)&&void 0!==d?d:void 0,v.blocked=t.blocked===o.m.BlockStatus.BLOCK,v.leftBlockTime=null!==(c=t.left_block_time)&&void 0!==c?c:void 0,v.ext=null!==(u=t.ext)&&void 0!==u?u:{},v.conversationId=i.id,v.conversationType=i.type,void 0!==n&&v.ctx.option.debug&&(v.ext[r.v9.LocalLogId]=n),v}static fakeParticipant(e,t,i){let r=new l(e);return r.conversationId=i.id,r.conversationType=i.type,r.readIndex=n.ZERO,r.minIndex=n.ZERO,r.userId=t,r}}},829727:function(e,t,i){"use strict";i.d(t,{Z:function(){return a}});var n=i(101380),r=i(621631),o=i(835649),s=i(491822);class a extends o.mA{constructor(e){super(e),this.option=e.option}sendByBeacon(e,t){return!1}sendBeacon(e,t){setTimeout(()=>{!this.sendByBeacon(e,(0,s.qC)(t))&&this.sendRequest(e,t)},0)}sendRequest(e,t){return(0,n.mG)(this,void 0,void 0,function*(){let i=yield this.send(e,"POST",this.encode(t));return this.decode(i)})}encode(e){return(0,s.qC)(e).buffer}decode(e){return r.m.Response.create((0,s.vB)(this.ctx,e))}get headers(){return Object.assign({Accept:this.mime,"Content-Type":this.mime},this.option.httpHeaders)}get mime(){return"application/x-protobuf"}get dataType(){return"arraybuffer"}get method(){return"POST"}}},198721:function(e,t,i){"use strict";i.d(t,{KE:function(){return s},QK:function(){return n},td:function(){return r}});var n,r,o=i(835649);!function(e){e[e.Unknown=0]="Unknown",e[e.Connected=1]="Connected",e[e.Disconnected=2]="Disconnected"}(n||(n={})),!function(e){e[e.Unknown=0]="Unknown",e[e.Cellular_2G=1]="Cellular_2G",e[e.Cellular_3G=2]="Cellular_3G",e[e.Cellular_4G=3]="Cellular_4G",e[e.Cellular_5G=4]="Cellular_5G",e[e.Wifi=5]="Wifi",e[e.Other=6]="Other",e[e.None=7]="None"}(r||(r={}));class s extends o.mA{}},952489:function(e,t,i){"use strict";i.d(t,{N:function(){return n},f:function(){return s}});var n,r=i(359756),o=i(835649);!function(e){e[e.Stopped=0]="Stopped",e[e.Running=1]="Running"}(n||(n={}));class s extends o.mA{constructor(e,t,i){return super(e),this.state=n.Stopped,this.refreshRate=0,this.doneDuration=0,this.refreshRate=t,this.doneDuration=i,this.onTick=new r.x(this.ctx),this.onDone=new r.x(this.ctx),this.onStop=new r.x(this.ctx),this}get duration(){return this.state===n.Stopped&&0!==this.lastStopTime?this.lastStopTime-this.startTime:this.state===n.Running?Date.now()-this.startTime:0}start(){this.state!==n.Running&&this.restart()}getTickTimer(){return this.tickTimer}update(){this.onTick.nextEmpty(this)}done(){this.stop(),this.onDone.nextEmpty()}}},435588:function(e,t,i){"use strict";i.d(t,{W:function(){return u}});var n=i(101380),r=i(621631),o=i(651889),s=i(557418),a=i(592242),l=i(473614),d=i(501297),c=i(835649);class u extends c.mA{constructor(e){super(e)}send(e,t,i={}){return(0,n.mG)(this,void 0,void 0,function*(){return(yield this.sendWithRawBody(e,t,i)).body})}sendWithRawBody(e,t,i={}){var u,v,h,f,g,p,m,y,x,I,_,b,k,C,S,w,M,T,U,O,R,E,A,B,P,D,N,G;return(0,n.mG)(this,void 0,void 0,function*(){let n;let j=l.u.performanceNow(),q=this.getReqTrackerContext(e);try{if(void 0===i.inboxType&&(i.inboxType=this.resolve(c.Uk.InboxType).getDefaultInboxWithoutCheck()),this.ctx.option.webSocketLevel===o._.PushOnly&&(i.forceHttp=!0),this.ctx.option.webSocketLevel===o._.All&&(i.forceHttp=!1),n=new d.F(this.ctx,t,e),yield n.prepareRequest(i.inboxType),yield this.resolve(c.Uk.NetworkManager).send(n,{maxHttpRetryTimes:!0===i.forceHttp?i.maxRetryTimes:void 0,maxWsRetryTimes:!0===i.forceHttp?0:i.maxRetryTimes,useBeacon:i.useBeacon}),i.useBeacon||void 0===n.response)return r.m.Response.create({});let T=n.response;if(0!==T.status_code){let d=T.status_code;switch(d){case o.NI.Degradation:throw new s.G({ctx:this.ctx,msg:"server degradation",type:o.NI.Degradation,sender:this,logid:null==T?void 0:T.log_id,args:{req:e,resp:T}});case o.NI.InvalidTicket:if(t===r.m.IMCMD.SEND_MESSAGE){let n=e.send_message_body.conversation_id,r=this.resolve(c.Uk.ConversationManager).get(n);if(!r)throw new s.G({ctx:this.ctx,msg:`conversation ${n} not exist in local`,type:o.NI.ConversationNotExist,sender:this,args:{convId:n}});let l=r.ticket;yield this.resolve(c.Uk.ConversationManager).refreshTicket(r.id);let d=r.ticket;if(l!==d&&!i.isRetryReq)return a.Y.ctxDebug(this.ctx,"refresh ticket due to invalid"),this.sendWithRawBody(e,t,Object.assign(Object.assign({},i),{isRetryReq:!0}));throw new s.G({ctx:this.ctx,msg:`invalid ticket for conv: ${n}`,type:o.NI.InvalidTicket,sender:this,logid:null==T?void 0:T.log_id,args:{req:e,resp:T}})}break;case o.NI.InvalidToken:case o.NI.ExpiredToken:let k=this.ctx.cachedToken;try{if(this.resolve(c.Uk.NetworkManager).closeWs(!0),""===k||this.ctx.option.authType===r.m.AuthType.SESSION_AUTH){if(!i.isRetryReq)return a.Y.ctxDebug(this.ctx,"http retry due to invalid session"),this.sendWithRawBody(e,t,Object.assign(Object.assign({},i),{isRetryReq:!0,forceHttp:!0}));throw new s.G({ctx:this.ctx,msg:"invalid session",type:o.NI.TokenFuncError,sender:this,logid:null==T?void 0:T.log_id,args:{req:e,resp:T}})}{yield this.ctx.resolve(c.Uk.AuthManager).refreshToken();let n=this.ctx.cachedToken;if(k!==n&&!i.isRetryReq)return a.Y.ctxDebug(this.ctx,"refresh token due to invalid"),this.sendWithRawBody(e,t,Object.assign(Object.assign({},i),{isRetryReq:!0}));throw new s.G({ctx:this.ctx,msg:`token refresh fail: ${n}`,type:o.NI.TokenFuncError,sender:this,logid:null==T?void 0:T.log_id,args:{req:e,resp:T}})}}catch(t){if(void 0!==t.type)throw t.args=Object.assign(Object.assign({},t.args),{req:e,resp:T}),t;throw new s.G({ctx:this.ctx,msg:"token refresh func error",type:o.NI.TokenFuncError,innerError:t,sender:this,logid:null==T?void 0:T.log_id,args:{req:e,resp:T}})}default:if(i.ignoreBizError)return this.resolve(c.Uk.Monitor).emitMetrics(l.U.NetworkRequest,{duration:Math.round(l.u.performanceNow()-j),retry_times:null!==(u=null==n?void 0:n.retryTimes)&&void 0!==u?u:0},{imsdk_cmd:t.toString(),imsdk_result:"0",seq_id:null!==(v=null==n?void 0:n.seqId.toString())&&void 0!==v?v:"",conversation_id:q.conversationId,uuid:q.uuid,error_msg:null!==(f=null===(h=null==n?void 0:n.response)||void 0===h?void 0:h.error_desc)&&void 0!==f?f:"",error_code:null!==(m=null===(p=null===(g=null==n?void 0:n.response)||void 0===g?void 0:g.status_code)||void 0===p?void 0:p.toString())&&void 0!==m?m:"",url_path:null!==(y=null==n?void 0:n.url)&&void 0!==y?y:"",net_type:null!==(I=null===(x=null==n?void 0:n.method)||void 0===x?void 0:x.toString())&&void 0!==I?I:"",logid:null!==(_=null==n?void 0:n.logid)&&void 0!==_?_:"",is_retry_req:i.isRetryReq?"1":"0"}),T;throw new s.G({ctx:this.ctx,msg:`${null!==(b=o.NI[d])&&void 0!==b?b:"unknown"}:${T.error_desc}`,type:d,sender:this,logid:null==T?void 0:T.log_id,args:{req:e,resp:T}})}}if(T.body){for(let e of(this.resolve(c.Uk.Monitor).emitMetrics(l.U.NetworkRequest,{duration:Math.round(l.u.performanceNow()-j),retry_times:null!==(k=n.retryTimes)&&void 0!==k?k:0},{imsdk_cmd:t.toString(),imsdk_result:"1",seq_id:n.seqId.toString(),conversation_id:q.conversationId,uuid:q.uuid,error_msg:"",error_code:"0",url_path:null!==(C=n.url)&&void 0!==C?C:"",net_type:null!==(w=null===(S=n.method)||void 0===S?void 0:S.toString())&&void 0!==w?w:"",logid:null!==(M=T.log_id)&&void 0!==M?M:"",is_retry_req:i.isRetryReq?"1":"0"}),this.ctx.plugin))yield e.receiveApiResponse(T);return T}throw new s.G({ctx:this.ctx,msg:"no response body",type:o.NI.Unknown,sender:this,logid:null==T?void 0:T.log_id,args:{req:e,resp:T}})}catch(r){if(this.resolve(c.Uk.Monitor).emitMetrics(l.U.NetworkRequest,{duration:Math.round(l.u.performanceNow()-j),retry_times:null!==(T=null==n?void 0:n.retryTimes)&&void 0!==T?T:0},{imsdk_cmd:t.toString(),imsdk_result:"0",seq_id:null!==(U=null==n?void 0:n.seqId.toString())&&void 0!==U?U:"",conversation_id:q.conversationId,uuid:q.uuid,error_msg:null!==(R=null===(O=null==n?void 0:n.response)||void 0===O?void 0:O.error_desc)&&void 0!==R?R:"",error_code:null!==(B=null===(A=null===(E=null==n?void 0:n.response)||void 0===E?void 0:E.status_code)||void 0===A?void 0:A.toString())&&void 0!==B?B:"",url_path:null!==(P=null==n?void 0:n.url)&&void 0!==P?P:"",net_type:null!==(N=null===(D=null==n?void 0:n.method)||void 0===D?void 0:D.toString())&&void 0!==N?N:"",logid:null!==(G=null==n?void 0:n.logid)&&void 0!==G?G:"",is_retry_req:i.isRetryReq?"1":"0"}),void 0===r)throw new s.G({ctx:this.ctx,msg:"unknown error",type:o.NI.Unknown,sender:this,args:{req:e}});if(void 0!==r.type)throw r.args=Object.assign(Object.assign({},r.args),{req:e}),r;throw new s.G({ctx:this.ctx,msg:"request unknown error",type:o.NI.Unknown,innerError:r,sender:this,args:{req:e}})}})}getReqTrackerContext(e){var t,i,n,r;for(let o of Object.keys(e)){let s=e[o];if(void 0!==s)return{conversationId:null!==(i=null===(t=s.conversation_id)||void 0===t?void 0:t.toString())&&void 0!==i?i:"",uuid:null!==(r=null===(n=s.client_message_id)||void 0===n?void 0:n.toString())&&void 0!==r?r:""}}return{conversationId:"",uuid:""}}}},175316:function(e,t,i){"use strict";i.d(t,{_:function(){return s}});var n=i(651889),r=i(557418),o=i(835649);class s extends o.mA{isValidInbox(e){return void 0!==e&&(!!this.getContext().option.acceptIncorrectInboxType||this.getInboxTypeArray().includes(e))}needSpecifyInbox(){let e=this.ctx.option.inboxType;return void 0!==e&&("number"!=typeof e||!(e>=0))&&(!!Array.isArray(e)&&!!(e.length>2)||!1)}getDefaultInboxWithoutCheck(){return this.getInboxTypeArray()[0]}getDefaultInbox(){if(this.needSpecifyInbox())throw new r.G({ctx:this.ctx,msg:"no available inboxType is provided",type:n.NI.InvalidInboxType,sender:this});return this.getDefaultInboxWithoutCheck()}getInboxTypeArray(){let e=this.ctx.option.inboxType;return Array.isArray(e)?e:void 0!==e?[e]:[0]}}},254378:function(e,t,i){"use strict";i.d(t,{a:function(){return u}});var n=i(101380),r=i(651889),o=i(557418),s=i(419707),a=i(621631),l=i(592242),d=i(193533),c=i(835649);class u extends c.mA{constructor(e){super(e),this.participants=new Map}applyLocal(e){e.forEach(e=>{!this.participants.has(e.conversationId)&&this.participants.set(e.conversationId,new Map),this.participants.get(e.conversationId).set(e.userId.toString(),e)})}clearAll(){this.participants.clear()}updateWithUserIdAsync(e,t){var i,r,o,a;return(0,n.mG)(this,void 0,void 0,function*(){let n=t.map(e=>d.fromValue(e)),l=yield this.resolve(c.Uk.CoreApi).GetConversationParticipantByUserId({conversationId:e.id,conversationShortId:d.fromString(e.shortId),conversationType:e.type,inboxType:e.inboxType,participants:n}),u=null!==(a=null===(o=null===(r=null===(i=null==l?void 0:l.body)||void 0===i?void 0:i.mget_conversation_participants_body)||void 0===r?void 0:r.participants)||void 0===o?void 0:o.map(t=>s.Q.fromServerParticipant(this.ctx,t,e,l.log_id)))&&void 0!==a?a:[];this.upsertBatch(e.id,u)})}upsert(e,t,i=!1){var n;let o=this.participants.get(e.toString());!o&&(o=new Map);let a=t;return a.userId=a.userId.toString(),o.has(t.userId.toString())&&(a=s.Q.featLocalParticipant(o.get(t.userId.toString()),a)),o.set(t.userId.toString(),a),this.participants.set(e,o),!i&&(this.resolve(c.Uk.EventBus).emit(r.c5.ParticipantUpsert,this,a),this.resolve(c.Uk.EventBus).emitEmpty(r.c5.ParticipantChange,this)),null===(n=this.resolve(c.Uk.DbProxy))||void 0===n||n.upsertParticipant(a),Array.from(o.values())}upsertBatch(e,t,i=!1){return t.forEach(t=>this.upsert(e,t,i)),this.get(e)}delete(e,t){let i=this.participants.get(e);if(!!i)t.forEach(e=>{var t;let n=i.get(e.toString());if(void 0!==n)i.delete(e.toString()),this.resolve(c.Uk.EventBus).emit(r.c5.ParticipantLeave,this,n),this.resolve(c.Uk.EventBus).emitEmpty(r.c5.ParticipantChange,this),null===(t=this.resolve(c.Uk.DbProxy))||void 0===t||t.deleteParticipant(n)})}get(e){let t=this.participants.get(e);if(t)return Array.from(t.values());{let t=this.resolve(c.Uk.ConversationManager).get(e);return t?this.getParticipants(t):Array.from([])}}getParticipants(e){var t,i,n;let o=[],d=this.getRaw(e.id);return(null==d?void 0:d.length)>0?d:(Number(null===(i=null===(t=null==e?void 0:e.firstPageParticipant)||void 0===t?void 0:t.participants)||void 0===i?void 0:i.length)>0?((null===(n=null==e?void 0:e.firstPageParticipant)||void 0===n?void 0:n.participants)||[]).forEach(t=>{o.push(s.Q.fromServerParticipant(this.ctx,t,e,e.ext[r.v9.LocalLogId]))}):e.type===a.m.ConversationType.ONE_TO_ONE_CHAT&&(l.Y.ctxDebug(this.ctx,"no first page participant found, fallback to local"),[e.toParticipantUserId,this.ctx.option.userId].forEach(t=>{if(t){let i=s.Q.fakeParticipant(this.ctx,t,e);o.push(i)}})),this.upsertBatch(e.id,o,!0),this.resolve(c.Uk.EventBus).emit(r.c5.InitParticipant,this,e),o)}getMap(e){let t=this.participants.get(e);if(t)return t;throw new o.G({ctx:this.ctx,type:r.NI.ConversationNotExist,msg:`conversation ${e} participants is not loaded`,sender:this,args:{conversationId:e}})}getMapRaw(e){return this.participants.get(e)}getRaw(e){let t=this.participants.get(e);return t?Array.from(t.values()):[]}getByUserIdRaw(e,t){let i=this.participants.get(e);if(i)return i.get(t.toString())}dispose(){this.clearAll()}}},170818:function(e,t,i){"use strict";i.d(t,{W:function(){return f}});var n,r=i("101380"),o=i("651889"),s=i("592242"),a=i("792243"),l=i("358115");!function(e){e[e.MarkConversationRead=1]="MarkConversationRead",e[e.DeleteMessage=2]="DeleteMessage",e[e.DeleteConversation=3]="DeleteConversation",e[e.SettingInfoUpdate=4]="SettingInfoUpdate",e[e.CoreInfoUpdate=6]="CoreInfoUpdate",e[e.ParticipantUpdate=7]="ParticipantUpdate",e[e.FirstMessage=8]="FirstMessage",e[e.NewMarkConversationRead=14]="NewMarkConversationRead"}(n||(n={}));class d extends a.v{static fromMessage(e){let t=e;return t.contentObj=l.parse(e.content),t.commandSubType=t.contentObj.command_type,t}}var c=i("190638"),u=i("193533"),v=i("419707"),h=i("835649");class f extends c.f{process(e){return(0,r.mG)(this,void 0,void 0,function*(){return e.data.isCommandMsg&&(e.needContinue=!1,yield this.parseCommand(e.data)),e})}parseCommand(e){return(0,r.mG)(this,void 0,void 0,function*(){let t=d.fromMessage(e);switch(t.contentObj.command_type){case n.DeleteConversation:this.handleDeleteConversationCMD(t);break;case n.DeleteMessage:this.handleDeleteMessageCMD(t);break;case n.MarkConversationRead:case n.NewMarkConversationRead:this.handleMarkConversationRead(t);break;case n.SettingInfoUpdate:yield this.handleUpdateSettingInfo(t);break;case n.CoreInfoUpdate:yield this.handleUpdateCoreInfo(t);break;case n.ParticipantUpdate:yield this.handleUpdateParticipant(t)}this.resolve(h.Uk.EventBus).emit(o.c5.ReceiveCommandMessage,this,t)})}handleDeleteConversationCMD(e){let{conversation_id:t}=e.contentObj;this.resolve(h.Uk.ConversationManager).delete(t)}handleDeleteMessageCMD(e){let{conversation_id:t,message_id:i}=e.contentObj;this.resolve(h.Uk.MessageManager).delete(t,i.toString())}handleMarkConversationRead(e){var t;if(this.ctx.initResult===o.rb.Succeeded){let{conversation_id:i,read_index:n,read_badge_count:r,mute_read_badge_count_info:o}=e.contentObj;this.resolve(h.Uk.ConversationManager).markRead(i,u.fromValue(n),r,null!==(t=null==o?void 0:o.map(e=>({message_type:e.type,read_badge_count:e.read_badge_count})))&&void 0!==t?t:[])}}handleUpdateSettingInfo(e){return(0,r.mG)(this,void 0,void 0,function*(){if(this.ctx.initResult===o.rb.Succeeded){let{conversation_version:t}=e.contentObj,i=u.fromValue(null!=t?t:u.MAX_VALUE),n=this.resolve(h.Uk.ConversationManager).getWithCreateLocal(e.conversationId,e.conversationShortId.toString(),e.conversationType);n.settingInfo.version.lte(i)?this.resolve(h.Uk.ConversationManager).refresh(n):s.Y.ctxWarn(this.ctx,"ignore online update setting info cmd, local version: ",n.settingInfo.version.toString(),"online: ",i.toString())}})}handleUpdateCoreInfo(e){return(0,r.mG)(this,void 0,void 0,function*(){if(this.ctx.initResult===o.rb.Succeeded){let{group_version:t}=e.contentObj,i=u.fromValue(t),n=this.resolve(h.Uk.ConversationManager).getWithCreateLocal(e.conversationId,e.conversationShortId.toString(),e.conversationType);n.coreInfo.version.lte(i)?this.resolve(h.Uk.ConversationManager).refresh(n):s.Y.ctxWarn(this.ctx,"ignore online update core info cmd, local version: ",n.coreInfo.version.toString(),"online: ",t.toString())}})}handleUpdateParticipant(e){return(0,r.mG)(this,void 0,void 0,function*(){if(this.ctx.initResult===o.rb.Succeeded){let{added_participant:t,modified_participant:i,removed_participant:n}=e.contentObj;if((null==t?void 0:t.length)>0){let i=t.map(String),n=[];i.forEach(t=>{let i=v.Q.fakeParticipant(this.ctx,t,{type:e.conversationType,id:e.conversationId});n.push(i)}),i.includes(this.ctx.option.userId)&&this.resolve(h.Uk.ConversationManager).join(e.conversationId),this.resolve(h.Uk.ParticipantManager).upsertBatch(e.conversationId,n)}if((null==i?void 0:i.length)>0){let t=this.resolve(h.Uk.ConversationManager).get(e.conversationId),n=i.map(String);t&&this.resolve(h.Uk.ParticipantManager).updateWithUserIdAsync(t,n)}if((null==n?void 0:n.length)>0){let t=n.map(String);t.includes(this.ctx.option.userId)&&this.resolve(h.Uk.ConversationManager).leave(e.conversationId),this.resolve(h.Uk.ParticipantManager).delete(e.conversationId,t)}}})}}},303009:function(e,t,i){"use strict";i.d(t,{n:function(){return a}});var n=i(101380),r=i(651889),o=i(190638),s=i(835649);class a extends o.f{process(e){var t;return(0,n.mG)(this,void 0,void 0,function*(){if(!e.data.isNormalMsg)return e;let i=this.resolve(s.Uk.MessageManager).getRaw(null===(t=e.conv)||void 0===t?void 0:t.id,e.data.clientId),n=void 0!==e.data.source&&(e.data.source===r.v$.Online||e.data.source===r.v$.UserInbox),o=(null==i?void 0:i.flightStatus)!==void 0&&n;this.resolve(s.Uk.MessageManager).upsert(e.data);let a=this.resolve(s.Uk.MessageManager).getRaw(e.data.conversationId,e.data.clientId);return i?o&&a.flightStatus!==r.b3.Received&&(a.flightStatus=r.b3.Received,this.ctx.initResult===r.rb.Succeeded&&this.resolve(s.Uk.EventBus).emit(r.c5.ReceiveSelfMessage,this,a),this.resolve(s.Uk.MessageManager).upsert(a)):n&&!e.data.isStrangerMessage&&(e.data.sender!==this.ctx.option.userId?this.ctx.initResult===r.rb.Succeeded&&this.resolve(s.Uk.EventBus).emit(r.c5.ReceiveNewMessage,this,a):this.ctx.initResult===r.rb.Succeeded&&this.resolve(s.Uk.EventBus).emit(r.c5.ReceiveSelfMessage,this,a)),e})}}},377319:function(e,t,i){"use strict";function n(e,t,i,n){i=i||0,n=n||e.length-i;let r=i,o=n,s=0;for(r=i,o=n;r<o;){let i=e[r++],n=i>>4;if(n>0){let i=n+240;for(;255===i;)n+=i=e[r++];let a=r+n;for(;r<a;)t[s++]=e[r++];if(r===o)break}let a=e[r++]|e[r++]<<8;if(0===a||a>s)return-(r-2);let l=15&i,d=l+240;for(;255===d;)l+=d=e[r++];let c=s-a,u=s+l+4;for(;s<u;)t[s++]=t[c++]}return s}i.d(t,{t:function(){return n}}),!Math.imul&&(Math.imul=function(e,t){let i=e>>>16,n=65535&e,r=t>>>16,o=65535&t;return n*o+(i*o+n*r<<16)|0})},111267:function(e,t,i){"use strict";function n(e,t){return e.gt(t)?e:t}function r(e,t){return e.lt(t)?e:t}function o(e,t,i){var o,s;let a=r(t.readIndex,null!==(o=t.readOrder)&&void 0!==o?o:t.readIndex),l=n(i.readIndex,null!==(s=i.readOrder)&&void 0!==s?s:i.readIndex);return e.getMessageList().filter(e=>e.indexInConversation.gte(a)&&e.indexInConversation.lte(l))}function s(e,t){let i=[],n=l(e.minIndex,t.minIndex),r=l(e.readIndex,t.readIndex);return void 0!==n&&i.push(n),void 0!==r&&i.push(r),i}function a(e){let t=[];for(let i of(e.sort((e,t)=>e.minIndex.sub(t.minIndex).toNumber()),e)){let e=0!==t.length?t[t.length-1]:void 0;0===t.length||(null==e?void 0:e.readIndex.lt(i.minIndex))?t.push(i):e.readIndex=n(e.readIndex,i.readIndex)}return t}function l(e,t){if(e.neq(t)){let i=r(e,t);return{minIndex:i,readIndex:n(e,t)}}}i.d(t,{BR:function(){return s},NK:function(){return o},d1:function(){return a}})},91113:function(e,t,i){"use strict";i.d(t,{k:function(){return a}});let n=[];for(let e=0;e<256;++e)n[e]=(e+256).toString(16).substr(1);function r(e){let t=0,i=n;return[i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],"-",i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]],i[e[t++]]].join("")}let o=Array(16);function s(){for(let e=0,t=0;e<16;e++)(3&e)==0&&(t=4294967296*Math.random()),o[e]=t>>>((3&e)<<3)&255;return o}function a(){let e=s();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,r(o)}},902687:function(e,t,i){"use strict";i.d(t,{y:function(){return u}});var n,r=i(101380),o=i(358115),s=i(193533),a=i(621631),l=i(651889),d=i(835649);i(689845);var c=i(190638);!function(e){e[e.BlockUser=1]="BlockUser",e[e.BlockConvNormalOnly=2]="BlockConvNormalOnly",e[e.BlockConvAll=3]="BlockConvAll"}(n||(n={}));class u extends c.f{process(e){return(0,r.mG)(this,void 0,void 0,function*(){return e.data.type===a.m.MessageType.MESSAGE_TYPE_BLOCK_COMMAND&&(e.needContinue=!1,this.handleBlockCmd(e.data,e.conv)),e})}handleBlockCmd(e,t){let i=o.parse(e.content),r=i.block_status;if(i.type===n.BlockUser){let{userID:n}=i;if(null==n||0===n.length)return;let o=this.resolve(d.Uk.ParticipantManager).getMapRaw(t.id);if(!o)return;for(let a of n){let n=null==a?void 0:a.toString();if(!o.has(n))continue;let c=o.get(n);c.blocked=!!r;let u=i.blockTime[n];c.leftBlockTime=u?s.fromValue(u):void 0,this.resolve(d.Uk.ParticipantManager).upsert(t.id,c),this.resolve(d.Uk.EventBus).emit(l.c5.ParticipantBlock,this,{participant:c,message:e})}}else this.resolve(d.Uk.ConversationManager).refreshAsync(t).then(t=>{t.map(t=>this.resolve(d.Uk.EventBus).emit(l.c5.ConversationBlock,this,{conversation:t,message:e}))})}}},156356:function(e,t,i){"use strict";i.d(t,{m:function(){return c}});var n=i(101380);i(193533);var r=i(621631),o=i(651889),s=i(835649),a=i(358115);i(689845);var l=i(190638),d=i(492173);class c extends l.f{process(e){return(0,n.mG)(this,void 0,void 0,function*(){return e.data.type===r.m.MessageType.MESSAGE_TYPE_NOTIFY_USER_CUSTOM_CONVERSATION_TAG_UPDATE_COMMAND&&(e.needContinue=!1,this.handle(e)),e})}handle(e){var t,i;let n=a.parse(e.data.content);this.resolve(s.Uk.EventBus).emit(o.c5.TagListUpdate,this,null!==(i=null===(t=n.user_custom_tag)||void 0===t?void 0:t.map(e=>d.j.fromServerTag(e)))&&void 0!==i?i:[])}}},751448:function(e,t,i){"use strict";i.d(t,{N:function(){return d}});var n=i(101380);i(193533);var r=i(621631),o=i(651889),s=i(592242),a=i(835649);i(358115),i(689845);var l=i(190638);class d extends l.f{process(e){return(0,n.mG)(this,void 0,void 0,function*(){return e.data.type===r.m.MessageType.MESSAGE_TYPE_UPDATE_MESSAGE_PROPERTY&&(e.needContinue=!1,yield this.handlePropertyCmd(e.data)),e})}handlePropertyCmd(e){return(0,n.mG)(this,void 0,void 0,function*(){let t=this.resolve(a.Uk.MessageManager).getRaw(e.conversationId,e.clientId);t?(t.version=e.version,s.Y.ctxDebug(this.ctx,"merge property, local:",t.property,"server:",e.property),t.property=e.property,this.resolve(a.Uk.MessageManager).upsert(t),this.resolve(a.Uk.EventBus).emit(o.c5.MessagePropertyUpsert,this,t)):s.Y.ctxDebug(this.ctx,"modify property cmd msg not exist in local",e)})}}},223818:function(e,t,i){"use strict";i.d(t,{Q:function(){return v}});var n=i(101380),r=i(193533),o=i(621631),s=i(651889),a=i(592242),l=i(557418),d=i(835649),c=i(832141);i(358115),i(689845);var u=i(46874);class v extends d.mA{constructor(e){super(e),this.messages=new Map,this.conversation=new Map}upsertOnline(e){return(0,n.mG)(this,void 0,void 0,function*(){let t=(yield this.resolve(d.Uk.ExtensionApi).GetConversationCoreInfo({conversationId:e.id,conversationShortId:r.fromString(e.shortId),conversationType:e.type,inboxType:e.inboxType})).get_conversation_core_info_body;if(!t||!t.conversation_core_info)throw new l.G({ctx:this.ctx,type:s.NI.ConversationNotExist,msg:`local conversation: ${e.id} not found online`,sender:this,args:{conversationId:e.id}});let i=u.$.fromServerConversation(this.ctx,t.conversation_core_info);return this.conversation.set(e.id,i),i})}getWithOnline(e,t,i){return(0,n.mG)(this,void 0,void 0,function*(){let n=this.conversation.get(e);if(!n||n.isOffline){if(!t||!i)throw new l.G({ctx:this.ctx,type:s.NI.InvalidParam,msg:"no shortId and type provided",sender:this});!n&&((n=new u.$(this.ctx)).id=e,n.shortId=t,n.type=o.m.ConversationType.BROADCAST_CHAT,n.isOffline=!0,n.coreInfo=new c._(n)),n=yield this.upsertOnline(n)}return n})}upsert(e){let t;let i=this.getConversationMsgs(e.conversationId),n=i.msgs.findIndex(t=>t&&t.clientId===e.clientId);n>=0&&(t=i.msgs[n]),t?(t.type===e.type?e=t.merge(e):a.Y.ctxWarn(this.ctx,"try to merge different msg:",t,e),i.msgs[n]=e):this.insertMsg(i,e),this.resolve(d.Uk.EventBus).emit(s.c5.MessageUpsert,this,e)}getList(e){let t=this.getConversationMsgs(e),i=t.tail;if(t.front<i)return t.msgs.slice(t.front,i);let n=t.msgs.slice(0,i);return t.msgs.slice(t.front,v.MaxMsgSize).concat(n)}insertMsg(e,t){let i=e.tail;e.tail=(e.tail+1)%v.MaxMsgSize,e.tail===e.front&&(e.front=(e.front+1)%v.MaxMsgSize),e.msgs[i]=t}get(e,t){let i=this.getRaw(e,t);if(!i)throw new l.G({ctx:this.ctx,type:s.NI.MessageNotExist,msg:`message ${t} @ ${e} not exist in local`,sender:this});return i}getConversation(e){let t=this.conversation.get(e);if(!t)throw new l.G({ctx:this.ctx,msg:`broadcast conversation ${e} not exist in local`,type:s.NI.ConversationNotExist,sender:this,args:{conversationId:e}});return t}getRaw(e,t){let i;let n=this.getConversationMsgs(e),r=n.msgs.findIndex(e=>e&&e.clientId===t);return r>=0&&(i=n.msgs[r]),i}getByServerId(e,t){let i=this.getConversationMsgs(e),n=i.msgs.findIndex(e=>e&&e.serverId===t);if(n<0)throw new l.G({ctx:this.ctx,type:s.NI.MessageNotExist,msg:`message ${t} @ ${e} not exist in local`,sender:this});return i.msgs[n]}getConversationMsgs(e){let t=this.messages.get(e);return!t&&(t={msgs:Array(v.MaxMsgSize),front:0,tail:0},this.messages.set(e,t)),t}processNewMessagesFromPull(e,t,i){return(0,n.mG)(this,void 0,void 0,function*(){for(let i of e)!i.ext&&(i.ext={}),yield this.processNewMessage(i,t)})}processNewMessage(e,t){return(0,n.mG)(this,void 0,void 0,function*(){if(!e.ext&&(e.ext={}),e.source=t,e.type>=0)return this.processTextMessage(e);throw new l.G({ctx:this.ctx,type:s.NI.UnknownMessageType,msg:`unknown message type: ${e.type} for msg:${e.clientId}`,sender:this})})}dispose(){this.conversation.clear(),this.messages.clear()}processTextMessage(e){return(0,n.mG)(this,void 0,void 0,function*(){if(!e.isNormalMsg)return e;let t=void 0!==e.source&&(e.source===s.v$.Online||e.source===s.v$.BroadcastLoadMore),i=this.getRaw(e.conversationId,e.clientId),n=(null==i?void 0:i.flightStatus)!==void 0&&t;this.upsert(e);let r=this.getRaw(e.conversationId,e.clientId);return i?n&&r.flightStatus!==s.b3.Received&&(r.flightStatus=s.b3.Received,this.resolve(d.Uk.EventBus).emit(s.c5.ReceiveBroadcastSelfMessage,this,r),this.upsert(r)):t&&(e.sender!==this.ctx.option.userId?this.resolve(d.Uk.EventBus).emit(s.c5.ReceiveBroadcastNewMessage,this,e):this.resolve(d.Uk.EventBus).emit(s.c5.ReceiveBroadcastSelfMessage,this,e)),e})}}v.MaxMsgSize=1001},650317:function(e,t,i){"use strict";i.d(t,{n:function(){return s}});var n=i(84105),r=i(835649),o=i(642337);class s extends n.v{constructor(){super(...arguments),this.name="AwemeHybridLinkPlugin"}install(){this.hybridLinkInstance=new o.j(this.ctx),this.register(r.Uk.HybridLink,this.hybridLinkInstance)}}},379831:function(e,t,i){"use strict";i.d(t,{T:function(){return h}});var n=i(101380),r=i(470332),o=i(193533),s=i(592242),a=i(557418),l=i(651889),d=i(792243),c=i(473614),u=i(621631),v=i(835649);class h extends r.v{constructor(){super(...arguments),this.innerCursor=[]}get coreApi(){return this.resolve(v.Uk.CoreApi)}get inboxType(){return this.resolve(v.Uk.InboxType)}get instance(){return this.resolve(v.Uk.CoreInstance)}getUserCursor(e){var t;return null!==(t=this.innerCursor[null!=e?e:this.inboxType.getDefaultInbox()])&&void 0!==t?t:o.ZERO}setUserCursor(e,t){var i;return(0,n.mG)(this,void 0,void 0,function*(){let n=null!=t?t:this.inboxType.getDefaultInbox(),r=this.innerCursor[n];if(!!(!r||r.lt(e)))s.Y.ctxDebug(this.ctx,`update cursor for inbox:${n} from ${null==r?void 0:r.toString()} to ${e.toString()}`),this.innerCursor[n]=e,yield null===(i=this.resolve(v.Uk.DbProxy))||void 0===i?void 0:i.saveUserCursor(n,e)})}getMessagesByUserInit(e={}){var t,i,r,d,c,u,h,f,g,p;return(0,n.mG)(this,void 0,void 0,function*(){let n,m,y,x,I;let _=null!==(t=e.inboxType)&&void 0!==t?t:this.inboxType.getDefaultInbox(),b=null!==(i=e.cursor)&&void 0!==i?i:o.ZERO,k=e.page;if(!this.inboxType.isValidInbox(_))throw new a.G({ctx:this.ctx,msg:"invalid inbox",type:l.NI.InvalidInboxType,sender:this});let C=o.ZERO,S=o.ZERO;if(e.mode===l.k5.AwemeMode){let t=yield this.coreApi.GetMessagesByInit({inboxType:_,convLimit:e.convLimit,msgLimit:e.msgLimit,page:k,version:e.version}),i=null===(r=t.body)||void 0===r?void 0:r.message_by_init;n=null===(d=i.messages)||void 0===d?void 0:d.map(e=>e.conversations),m=[],null===(c=i.messages)||void 0===c||c.forEach(e=>e.messages&&(null==m?void 0:m.push(...e.messages))),y=null==i?void 0:i.user_cursor,x=i.has_more,S=i.next_init_version,I=t.log_id}else{let t=yield this.coreApi.GetMessagesByUserInitV2({cursor:o.fromValue(b),inboxType:_,initSubType:e.initSubType,convLimit:e.convLimit,msgLimit:e.msgLimit,tagIds:null===(u=e.tagIds)||void 0===u?void 0:u.map(e=>o.fromValue(e)),userCustomTagIds:null===(h=e.userCustomTagIds)||void 0===h?void 0:h.map(e=>o.fromValue(e))}),i=null===(f=t.body)||void 0===f?void 0:f.messages_per_user_init_v2_body;n=i.conversations,m=i.messages,y=null==i?void 0:i.per_user_cursor,x=i.has_more,C=i.next_cursor,I=t.log_id}return this.instance.processInitConversation(n,I),yield this.instance.processInitMessage(m,I),this.getUserCursor(_).neq(o.ZERO)&&(null==y?void 0:y.neq(o.ZERO))&&(null===(g=this.getUserCursor(_))||void 0===g?void 0:g.neq(y))&&(s.Y.ctxWarn(this.ctx,`cursor not match: before:${null===(p=this.getUserCursor(_))||void 0===p?void 0:p.toString()}, after:${null==y?void 0:y.toString()}, pull user, logid:${I}`),yield this.getMessagesByUser({inboxType:_})),y&&(yield this.setUserCursor(y,_)),this.resolve(v.Uk.EventBus).emitEmpty(l.c5.InitLoadPage,this),{hasMore:x,cursor:C,page:(null!=k?k:0)+1,version:S}})}getMessagesByUser(e={}){var t,i,r,d,c;return(0,n.mG)(this,void 0,void 0,function*(){if(e.cursor instanceof Date&&(e.cursor=`${e.cursor.getTime()}000`),void 0===e.inboxType&&(e.inboxType=this.inboxType.getDefaultInbox()),!this.inboxType.isValidInbox(e.inboxType))throw new a.G({ctx:this.ctx,msg:"invalid inbox",type:l.NI.InvalidInboxType,sender:this});if(!0===this.ctx.option.disableInitPull&&0===this.instance.getConversationList().length&&this.getUserCursor(e.inboxType).eq(o.ZERO)&&void 0===e.cursor){s.Y.ctxWarn(this.ctx,"try to pull history from 0, preventing");return}let n=!0,u=void 0!==e.cursor?o.fromValue(e.cursor):this.getUserCursor(e.inboxType);for(;n;){let o=yield this.coreApi.GetMessagesByUser({cursor:u,limit:null!==(t=e.limit)&&void 0!==t?t:50,inboxType:e.inboxType}),a=null===(i=o.body)||void 0===i?void 0:i.messages_per_user_body;n=a.has_more,u=a.next_cursor;let h=new Map;null===(r=a.hasmore_message_conv_list)||void 0===r||r.forEach(e=>{let t=e.toString(),i=this.resolve(v.Uk.ConversationManager).getWithShortIdRaw(t);h.set(t,null==i?void 0:i.lastMessageIndex)});let{conMap:f}=yield this.resolve(v.Uk.MessageManager).processNewMessagesFromPull(a.messages,l.v$.UserInbox,o.log_id);null===(d=a.hasmore_message_conv_list)||void 0===d||d.forEach(e=>{let t=e.toString(),i=f.get(t);if(i){let e=this.resolve(v.Uk.ConversationManager).getRaw(i.conversationId);this.patchMessage({cursor:i,conversation:e,limitindex:h.get(t)})}else s.Y.ctxWarn(this.ctx,`not found message of conversation in hasmore_message_conv_list, conversationid:${t}, logid:${o.log_id}`)}),null===(c=a.conversation_badge_count)||void 0===c||c.map(e=>{let t=this.resolve(v.Uk.ConversationManager).getRaw(e.conversation_id.toString());t&&this.instance.handleBadgeCount(e,t)}),this.instance.initResult===l.rb.Start&&this.resolve(v.Uk.EventBus).emitEmpty(l.c5.InitLoadPage,this)}yield this.setUserCursor(u,e.inboxType),this.resolve(v.Uk.ConversationManager).refreshLocal()})}prepareHistoryForInbox({inboxType:e,convLimit:t,msgLimit:i,mode:r,convTotal:a,tagIds:d,userCustomTagIds:c}){var u,h,f;return(0,n.mG)(this,void 0,void 0,function*(){try{let n=yield null===(u=this.resolve(v.Uk.DbProxy))||void 0===u?void 0:u.loadUserCursor(e);if(void 0!==n)return s.Y.ctxDebug(this.ctx,`load history for inbox ${e} by db`),yield this.setUserCursor(n,e),yield this.getMessagesByUser({inboxType:e,cursor:n}),!0;if(this.ctx.option.disableInitPull){let n;if(s.Y.ctxDebug(this.ctx,`load history for inbox ${e} by disable init`),r===l.k5.AwemeMode){let r=yield this.coreApi.GetMessagesByInit({inboxType:e,convLimit:t,msgLimit:i});n=(null===(h=r.body)||void 0===h?void 0:h.message_by_init).user_cursor}else{let r=yield this.coreApi.GetMessagesByUserInitV2({inboxType:e,convLimit:t,msgLimit:i,cursor:o.ZERO});n=(null===(f=r.body)||void 0===f?void 0:f.messages_per_user_init_v2_body).per_user_cursor}return yield this.setUserCursor(n,e),!0}s.Y.ctxDebug(this.ctx,`load history for inbox ${e} by full init`);let g={hasMore:!0,cursor:o.ZERO,page:0,version:void 0};for(;g.hasMore&&(g=yield this.getMessagesByUserInit(Object.assign({inboxType:e,initSubType:this.ctx.option.initSubType,convLimit:t,msgLimit:i,mode:r,tagIds:d,userCustomTagIds:c},g)),!a||!(this.resolve(v.Uk.ConversationManager).getConversationArray().length>=a)););return!0}catch(t){return s.Y.ctxError(this.ctx,`load history failed for inbox:${e}`,t),!1}})}patchMessage(e){var t,i;return(0,n.mG)(this,void 0,void 0,function*(){let{cursor:n}=e,r=20;if(!e.limitindex)return;n instanceof d.v&&(n=n.indexInConversation),void 0===n&&(n=e.conversation.firstMessageIndex);let s=yield this.coreApi.GetMessagesByConversation({conversationId:e.conversation.id,conversationShortId:o.fromString(e.conversation.shortId),conversationType:e.conversation.type,anchorIndex:o.fromValue(n),direction:u.m.MessageDirection.OLDER,limit:null!==(t=e.limit)&&void 0!==t?t:r,inboxType:e.conversation.inboxType});this.resolve(v.Uk.Monitor).emitMetrics(c.U.GetMessagesByConversation,{count:1},{log_id:s.log_id,from:"patch",conversationId:e.conversation.shortId,cursor:o.fromValue(n).toString()});let a=null===(i=s.body)||void 0===i?void 0:i.messages_in_conversation_body,{conMap:h}=yield this.resolve(v.Uk.MessageManager).processNewMessagesFromPull(a.messages,l.v$.UserInbox,s.log_id),f=h.get(e.conversation.shortId);if(!(null==a?void 0:a.has_more)||!f||e.limitindex.gt((null==f?void 0:f.indexInConversation)||o.ZERO)){e.conversation.forceRefreshUnreadCount();return}this.patchMessage({conversation:e.conversation,limit:e.limit||r,cursor:null==a?void 0:a.next_cursor,limitindex:e.limitindex})})}receivePacket(e){var t,i,r,a,l,d,c;return(0,n.mG)(this,void 0,void 0,function*(){let n=e,u=!1,v=this.getUserCursor(n.inbox_type),h=null===(t=n.body)||void 0===t?void 0:t.has_new_message_notify;h?v.lt(null!==(i=h.previous_cursor)&&void 0!==i?i:o.ZERO)||(null===(r=h.previous_cursor)||void 0===r?void 0:r.eq(o.ZERO))?(u=!0,s.Y.ctxWarn(this.ctx,`push cursour is greater than local cursor, push:${null!==(a=h.previous_cursor)&&void 0!==a?a:o.ZERO}, local:${v.toString()}, msgid:${null===(l=h.message)||void 0===l?void 0:l.server_message_id}, logid:${n.log_id}`)):(null===(d=h.previous_cursor)||void 0===d?void 0:d.eq(v))?yield this.instance.processPushMessage(h,n):(u=!0,s.Y.ctxWarn(this.ctx,`push cursour is less than local cursor, push:${h.previous_cursor}, local:${v}, msgid:${null===(c=h.message)||void 0===c?void 0:c.server_message_id}, logid:${n.log_id}`)):(u=!0,s.Y.ctxWarn(this.ctx,`push body is missing, logid:${n.log_id}`)),u&&(yield this.getMessagesByUser({inboxType:n.inbox_type,cursor:v}))})}getReportParams(e){return Object.assign({hybrid_type:"imcloud"},void 0!==e?{cursor:this.getUserCursor(e).toString()}:{})}}},855537:function(e,t,i){"use strict";i.d(t,{Dp:function(){return s},Cu:function(){return l},af:function(){return o}}),i("193533");var n=i("473614");i("358115"),i("689845");class r{constructor(e=[],t){this.metricsToReport=[],this.sampleRate={},this.call=e=>{if(!this.metricsToReport.includes(e))return!1;let t=this.sampleRate[e],i=this.sampleRate[r.globalSampleRate],n=Math.random();return void 0!==t?n<t:void 0===i||n<i},this.metricsToReport=e,t&&(this.sampleRate=t)}}function o(e){return(e.startsWith("imsdk")?e:`imsdk_${e}`).replace(/\./g,"_")}r.globalSampleRate="__globalSampleRate";let s=[n.U.CreateConversation,n.U.SendMessage,n.U.ReceiveMessage,n.U.WsConnect,n.U.NetworkRequest].map(e=>o(e)),a={[o(n.U.NetworkRequest)]:.05,[r.globalSampleRate]:1};class l{constructor(e,t){var i,n;this.sampleCallback=()=>!0,this.collector=e,(null==t?void 0:t.sampleCallback)?this.sampleCallback=t.sampleCallback:this.sampleCallback=new r(null!==(i=null==t?void 0:t.metricsToReport)&&void 0!==i?i:s,null!==(n=null==t?void 0:t.sampleRate)&&void 0!==n?n:a).call}emitCounter(e,t,i){}emitDuration(e,t,i){}emitError(e){}emitNetwork(e,t,i){}emitEvent(e,t,i){}emitLog(e,t){}emitTracker(e,t){}emitMetrics(e,t,i){var n;let r=o(e);if(!!(null===(n=this.sampleCallback)||void 0===n?void 0:n.call(this,r)))this.collector.event(r,Object.assign(Object.assign({},t),i))}}l.globalSampleRate=r.globalSampleRate},52185:function(e,t,i){"use strict";i.d(t,{S:function(){return a}});var n=i(101380),r=i(193533),o=i(621631),s=i(435588);i(358115),i(689845);class a extends s.W{GetMessagesCheckInfoInConversation(e){return(0,n.mG)(this,void 0,void 0,function*(){let t=o.m.RequestBody.create({get_messages_checkinfo_in_conversation_body:{conversation_id:e.conversationId,conversation_short_id:r.fromValue(e.conversationShortId),conversation_type:e.conversationType,cursor_reverse_begin:e.cursorReverseBegin?r.fromValue(e.cursorReverseBegin):null,cursor_reverse_end:e.cursorReverseEnd?r.fromValue(e.cursorReverseEnd):null,expect_msg_total_count:e.expectedTotalMessageCount}});return(yield this.send(t,o.m.IMCMD.GET_MESSAGES_CHECKINFO_IN_CONVERSATION,{inboxType:e.inboxType})).get_messages_checkinfo_in_conversation_body})}GetConversationsCheckInfo(e){return(0,n.mG)(this,void 0,void 0,function*(){let t=o.m.RequestBody.create({});return(yield this.send(t,o.m.IMCMD.GET_CONVERSATIONS_CHECKINFO,{inboxType:e.inboxType})).get_conversations_checkinfo_body})}}},36472:function(e,t,i){"use strict";i.d(t,{J:function(){return d}});var n=i(193533),r=i(621631),o=i(597552);i(689845);var s=i(832141),a=i(746705),l=i(986293);class d{static toStore(e){var t,i,n,r,o,s,a,l,c,u,v,h;let f=new d;return f.coreInfo={conversationId:e.coreInfo.conversationId,version:null===(t=e.coreInfo.version)||void 0===t?void 0:t.toString(),name:e.coreInfo.name,desc:e.coreInfo.desc,icon:e.coreInfo.icon,notice:e.coreInfo.notice,owner:e.coreInfo.owner,secOwner:e.coreInfo.secOwner,innerExt:e.coreInfo.ext,inboxType:e.coreInfo.inboxType},f.firstPageParticipant={cursor:null===(n=null===(i=e.firstPageParticipant)||void 0===i?void 0:i.cursor)||void 0===n?void 0:n.toString(),hasMore:null===(r=e.firstPageParticipant)||void 0===r?void 0:r.has_more,participants:null===(s=null===(o=e.firstPageParticipant)||void 0===o?void 0:o.participants)||void 0===s?void 0:s.map(e=>{var t,i,n;return{userId:null===(t=e.user_id)||void 0===t?void 0:t.toString(),secUid:e.sec_uid,sortOrder:null===(i=e.sort_order)||void 0===i?void 0:i.toString(),role:e.role,alias:e.alias,blocked:e.blocked,leftBlockTime:null===(n=e.left_block_time)||void 0===n?void 0:n.toString()}})},f.id=e.id,f.isMember=e.isMember,f.mode=e.mode,f.isOffline=e.isOffline,f.participantCount=e.participantCount,f.settingInfo={conversationId:e.settingInfo.conversationId,version:null===(a=e.settingInfo.version)||void 0===a?void 0:a.toString(),stickTop:e.settingInfo.stickTop,mute:e.settingInfo.mute,favor:e.settingInfo.favor,innerExt:e.settingInfo.ext,minIndex:null===(l=e.settingInfo.minIndex)||void 0===l?void 0:l.toString(),readIndex:null===(c=e.settingInfo.readIndex)||void 0===c?void 0:c.toString(),readIndexV2:null===(u=e.settingInfo.readIndexV2)||void 0===u?void 0:u.toString(),setTopTime:null===(v=e.settingInfo.setTopTime)||void 0===v?void 0:v.toString(),setFavoriteTime:null===(h=e.settingInfo.setFavoriteTime)||void 0===h?void 0:h.toString(),pushStatus:e.settingInfo.pushStatus,readBadgeCount:e.settingInfo.readBadgeCount,muteReadBadgeCountInfos:e.settingInfo.muteReadBadgeCountInfos},f.shortId=e.shortId,f.ticket=e.ticket,f.type=e.bizType,f.badgeCount=e.badgeCount,f.muteBadgeCountInfos=e.muteBadgeCountInfos,f}static fromStore(e,t){var i,d,c,u,v,h,f,g,p,m,y,x,I;let _=t.mode?new l.C(e):new o.r(e),b=new s._(_);b.version=n.fromValue(null!==(d=null===(i=t.coreInfo)||void 0===i?void 0:i.version)&&void 0!==d?d:0),b.name=t.coreInfo.name,b.desc=t.coreInfo.desc,b.icon=t.coreInfo.icon,b.notice=t.coreInfo.notice,b.owner=t.coreInfo.owner,b.secOwner=t.coreInfo.secOwner,b.ext=t.coreInfo.innerExt,b.inboxType=t.coreInfo.inboxType;let k=new a.H(_);return k.version=n.fromValue(null!==(u=null===(c=t.settingInfo)||void 0===c?void 0:c.version)&&void 0!==u?u:0),k.stickTop=t.settingInfo.stickTop,k.mute=t.settingInfo.mute,k.favor=t.settingInfo.favor,k.ext=t.settingInfo.innerExt,k.readIndex=n.fromValue(null!==(v=t.settingInfo.readIndex)&&void 0!==v?v:0),k.readIndexV2=n.fromValue(null!==(h=t.settingInfo.readIndexV2)&&void 0!==h?h:0),k.minIndex=n.fromValue(null!==(f=t.settingInfo.minIndex)&&void 0!==f?f:0),k.setTopTime=n.fromValue(null!==(g=t.settingInfo.setTopTime)&&void 0!==g?g:0),k.setFavoriteTime=n.fromValue(null!==(p=t.settingInfo.setFavoriteTime)&&void 0!==p?p:0),k.pushStatus=t.settingInfo.pushStatus,_.badgeCount=t.badgeCount,_.muteBadgeCountInfos=t.muteBadgeCountInfos,k.readBadgeCount=t.settingInfo.readBadgeCount,k.muteReadBadgeCountInfos=t.settingInfo.muteReadBadgeCountInfos,_.coreInfo=b,_.settingInfo=k,_.firstPageParticipant=r.m.ParticipantsPage.create({cursor:(null===(m=t.firstPageParticipant)||void 0===m?void 0:m.cursor)?n.fromValue(t.firstPageParticipant.cursor):void 0,has_more:null===(y=t.firstPageParticipant)||void 0===y?void 0:y.hasMore,participants:null===(I=null===(x=t.firstPageParticipant)||void 0===x?void 0:x.participants)||void 0===I?void 0:I.map(e=>({user_id:e.userId?n.fromValue(e.userId):void 0,sec_uid:e.secUid,sort_order:e.sortOrder?n.fromValue(e.sortOrder):void 0,role:e.role,alias:e.alias,blocked:e.blocked,left_block_time:e.leftBlockTime?n.fromValue(e.leftBlockTime):void 0}))}),_.id=t.id,_.isMember=t.isMember,_.isOffline=t.isOffline,_.participantCount=t.participantCount,_.shortId=t.shortId,_.ticket=t.ticket,_.bizType=t.type,_}}},716983:function(e,t,i){"use strict";i.d(t,{h:function(){return o}});var n=i(193533);i(358115),i(689845);var r=i(419707);class o{static formatParticipantKey(e){return`${e.conversationId}:${e.userId}`}static toStore(e){var t,i;let n=new o;return n.userId=e.userId,n.secUid=e.secUid,n.sortOrder=null===(t=e.sortOrder)||void 0===t?void 0:t.toString(),n.role=e.role,n.alias=e.alias,n.conversationId=e.conversationId,n.conversationType=e.conversationType,n.blocked=e.blocked,n.leftBlockTime=null===(i=e.leftBlockTime)||void 0===i?void 0:i.toString(),n.readIndex=e.readIndex.toString(),n.readOrder=e.readOrder.toString(),n.minIndex=e.minIndex.toString(),n}static fromStore(e,t){var i,o,s;let a=new r.Q(e);return a.userId=t.userId,a.secUid=t.secUid,a.sortOrder=t.sortOrder?n.fromValue(t.sortOrder):void 0,a.role=t.role,a.alias=t.alias,a.conversationId=t.conversationId,a.conversationType=t.conversationType,a.blocked=t.blocked,a.leftBlockTime=t.leftBlockTime?n.fromValue(t.leftBlockTime):void 0,a.readIndex=n.fromValue(null!==(i=t.readIndex)&&void 0!==i?i:0),a.readOrder=n.fromValue(null!==(o=t.readOrder)&&void 0!==o?o:0),a.minIndex=n.fromValue(null!==(s=t.minIndex)&&void 0!==s?s:0),a}}},445534:function(e,t,i){"use strict";i.d(t,{l:function(){return p}});var n=i(101380),r=i(193533),o=i(621631),s=i(651889),a=i(592242),l=i(835649),d=i(832141),c=i(746705),u=i(792243);i(689845);var v=i(84105),h=i(379407),f=i(986293),g=i(590381);class p extends v.v{constructor(){super(...arguments),this.name="StrangerPlugin",this.internalUnreadCount=0}getStrangerConversationList(e={}){var t,i,s,a,v,h,g;return(0,n.mG)(this,void 0,void 0,function*(){let n=yield this.api.GetStrangerConversationList({cursor:e.cursor?r.fromValue(e.cursor):r.ZERO,limit:null!==(t=e.limit)&&void 0!==t?t:10}),p=null===(i=n.body)||void 0===i?void 0:i.get_stranger_conversation_body,m=p.conversation_list;this.internalUnreadCount=p.total_unread;let y=!1;if((null===(s=e.cursor)||void 0===s?void 0:s.toString())==="0"&&1===e.limit){let e=yield this.getStrangerPreview({sync:!1});m&&1===m.length&&(null===(a=null==e?void 0:e.conversation)||void 0===a?void 0:a.id)===m[0].conversation_id&&(null===(v=null==e?void 0:e.message)||void 0===v?void 0:v.serverId)===(null===(g=null===(h=m[0].last_message)||void 0===h?void 0:h.server_message_id)||void 0===g?void 0:g.toString())&&(null==e?void 0:e.unreadCount)===(null==p?void 0:p.total_unread)&&(y=!0)}return{conversation:m.map(e=>{var t;let i=new f.C(this.ctx);if(i.coreInfo=new d._(i),i.settingInfo=new c.H(i),i.id=e.conversation_id,i.shortId=e.conversation_short_id.toString(),i.type=o.m.ConversationType.ONE_TO_ONE_CHAT,i.unreadCount=e.unread,i.isOffline=!1,i.firstPageParticipant=o.m.ParticipantsPage.create({participants:e.participants}),i.ext=null!==(t=e.ext)&&void 0!==t?t:{},!y){this.resolve(l.Uk.ConversationManager).upsert(i);let t=u.v.fromServerMessage(this.ctx,e.last_message,n.log_id);this.resolve(l.Uk.MessageManager).upsert(t)}return i}),unreadCount:null==p?void 0:p.total_unread,hasMore:null==p?void 0:p.has_more,cursor:null==p?void 0:p.next_cursor}})}getStrangerConversationMessage(e){var t,i;return(0,n.mG)(this,void 0,void 0,function*(){let n=yield this.api.GetStrangerConversationMessage({shortId:r.fromString(e.conversation.shortId),resetUnreadCount:null!==(t=e.resetUnreadCount)&&void 0!==t&&t});return(null===(i=n.body)||void 0===i?void 0:i.get_stranger_messages_body).messages.forEach(e=>this.resolve(l.Uk.MessageManager).upsert(u.v.fromServerMessage(this.ctx,e,n.log_id))),this.resolve(l.Uk.MessageManager).getList(e.conversation.id)})}deleteStrangerConversation(e){return(0,n.mG)(this,void 0,void 0,function*(){yield this.api.DeleteStrangerConversation({shortId:r.fromString(e.conversation.shortId)}),this.resolve(l.Uk.ConversationManager).delete(e.conversation.id)})}deleteAllStrangerConversation(){return(0,n.mG)(this,void 0,void 0,function*(){yield this.api.DeleteAllStrangerConversation(),this.resolve(l.Uk.ConversationManager).getConversationArray(e=>0!==e.mode).forEach(e=>this.resolve(l.Uk.ConversationManager).delete(e.id)),this.internalUnreadCount=0})}markStrangerConversationRead(e){return(0,n.mG)(this,void 0,void 0,function*(){yield this.api.MarkStrangerConversationRead({shortId:r.fromString(e.conversation.shortId)}),this.internalUnreadCount-=e.conversation.unreadCount,e.conversation.unreadCount=0,this.resolve(l.Uk.ConversationManager).upsert(e.conversation)})}markAllStrangerConversationRead(){return(0,n.mG)(this,void 0,void 0,function*(){yield this.api.MarkAllStrangerConversationRead(),this.resolve(l.Uk.ConversationManager).getConversationArray(e=>0!==e.mode).forEach(e=>{e.unreadCount=0,this.resolve(l.Uk.ConversationManager).upsert(e)}),this.internalUnreadCount=0})}getStrangerPreview(e={}){var t;return(0,n.mG)(this,void 0,void 0,function*(){let i=yield this.refreshStrangerPreviewConversation(null!==(t=null==e?void 0:e.sync)&&void 0!==t&&t);return i?{conversation:i,message:i.lastVisibleMessage,unreadCount:this.internalUnreadCount}:null})}install(){this.api=this.register(l.Uk.StrangerApi,h.N),this.register(l.Uk.StrangerPlugin,this),this.instance.getStrangerConversationList=this.extendFunc(this.getStrangerConversationList),this.instance.getStrangerConversationMessage=this.extendFunc(this.getStrangerConversationMessage),this.instance.deleteStrangerConversation=this.extendFunc(this.deleteStrangerConversation),this.instance.deleteAllStrangerConversation=this.extendFunc(this.deleteAllStrangerConversation),this.instance.markStrangerConversationRead=this.extendFunc(this.markStrangerConversationRead),this.instance.markAllStrangerConversationRead=this.extendFunc(this.markAllStrangerConversationRead),this.instance.getStrangerPreview=this.extendFunc(this.getStrangerPreview),this.resolve(l.Uk.MessageManager).injectProcessor(new g.s(this.ctx)),this.resolve(l.Uk.EventBus).subscribe(s.c5.StrangerUpgrade,e=>(0,n.mG)(this,void 0,void 0,function*(){yield this.resolve(l.Uk.CoreInstance).getMessagesByUser({inboxType:e.inboxType})}))}init(){return(0,n.mG)(this,void 0,void 0,function*(){try{yield this.getStrangerPreview({sync:!0})}catch(e){a.Y.ctxWarn(this.ctx,"stranger plugin init error:",e)}})}receivePacket(e){var t;return(0,n.mG)(this,void 0,void 0,function*(){if(e.cmd===o.m.IMCMD.STRANGER_NEW_MSG_NOTIFY){let i=null===(t=e.body)||void 0===t?void 0:t.has_new_message_notify.message;if(!this.resolve(l.Uk.ConversationManager).getRaw(i.conversation_id))return;let n=u.v.fromServerMessage(this.ctx,i,e.log_id);this.resolve(l.Uk.MessageManager).upsert(n),this.internalUnreadCount++,this.resolve(l.Uk.EventBus).emit(s.c5.ReceiveNewStrangerMessage,this,n)}})}ticker(){return(0,n.mG)(this,void 0,void 0,function*(){this.ctx.option.pullInterval&&(yield this.refreshStrangerPreviewConversation(!0))})}refreshStrangerPreviewConversation(e=!1){return(0,n.mG)(this,void 0,void 0,function*(){for(let t of(e&&(yield this.getStrangerConversationList({cursor:r.ZERO,limit:1})),this.resolve(l.Uk.ConversationManager).getConversationArray(e=>0!==e.mode)))if(t.lastVisibleMessage)return t;return null})}}},362012:function(e,t,i){"use strict";i.d(t,{G:function(){return n}});let n={version:"1.1.3",branch:"Detached: 8aa2dcb88b41538885168e4afbbd2b6bac8aefb2",commit:"8aa2dcb"}},176147:function(e,t,i){"use strict";i.d(t,{f:function(){return u}});var n=i(101380),r=i(193533),o=i(621631),s=i(84105),a=i(835649),l=i(592242),d=i(768438);let c=new Map([[o.m.IMCMD.SEND_MESSAGE,["send_message_body","content","conversation_id","conversation_short_id"]],[o.m.IMCMD.CREATE_CONVERSATION_V2,["create_conversation_v2_body","avatar_url","idempotent_id","name","participants"]],[o.m.IMCMD.ADD_CONVERSATION_PARTICIPANTS,["conversation_add_participants_body","conversation_id","conversation_short_id","participants"]]]);class u extends s.v{install(){this.isCertAuth&&this.register(a.Uk.SecurityProxy,new d.V(this.ctx))}sendPacket(e){return(0,n.mG)(this,void 0,void 0,function*(){if(this.isCertAuth){let{cert:t,tsSign:i}=this.ctx.option;e.sdk_cert=t||"",e.ts_sign=i||"";let n=Math.round(Date.now()/1e3);if(this.ctx.option.certAuthZeroTrustUsePubKey&&(e.iter_version="1",e.timestamp=r.fromValue(n)),c.has(e.cmd)){let t=c.get(e.cmd),i=t[0],o=[...t.slice(1),...this.ctx.option.certAuthZeroTrustUsePubKey?["timestamp"]:[]];o.sort();let s=[];o.forEach(t=>{var o,a;if("timestamp"===t)return s.push(`timestamp=${n}`);let l=null===(o=e.body)||void 0===o?void 0:o[i],d=null!==(a=null==l?void 0:l[t])&&void 0!==a?a:"",c=Array.isArray(d)?d.map(String).join(","):r.isLong(d)?String(d):d;s.push(`${t}=${c}`)});try{let{req_sign:t}=yield this.resolve(a.Uk.SecurityProxy).sign(s.join("&"));e.reuqest_sign=t}catch(e){l.Y.ctxWarn(this.ctx,"request sign fail",e)}}}return e})}get isCertAuth(){return this.ctx.option.authType&&[o.m.AuthType.CERT_AUTH,o.m.AuthType.PASSPORT_CERT_AUTH].includes(this.ctx.option.authType)}}},689845:function(module,__unused_webpack_exports,__webpack_require__){var process=__webpack_require__(928686);!function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_MD5_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=window:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_MD5_NO_COMMON_JS&&module.exports,AMD="function"==typeof define&&define.amd,ARRAY_BUFFER=!root.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[128,32768,8388608,-2147483648],SHIFT=[0,8,16,24],OUTPUT_TYPES=["hex","array","digest","buffer","arrayBuffer","base64"],BASE64_ENCODE_CHAR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),buffer8,blocks=[];if(ARRAY_BUFFER){var buffer=new ArrayBuffer(68);buffer8=new Uint8Array(buffer),blocks=new Uint32Array(buffer)}(root.JS_MD5_NO_NODE_JS||!Array.isArray)&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),ARRAY_BUFFER&&(root.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!ArrayBuffer.isView)&&(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e){return function(t){return new Md5(!0).update(t)[e]()}},createMethod=function(){var e=createOutputMethod("hex");NODE_JS&&(e=nodeWrap(e)),e.create=function(){return new Md5},e.update=function(t){return e.create().update(t)};for(var t=0;t<OUTPUT_TYPES.length;++t){var i=OUTPUT_TYPES[t];e[i]=createOutputMethod(i)}return e},nodeWrap=function(method){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),nodeMethod=function(e){if("string"==typeof e)return crypto.createHash("md5").update(e,"utf8").digest("hex");if(null==e)throw ERROR;e.constructor===ArrayBuffer&&(e=new Uint8Array(e));return Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash("md5").update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod};function Md5(e){if(e)blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks,this.buffer8=buffer8;else if(ARRAY_BUFFER){var t=new ArrayBuffer(68);this.buffer8=new Uint8Array(t),this.blocks=new Uint32Array(t)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Md5.prototype.update=function(e){if(!this.finalized){var t,i=typeof e;if("string"!==i){if("object"===i){if(null===e)throw ERROR;if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!Array.isArray(e)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(e)))throw ERROR}else throw ERROR;t=!0}for(var n,r,o=0,s=e.length,a=this.blocks,l=this.buffer8;o<s;){if(this.hashed&&(this.hashed=!1,a[0]=a[16],a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),t){if(ARRAY_BUFFER)for(r=this.start;o<s&&r<64;++o)l[r++]=e[o];else for(r=this.start;o<s&&r<64;++o)a[r>>2]|=e[o]<<SHIFT[3&r++]}else if(ARRAY_BUFFER)for(r=this.start;o<s&&r<64;++o)(n=e.charCodeAt(o))<128?l[r++]=n:(n<2048?l[r++]=192|n>>6:(n<55296||n>=57344?l[r++]=224|n>>12:(n=65536+((1023&n)<<10|1023&e.charCodeAt(++o)),l[r++]=240|n>>18,l[r++]=128|n>>12&63),l[r++]=128|n>>6&63),l[r++]=128|63&n);else for(r=this.start;o<s&&r<64;++o)(n=e.charCodeAt(o))<128?a[r>>2]|=n<<SHIFT[3&r++]:(n<2048?a[r>>2]|=(192|n>>6)<<SHIFT[3&r++]:(n<55296||n>=57344?a[r>>2]|=(224|n>>12)<<SHIFT[3&r++]:(n=65536+((1023&n)<<10|1023&e.charCodeAt(++o)),a[r>>2]|=(240|n>>18)<<SHIFT[3&r++],a[r>>2]|=(128|n>>12&63)<<SHIFT[3&r++]),a[r>>2]|=(128|n>>6&63)<<SHIFT[3&r++]),a[r>>2]|=(128|63&n)<<SHIFT[3&r++]);this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Md5.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[t>>2]|=EXTRA[3&t],t>=56&&(!this.hashed&&this.hash(),e[0]=e[16],e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.bytes<<3,e[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},Md5.prototype.hash=function(){var e,t,i,n,r,o,s=this.blocks;this.first?(i=((i=(-271733879^(n=((n=(-1732584194^2004318071&(e=((e=s[0]-680876937)<<7|e>>>25)-271733879<<0))+s[1]-117830708)<<12|n>>>20)+e<<0)&(-271733879^e))+s[2]-1126478375)<<17|i>>>15)+n<<0,t=((t=(e^i&(n^e))+s[3]-1316259209)<<22|t>>>10)+i<<0):(e=this.h0,t=this.h1,i=this.h2,e+=((n=this.h3)^t&(i^n))+s[0]-680876936,n+=(i^(e=(e<<7|e>>>25)+t<<0)&(t^i))+s[1]-389564586,i+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[2]+606105819,t+=(e^(i=(i<<17|i>>>15)+n<<0)&(n^e))+s[3]-1044525330,t=(t<<22|t>>>10)+i<<0),e+=(n^t&(i^n))+s[4]-176418897,n+=(i^(e=(e<<7|e>>>25)+t<<0)&(t^i))+s[5]+1200080426,i+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[6]-1473231341,t+=(e^(i=(i<<17|i>>>15)+n<<0)&(n^e))+s[7]-45705983,e+=(n^(t=(t<<22|t>>>10)+i<<0)&(i^n))+s[8]+1770035416,n+=(i^(e=(e<<7|e>>>25)+t<<0)&(t^i))+s[9]-1958414417,i+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[10]-42063,t+=(e^(i=(i<<17|i>>>15)+n<<0)&(n^e))+s[11]-1990404162,e+=(n^(t=(t<<22|t>>>10)+i<<0)&(i^n))+s[12]+1804603682,n+=(i^(e=(e<<7|e>>>25)+t<<0)&(t^i))+s[13]-40341101,i+=(t^(n=(n<<12|n>>>20)+e<<0)&(e^t))+s[14]-1502002290,t+=(e^(i=(i<<17|i>>>15)+n<<0)&(n^e))+s[15]+1236535329,t=(t<<22|t>>>10)+i<<0,e+=(i^n&(t^i))+s[1]-165796510,e=(e<<5|e>>>27)+t<<0,n+=(t^i&(e^t))+s[6]-1069501632,n=(n<<9|n>>>23)+e<<0,i+=(e^t&(n^e))+s[11]+643717713,i=(i<<14|i>>>18)+n<<0,t+=(n^e&(i^n))+s[0]-373897302,t=(t<<20|t>>>12)+i<<0,e+=(i^n&(t^i))+s[5]-701558691,e=(e<<5|e>>>27)+t<<0,n+=(t^i&(e^t))+s[10]+38016083,n=(n<<9|n>>>23)+e<<0,i+=(e^t&(n^e))+s[15]-660478335,i=(i<<14|i>>>18)+n<<0,t+=(n^e&(i^n))+s[4]-405537848,t=(t<<20|t>>>12)+i<<0,e+=(i^n&(t^i))+s[9]+568446438,e=(e<<5|e>>>27)+t<<0,n+=(t^i&(e^t))+s[14]-1019803690,n=(n<<9|n>>>23)+e<<0,i+=(e^t&(n^e))+s[3]-187363961,i=(i<<14|i>>>18)+n<<0,t+=(n^e&(i^n))+s[8]+1163531501,t=(t<<20|t>>>12)+i<<0,e+=(i^n&(t^i))+s[13]-1444681467,e=(e<<5|e>>>27)+t<<0,n+=(t^i&(e^t))+s[2]-51403784,n=(n<<9|n>>>23)+e<<0,i+=(e^t&(n^e))+s[7]+1735328473,i=(i<<14|i>>>18)+n<<0,t+=(n^e&(i^n))+s[12]-1926607734,e+=((r=(t=(t<<20|t>>>12)+i<<0)^i)^n)+s[5]-378558,n+=(r^(e=(e<<4|e>>>28)+t<<0))+s[8]-2022574463,i+=((o=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[11]+1839030562,t+=(o^(i=(i<<16|i>>>16)+n<<0))+s[14]-35309556,e+=((r=(t=(t<<23|t>>>9)+i<<0)^i)^n)+s[1]-1530992060,n+=(r^(e=(e<<4|e>>>28)+t<<0))+s[4]+1272893353,i+=((o=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[7]-155497632,t+=(o^(i=(i<<16|i>>>16)+n<<0))+s[10]-1094730640,e+=((r=(t=(t<<23|t>>>9)+i<<0)^i)^n)+s[13]+681279174,n+=(r^(e=(e<<4|e>>>28)+t<<0))+s[0]-358537222,i+=((o=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[3]-722521979,t+=(o^(i=(i<<16|i>>>16)+n<<0))+s[6]+76029189,e+=((r=(t=(t<<23|t>>>9)+i<<0)^i)^n)+s[9]-640364487,n+=(r^(e=(e<<4|e>>>28)+t<<0))+s[12]-421815835,i+=((o=(n=(n<<11|n>>>21)+e<<0)^e)^t)+s[15]+530742520,t+=(o^(i=(i<<16|i>>>16)+n<<0))+s[2]-995338651,t=(t<<23|t>>>9)+i<<0,e+=(i^(t|~n))+s[0]-198630844,e=(e<<6|e>>>26)+t<<0,n+=(t^(e|~i))+s[7]+1126891415,n=(n<<10|n>>>22)+e<<0,i+=(e^(n|~t))+s[14]-1416354905,i=(i<<15|i>>>17)+n<<0,t+=(n^(i|~e))+s[5]-57434055,t=(t<<21|t>>>11)+i<<0,e+=(i^(t|~n))+s[12]+1700485571,e=(e<<6|e>>>26)+t<<0,n+=(t^(e|~i))+s[3]-1894986606,n=(n<<10|n>>>22)+e<<0,i+=(e^(n|~t))+s[10]-1051523,i=(i<<15|i>>>17)+n<<0,t+=(n^(i|~e))+s[1]-2054922799,t=(t<<21|t>>>11)+i<<0,e+=(i^(t|~n))+s[8]+1873313359,e=(e<<6|e>>>26)+t<<0,n+=(t^(e|~i))+s[15]-30611744,n=(n<<10|n>>>22)+e<<0,i+=(e^(n|~t))+s[6]-1560198380,i=(i<<15|i>>>17)+n<<0,t+=(n^(i|~e))+s[13]+1309151649,t=(t<<21|t>>>11)+i<<0,e+=(i^(t|~n))+s[4]-145523070,e=(e<<6|e>>>26)+t<<0,n+=(t^(e|~i))+s[11]-1120210379,n=(n<<10|n>>>22)+e<<0,i+=(e^(n|~t))+s[2]+718787259,i=(i<<15|i>>>17)+n<<0,t+=(n^(i|~e))+s[9]-343485551,t=(t<<21|t>>>11)+i<<0,this.first?(this.h0=e+1732584193<<0,this.h1=t-271733879<<0,this.h2=i-1732584194<<0,this.h3=n+271733878<<0,this.first=!1):(this.h0=this.h0+e<<0,this.h1=this.h1+t<<0,this.h2=this.h2+i<<0,this.h3=this.h3+n<<0)},Md5.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,n=this.h3;return HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]},Md5.prototype.toString=Md5.prototype.hex,Md5.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,i=this.h2,n=this.h3;return[255&e,e>>8&255,e>>16&255,e>>24&255,255&t,t>>8&255,t>>16&255,t>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255,255&n,n>>8&255,n>>16&255,n>>24&255]},Md5.prototype.array=Md5.prototype.digest,Md5.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(16),t=new Uint32Array(e);return t[0]=this.h0,t[1]=this.h1,t[2]=this.h2,t[3]=this.h3,e},Md5.prototype.buffer=Md5.prototype.arrayBuffer,Md5.prototype.base64=function(){for(var e,t,i,n="",r=this.array(),o=0;o<15;)e=r[o++],t=r[o++],i=r[o++],n+=BASE64_ENCODE_CHAR[e>>>2]+BASE64_ENCODE_CHAR[(e<<4|t>>>4)&63]+BASE64_ENCODE_CHAR[(t<<2|i>>>6)&63]+BASE64_ENCODE_CHAR[63&i];return n+=BASE64_ENCODE_CHAR[(e=r[o])>>>2]+BASE64_ENCODE_CHAR[e<<4&63]+"=="};var exports=createMethod();COMMON_JS?module.exports=exports:(root.md5=exports,AMD&&define(function(){return exports}))}()},358115:function(e,t,i){var n=i(502044).stringify,r=i(985101);e.exports=function(e){return{parse:r(e),stringify:n}},e.exports.parse=r(),e.exports.stringify=n},164321:function(e){function t(e,t){for(var i,n=-1,r=e.length;++n<r;){var o=t(e[n]);void 0!==o&&(i=void 0===i?o:i+o)}return i}e.exports=t},812736:function(e){!function(t,i){e.exports=i()}(0,function(){"use strict";var e={isEqual:!0,isMatchingKey:!0,isPromise:!0,maxSize:!0,onCacheAdd:!0,onCacheChange:!0,onCacheHit:!0,transformKey:!0},t=Array.prototype.slice;function i(e){var i=e.length;return i?1===i?[e[0]]:2===i?[e[0],e[1]]:3===i?[e[0],e[1],e[2]]:t.call(e,0):[]}function n(t){var i={};for(var n in t)!e[n]&&(i[n]=t[n]);return i}function r(e){return"function"==typeof e&&e.isMemoized}function o(e,t){return e===t||e!=e&&t!=t}function s(e,t){var i={};for(var n in e)i[n]=e[n];for(var n in t)i[n]=t[n];return i}var a=function(){function e(e){this.keys=[],this.values=[],this.options=e;var t="function"==typeof e.isMatchingKey;t?this.getKeyIndex=this._getKeyIndexFromMatchingKey:e.maxSize>1?this.getKeyIndex=this._getKeyIndexForMany:this.getKeyIndex=this._getKeyIndexForSingle,this.canTransformKey="function"==typeof e.transformKey,this.shouldCloneArguments=this.canTransformKey||t,this.shouldUpdateOnAdd="function"==typeof e.onCacheAdd,this.shouldUpdateOnChange="function"==typeof e.onCacheChange,this.shouldUpdateOnHit="function"==typeof e.onCacheHit}return Object.defineProperty(e.prototype,"size",{get:function(){return this.keys.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"snapshot",{get:function(){return{keys:i(this.keys),size:this.size,values:i(this.values)}},enumerable:!1,configurable:!0}),e.prototype._getKeyIndexFromMatchingKey=function(e){var t=this.options,i=t.isMatchingKey,n=t.maxSize,r=this.keys,o=r.length;if(!o)return -1;if(i(r[0],e))return 0;if(n>1){for(var s=1;s<o;s++)if(i(r[s],e))return s}return -1},e.prototype._getKeyIndexForMany=function(e){var t,i,n=this.options.isEqual,r=this.keys,o=r.length;if(!o)return -1;if(1===o)return this._getKeyIndexForSingle(e);var s=e.length;if(s>1){for(var a=0;a<o;a++)if((t=r[a]).length===s){for(i=0;i<s&&n(t[i],e[i]);i++);if(i===s)return a}}else for(var a=0;a<o;a++)if((t=r[a]).length===s&&n(t[0],e[0]))return a;return -1},e.prototype._getKeyIndexForSingle=function(e){var t=this.keys;if(!t.length)return -1;var i=t[0],n=i.length;if(e.length!==n)return -1;var r=this.options.isEqual;if(n>1){for(var o=0;o<n;o++)if(!r(i[o],e[o]))return -1;return 0}return r(i[0],e[0])?0:-1},e.prototype.orderByLru=function(e,t,i){for(var n=this.keys,r=this.values,o=n.length,s=i;s--;)n[s+1]=n[s],r[s+1]=r[s];n[0]=e,r[0]=t;var a=this.options.maxSize;o===a&&i===o?(n.pop(),r.pop()):i>=a&&(n.length=r.length=a)},e.prototype.updateAsyncCache=function(e){var t=this,i=this.options,n=i.onCacheChange,r=i.onCacheHit,o=this.keys[0],s=this.values[0];this.values[0]=s.then(function(i){return t.shouldUpdateOnHit&&r(t,t.options,e),t.shouldUpdateOnChange&&n(t,t.options,e),i},function(e){var i=t.getKeyIndex(o);throw -1!==i&&(t.keys.splice(i,1),t.values.splice(i,1)),e})},e}();function l(e,t){if(void 0===t&&(t={}),r(e))return l(e.fn,s(e.options,t));if("function"!=typeof e)throw TypeError("You must pass a function to `memoize`.");var d=t.isEqual,c=void 0===d?o:d,u=t.isMatchingKey,v=t.isPromise,h=void 0!==v&&v,f=t.maxSize,g=void 0===f?1:f,p=t.onCacheAdd,m=t.onCacheChange,y=t.onCacheHit,x=t.transformKey,I=s({isEqual:c,isMatchingKey:u,isPromise:h,maxSize:g,onCacheAdd:p,onCacheChange:m,onCacheHit:y,transformKey:x},n(t)),_=new a(I),b=_.keys,k=_.values,C=_.canTransformKey,S=_.shouldCloneArguments,w=_.shouldUpdateOnAdd,M=_.shouldUpdateOnChange,T=_.shouldUpdateOnHit,U=function(){var t=S?i(arguments):arguments;C&&(t=x(t));var n=b.length?_.getKeyIndex(t):-1;if(-1!==n)T&&y(_,I,U),n&&(_.orderByLru(b[n],k[n],n),M&&m(_,I,U));else{var r=e.apply(this,arguments),o=S?t:i(arguments);_.orderByLru(o,r,b.length),h&&_.updateAsyncCache(U),w&&p(_,I,U),M&&m(_,I,U)}return k[0]};return U.cache=_,U.fn=e,U.isMemoized=!0,U.options=I,U}return l})}}]);